var Tn=Object.defineProperty,$n=Object.defineProperties;var In=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var Gs=Object.prototype.hasOwnProperty,Zs=Object.prototype.propertyIsEnumerable;var Je=(t,r)=>(r=Symbol[t])?r:Symbol.for("Symbol."+t),Bn=t=>{throw TypeError(t)};var Xs=(t,r,n)=>r in t?Tn(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,q=(t,r)=>{for(var n in r||(r={}))Gs.call(r,n)&&Xs(t,n,r[n]);if(At)for(var n of At(r))Zs.call(r,n)&&Xs(t,n,r[n]);return t},ee=(t,r)=>$n(t,In(r));var rs=(t,r)=>{var n={};for(var s in t)Gs.call(t,s)&&r.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&At)for(var s of At(t))r.indexOf(s)<0&&Zs.call(t,s)&&(n[s]=t[s]);return n};var Un=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var X=(t,r,n)=>new Promise((s,a)=>{var c=l=>{try{u(n.next(l))}catch(i){a(i)}},o=l=>{try{u(n.throw(l))}catch(i){a(i)}},u=l=>l.done?s(l.value):Promise.resolve(l.value).then(c,o);u((n=n.apply(t,r)).next())}),$e=function(t,r){this[0]=t,this[1]=r},ns=(t,r,n)=>{var s=(o,u,l,i)=>{try{var d=n[o](u),m=(u=d.value)instanceof $e,p=d.done;Promise.resolve(m?u[0]:u).then(w=>m?s(o==="return"?o:"next",u[1]?{done:w.done,value:w.value}:w,l,i):l({value:w,done:p})).catch(w=>s("throw",w,l,i))}catch(w){i(w)}},a=o=>c[o]=u=>new Promise((l,i)=>s(o,u,l,i)),c={};return n=n.apply(t,r),c[Je("asyncIterator")]=()=>c,a("next"),a("throw"),a("return"),c},as=t=>{var r=t[Je("asyncIterator")],n=!1,s,a={};return r==null?(r=t[Je("iterator")](),s=c=>a[c]=o=>r[c](o)):(r=r.call(t),s=c=>a[c]=o=>{if(n){if(n=!1,c==="throw")throw o;return o}return n=!0,{done:!1,value:new $e(new Promise(u=>{var l=r[c](o);l instanceof Object||Bn("Object expected"),u(l)}),1)}}),a[Je("iterator")]=()=>a,s("next"),"throw"in r?s("throw"):a.throw=c=>{throw c},"return"in r&&s("return"),a},er=(t,r,n)=>(r=t[Je("asyncIterator")])?r.call(t):(t=t[Je("iterator")](),r={},n=(s,a)=>(a=t[s])&&(r[s]=c=>new Promise((o,u,l)=>(c=a.call(t,c),l=c.done,Promise.resolve(c.value).then(i=>o({value:i,done:l}),u)))),n("next"),n("return"),r);import{j as e}from"./mui-pHrinNmD.js";import{a as Yn,c as vr,g as Nr,r as f,u as hs,L as zn,b as Ge,d as Hn,e as Wn,R as ht,f as qn,h as De,B as Vn}from"./vendor-0kNZJvhf.js";var eo=Un(Pe=>{(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();var cs={},tr=Yn;cs.createRoot=tr.createRoot,cs.hydrateRoot=tr.hydrateRoot;var wr={exports:{}};(function(t,r){(function(n,s){t.exports=s()})(vr,function(){var n=1e3,s=6e4,a=36e5,c="millisecond",o="second",u="minute",l="hour",i="day",d="week",m="month",p="quarter",w="year",h="date",N="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,I={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(D){var g=["th","st","nd","rd"],C=D%100;return"["+D+(g[(C-20)%10]||g[C]||g[0])+"]"}},v=function(D,g,C){var _=String(D);return!_||_.length>=g?D:""+Array(g+1-_.length).join(C)+D},k={s:v,z:function(D){var g=-D.utcOffset(),C=Math.abs(g),_=Math.floor(C/60),R=C%60;return(g<=0?"+":"-")+v(_,2,"0")+":"+v(R,2,"0")},m:function D(g,C){if(g.date()<C.date())return-D(C,g);var _=12*(C.year()-g.year())+(C.month()-g.month()),R=g.clone().add(_,m),B=C-R<0,V=g.clone().add(_+(B?-1:1),m);return+(-(_+(C-R)/(B?R-V:V-R))||0)},a:function(D){return D<0?Math.ceil(D)||0:Math.floor(D)},p:function(D){return{M:m,y:w,w:d,d:i,D:h,h:l,m:u,s:o,ms:c,Q:p}[D]||String(D||"").toLowerCase().replace(/s$/,"")},u:function(D){return D===void 0}},F="en",M={};M[F]=I;var W="$isDayjsObject",oe=function(D){return D instanceof T||!(!D||!D[W])},L=function D(g,C,_){var R;if(!g)return F;if(typeof g=="string"){var B=g.toLowerCase();M[B]&&(R=B),C&&(M[B]=C,R=B);var V=g.split("-");if(!R&&V.length>1)return D(V[0])}else{var S=g.name;M[S]=g,R=S}return!_&&R&&(F=R),R||!_&&F},Y=function(D,g){if(oe(D))return D.clone();var C=typeof g=="object"?g:{};return C.date=D,C.args=arguments,new T(C)},H=k;H.l=L,H.i=oe,H.w=function(D,g){return Y(D,{locale:g.$L,utc:g.$u,x:g.$x,$offset:g.$offset})};var T=function(){function D(C){this.$L=L(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[W]=!0}var g=D.prototype;return g.parse=function(C){this.$d=function(_){var R=_.date,B=_.utc;if(R===null)return new Date(NaN);if(H.u(R))return new Date;if(R instanceof Date)return new Date(R);if(typeof R=="string"&&!/Z$/i.test(R)){var V=R.match(b);if(V){var S=V[2]-1||0,Q=(V[7]||"0").substring(0,3);return B?new Date(Date.UTC(V[1],S,V[3]||1,V[4]||0,V[5]||0,V[6]||0,Q)):new Date(V[1],S,V[3]||1,V[4]||0,V[5]||0,V[6]||0,Q)}}return new Date(R)}(C),this.init()},g.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},g.$utils=function(){return H},g.isValid=function(){return this.$d.toString()!==N},g.isSame=function(C,_){var R=Y(C);return this.startOf(_)<=R&&R<=this.endOf(_)},g.isAfter=function(C,_){return Y(C)<this.startOf(_)},g.isBefore=function(C,_){return this.endOf(_)<Y(C)},g.$g=function(C,_,R){return H.u(C)?this[_]:this.set(R,C)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(C,_){var R=this,B=!!H.u(_)||_,V=H.p(C),S=function(be,Ne){var Z=H.w(R.$u?Date.UTC(R.$y,Ne,be):new Date(R.$y,Ne,be),R);return B?Z:Z.endOf(i)},Q=function(be,Ne){return H.w(R.toDate()[be].apply(R.toDate("s"),(B?[0,0,0,0]:[23,59,59,999]).slice(Ne)),R)},se=this.$W,$=this.$M,re=this.$D,E="set"+(this.$u?"UTC":"");switch(V){case w:return B?S(1,0):S(31,11);case m:return B?S(1,$):S(0,$+1);case d:var ie=this.$locale().weekStart||0,ce=(se<ie?se+7:se)-ie;return S(B?re-ce:re+(6-ce),$);case i:case h:return Q(E+"Hours",0);case l:return Q(E+"Minutes",1);case u:return Q(E+"Seconds",2);case o:return Q(E+"Milliseconds",3);default:return this.clone()}},g.endOf=function(C){return this.startOf(C,!1)},g.$set=function(C,_){var R,B=H.p(C),V="set"+(this.$u?"UTC":""),S=(R={},R[i]=V+"Date",R[h]=V+"Date",R[m]=V+"Month",R[w]=V+"FullYear",R[l]=V+"Hours",R[u]=V+"Minutes",R[o]=V+"Seconds",R[c]=V+"Milliseconds",R)[B],Q=B===i?this.$D+(_-this.$W):_;if(B===m||B===w){var se=this.clone().set(h,1);se.$d[S](Q),se.init(),this.$d=se.set(h,Math.min(this.$D,se.daysInMonth())).$d}else S&&this.$d[S](Q);return this.init(),this},g.set=function(C,_){return this.clone().$set(C,_)},g.get=function(C){return this[H.p(C)]()},g.add=function(C,_){var R,B=this;C=Number(C);var V=H.p(_),S=function($){var re=Y(B);return H.w(re.date(re.date()+Math.round($*C)),B)};if(V===m)return this.set(m,this.$M+C);if(V===w)return this.set(w,this.$y+C);if(V===i)return S(1);if(V===d)return S(7);var Q=(R={},R[u]=s,R[l]=a,R[o]=n,R)[V]||1,se=this.$d.getTime()+C*Q;return H.w(se,this)},g.subtract=function(C,_){return this.add(-1*C,_)},g.format=function(C){var _=this,R=this.$locale();if(!this.isValid())return R.invalidDate||N;var B=C||"YYYY-MM-DDTHH:mm:ssZ",V=H.z(this),S=this.$H,Q=this.$m,se=this.$M,$=R.weekdays,re=R.months,E=R.meridiem,ie=function(Ne,Z,ae,z){return Ne&&(Ne[Z]||Ne(_,B))||ae[Z].slice(0,z)},ce=function(Ne){return H.s(S%12||12,Ne,"0")},be=E||function(Ne,Z,ae){var z=Ne<12?"AM":"PM";return ae?z.toLowerCase():z};return B.replace(y,function(Ne,Z){return Z||function(ae){switch(ae){case"YY":return String(_.$y).slice(-2);case"YYYY":return H.s(_.$y,4,"0");case"M":return se+1;case"MM":return H.s(se+1,2,"0");case"MMM":return ie(R.monthsShort,se,re,3);case"MMMM":return ie(re,se);case"D":return _.$D;case"DD":return H.s(_.$D,2,"0");case"d":return String(_.$W);case"dd":return ie(R.weekdaysMin,_.$W,$,2);case"ddd":return ie(R.weekdaysShort,_.$W,$,3);case"dddd":return $[_.$W];case"H":return String(S);case"HH":return H.s(S,2,"0");case"h":return ce(1);case"hh":return ce(2);case"a":return be(S,Q,!0);case"A":return be(S,Q,!1);case"m":return String(Q);case"mm":return H.s(Q,2,"0");case"s":return String(_.$s);case"ss":return H.s(_.$s,2,"0");case"SSS":return H.s(_.$ms,3,"0");case"Z":return V}return null}(Ne)||V.replace(":","")})},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(C,_,R){var B,V=this,S=H.p(_),Q=Y(C),se=(Q.utcOffset()-this.utcOffset())*s,$=this-Q,re=function(){return H.m(V,Q)};switch(S){case w:B=re()/12;break;case m:B=re();break;case p:B=re()/3;break;case d:B=($-se)/6048e5;break;case i:B=($-se)/864e5;break;case l:B=$/a;break;case u:B=$/s;break;case o:B=$/n;break;default:B=$}return R?B:H.a(B)},g.daysInMonth=function(){return this.endOf(m).$D},g.$locale=function(){return M[this.$L]},g.locale=function(C,_){if(!C)return this.$L;var R=this.clone(),B=L(C,_,!0);return B&&(R.$L=B),R},g.clone=function(){return H.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},D}(),G=T.prototype;return Y.prototype=G,[["$ms",c],["$s",o],["$m",u],["$H",l],["$W",i],["$M",m],["$y",w],["$D",h]].forEach(function(D){G[D[1]]=function(g){return this.$g(g,D[0],D[1])}}),Y.extend=function(D,g){return D.$i||(D(g,T,Y),D.$i=!0),Y},Y.locale=L,Y.isDayjs=oe,Y.unix=function(D){return Y(1e3*D)},Y.en=M[F],Y.Ls=M,Y.p={},Y})})(wr);var Kn=wr.exports;const P=Nr(Kn);function Cr(t,r){return function(){return t.apply(r,arguments)}}const{toString:Jn}=Object.prototype,{getPrototypeOf:ps}=Object,{iterator:It,toStringTag:kr}=Symbol,Bt=(t=>r=>{const n=Jn.call(r);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Fe=t=>(t=t.toLowerCase(),r=>Bt(r)===t),Ut=t=>r=>typeof r===t,{isArray:Ze}=Array,Xe=Ut("undefined");function ft(t){return t!==null&&!Xe(t)&&t.constructor!==null&&!Xe(t.constructor)&&ke(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const _r=Fe("ArrayBuffer");function Qn(t){let r;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?r=ArrayBuffer.isView(t):r=t&&t.buffer&&_r(t.buffer),r}const Xn=Ut("string"),ke=Ut("function"),Sr=Ut("number"),bt=t=>t!==null&&typeof t=="object",Gn=t=>t===!0||t===!1,Lt=t=>{if(Bt(t)!=="object")return!1;const r=ps(t);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(kr in t)&&!(It in t)},Zn=t=>{if(!bt(t)||ft(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch(r){return!1}},ea=Fe("Date"),ta=Fe("File"),sa=Fe("Blob"),ra=Fe("FileList"),na=t=>bt(t)&&ke(t.pipe),aa=t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||ke(t.append)&&((r=Bt(t))==="formdata"||r==="object"&&ke(t.toString)&&t.toString()==="[object FormData]"))},ia=Fe("URLSearchParams"),[oa,la,ca,da]=["ReadableStream","Request","Response","Headers"].map(Fe),ma=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function gt(t,r,{allOwnKeys:n=!1}={}){if(t===null||typeof t=="undefined")return;let s,a;if(typeof t!="object"&&(t=[t]),Ze(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{if(ft(t))return;const c=n?Object.getOwnPropertyNames(t):Object.keys(t),o=c.length;let u;for(s=0;s<o;s++)u=c[s],r.call(null,t[u],u,t)}}function Mr(t,r){if(ft(t))return null;r=r.toLowerCase();const n=Object.keys(t);let s=n.length,a;for(;s-- >0;)if(a=n[s],r===a.toLowerCase())return a;return null}const Ye=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,Er=t=>!Xe(t)&&t!==Ye;function ds(){const{caseless:t,skipUndefined:r}=Er(this)&&this||{},n={},s=(a,c)=>{const o=t&&Mr(n,c)||c;Lt(n[o])&&Lt(a)?n[o]=ds(n[o],a):Lt(a)?n[o]=ds({},a):Ze(a)?n[o]=a.slice():(!r||!Xe(a))&&(n[o]=a)};for(let a=0,c=arguments.length;a<c;a++)arguments[a]&&gt(arguments[a],s);return n}const ua=(t,r,n,{allOwnKeys:s}={})=>(gt(r,(a,c)=>{n&&ke(a)?t[c]=Cr(a,n):t[c]=a},{allOwnKeys:s}),t),xa=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ha=(t,r,n,s)=>{t.prototype=Object.create(r.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),n&&Object.assign(t.prototype,n)},pa=(t,r,n,s)=>{let a,c,o;const u={};if(r=r||{},t==null)return r;do{for(a=Object.getOwnPropertyNames(t),c=a.length;c-- >0;)o=a[c],(!s||s(o,t,r))&&!u[o]&&(r[o]=t[o],u[o]=!0);t=n!==!1&&ps(t)}while(t&&(!n||n(t,r))&&t!==Object.prototype);return r},fa=(t,r,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=r.length;const s=t.indexOf(r,n);return s!==-1&&s===n},ba=t=>{if(!t)return null;if(Ze(t))return t;let r=t.length;if(!Sr(r))return null;const n=new Array(r);for(;r-- >0;)n[r]=t[r];return n},ga=(t=>r=>t&&r instanceof t)(typeof Uint8Array!="undefined"&&ps(Uint8Array)),ya=(t,r)=>{const s=(t&&t[It]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},ja=(t,r)=>{let n;const s=[];for(;(n=t.exec(r))!==null;)s.push(n);return s},va=Fe("HTMLFormElement"),Na=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,a){return s.toUpperCase()+a}),sr=(({hasOwnProperty:t})=>(r,n)=>t.call(r,n))(Object.prototype),wa=Fe("RegExp"),Rr=(t,r)=>{const n=Object.getOwnPropertyDescriptors(t),s={};gt(n,(a,c)=>{let o;(o=r(a,c,t))!==!1&&(s[c]=o||a)}),Object.defineProperties(t,s)},Ca=t=>{Rr(t,(r,n)=>{if(ke(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(ke(s)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},ka=(t,r)=>{const n={},s=a=>{a.forEach(c=>{n[c]=!0})};return Ze(t)?s(t):s(String(t).split(r)),n},_a=()=>{},Sa=(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r;function Ma(t){return!!(t&&ke(t.append)&&t[kr]==="FormData"&&t[It])}const Ea=t=>{const r=new Array(10),n=(s,a)=>{if(bt(s)){if(r.indexOf(s)>=0)return;if(ft(s))return s;if(!("toJSON"in s)){r[a]=s;const c=Ze(s)?[]:{};return gt(s,(o,u)=>{const l=n(o,a+1);!Xe(l)&&(c[u]=l)}),r[a]=void 0,c}}return s};return n(t,0)},Ra=Fe("AsyncFunction"),Aa=t=>t&&(bt(t)||ke(t))&&ke(t.then)&&ke(t.catch),Ar=((t,r)=>t?setImmediate:r?((n,s)=>(Ye.addEventListener("message",({source:a,data:c})=>{a===Ye&&c===n&&s.length&&s.shift()()},!1),a=>{s.push(a),Ye.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",ke(Ye.postMessage)),Fa=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Ye):typeof process!="undefined"&&process.nextTick||Ar,La=t=>t!=null&&ke(t[It]),j={isArray:Ze,isArrayBuffer:_r,isBuffer:ft,isFormData:aa,isArrayBufferView:Qn,isString:Xn,isNumber:Sr,isBoolean:Gn,isObject:bt,isPlainObject:Lt,isEmptyObject:Zn,isReadableStream:oa,isRequest:la,isResponse:ca,isHeaders:da,isUndefined:Xe,isDate:ea,isFile:ta,isBlob:sa,isRegExp:wa,isFunction:ke,isStream:na,isURLSearchParams:ia,isTypedArray:ga,isFileList:ra,forEach:gt,merge:ds,extend:ua,trim:ma,stripBOM:xa,inherits:ha,toFlatObject:pa,kindOf:Bt,kindOfTest:Fe,endsWith:fa,toArray:ba,forEachEntry:ya,matchAll:ja,isHTMLForm:va,hasOwnProperty:sr,hasOwnProp:sr,reduceDescriptors:Rr,freezeMethods:Ca,toObjectSet:ka,toCamelCase:Na,noop:_a,toFiniteNumber:Sa,findKey:Mr,global:Ye,isContextDefined:Er,isSpecCompliantForm:Ma,toJSONObject:Ea,isAsyncFn:Ra,isThenable:Aa,setImmediate:Ar,asap:Fa,isIterable:La};function ne(t,r,n,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),n&&(this.config=n),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}j.inherits(ne,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}});const Fr=ne.prototype,Lr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Lr[t]={value:t}});Object.defineProperties(ne,Lr);Object.defineProperty(Fr,"isAxiosError",{value:!0});ne.from=(t,r,n,s,a,c)=>{const o=Object.create(Fr);j.toFlatObject(t,o,function(d){return d!==Error.prototype},i=>i!=="isAxiosError");const u=t&&t.message?t.message:"Error",l=r==null&&t?t.code:r;return ne.call(o,u,l,n,s,a),t&&o.cause==null&&Object.defineProperty(o,"cause",{value:t,configurable:!0}),o.name=t&&t.name||"Error",c&&Object.assign(o,c),o};const Oa=null;function ms(t){return j.isPlainObject(t)||j.isArray(t)}function Or(t){return j.endsWith(t,"[]")?t.slice(0,-2):t}function rr(t,r,n){return t?t.concat(r).map(function(a,c){return a=Or(a),!n&&c?"["+a+"]":a}).join(n?".":""):r}function Da(t){return j.isArray(t)&&!t.some(ms)}const Pa=j.toFlatObject(j,{},null,function(r){return/^is[A-Z]/.test(r)});function Yt(t,r,n){if(!j.isObject(t))throw new TypeError("target must be an object");r=r||new FormData,n=j.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(N,b){return!j.isUndefined(b[N])});const s=n.metaTokens,a=n.visitor||d,c=n.dots,o=n.indexes,l=(n.Blob||typeof Blob!="undefined"&&Blob)&&j.isSpecCompliantForm(r);if(!j.isFunction(a))throw new TypeError("visitor must be a function");function i(h){if(h===null)return"";if(j.isDate(h))return h.toISOString();if(j.isBoolean(h))return h.toString();if(!l&&j.isBlob(h))throw new ne("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(h)||j.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function d(h,N,b){let y=h;if(h&&!b&&typeof h=="object"){if(j.endsWith(N,"{}"))N=s?N:N.slice(0,-2),h=JSON.stringify(h);else if(j.isArray(h)&&Da(h)||(j.isFileList(h)||j.endsWith(N,"[]"))&&(y=j.toArray(h)))return N=Or(N),y.forEach(function(v,k){!(j.isUndefined(v)||v===null)&&r.append(o===!0?rr([N],k,c):o===null?N:N+"[]",i(v))}),!1}return ms(h)?!0:(r.append(rr(b,N,c),i(h)),!1)}const m=[],p=Object.assign(Pa,{defaultVisitor:d,convertValue:i,isVisitable:ms});function w(h,N){if(!j.isUndefined(h)){if(m.indexOf(h)!==-1)throw Error("Circular reference detected in "+N.join("."));m.push(h),j.forEach(h,function(y,I){(!(j.isUndefined(y)||y===null)&&a.call(r,y,j.isString(I)?I.trim():I,N,p))===!0&&w(y,N?N.concat(I):[I])}),m.pop()}}if(!j.isObject(t))throw new TypeError("data must be an object");return w(t),r}function nr(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function fs(t,r){this._pairs=[],t&&Yt(t,this,r)}const Dr=fs.prototype;Dr.append=function(r,n){this._pairs.push([r,n])};Dr.toString=function(r){const n=r?function(s){return r.call(this,s,nr)}:nr;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Ta(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Pr(t,r,n){if(!r)return t;const s=n&&n.encode||Ta;j.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let c;if(a?c=a(r,n):c=j.isURLSearchParams(r)?r.toString():new fs(r,n).toString(s),c){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+c}return t}class ar{constructor(){this.handlers=[]}use(r,n,s){return this.handlers.push({fulfilled:r,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){j.forEach(this.handlers,function(s){s!==null&&r(s)})}}const Tr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$a=typeof URLSearchParams!="undefined"?URLSearchParams:fs,Ia=typeof FormData!="undefined"?FormData:null,Ba=typeof Blob!="undefined"?Blob:null,Ua={isBrowser:!0,classes:{URLSearchParams:$a,FormData:Ia,Blob:Ba},protocols:["http","https","file","blob","url","data"]},bs=typeof window!="undefined"&&typeof document!="undefined",us=typeof navigator=="object"&&navigator||void 0,Ya=bs&&(!us||["ReactNative","NativeScript","NS"].indexOf(us.product)<0),za=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ha=bs&&window.location.href||"http://localhost",Wa=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:bs,hasStandardBrowserEnv:Ya,hasStandardBrowserWebWorkerEnv:za,navigator:us,origin:Ha},Symbol.toStringTag,{value:"Module"})),Ce=q(q({},Wa),Ua);function qa(t,r){return Yt(t,new Ce.classes.URLSearchParams,q({visitor:function(n,s,a,c){return Ce.isNode&&j.isBuffer(n)?(this.append(s,n.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)}},r))}function Va(t){return j.matchAll(/\w+|\[(\w*)]/g,t).map(r=>r[0]==="[]"?"":r[1]||r[0])}function Ka(t){const r={},n=Object.keys(t);let s;const a=n.length;let c;for(s=0;s<a;s++)c=n[s],r[c]=t[c];return r}function $r(t){function r(n,s,a,c){let o=n[c++];if(o==="__proto__")return!0;const u=Number.isFinite(+o),l=c>=n.length;return o=!o&&j.isArray(a)?a.length:o,l?(j.hasOwnProp(a,o)?a[o]=[a[o],s]:a[o]=s,!u):((!a[o]||!j.isObject(a[o]))&&(a[o]=[]),r(n,s,a[o],c)&&j.isArray(a[o])&&(a[o]=Ka(a[o])),!u)}if(j.isFormData(t)&&j.isFunction(t.entries)){const n={};return j.forEachEntry(t,(s,a)=>{r(Va(s),a,n,0)}),n}return null}function Ja(t,r,n){if(j.isString(t))try{return(r||JSON.parse)(t),j.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const yt={transitional:Tr,adapter:["xhr","http","fetch"],transformRequest:[function(r,n){const s=n.getContentType()||"",a=s.indexOf("application/json")>-1,c=j.isObject(r);if(c&&j.isHTMLForm(r)&&(r=new FormData(r)),j.isFormData(r))return a?JSON.stringify($r(r)):r;if(j.isArrayBuffer(r)||j.isBuffer(r)||j.isStream(r)||j.isFile(r)||j.isBlob(r)||j.isReadableStream(r))return r;if(j.isArrayBufferView(r))return r.buffer;if(j.isURLSearchParams(r))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return qa(r,this.formSerializer).toString();if((u=j.isFileList(r))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Yt(u?{"files[]":r}:r,l&&new l,this.formSerializer)}}return c||a?(n.setContentType("application/json",!1),Ja(r)):r}],transformResponse:[function(r){const n=this.transitional||yt.transitional,s=n&&n.forcedJSONParsing,a=this.responseType==="json";if(j.isResponse(r)||j.isReadableStream(r))return r;if(r&&j.isString(r)&&(s&&!this.responseType||a)){const o=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(r,this.parseReviver)}catch(u){if(o)throw u.name==="SyntaxError"?ne.from(u,ne.ERR_BAD_RESPONSE,this,null,this.response):u}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ce.classes.FormData,Blob:Ce.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],t=>{yt.headers[t]={}});const Qa=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xa=t=>{const r={};let n,s,a;return t&&t.split(`
`).forEach(function(o){a=o.indexOf(":"),n=o.substring(0,a).trim().toLowerCase(),s=o.substring(a+1).trim(),!(!n||r[n]&&Qa[n])&&(n==="set-cookie"?r[n]?r[n].push(s):r[n]=[s]:r[n]=r[n]?r[n]+", "+s:s)}),r},ir=Symbol("internals");function xt(t){return t&&String(t).trim().toLowerCase()}function Ot(t){return t===!1||t==null?t:j.isArray(t)?t.map(Ot):String(t)}function Ga(t){const r=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)r[s[1]]=s[2];return r}const Za=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function is(t,r,n,s,a){if(j.isFunction(s))return s.call(this,r,n);if(a&&(r=n),!!j.isString(r)){if(j.isString(s))return r.indexOf(s)!==-1;if(j.isRegExp(s))return s.test(r)}}function ei(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,n,s)=>n.toUpperCase()+s)}function ti(t,r){const n=j.toCamelCase(" "+r);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(a,c,o){return this[s].call(this,r,a,c,o)},configurable:!0})})}let _e=class{constructor(r){r&&this.set(r)}set(r,n,s){const a=this;function c(u,l,i){const d=xt(l);if(!d)throw new Error("header name must be a non-empty string");const m=j.findKey(a,d);(!m||a[m]===void 0||i===!0||i===void 0&&a[m]!==!1)&&(a[m||l]=Ot(u))}const o=(u,l)=>j.forEach(u,(i,d)=>c(i,d,l));if(j.isPlainObject(r)||r instanceof this.constructor)o(r,n);else if(j.isString(r)&&(r=r.trim())&&!Za(r))o(Xa(r),n);else if(j.isObject(r)&&j.isIterable(r)){let u={},l,i;for(const d of r){if(!j.isArray(d))throw TypeError("Object iterator must return a key-value pair");u[i=d[0]]=(l=u[i])?j.isArray(l)?[...l,d[1]]:[l,d[1]]:d[1]}o(u,n)}else r!=null&&c(n,r,s);return this}get(r,n){if(r=xt(r),r){const s=j.findKey(this,r);if(s){const a=this[s];if(!n)return a;if(n===!0)return Ga(a);if(j.isFunction(n))return n.call(this,a,s);if(j.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,n){if(r=xt(r),r){const s=j.findKey(this,r);return!!(s&&this[s]!==void 0&&(!n||is(this,this[s],s,n)))}return!1}delete(r,n){const s=this;let a=!1;function c(o){if(o=xt(o),o){const u=j.findKey(s,o);u&&(!n||is(s,s[u],u,n))&&(delete s[u],a=!0)}}return j.isArray(r)?r.forEach(c):c(r),a}clear(r){const n=Object.keys(this);let s=n.length,a=!1;for(;s--;){const c=n[s];(!r||is(this,this[c],c,r,!0))&&(delete this[c],a=!0)}return a}normalize(r){const n=this,s={};return j.forEach(this,(a,c)=>{const o=j.findKey(s,c);if(o){n[o]=Ot(a),delete n[c];return}const u=r?ei(c):String(c).trim();u!==c&&delete n[c],n[u]=Ot(a),s[u]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const n=Object.create(null);return j.forEach(this,(s,a)=>{s!=null&&s!==!1&&(n[a]=r&&j.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,n])=>r+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...n){const s=new this(r);return n.forEach(a=>s.set(a)),s}static accessor(r){const s=(this[ir]=this[ir]={accessors:{}}).accessors,a=this.prototype;function c(o){const u=xt(o);s[u]||(ti(a,o),s[u]=!0)}return j.isArray(r)?r.forEach(c):c(r),this}};_e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(_e.prototype,({value:t},r)=>{let n=r[0].toUpperCase()+r.slice(1);return{get:()=>t,set(s){this[n]=s}}});j.freezeMethods(_e);function os(t,r){const n=this||yt,s=r||n,a=_e.from(s.headers);let c=s.data;return j.forEach(t,function(u){c=u.call(n,c,a.normalize(),r?r.status:void 0)}),a.normalize(),c}function Ir(t){return!!(t&&t.__CANCEL__)}function et(t,r,n){ne.call(this,t==null?"canceled":t,ne.ERR_CANCELED,r,n),this.name="CanceledError"}j.inherits(et,ne,{__CANCEL__:!0});function Br(t,r,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):r(new ne("Request failed with status code "+n.status,[ne.ERR_BAD_REQUEST,ne.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function si(t){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return r&&r[1]||""}function ri(t,r){t=t||10;const n=new Array(t),s=new Array(t);let a=0,c=0,o;return r=r!==void 0?r:1e3,function(l){const i=Date.now(),d=s[c];o||(o=i),n[a]=l,s[a]=i;let m=c,p=0;for(;m!==a;)p+=n[m++],m=m%t;if(a=(a+1)%t,a===c&&(c=(c+1)%t),i-o<r)return;const w=d&&i-d;return w?Math.round(p*1e3/w):void 0}}function ni(t,r){let n=0,s=1e3/r,a,c;const o=(i,d=Date.now())=>{n=d,a=null,c&&(clearTimeout(c),c=null),t(...i)};return[(...i)=>{const d=Date.now(),m=d-n;m>=s?o(i,d):(a=i,c||(c=setTimeout(()=>{c=null,o(a)},s-m)))},()=>a&&o(a)]}const Pt=(t,r,n=3)=>{let s=0;const a=ri(50,250);return ni(c=>{const o=c.loaded,u=c.lengthComputable?c.total:void 0,l=o-s,i=a(l),d=o<=u;s=o;const m={loaded:o,total:u,progress:u?o/u:void 0,bytes:l,rate:i||void 0,estimated:i&&u&&d?(u-o)/i:void 0,event:c,lengthComputable:u!=null,[r?"download":"upload"]:!0};t(m)},n)},or=(t,r)=>{const n=t!=null;return[s=>r[0]({lengthComputable:n,total:t,loaded:s}),r[1]]},lr=t=>(...r)=>j.asap(()=>t(...r)),ai=Ce.hasStandardBrowserEnv?((t,r)=>n=>(n=new URL(n,Ce.origin),t.protocol===n.protocol&&t.host===n.host&&(r||t.port===n.port)))(new URL(Ce.origin),Ce.navigator&&/(msie|trident)/i.test(Ce.navigator.userAgent)):()=>!0,ii=Ce.hasStandardBrowserEnv?{write(t,r,n,s,a,c,o){if(typeof document=="undefined")return;const u=[`${t}=${encodeURIComponent(r)}`];j.isNumber(n)&&u.push(`expires=${new Date(n).toUTCString()}`),j.isString(s)&&u.push(`path=${s}`),j.isString(a)&&u.push(`domain=${a}`),c===!0&&u.push("secure"),j.isString(o)&&u.push(`SameSite=${o}`),document.cookie=u.join("; ")},read(t){if(typeof document=="undefined")return null;const r=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return r?decodeURIComponent(r[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function oi(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function li(t,r){return r?t.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):t}function Ur(t,r,n){let s=!oi(r);return t&&(s||n==!1)?li(t,r):r}const cr=t=>t instanceof _e?q({},t):t;function He(t,r){r=r||{};const n={};function s(i,d,m,p){return j.isPlainObject(i)&&j.isPlainObject(d)?j.merge.call({caseless:p},i,d):j.isPlainObject(d)?j.merge({},d):j.isArray(d)?d.slice():d}function a(i,d,m,p){if(j.isUndefined(d)){if(!j.isUndefined(i))return s(void 0,i,m,p)}else return s(i,d,m,p)}function c(i,d){if(!j.isUndefined(d))return s(void 0,d)}function o(i,d){if(j.isUndefined(d)){if(!j.isUndefined(i))return s(void 0,i)}else return s(void 0,d)}function u(i,d,m){if(m in r)return s(i,d);if(m in t)return s(void 0,i)}const l={url:c,method:c,data:c,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u,headers:(i,d,m)=>a(cr(i),cr(d),m,!0)};return j.forEach(Object.keys(q(q({},t),r)),function(d){const m=l[d]||a,p=m(t[d],r[d],d);j.isUndefined(p)&&m!==u||(n[d]=p)}),n}const Yr=t=>{const r=He({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:c,headers:o,auth:u}=r;if(r.headers=o=_e.from(o),r.url=Pr(Ur(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),u&&o.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),j.isFormData(n)){if(Ce.hasStandardBrowserEnv||Ce.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(j.isFunction(n.getHeaders)){const l=n.getHeaders(),i=["content-type","content-length"];Object.entries(l).forEach(([d,m])=>{i.includes(d.toLowerCase())&&o.set(d,m)})}}if(Ce.hasStandardBrowserEnv&&(s&&j.isFunction(s)&&(s=s(r)),s||s!==!1&&ai(r.url))){const l=a&&c&&ii.read(c);l&&o.set(a,l)}return r},ci=typeof XMLHttpRequest!="undefined",di=ci&&function(t){return new Promise(function(n,s){const a=Yr(t);let c=a.data;const o=_e.from(a.headers).normalize();let{responseType:u,onUploadProgress:l,onDownloadProgress:i}=a,d,m,p,w,h;function N(){w&&w(),h&&h(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let b=new XMLHttpRequest;b.open(a.method.toUpperCase(),a.url,!0),b.timeout=a.timeout;function y(){if(!b)return;const v=_e.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),F={data:!u||u==="text"||u==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:v,config:t,request:b};Br(function(W){n(W),N()},function(W){s(W),N()},F),b=null}"onloadend"in b?b.onloadend=y:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(y)},b.onabort=function(){b&&(s(new ne("Request aborted",ne.ECONNABORTED,t,b)),b=null)},b.onerror=function(k){const F=k&&k.message?k.message:"Network Error",M=new ne(F,ne.ERR_NETWORK,t,b);M.event=k||null,s(M),b=null},b.ontimeout=function(){let k=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const F=a.transitional||Tr;a.timeoutErrorMessage&&(k=a.timeoutErrorMessage),s(new ne(k,F.clarifyTimeoutError?ne.ETIMEDOUT:ne.ECONNABORTED,t,b)),b=null},c===void 0&&o.setContentType(null),"setRequestHeader"in b&&j.forEach(o.toJSON(),function(k,F){b.setRequestHeader(F,k)}),j.isUndefined(a.withCredentials)||(b.withCredentials=!!a.withCredentials),u&&u!=="json"&&(b.responseType=a.responseType),i&&([p,h]=Pt(i,!0),b.addEventListener("progress",p)),l&&b.upload&&([m,w]=Pt(l),b.upload.addEventListener("progress",m),b.upload.addEventListener("loadend",w)),(a.cancelToken||a.signal)&&(d=v=>{b&&(s(!v||v.type?new et(null,t,b):v),b.abort(),b=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const I=si(a.url);if(I&&Ce.protocols.indexOf(I)===-1){s(new ne("Unsupported protocol "+I+":",ne.ERR_BAD_REQUEST,t));return}b.send(c||null)})},mi=(t,r)=>{const{length:n}=t=t?t.filter(Boolean):[];if(r||n){let s=new AbortController,a;const c=function(i){if(!a){a=!0,u();const d=i instanceof Error?i:this.reason;s.abort(d instanceof ne?d:new et(d instanceof Error?d.message:d))}};let o=r&&setTimeout(()=>{o=null,c(new ne(`timeout ${r} of ms exceeded`,ne.ETIMEDOUT))},r);const u=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(i=>{i.unsubscribe?i.unsubscribe(c):i.removeEventListener("abort",c)}),t=null)};t.forEach(i=>i.addEventListener("abort",c));const{signal:l}=s;return l.unsubscribe=()=>j.asap(u),l}},ui=function*(t,r){let n=t.byteLength;if(n<r){yield t;return}let s=0,a;for(;s<n;)a=s+r,yield t.slice(s,a),s=a},xi=function(t,r){return ns(this,null,function*(){try{for(var n=er(hi(t)),s,a,c;s=!(a=yield new $e(n.next())).done;s=!1){const o=a.value;yield*as(ui(o,r))}}catch(a){c=[a]}finally{try{s&&(a=n.return)&&(yield new $e(a.call(n)))}finally{if(c)throw c[0]}}})},hi=function(t){return ns(this,null,function*(){if(t[Symbol.asyncIterator]){yield*as(t);return}const r=t.getReader();try{for(;;){const{done:n,value:s}=yield new $e(r.read());if(n)break;yield s}}finally{yield new $e(r.cancel())}})},dr=(t,r,n,s)=>{const a=xi(t,r);let c=0,o,u=i=>{o||(o=!0,s&&s(i))};return new ReadableStream({pull(i){return X(this,null,function*(){try{const{done:d,value:m}=yield a.next();if(d){u(),i.close();return}let p=m.byteLength;if(n){let w=c+=p;n(w)}i.enqueue(new Uint8Array(m))}catch(d){throw u(d),d}})},cancel(i){return u(i),a.return()}},{highWaterMark:2})},mr=64*1024,{isFunction:Ft}=j,pi=(({Request:t,Response:r})=>({Request:t,Response:r}))(j.global),{ReadableStream:ur,TextEncoder:xr}=j.global,hr=(t,...r)=>{try{return!!t(...r)}catch(n){return!1}},fi=t=>{t=j.merge.call({skipUndefined:!0},pi,t);const{fetch:r,Request:n,Response:s}=t,a=r?Ft(r):typeof fetch=="function",c=Ft(n),o=Ft(s);if(!a)return!1;const u=a&&Ft(ur),l=a&&(typeof xr=="function"?(h=>N=>h.encode(N))(new xr):h=>X(Pe,null,function*(){return new Uint8Array(yield new n(h).arrayBuffer())})),i=c&&u&&hr(()=>{let h=!1;const N=new n(Ce.origin,{body:new ur,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type");return h&&!N}),d=o&&u&&hr(()=>j.isReadableStream(new s("").body)),m={stream:d&&(h=>h.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!m[h]&&(m[h]=(N,b)=>{let y=N&&N[h];if(y)return y.call(N);throw new ne(`Response type '${h}' is not supported`,ne.ERR_NOT_SUPPORT,b)})});const p=h=>X(Pe,null,function*(){if(h==null)return 0;if(j.isBlob(h))return h.size;if(j.isSpecCompliantForm(h))return(yield new n(Ce.origin,{method:"POST",body:h}).arrayBuffer()).byteLength;if(j.isArrayBufferView(h)||j.isArrayBuffer(h))return h.byteLength;if(j.isURLSearchParams(h)&&(h=h+""),j.isString(h))return(yield l(h)).byteLength}),w=(h,N)=>X(Pe,null,function*(){const b=j.toFiniteNumber(h.getContentLength());return b==null?p(N):b});return h=>X(Pe,null,function*(){let{url:N,method:b,data:y,signal:I,cancelToken:v,timeout:k,onDownloadProgress:F,onUploadProgress:M,responseType:W,headers:oe,withCredentials:L="same-origin",fetchOptions:Y}=Yr(h),H=r||fetch;W=W?(W+"").toLowerCase():"text";let T=mi([I,v&&v.toAbortSignal()],k),G=null;const D=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let g;try{if(M&&i&&b!=="get"&&b!=="head"&&(g=yield w(oe,y))!==0){let S=new n(N,{method:"POST",body:y,duplex:"half"}),Q;if(j.isFormData(y)&&(Q=S.headers.get("content-type"))&&oe.setContentType(Q),S.body){const[se,$]=or(g,Pt(lr(M)));y=dr(S.body,mr,se,$)}}j.isString(L)||(L=L?"include":"omit");const C=c&&"credentials"in n.prototype,_=ee(q({},Y),{signal:T,method:b.toUpperCase(),headers:oe.normalize().toJSON(),body:y,duplex:"half",credentials:C?L:void 0});G=c&&new n(N,_);let R=yield c?H(G,Y):H(N,_);const B=d&&(W==="stream"||W==="response");if(d&&(F||B&&D)){const S={};["status","statusText","headers"].forEach(re=>{S[re]=R[re]});const Q=j.toFiniteNumber(R.headers.get("content-length")),[se,$]=F&&or(Q,Pt(lr(F),!0))||[];R=new s(dr(R.body,mr,se,()=>{$&&$(),D&&D()}),S)}W=W||"text";let V=yield m[j.findKey(m,W)||"text"](R,h);return!B&&D&&D(),yield new Promise((S,Q)=>{Br(S,Q,{data:V,headers:_e.from(R.headers),status:R.status,statusText:R.statusText,config:h,request:G})})}catch(C){throw D&&D(),C&&C.name==="TypeError"&&/Load failed|fetch/i.test(C.message)?Object.assign(new ne("Network Error",ne.ERR_NETWORK,h,G),{cause:C.cause||C}):ne.from(C,C&&C.code,h,G)}})},bi=new Map,zr=t=>{let r=t&&t.env||{};const{fetch:n,Request:s,Response:a}=r,c=[s,a,n];let o=c.length,u=o,l,i,d=bi;for(;u--;)l=c[u],i=d.get(l),i===void 0&&d.set(l,i=u?new Map:fi(r)),d=i;return i};zr();const gs={http:Oa,xhr:di,fetch:{get:zr}};j.forEach(gs,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch(n){}Object.defineProperty(t,"adapterName",{value:r})}});const pr=t=>`- ${t}`,gi=t=>j.isFunction(t)||t===null||t===!1;function yi(t,r){t=j.isArray(t)?t:[t];const{length:n}=t;let s,a;const c={};for(let o=0;o<n;o++){s=t[o];let u;if(a=s,!gi(s)&&(a=gs[(u=String(s)).toLowerCase()],a===void 0))throw new ne(`Unknown adapter '${u}'`);if(a&&(j.isFunction(a)||(a=a.get(r))))break;c[u||"#"+o]=a}if(!a){const o=Object.entries(c).map(([l,i])=>`adapter ${l} `+(i===!1?"is not supported by the environment":"is not available in the build"));let u=n?o.length>1?`since :
`+o.map(pr).join(`
`):" "+pr(o[0]):"as no adapter specified";throw new ne("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return a}const Hr={getAdapter:yi,adapters:gs};function ls(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new et(null,t)}function fr(t){return ls(t),t.headers=_e.from(t.headers),t.data=os.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Hr.getAdapter(t.adapter||yt.adapter,t)(t).then(function(s){return ls(t),s.data=os.call(t,t.transformResponse,s),s.headers=_e.from(s.headers),s},function(s){return Ir(s)||(ls(t),s&&s.response&&(s.response.data=os.call(t,t.transformResponse,s.response),s.response.headers=_e.from(s.response.headers))),Promise.reject(s)})}const Wr="1.13.2",zt={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{zt[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const br={};zt.transitional=function(r,n,s){function a(c,o){return"[Axios v"+Wr+"] Transitional option '"+c+"'"+o+(s?". "+s:"")}return(c,o,u)=>{if(r===!1)throw new ne(a(o," has been removed"+(n?" in "+n:"")),ne.ERR_DEPRECATED);return n&&!br[o]&&(br[o]=!0,console.warn(a(o," has been deprecated since v"+n+" and will be removed in the near future"))),r?r(c,o,u):!0}};zt.spelling=function(r){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${r}`),!0)};function ji(t,r,n){if(typeof t!="object")throw new ne("options must be an object",ne.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let a=s.length;for(;a-- >0;){const c=s[a],o=r[c];if(o){const u=t[c],l=u===void 0||o(u,c,t);if(l!==!0)throw new ne("option "+c+" must be "+l,ne.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ne("Unknown option "+c,ne.ERR_BAD_OPTION)}}const Dt={assertOptions:ji,validators:zt},Oe=Dt.validators;let ze=class{constructor(r){this.defaults=r||{},this.interceptors={request:new ar,response:new ar}}request(r,n){return X(this,null,function*(){try{return yield this._request(r,n)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch(o){}}throw s}})}_request(r,n){typeof r=="string"?(n=n||{},n.url=r):n=r||{},n=He(this.defaults,n);const{transitional:s,paramsSerializer:a,headers:c}=n;s!==void 0&&Dt.assertOptions(s,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(j.isFunction(a)?n.paramsSerializer={serialize:a}:Dt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Dt.assertOptions(n,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=c&&j.merge(c.common,c[n.method]);c&&j.forEach(["delete","get","head","post","put","patch","common"],h=>{delete c[h]}),n.headers=_e.concat(o,c);const u=[];let l=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(n)===!1||(l=l&&N.synchronous,u.unshift(N.fulfilled,N.rejected))});const i=[];this.interceptors.response.forEach(function(N){i.push(N.fulfilled,N.rejected)});let d,m=0,p;if(!l){const h=[fr.bind(this),void 0];for(h.unshift(...u),h.push(...i),p=h.length,d=Promise.resolve(n);m<p;)d=d.then(h[m++],h[m++]);return d}p=u.length;let w=n;for(;m<p;){const h=u[m++],N=u[m++];try{w=h(w)}catch(b){N.call(this,b);break}}try{d=fr.call(this,w)}catch(h){return Promise.reject(h)}for(m=0,p=i.length;m<p;)d=d.then(i[m++],i[m++]);return d}getUri(r){r=He(this.defaults,r);const n=Ur(r.baseURL,r.url,r.allowAbsoluteUrls);return Pr(n,r.params,r.paramsSerializer)}};j.forEach(["delete","get","head","options"],function(r){ze.prototype[r]=function(n,s){return this.request(He(s||{},{method:r,url:n,data:(s||{}).data}))}});j.forEach(["post","put","patch"],function(r){function n(s){return function(c,o,u){return this.request(He(u||{},{method:r,headers:s?{"Content-Type":"multipart/form-data"}:{},url:c,data:o}))}}ze.prototype[r]=n(),ze.prototype[r+"Form"]=n(!0)});let vi=class qr{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(c){n=c});const s=this;this.promise.then(a=>{if(!s._listeners)return;let c=s._listeners.length;for(;c-- >0;)s._listeners[c](a);s._listeners=null}),this.promise.then=a=>{let c;const o=new Promise(u=>{s.subscribe(u),c=u}).then(a);return o.cancel=function(){s.unsubscribe(c)},o},r(function(c,o,u){s.reason||(s.reason=new et(c,o,u),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const n=this._listeners.indexOf(r);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const r=new AbortController,n=s=>{r.abort(s)};return this.subscribe(n),r.signal.unsubscribe=()=>this.unsubscribe(n),r.signal}static source(){let r;return{token:new qr(function(a){r=a}),cancel:r}}};function Ni(t){return function(n){return t.apply(null,n)}}function wi(t){return j.isObject(t)&&t.isAxiosError===!0}const xs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(xs).forEach(([t,r])=>{xs[r]=t});function Vr(t){const r=new ze(t),n=Cr(ze.prototype.request,r);return j.extend(n,ze.prototype,r,{allOwnKeys:!0}),j.extend(n,r,null,{allOwnKeys:!0}),n.create=function(a){return Vr(He(t,a))},n}const we=Vr(yt);we.Axios=ze;we.CanceledError=et;we.CancelToken=vi;we.isCancel=Ir;we.VERSION=Wr;we.toFormData=Yt;we.AxiosError=ne;we.Cancel=we.CanceledError;we.all=function(r){return Promise.all(r)};we.spread=Ni;we.isAxiosError=wi;we.mergeConfig=He;we.AxiosHeaders=_e;we.formToJSON=t=>$r(j.isHTMLForm(t)?new FormData(t):t);we.getAdapter=Hr.getAdapter;we.HttpStatusCode=xs;we.default=we;const{Axios:io,AxiosError:oo,CanceledError:lo,isCancel:co,CancelToken:mo,VERSION:uo,all:xo,Cancel:ho,isAxiosError:po,spread:fo,toFormData:bo,AxiosHeaders:go,HttpStatusCode:yo,formToJSON:jo,getAdapter:vo,mergeConfig:No}=we,Ci="/api",ki=Ci,K=we.create({baseURL:ki});K.interceptors.request.use(t=>{const r=localStorage.getItem("token");return r&&(t.headers=ee(q({},t.headers),{Authorization:`Bearer ${r}`})),t});K.interceptors.response.use(t=>t,t=>{var n;return((n=t==null?void 0:t.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("name"),localStorage.removeItem("userId"),typeof window!="undefined"&&window.location.pathname!=="/"&&window.location.assign("/")),Promise.reject(t)});const Kr=f.createContext(void 0),_i=({children:t})=>{const[r,n]=f.useState({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!1});f.useEffect(()=>{X(Pe,null,function*(){const u=localStorage.getItem("token"),l=localStorage.getItem("role"),i=localStorage.getItem("name"),d=localStorage.getItem("userId");if(u)try{const m=yield K.get("/auth/me",{headers:{Authorization:`Bearer ${u}`}}),p=m.data.role;localStorage.setItem("role",p),localStorage.setItem("name",m.data.full_name),localStorage.setItem("userId",m.data.id),n({token:u,role:p,name:m.data.full_name,userId:m.data.id,user:m.data,mustChangePassword:!!m.data.must_change_password,ready:!0});return}catch(m){localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0});return}(l||i||d)&&localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0})})},[]);const s=()=>X(Pe,null,function*(){const o=localStorage.getItem("token");if(!o)return;const u=yield K.get("/auth/me",{headers:{Authorization:`Bearer ${o}`}}),l=u.data.role;localStorage.setItem("role",l),localStorage.setItem("name",u.data.full_name),localStorage.setItem("userId",u.data.id),n({token:o,role:l,name:u.data.full_name,userId:u.data.id,user:u.data,mustChangePassword:!!u.data.must_change_password,ready:!0})}),a=(o,u,l,i)=>X(Pe,null,function*(){const d=yield K.post("/auth/token",{email:o,password:u,mfa_code:l,recovery_code:i}),m=d.data.access_token;localStorage.setItem("token",m);const p=yield K.get("/auth/me",{headers:{Authorization:`Bearer ${m}`}}),w=p.data.role;return localStorage.setItem("role",w),localStorage.setItem("name",p.data.full_name),localStorage.setItem("userId",p.data.id),n({token:m,role:w,name:p.data.full_name,userId:p.data.id,user:p.data,mustChangePassword:!!p.data.must_change_password,ready:!0}),d.data}),c=()=>{localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0})};return e.jsx(Kr.Provider,{value:ee(q({},r),{login:a,logout:c,refreshMe:s}),children:t})},qe=()=>{const t=f.useContext(Kr);if(!t)throw new Error("useAuth must be used within AuthProvider");return t};function Ie({to:t,icon:r,label:n,badge:s}){const c=hs().pathname===t;return e.jsxs(zn,{to:t,className:`flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition ${c?"bg-app text-text-primary":"text-text-secondary hover:bg-app hover:text-text-primary"}`,children:[e.jsx("span",{className:"h-5 w-5",children:r}),e.jsx("span",{className:"flex-1",children:n}),s!==void 0&&s>0&&e.jsx("span",{className:"ml-auto inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-app px-1 text-[11px] font-semibold text-text-secondary border border-border",children:s})]})}function Si(){var n,s,a;const{user:t,logout:r}=qe();return e.jsxs("div",{className:"fixed inset-y-0 left-0 w-64 bg-surface border-r border-border px-6 py-6 flex flex-col gap-6 overflow-y-auto scrollbar-thin",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-brand flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"C"})}),e.jsx("span",{className:"text-lg font-semibold text-text-primary",children:"Compass"})]}),e.jsxs("nav",{className:"flex flex-col gap-1",children:[e.jsx(Ie,{to:"/",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),label:"Dashboard"}),e.jsx(Ie,{to:"/tasks",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),label:"My Tasks"}),e.jsx(Ie,{to:"/complaints",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),label:"Complaints"}),e.jsx(Ie,{to:"/create",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),label:"New Complaint"}),(t==null?void 0:t.role)!=="read_only"&&e.jsx(Ie,{to:"/reference",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),label:"Reference Data"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="complaints_manager")&&e.jsx(Ie,{to:"/users",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),label:"Users"}),e.jsx(Ie,{to:"/settings",icon:e.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),label:"Settings"})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-brand flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:((s=(n=t==null?void 0:t.full_name)==null?void 0:n.charAt(0))==null?void 0:s.toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:(t==null?void 0:t.full_name)||"User"}),e.jsx("div",{className:"text-xs text-text-secondary truncate capitalize",children:((a=t==null?void 0:t.role)==null?void 0:a.replace(/_/g," "))||"User"})]})]}),e.jsxs("button",{onClick:r,className:"flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-text-secondary hover:bg-app hover:text-text-primary transition",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Sign out"})]})]})]})}function Mi({children:t}){return e.jsxs("div",{className:"min-h-screen bg-app text-text-primary",children:[e.jsx(Si,{}),e.jsx("div",{className:"ml-64 min-h-screen flex flex-col",children:t})]})}function A(c){var o=c,{variant:t="primary",size:r="md",className:n="",children:s}=o,a=rs(o,["variant","size","className","children"]);const u="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-offset-2 focus-visible:ring-offset-app disabled:opacity-40 disabled:pointer-events-none",l={sm:"h-8 px-3 text-xs",md:"h-10 px-4 text-sm"},i={primary:"bg-brand text-white hover:opacity-90 active:translate-y-px",secondary:"bg-surface text-text-primary border border-border hover:bg-app active:translate-y-px",ghost:"bg-transparent text-text-primary hover:bg-app active:translate-y-px",icon:"h-10 w-10 p-0 rounded-full hover:bg-app active:translate-y-px"};return e.jsx("button",ee(q({className:`${u} ${l[r]} ${i[t]} ${n}`},a),{children:s}))}function te(a){var c=a,{error:t,leadingIcon:r,className:n=""}=c,s=rs(c,["error","leadingIcon","className"]);const o="w-full h-10 rounded-lg border bg-surface px-3 text-sm text-text-primary placeholder:text-text-muted outline-none transition",u=t?"border-semantic-error focus:border-semantic-error focus:ring-2 focus:ring-semantic-error/15":"border-border focus:border-brand focus:ring-2 focus:ring-brand/15",l=r?"pl-10":"px-3";return e.jsxs("div",{className:"relative",children:[r&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-text-muted",children:r}),e.jsx("input",q({className:`${o} ${u} ${l} ${n}`},s))]})}function de({children:t,className:r="",onClick:n,selected:s,inverse:a}){const c="rounded-card border shadow-card p-4",o=a?"bg-brand text-white border-transparent":"bg-surface text-text-primary border-border",u=s?"ring-2 ring-brand/15":"",l=n?"cursor-pointer hover:shadow-sm active:translate-y-px transition":"";return e.jsx("div",{className:`${c} ${o} ${u} ${l} ${r}`,onClick:n,children:t})}function pe({children:t,className:r=""}){return e.jsx("div",{className:`flex items-start justify-between gap-3 ${r}`,children:t})}function fe({children:t,className:r="",inverse:n}){const s=n?"text-white":"text-text-primary";return e.jsx("h3",{className:`text-sm font-semibold ${s} ${r}`,children:t})}function me({children:t,className:r="",inverse:n}){const s=n?"text-white/80":"text-text-secondary";return e.jsx("div",{className:`mt-2 text-xs leading-relaxed ${s} ${r}`,children:t})}function ge({open:t,onClose:r,children:n}){return f.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:r}),e.jsx("div",{className:"fixed left-1/2 top-1/2 w-[min(560px,calc(100%-2rem))] -translate-x-1/2 -translate-y-1/2 rounded-modal border border-border bg-surface p-6 shadow-xl z-50 max-h-[90vh] overflow-hidden flex flex-col",children:n})]}):null}function ye({children:t,onClose:r}){return e.jsxs("div",{className:"mb-4 flex items-center justify-between flex-shrink-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:t}),r&&e.jsx("button",{onClick:r,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-text-muted hover:bg-app hover:text-text-primary transition","aria-label":"Close modal",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function je({children:t}){return e.jsx("div",{className:"text-sm text-text-secondary overflow-y-auto pr-1",children:t})}function ve({children:t}){return e.jsx("div",{className:"mt-6 flex justify-end gap-3 flex-shrink-0",children:t})}function Jr({children:t,className:r=""}){return e.jsx("div",{className:`overflow-hidden rounded-card border border-border bg-surface ${r}`,children:e.jsx("table",{className:"w-full table-auto",children:t})})}function Ei({children:t}){return e.jsx("thead",{className:"bg-app",children:t})}function Ri({children:t}){return e.jsx("tbody",{children:t})}function gr({children:t,onClick:r,className:n=""}){const s=r?"cursor-pointer hover:bg-app/60":"hover:bg-app/60";return e.jsx("tr",{className:`border-t border-border ${s} ${n}`,onClick:r,children:t})}function Be({children:t,className:r=""}){return e.jsx("th",{className:`h-10 px-4 text-left text-xs font-semibold text-text-secondary ${r}`,children:t})}function Ue({children:t,className:r=""}){return e.jsx("td",{className:`h-12 px-4 text-sm text-text-primary ${r}`,children:t})}function Qe({value:t,onChange:r,options:n,placeholder:s,className:a=""}){const[c,o]=f.useState(!1),[u,l]=f.useState(t),[i,d]=f.useState(0),m=f.useRef(null),p=f.useRef(null),w=f.useRef(t);f.useEffect(()=>{l(t),w.current=t},[t]);const h=n.filter(v=>v.toLowerCase().includes(u.toLowerCase()));f.useEffect(()=>{const v=k=>{p.current&&!p.current.contains(k.target)&&m.current&&!m.current.contains(k.target)&&(o(!1),r(u))};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[u,r]);const N=v=>{const k=v.target.value;l(k),w.current=k,o(!0),d(0)},b=v=>{var k;l(v),w.current=v,r(v),o(!1),(k=m.current)==null||k.blur()},y=v=>{var k;if(!c&&(v.key==="ArrowDown"||v.key==="ArrowUp")){o(!0);return}if(c)switch(v.key){case"ArrowDown":v.preventDefault(),d(F=>F<h.length-1?F+1:F);break;case"ArrowUp":v.preventDefault(),d(F=>F>0?F-1:0);break;case"Enter":v.preventDefault(),h[i]&&b(h[i]);break;case"Escape":v.preventDefault(),o(!1),(k=m.current)==null||k.blur();break}},I=()=>{setTimeout(()=>{var v;(v=p.current)!=null&&v.contains(document.activeElement)||(o(!1),r(w.current))},200)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:m,type:"text",value:u,onChange:N,onFocus:()=>o(!0),onBlur:I,onKeyDown:y,placeholder:s,className:`w-full h-10 rounded-lg border border-border bg-surface pl-3 pr-10 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${a}`}),e.jsx("button",{type:"button",onClick:()=>{var v;o(!c),(v=m.current)==null||v.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition","aria-label":c?"Close options":"Open options",children:e.jsx("svg",{className:`h-4 w-4 transition-transform ${c?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),c&&h.length>0&&e.jsx("div",{ref:p,className:"absolute z-50 mt-1 w-full rounded-lg border border-border bg-surface shadow-lg max-h-60 overflow-auto scrollbar-thin",children:h.map((v,k)=>e.jsx("button",{type:"button",onMouseDown:F=>{F.preventDefault()},onClick:()=>b(v),onMouseEnter:()=>d(k),className:`w-full text-left px-3 py-2 text-sm transition ${k===i?"bg-app text-text-primary":"text-text-secondary hover:bg-app hover:text-text-primary"}`,children:v},v))}),c&&u&&h.length===0&&e.jsx("div",{ref:p,className:"absolute z-50 mt-1 w-full rounded-lg border border-border bg-surface shadow-lg p-3",children:e.jsxs("p",{className:"text-sm text-text-secondary",children:['No matches found. Type to create "',u,'"']})})]})}function Ae({title:t,actions:r}){return e.jsxs("div",{className:"h-16 px-10 flex items-center justify-between gap-6 bg-app border-b border-border",children:[t?e.jsx("h1",{className:"text-2xl font-semibold text-text-primary",children:t}):e.jsx("div",{className:"w-full max-w-md",children:e.jsx(te,{type:"search",placeholder:"Search complaints...",leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),e.jsx("div",{className:"flex items-center gap-3",children:r})]})}function Ai(){const t=Ge(),{userId:r,token:n}=qe(),[s,a]=f.useState(null),[c,o]=f.useState([]),[u,l]=f.useState("mine"),[i,d]=f.useState(!1),[m,p]=f.useState(!0),[w,h]=f.useState(null),N=()=>X(this,null,function*(){var y;if(n){p(!0),h(null);try{const I=yield K.get("/complaints/metrics",{params:{_:Date.now()}});a(I.data)}catch(I){if(((y=I==null?void 0:I.response)==null?void 0:y.status)===401)return;console.error("Failed to load dashboard metrics",I),h("Failed to load metrics. Please try again.")}finally{p(!1)}}});f.useEffect(()=>{N()},[n]),f.useEffect(()=>{if(!r||!n)return;X(this,null,function*(){var I;d(!0);try{let v=[];u==="mine"?v=((yield K.get("/complaints",{params:{handler_id:r,page:1,page_size:50,_:Date.now()}})).data||[]).filter(F=>F.status!=="Closed"):u==="unassigned"?v=((yield K.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(F=>F.status!=="Closed").filter(F=>!F.assigned_handler_id):u==="breached"?v=((yield K.get("/complaints",{params:{overdue:!0,page:1,page_size:100,_:Date.now()}})).data||[]).filter(F=>F.status!=="Closed"):u==="oldest"&&(v=((yield K.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(F=>F.status!=="Closed"),v.sort((F,M)=>P(F.received_at).valueOf()-P(M.received_at).valueOf()),v=v.slice(0,20)),o(v)}catch(v){if(((I=v==null?void 0:v.response)==null?void 0:I.status)===401)return;console.error("Failed to load queue",v)}finally{d(!1)}})},[r,n,u]);const b=y=>y===null?"N/A":`${Math.round(y)}%`;return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"secondary",onClick:N,disabled:m,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),m?"Refreshing...":"Refresh"]}),e.jsxs(A,{variant:"primary",onClick:()=>t("/create"),children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"New Complaint"]})]})}),e.jsxs("div",{className:"px-10 py-6",children:[w&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:w}),e.jsx(A,{variant:"secondary",onClick:N,children:"Retry"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>t("/complaints"),className:"rounded-card border border-border bg-app p-6 text-left hover:bg-surface transition",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Open Cases"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-text-primary",children:m?"":(s==null?void 0:s.kpis.open)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"Total open complaints"})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"My Open"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-text-primary",children:m?"":(s==null?void 0:s.kpis.my_open)||0}),e.jsxs("div",{className:"mt-2 text-xs text-text-secondary",children:["Assigned to me",!m&&s&&e.jsx("button",{onClick:()=>t("/tasks"),className:"ml-2 text-brand hover:text-brand-dark font-medium",children:"View "})]})]}),e.jsxs("button",{type:"button",onClick:()=>t("/complaints?overdue=true"),className:"rounded-card border border-border bg-app p-6 text-left hover:bg-surface transition",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"SLA Breaches"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-semantic-error",children:m?"":(s==null?void 0:s.kpis.open_sla_breaches)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"Open breaches"})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Stale (21d+)"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-semantic-warning",children:m?"":(s==null?void 0:s.kpis.open_stale_21d)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"No activity"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"7-Day Flow"})}),e.jsx(me,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-semantic-success"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"New complaints"})]}),e.jsx("span",{className:"text-xl font-semibold text-text-primary",children:(s==null?void 0:s.flow_7d.new)||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Closed"})]}),e.jsx("span",{className:"text-xl font-semibold text-text-primary",children:(s==null?void 0:s.flow_7d.closed)||0})]}),e.jsx("div",{className:"pt-2 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:"Net change"}),e.jsxs("span",{className:`text-lg font-semibold ${((s==null?void 0:s.flow_7d.new)||0)-((s==null?void 0:s.flow_7d.closed)||0)>0?"text-semantic-warning":"text-semantic-success"}`,children:[((s==null?void 0:s.flow_7d.new)||0)-((s==null?void 0:s.flow_7d.closed)||0)>0?"+":"",((s==null?void 0:s.flow_7d.new)||0)-((s==null?void 0:s.flow_7d.closed)||0)]})]})})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Age of Open Cases"})}),e.jsx(me,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsx("div",{className:"space-y-3",children:[{label:"0-7 days",key:"0-7",color:"bg-semantic-success"},{label:"8-21 days",key:"8-21",color:"bg-semantic-info"},{label:"22-56 days",key:"22-56",color:"bg-semantic-warning"},{label:"56+ days",key:"56+",color:"bg-semantic-error"}].map(({label:y,key:I,color:v})=>{const k=s==null?void 0:s.aging_open;if(!k)return null;const F=k[I]||0,M=Object.values(k).reduce((oe,L)=>oe+L,0),W=M>0?F/M*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:y}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:F})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${v} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,W))}%`}})})]},I)})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(de,{children:e.jsxs(me,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Vulnerable Customers"}),e.jsx("div",{className:"text-2xl font-semibold text-text-primary",children:m?"":(s==null?void 0:s.risk.open_vulnerable.count)||0}),!m&&s&&s.risk.open_vulnerable.pct_of_open!==null&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:[b(s.risk.open_vulnerable.pct_of_open)," of open"]}),!m&&e.jsx("button",{type:"button",onClick:()=>t("/complaints?vulnerability=true"),className:"mt-2 text-xs font-medium text-brand hover:text-brand-dark",children:"View cases "})]})}),e.jsx(de,{children:e.jsxs(me,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Reopened Cases"}),e.jsx("div",{className:"text-2xl font-semibold text-semantic-warning",children:m?"":(s==null?void 0:s.risk.reopened.count)||0}),!m&&s&&s.risk.reopened.pct_all_time!==null&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:[b(s.risk.reopened.pct_all_time)," of all time"]})]})}),e.jsx(de,{children:e.jsxs(me,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Escalated (Open)"}),e.jsx("div",{className:"text-2xl font-semibold text-semantic-error",children:m?"":(s==null?void 0:s.risk.escalated_open)||0}),e.jsx("div",{className:"mt-1 text-xs text-text-muted",children:"Requires attention"})]})}),e.jsx(de,{children:e.jsxs(me,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Final Response Rate"}),e.jsx("div",{className:"text-2xl font-semibold text-text-primary",children:m?"":b((s==null?void 0:s.risk.final_attachment_open_pct)||null)}),e.jsx("div",{className:"mt-1 text-xs text-text-muted",children:"Open with attachments"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Acknowledgement SLA (30d)"})}),e.jsx(me,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"On-time rate"}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:b((s==null?void 0:s.sla_30d.ack.on_time_pct)||null)})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-semantic-success transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(s==null?void 0:s.sla_30d.ack.on_time_pct)||0))}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:[(s==null?void 0:s.sla_30d.ack.on_time)||0," / ",(s==null?void 0:s.sla_30d.ack.total)||0," on time"]})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Final Response SLA (30d)"})}),e.jsx(me,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"On-time rate"}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:b((s==null?void 0:s.sla_30d.final.on_time_pct)||null)})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-semantic-success transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(s==null?void 0:s.sla_30d.final.on_time_pct)||0))}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:[(s==null?void 0:s.sla_30d.final.on_time)||0," / ",(s==null?void 0:s.sla_30d.final.total)||0," on time"]})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Team Workload"})}),e.jsx(me,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4 space-y-2",children:[((s==null?void 0:s.workload_open_by_handler)||[]).slice(0,5).map(y=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary truncate pr-2",children:y.name}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:y.count})]},y.id)),(!(s!=null&&s.workload_open_by_handler)||s.workload_open_by_handler.length===0)&&e.jsx("div",{className:"text-xs text-text-muted text-center py-4",children:"No workload data"})]})})]})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"My Queue"})}),e.jsx("div",{className:"mt-4 border-b border-border",children:e.jsx("div",{className:"flex gap-1 px-4",children:["mine","unassigned","breached","oldest"].map(y=>e.jsx("button",{onClick:()=>l(y),className:`px-4 py-2 text-sm font-medium capitalize transition border-b-2 ${u===y?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:y},y))})}),e.jsx("div",{className:"p-4",children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):c.length===0?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"No complaints in this queue"}):e.jsx("div",{className:"space-y-2",children:c.map(y=>e.jsxs("div",{onClick:()=>t(`/complaints/${y.id}`),className:"flex items-center justify-between p-3 rounded-lg border border-border hover:bg-app cursor-pointer transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:y.reference}),e.jsx("div",{className:"text-xs text-text-secondary truncate mt-1",children:y.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsx("span",{className:"text-xs text-text-muted whitespace-nowrap",children:P(y.received_at).format("MMM D")}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${y.status==="New"?"bg-semantic-info/10 text-semantic-info":y.status==="Acknowledged"?"bg-semantic-success/10 text-semantic-success":"bg-app text-text-secondary"}`,children:y.status})]})]},y.id))})})]})]})]})}function Tt({status:t,className:r=""}){const n=s=>{switch(s){case"New":return"bg-semantic-info/10 text-semantic-info border-semantic-info/20";case"Acknowledged":return"bg-semantic-success/10 text-semantic-success border-semantic-success/20";case"In Investigation":return"bg-blue-50 text-blue-700 border-blue-200";case"Response Drafted":return"bg-purple-50 text-purple-700 border-purple-200";case"Awaiting Customer":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"Escalated":return"bg-semantic-warning/10 text-semantic-warning border-semantic-warning/20";case"Closed":return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-app text-text-secondary border-border"}};return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium border ${n(t)} ${r}`,children:t})}function Fi(){const t=Ge(),[r]=Hn(),[n,s]=f.useState([]),[a,c]=f.useState(!0),[o,u]=f.useState(null),[l,i]=f.useState(""),[d,m]=f.useState("all"),[p,w]=f.useState("all"),[h,N]=f.useState(!1),[b,y]=f.useState(!1),[I,v]=f.useState("received_at"),[k,F]=f.useState("desc"),[M,W]=f.useState(1),[oe]=f.useState(50),[L,Y]=f.useState(1),[H,T]=f.useState([]);f.useEffect(()=>{const S=r.get("overdue"),Q=r.get("vulnerability"),se=r.get("status"),$=r.get("handler"),re=r.get("search");S!==null&&N(S==="true"),Q!==null&&y(Q==="true"),se&&m(se),$&&w($),re&&i(re),W(1)},[]);const G=()=>X(this,null,function*(){c(!0),u(null);try{const S={page:M,page_size:oe,_:Date.now()};d!=="all"&&(S.status_filter=d),p!=="all"&&p!=="unassigned"&&(S.handler_id=p),h&&(S.overdue=!0),b&&(S.vulnerability=!0),l.trim()&&(S.search=l.trim());const Q=yield K.get("/complaints",{params:S}),se=Q.data||[];s(p==="unassigned"?se.filter($=>!$.assigned_handler_id):se),Q.data&&Q.data.length===oe?Y(M+1):Y(M)}catch(S){console.error("Failed to load complaints",S),u("Failed to load complaints. Please try again.")}finally{c(!1)}}),D=()=>X(this,null,function*(){try{const S=yield K.get("/users");T(S.data||[])}catch(S){console.error("Failed to load handlers",S)}});f.useEffect(()=>{D()},[]),f.useEffect(()=>{G()},[M,p,h,d,b]);const g=S=>{I===S?F(k==="asc"?"desc":"asc"):(v(S),F("asc"))},C=S=>I!==S?e.jsx("svg",{className:"h-4 w-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):k==="asc"?e.jsx("svg",{className:"h-4 w-4 text-brand",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"h-4 w-4 text-brand",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),_=n.sort((S,Q)=>{var re,E;let se,$;switch(I){case"reference":se=S.reference,$=Q.reference;break;case"status":se=S.status,$=Q.status;break;case"received_at":se=new Date(S.received_at).getTime(),$=new Date(Q.received_at).getTime();break;case"handler":se=S.assigned_handler_name||"zzz",$=Q.assigned_handler_name||"zzz";break;case"complainant":se=((re=S.complainant)==null?void 0:re.full_name)||"zzz",$=((E=Q.complainant)==null?void 0:E.full_name)||"zzz";break;default:return 0}return se<$?k==="asc"?-1:1:se>$?k==="asc"?1:-1:0}),R=S=>{if(S.status==="Closed")return!1;const Q=P();return!S.acknowledged_at&&S.ack_due_at?P(S.ack_due_at).isBefore(Q):!S.final_response_at&&S.final_due_at?P(S.final_due_at).isBefore(Q):!1},B=()=>{i(""),m("all"),w("all"),N(!1),y(!1),W(1)},V=[l!=="",d!=="all",p!=="all",h,b].filter(Boolean).length;return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Complaints",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"secondary",onClick:G,disabled:a,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),a?"Refreshing...":"Refresh"]}),e.jsxs(A,{variant:"primary",onClick:()=>t("/create"),children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"New Complaint"]})]})}),e.jsxs("div",{className:"px-10 py-6",children:[e.jsx(de,{className:"mb-6",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Filters & Search"}),V>0&&e.jsxs(A,{variant:"secondary",onClick:B,children:["Clear all (",V,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(te,{type:"search",placeholder:"Search by reference, description, or complainant...",value:l,onChange:S=>i(S.target.value),onKeyDown:S=>{S.key==="Enter"&&(S.preventDefault(),W(1),G())},leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("p",{className:"mt-1 text-xs text-text-muted",children:"Tip: Press Enter or click Refresh to run a new search (server-side)."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-medium text-text-primary mb-1",children:"Status"}),e.jsxs("select",{id:"status-filter",value:d,onChange:S=>m(S.target.value),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-surface text-text-primary focus:outline-none focus:ring-2 focus:ring-brand",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"new",children:"New"}),e.jsx("option",{value:"acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"in_investigation",children:"In Investigation"}),e.jsx("option",{value:"response_drafted",children:"Response Drafted"}),e.jsx("option",{value:"final_response_issued",children:"Final Response Issued"}),e.jsx("option",{value:"reopened",children:"Reopened"}),e.jsx("option",{value:"closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"handler-filter",className:"block text-xs font-medium text-text-primary mb-1",children:"Handler"}),e.jsxs("select",{id:"handler-filter",value:p,onChange:S=>w(S.target.value),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-surface text-text-primary focus:outline-none focus:ring-2 focus:ring-brand",children:[e.jsx("option",{value:"all",children:"All Handlers"}),e.jsx("option",{value:"unassigned",children:"Unassigned"}),H.map(S=>e.jsx("option",{value:S.id,children:S.full_name},S.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:S=>N(S.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Overdue only"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:S=>y(S.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Vulnerable only"})]})]})]})]})}),o&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:o}),e.jsx(A,{variant:"secondary",onClick:G,children:"Retry"})]}),a?e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading complaints..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-text-secondary",children:["Showing ",_.length," complaint",_.length!==1?"s":""]}),L>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"secondary",onClick:()=>W(M-1),disabled:M===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["Page ",M," of ",L]}),e.jsx(A,{variant:"secondary",onClick:()=>W(M+1),disabled:M===L,children:"Next"})]})]}),e.jsxs(Jr,{children:[e.jsx(Ei,{children:e.jsxs(gr,{children:[e.jsx(Be,{children:e.jsxs("button",{onClick:()=>g("reference"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Reference ",C("reference")]})}),e.jsx(Be,{children:e.jsxs("button",{onClick:()=>g("status"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Status ",C("status")]})}),e.jsx(Be,{children:e.jsxs("button",{onClick:()=>g("complainant"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Complainant ",C("complainant")]})}),e.jsx(Be,{children:"Description"}),e.jsx(Be,{children:e.jsxs("button",{onClick:()=>g("received_at"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Received ",C("received_at")]})}),e.jsx(Be,{children:e.jsxs("button",{onClick:()=>g("handler"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Handler ",C("handler")]})}),e.jsx(Be,{children:"Flags"})]})}),e.jsx(Ri,{children:_.map(S=>{var se;const Q=R(S);return e.jsxs(gr,{onClick:()=>t(`/complaints/${S.id}`),children:[e.jsx(Ue,{children:e.jsx("span",{className:"font-semibold",children:S.reference})}),e.jsx(Ue,{children:e.jsx(Tt,{status:S.status})}),e.jsx(Ue,{children:e.jsx("span",{className:"text-text-primary",children:((se=S.complainant)==null?void 0:se.full_name)||"Unknown"})}),e.jsx(Ue,{children:e.jsx("span",{className:"truncate max-w-xs block text-text-secondary",children:S.description||"No description"})}),e.jsx(Ue,{children:e.jsx("span",{className:"text-text-muted",children:P(S.received_at).format("MMM D, YYYY")})}),e.jsx(Ue,{children:e.jsx("span",{className:"text-text-muted",children:S.assigned_handler_name||"Unassigned"})}),e.jsx(Ue,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[Q&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-semantic-error/10 text-semantic-error",title:"SLA breach",children:" Overdue"}),S.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-semantic-warning/10 text-semantic-warning",title:"Vulnerable customer",children:" Vulnerable"}),S.fos_complaint&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-700",title:"Referred to FOS",children:"FOS"})]})})]},S.id)})})]}),L>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx(A,{variant:"secondary",onClick:()=>W(M-1),disabled:M===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["Page ",M," of ",L]}),e.jsx(A,{variant:"secondary",onClick:()=>W(M+1),disabled:M===L,children:"Next"})]})]}),!a&&_.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"No complaints found"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:V>0?"Try adjusting your filters or search criteria":"No complaints have been created yet"}),V>0&&e.jsx(A,{variant:"secondary",onClick:B,className:"mt-4",children:"Clear all filters"})]})]})]})}function Li(){var Qs;const{id:t}=Wn(),r=Ge(),{user:n}=qe(),[s,a]=f.useState(null),[c,o]=f.useState([]),[u,l]=f.useState(!0),[i,d]=f.useState("overview"),[m,p]=f.useState([]),[w,h]=f.useState(null),[N,b]=f.useState("all"),[y,I]=f.useState(!1),[v,k]=f.useState(!1),[F,M]=f.useState(""),[W,oe]=f.useState(!1),[L,Y]=f.useState(!1),[H,T]=f.useState(!1),[G,D]=f.useState(null),[g,C]=f.useState({source:"",received_at:"",description:"",category:"",reason:"",vulnerability_flag:!1,vulnerability_notes:"",policy_number:"",product:"",insurer:"",broker:"",scheme:"",complainant_full_name:"",complainant_email:"",complainant_phone:"",complainant_address:"",complainant_dob:""}),[_,R]=f.useState([]),[B,V]=f.useState([]),[S,Q]=f.useState([]),[se,$]=f.useState(!1),[re,E]=f.useState(""),[ie,ce]=f.useState(!1),[be,Ne]=f.useState(null),[Z,ae]=f.useState(!1),[z,Me]=f.useState({kind:"general",channel:"email",direction:"inbound",summary:"",occurred_at:P().format("YYYY-MM-DDTHH:mm"),is_final_response:!1,is_internal:!1}),[tn,sn]=f.useState({}),[rn,tt]=f.useState(!1),[jt,ys]=f.useState(null),[vt,js]=f.useState(!1),[vs,Ns]=f.useState(null),[nn,st]=f.useState(!1),[Le,rt]=f.useState({outcome:"upheld",rationale:"",notes:""}),[ws,Ht]=f.useState(!1),[Cs,Nt]=f.useState(null),[an,nt]=f.useState(!1),[Ee,at]=f.useState({payment_type:"financial_loss",amount:"",rationale:"",action_description:""}),[ks,Ve]=f.useState(!1),[_s,Ke]=f.useState(null),[on,it]=f.useState(!1),[Wt,Ss]=f.useState(null),[wt,Ms]=f.useState(P().format("YYYY-MM-DD")),[qt,Es]=f.useState(!1),[Rs,Vt]=f.useState(null),[ln,ot]=f.useState(!1),[As,cn]=f.useState(null),[Ct,Fs]=f.useState(P().format("YYYY-MM-DDTHH:mm")),[Ls,Os]=f.useState(!1),[dn,lt]=f.useState(!1),[Kt,Ds]=f.useState(""),[ct,Ps]=f.useState(""),[dt,Ts]=f.useState(""),[Jt,$s]=f.useState(P().format("YYYY-MM-DDTHH:mm")),[kt,Is]=f.useState(!0),[Qt,Bs]=f.useState(!1),[mn,mt]=f.useState(!1),[_t,Us]=f.useState(""),[St,Ys]=f.useState(P().format("YYYY-MM-DDTHH:mm")),[Xt,zs]=f.useState(!1),[un,ut]=f.useState(!1),[Mt,Hs]=f.useState(""),[Gt,Ws]=f.useState(P().format("YYYY-MM-DDTHH:mm")),[Zt,qs]=f.useState(!1),[Vs,Et]=f.useState(null);f.useEffect(()=>{t&&(Se(),pn(),xn())},[t]);const xn=()=>{Promise.all([K.get("/reference/products"),K.get("/reference/insurers"),K.get("/reference/brokers")]).then(([x,U,O])=>{R(x.data.map(J=>J.name)),V(U.data.map(J=>J.name)),Q(O.data.map(J=>J.name))}).catch(x=>{console.error("Failed to load reference data",x)})},hn=()=>{t&&K.get(`/complaints/${t}/events`).then(x=>o(x.data)).catch(x=>console.error("Failed to load events",x))},Se=()=>{t&&(l(!0),K.get(`/complaints/${t}`).then(x=>{a(x.data),hn(),l(!1)}).catch(x=>{console.error("Failed to load complaint",x),l(!1)}))},pn=()=>{K.get("/users").then(x=>{const U=x.data.filter(O=>O.is_active&&["admin","complaints_handler","complaints_manager","reviewer"].includes(O.role));p(U)}).catch(x=>{console.error("Failed to load users",x)})},fn=()=>X(this,null,function*(){var x,U;if(!(!t||!n)){ce(!0),Ne(null);try{yield K.post(`/complaints/${t}/assign`,null,{params:{handler_id:n.id}}),Se()}catch(O){Ne(((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to assign complaint")}finally{ce(!1)}}}),bn=()=>X(this,null,function*(){var x,U;if(!(!t||!re)){ce(!0),Ne(null);try{yield K.post(`/complaints/${t}/assign`,null,{params:{handler_id:re}}),$(!1),E(""),Se()}catch(O){Ne(((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to assign complaint")}finally{ce(!1)}}}),Ks=x=>X(this,null,function*(){var O,J;if(!t||!z.summary)return;const U=z.is_internal?!1:z.is_final_response;if(U&&(!jt||jt.length===0)&&!(x!=null&&x.allowFinalWithoutAttachment)){tt(!0);return}js(!0),Ns(null);try{const le=new FormData;le.append("kind",z.kind),le.append("channel",z.channel),le.append("direction",z.direction),le.append("summary",z.summary),le.append("occurred_at",P(z.occurred_at).toISOString()),le.append("is_final_response",U.toString()),le.append("is_internal",z.is_internal.toString()),jt&&Array.from(jt).forEach(ue=>{le.append("files",ue)}),yield K.post(`/complaints/${t}/communications`,le,{headers:{"Content-Type":"multipart/form-data"}}),ae(!1),Me({kind:"general",channel:"email",direction:"inbound",summary:"",occurred_at:P().format("YYYY-MM-DDTHH:mm"),is_final_response:!1,is_internal:!1}),ys(null),Se()}catch(le){const ue=(J=(O=le==null?void 0:le.response)==null?void 0:O.data)==null?void 0:J.detail;let xe="Failed to add communication";typeof ue=="string"?xe=ue:Array.isArray(ue)?xe=ue.map(Re=>Re.msg||JSON.stringify(Re)).join(", "):ue&&typeof ue=="object"&&(xe=JSON.stringify(ue)),Ns(xe)}finally{js(!1)}}),gn=()=>X(this,null,function*(){tt(!1),yield Ks({allowFinalWithoutAttachment:!0})});if(u)return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Loading..."}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading complaint details..."})})]});if(!s)return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Not Found"}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"Complaint not found"}),e.jsx(A,{variant:"secondary",onClick:()=>r("/complaints"),className:"mt-4",children:"Back to Complaints"})]})})]});const es=(x,U)=>X(this,null,function*(){var O,J;if(t)try{yield K.post(`/complaints/${t}/${x}`),h({type:"success",text:U}),Se()}catch(le){h({type:"error",text:((J=(O=le==null?void 0:le.response)==null?void 0:O.data)==null?void 0:J.detail)||`Failed to ${U.toLowerCase()}`})}}),Js=(x,U)=>X(this,null,function*(){var O;try{if((O=navigator==null?void 0:navigator.clipboard)!=null&&O.writeText)yield navigator.clipboard.writeText(x);else{const J=document.createElement("textarea");J.value=x,J.style.position="fixed",J.style.left="-9999px",document.body.appendChild(J),J.focus(),J.select(),document.execCommand("copy"),J.remove()}h({type:"success",text:U})}catch(J){h({type:"error",text:"Copy failed. Please copy manually."})}}),yn=()=>{var Re,Te;const x=((Re=s==null?void 0:s.complainant)==null?void 0:Re.full_name)||"Customer",U=((Te=s==null?void 0:s.complainant)==null?void 0:Te.email)||"",O=(n==null?void 0:n.full_name)||(n==null?void 0:n.name)||"Complaints Team",J=(s==null?void 0:s.reference)||"",le=s!=null&&s.received_at?P(s.received_at).format("D MMM YYYY"):"",ue=s!=null&&s.ack_due_at?P(s.ack_due_at).format("D MMM YYYY"):"",xe=s!=null&&s.final_due_at?P(s.final_due_at).format("D MMM YYYY"):"";Ds(U),Ps(`Complaint acknowledgement  ${J}`),$s(P().format("YYYY-MM-DDTHH:mm")),Is(!0),Ts([`Dear ${x},`,"",`Thank you for your complaint received on ${le}.`,"","We are sorry you have had cause to complain. We are reviewing your complaint and will keep you updated.","",ue?`We aim to acknowledge complaints within required timescales (due by ${ue}).`:"",xe?`We aim to provide our final response by ${xe}.`:"","",`Reference: ${J}`,"","Kind regards,",O,""].filter(he=>he!=="").join(`
`)),lt(!0)},jn=(x,U,O)=>{const J=["Acknowledgement email sent.",x?`To: ${x}`:null,U?`Subject: ${U}`:null,"",O||null].filter(Boolean).join(`
`);return J.length<=1e3?J:J.slice(0,980)+`
(truncated)`},vn=()=>{const x=(Kt||"").trim(),U=encodeURIComponent(ct||""),O=encodeURIComponent((dt||"").replace(/\n/g,`\r
`));window.location.href=`mailto:${encodeURIComponent(x)}?subject=${U}&body=${O}`},Nn=()=>X(this,null,function*(){var x,U;Bs(!0);try{const O=Jt?P(Jt).toISOString():null;if(yield K.post(`/complaints/${t}/acknowledge`,{acknowledged_at:O}),kt){const J=new FormData;J.append("kind","acknowledgement"),J.append("channel","email"),J.append("direction","outbound"),J.append("summary",jn(Kt,ct,dt)),J.append("occurred_at",O||P().toISOString()),J.append("is_final_response","false"),J.append("is_internal","false"),yield K.post(`/complaints/${t}/communications`,J,{headers:{"Content-Type":"multipart/form-data"}})}h({type:"success",text:kt?"Complaint acknowledged and logged in Communications":"Complaint acknowledged"}),Se(),lt(!1)}catch(O){h({type:"error",text:((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||(kt?"Failed to acknowledge and/or log the communication":"Failed to acknowledge complaint")})}finally{Bs(!1)}}),ts=x=>x?String(x).trim().toLowerCase().replace(/\s+/g,"_").replace(/-+/g,"_"):"",wn=()=>X(this,null,function*(){var J,le;if(!t)return;Ht(!0),Nt(null);const x=(Le.rationale||"").trim(),U=(Le.notes||"").trim();if(new Set(["upheld","partially_upheld","not_upheld","out_of_scope"]).has(Le.outcome)&&x.length<10){Ht(!1),Nt("Please add a short rationale (at least 10 characters) for this outcome.");return}try{yield K.post(`/complaints/${t}/outcome`,{outcome:Le.outcome,rationale:x||null,notes:U||null}),st(!1),Se()}catch(ue){Nt(((le=(J=ue==null?void 0:ue.response)==null?void 0:J.data)==null?void 0:le.detail)||"Failed to save outcome")}finally{Ht(!1)}}),Cn=()=>X(this,null,function*(){var J,le,ue;if(!t)return;Ve(!0),Ke(null);const x=(Ee.amount||"").trim(),U=x?Number(x):null,O=(Ee.rationale||"").trim();if(x&&(Number.isNaN(U)||U===null)){Ve(!1),Ke("Please enter a valid amount.");return}if(U!==null&&U<0){Ve(!1),Ke("Amount cannot be negative.");return}if(U!==null&&!/^\d+(\.\d{1,2})?$/.test(x)){Ve(!1),Ke("Amount must have at most 2 decimal places.");return}if(U!==null&&U>0&&O.length<10){Ve(!1),Ke("Please add a short rationale (at least 10 characters) for monetary redress.");return}try{yield K.post(`/complaints/${t}/redress`,{payment_type:Ee.payment_type,amount:U!==null?U:null,rationale:O||null,action_description:Ee.action_description||null,outcome_id:((J=s==null?void 0:s.outcome)==null?void 0:J.id)||null}),nt(!1),at({payment_type:"financial_loss",amount:"",rationale:"",action_description:""}),Se()}catch(xe){Ke(((ue=(le=xe==null?void 0:xe.response)==null?void 0:le.data)==null?void 0:ue.detail)||"Failed to add redress")}finally{Ve(!1)}}),kn=x=>{Vt(null),Ss(x),Ms(P().format("YYYY-MM-DD")),it(!0)},_n=()=>X(this,null,function*(){var x,U;if(!(!t||!Wt)){Es(!0),Vt(null);try{yield K.patch(`/complaints/${t}/redress/${Wt}`,{paid_at:wt?P(wt).startOf("day").toISOString():null}),it(!1),Ss(null),Se()}catch(O){Vt(((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to record payment date")}finally{Es(!1)}}}),Sn=()=>{s!=null&&s.outcome?rt({outcome:s.outcome.outcome,rationale:s.outcome.rationale||"",notes:s.outcome.notes||""}):rt({outcome:"upheld",rationale:"",notes:""}),Nt(null),st(!0)},ss=x=>{cn(x),Fs(P().format("YYYY-MM-DDTHH:mm")),ot(!0)},Mn=()=>X(this,null,function*(){if(!(!t||!As)){Os(!0);try{yield K.post(`/complaints/${t}/${As}`,{closed_at:Ct?P(Ct).toISOString():null}),ot(!1),Se()}catch(x){console.error("Failed to close complaint",x)}finally{Os(!1)}}}),En=()=>{Us(""),Ys(P().format("YYYY-MM-DDTHH:mm")),mt(!0)},Rn=()=>X(this,null,function*(){if(t){zs(!0);try{yield K.post(`/complaints/${t}/reopen`,{reason:(_t==null?void 0:_t.trim())||null,reopened_at:St?P(St).toISOString():null}),mt(!1),Se()}catch(x){console.error("Failed to reopen complaint",x)}finally{zs(!1)}}}),An=()=>{Et(null),Hs(""),Ws(P().format("YYYY-MM-DDTHH:mm")),ut(!0)},Fn=()=>X(this,null,function*(){var x,U;if(t){if(!Mt.trim()){Et("FOS reference is required");return}qs(!0),Et(null);try{yield K.post(`/complaints/${t}/refer-to-fos`,{fos_reference:Mt.trim(),fos_referred_at:Gt?P(Gt).toISOString():null}),ut(!1),Se()}catch(O){Et(((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to refer to FOS")}finally{qs(!1)}}}),Ln=()=>X(this,null,function*(){var x,U;if(t&&(n==null?void 0:n.role)==="admin"){oe(!0);try{yield K.delete(`/complaints/${t}`),r("/complaints")}catch(O){h({type:"error",text:((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to delete complaint"})}finally{oe(!1),k(!1),M("")}}}),On=()=>X(this,null,function*(){var x,U;if(t)try{const O=yield K.get(`/complaints/${t}/timeline.pdf`,{responseType:"blob"}),J=new Blob([O.data],{type:"application/pdf"}),le=window.URL.createObjectURL(J),ue=document.createElement("a");ue.href=le,ue.download=`${(s==null?void 0:s.reference)||"complaint"}-timeline.pdf`,document.body.appendChild(ue),ue.click(),ue.remove(),window.URL.revokeObjectURL(le)}catch(O){h({type:"error",text:((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to download timeline PDF"})}}),Dn=()=>{var x,U,O,J,le;s&&(D(null),C({source:s.source||"",received_at:s.received_at?P(s.received_at).format("YYYY-MM-DDTHH:mm"):P().format("YYYY-MM-DDTHH:mm"),description:s.description||"",category:s.category||"",reason:s.reason||"",vulnerability_flag:!!s.vulnerability_flag,vulnerability_notes:s.vulnerability_notes||"",policy_number:s.policy_number||"",product:s.product||"",insurer:s.insurer||"",broker:s.broker||"",scheme:s.scheme||"",complainant_full_name:((x=s.complainant)==null?void 0:x.full_name)||"",complainant_email:((U=s.complainant)==null?void 0:U.email)||"",complainant_phone:((O=s.complainant)==null?void 0:O.phone)||"",complainant_address:((J=s.complainant)==null?void 0:J.address)||"",complainant_dob:(le=s.complainant)!=null&&le.date_of_birth?P(s.complainant.date_of_birth).format("YYYY-MM-DD"):""}),Y(!0))},Pn=()=>X(this,null,function*(){var x,U;if(t){T(!0),D(null);try{const O={source:g.source||null,received_at:g.received_at?P(g.received_at).toISOString():null,description:g.description||null,category:g.category||null,reason:g.reason||null,vulnerability_flag:g.vulnerability_flag,vulnerability_notes:g.vulnerability_notes||null,product:g.product||null,insurer:g.insurer||null,broker:g.broker||null,scheme:g.scheme||null,policy_number:g.policy_number||null,complainant:{full_name:g.complainant_full_name||null,email:g.complainant_email||null,phone:g.complainant_phone||null,address:g.complainant_address||null,date_of_birth:g.complainant_dob||null},policy:{policy_number:g.policy_number||null,insurer:g.insurer||null,broker:g.broker||null,product:g.product||null,scheme:g.scheme||null}};O.complainant&&!Object.values(O.complainant).some(J=>J!==null)&&delete O.complainant,O.policy&&!Object.values(O.policy).some(J=>J!==null)&&delete O.policy,yield K.patch(`/complaints/${t}`,O),Y(!1),Se(),h({type:"success",text:"Complaint updated"})}catch(O){D(((U=(x=O==null?void 0:O.response)==null?void 0:x.data)==null?void 0:U.detail)||"Failed to update complaint")}finally{T(!1)}}});return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:s.reference,actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Tt,{status:s.status}),(n==null?void 0:n.role)!=="read_only"&&e.jsx(A,{variant:"secondary",onClick:Dn,children:"Edit Complaint"}),(n==null?void 0:n.role)!=="read_only"&&e.jsx(A,{variant:"secondary",onClick:On,children:"Download Timeline"}),(n==null?void 0:n.role)==="admin"&&e.jsx(A,{variant:"secondary",onClick:()=>k(!0),className:"border-semantic-error/40 text-semantic-error hover:bg-semantic-error/5",children:"Delete"}),e.jsx(A,{variant:"secondary",onClick:()=>r("/complaints"),children:"Back"})]})}),e.jsxs("div",{className:"px-10 py-6",children:[w&&e.jsxs("div",{className:`mb-6 rounded-lg border p-4 flex items-start justify-between gap-4 ${w.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:[e.jsx("div",{className:"text-sm",children:w.text}),e.jsx("button",{onClick:()=>h(null),className:"text-sm font-medium underline underline-offset-2",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsx("div",{className:"flex gap-1",children:["overview","communications","outcome","history"].map(x=>e.jsx("button",{onClick:()=>d(x),className:`px-4 py-3 text-sm font-medium capitalize transition border-b-2 ${i===x?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:x},x))})}),i==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[(n==null?void 0:n.role)!=="read_only"&&e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Actions"})}),e.jsx(me,{children:e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[!s.acknowledged_at&&["new","reopened"].includes(ts(s.status))&&e.jsx(A,{variant:"primary",size:"sm",onClick:yn,children:" Acknowledge"}),["acknowledged","new","reopened"].includes(ts(s.status))&&e.jsx(A,{variant:"primary",size:"sm",onClick:()=>es("investigate","Investigation started"),children:" Start Investigation"}),["in_investigation"].includes(ts(s.status))&&e.jsx(A,{variant:"secondary",size:"sm",onClick:()=>es("draft-response","Response drafted"),children:" Draft Response"}),s.outcome&&!s.final_response_at&&e.jsx(A,{variant:"primary",size:"sm",onClick:()=>es("final-response","Final response issued"),children:" Issue Final Response"}),!s.closed_at&&e.jsx(A,{variant:"secondary",size:"sm",onClick:()=>ss("close-non-reportable"),children:" Close as Non-Reportable"}),s.closed_at&&e.jsx(A,{variant:"primary",size:"sm",onClick:En,children:" Reopen Complaint"}),s.fos_complaint?e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-semantic-info/10 text-semantic-info border border-semantic-info/20",children:[e.jsx("span",{className:"text-sm font-medium",children:" Referred to FOS"}),s.fos_reference&&e.jsxs("span",{className:"text-xs",children:["(",s.fos_reference,")"]})]}):e.jsx(A,{variant:"secondary",size:"sm",onClick:An,children:" Refer to Ombudsman"})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Complaint Details"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-text-primary",children:s.description||"No description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Category"}),e.jsx("p",{className:"text-sm text-text-primary",children:s.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Reason"}),e.jsx("p",{className:"text-sm text-text-primary",children:s.reason||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Product"}),e.jsx("p",{className:"text-sm text-text-primary",children:s.product||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Scheme"}),e.jsx("p",{className:"text-sm text-text-primary",children:s.scheme||"N/A"})]})]})]})})]}),s.complainant&&e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Complainant"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-sm text-text-primary font-medium",children:s.complainant.full_name}),s.complainant.email&&e.jsx("p",{className:"text-sm text-text-secondary",children:s.complainant.email}),s.complainant.phone&&e.jsx("p",{className:"text-sm text-text-secondary",children:s.complainant.phone})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Status"})}),e.jsx(me,{children:e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Case State"}),e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:s.closed_at?"Closed":"Open"})]}),e.jsx(Tt,{status:s.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Workflow Status"}),e.jsx("p",{className:"text-sm text-text-primary",children:s.status})]}),e.jsxs("div",{className:"pt-2 border-t border-border space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Ack due"}),e.jsx("span",{className:`text-xs font-medium ${s.ack_breached?"text-semantic-error":"text-text-primary"}`,children:s.ack_due_at?P(s.ack_due_at).format("MMM D, YYYY"):""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Final due"}),e.jsx("span",{className:`text-xs font-medium ${s.final_breached?"text-semantic-error":"text-text-primary"}`,children:s.final_due_at?P(s.final_due_at).format("MMM D, YYYY"):""})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-border",children:[s.ack_breached&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-error/10 text-semantic-error border border-semantic-error/20",children:" Ack breached"}),s.final_breached&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-error/10 text-semantic-error border border-semantic-error/20",children:" Final breached"}),s.is_escalated&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-warning/10 text-semantic-warning border border-semantic-warning/20",children:" Escalated"}),s.fos_complaint&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-info/10 text-semantic-info border border-semantic-info/20",children:" FOS referred"}),s.non_reportable&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-muted border border-border",children:" Non-reportable"}),s.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-warning/10 text-semantic-warning border border-semantic-warning/20",children:" Vulnerable"})]})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Timeline"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Received"}),e.jsx("p",{className:"text-sm text-text-primary",children:P(s.received_at).format("MMM D, YYYY h:mm A")})]}),s.acknowledged_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Acknowledged"}),e.jsx("p",{className:"text-sm text-text-primary",children:P(s.acknowledged_at).format("MMM D, YYYY h:mm A")})]}),s.closed_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Closed"}),e.jsx("p",{className:"text-sm text-text-primary",children:P(s.closed_at).format("MMM D, YYYY h:mm A")})]})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Assignment"})}),e.jsx(me,{children:e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Current Handler"}),e.jsx("p",{className:"text-sm text-text-primary font-semibold",children:s.assigned_handler_name||"Unassigned"})]}),(n==null?void 0:n.role)!=="read_only"&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[(!s.assigned_handler_id||s.assigned_handler_id!==(n==null?void 0:n.id))&&e.jsxs(A,{variant:"secondary",size:"sm",onClick:fn,disabled:ie,className:"w-full",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Assign to Me"]}),((n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="complaints_manager"||(n==null?void 0:n.role)==="reviewer")&&e.jsxs(A,{variant:"secondary",size:"sm",onClick:()=>$(!0),disabled:ie,className:"w-full",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),"Assign to User"]})]})]})})]})]})]}),i==="communications"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Communications"}),e.jsxs(A,{variant:"primary",onClick:()=>ae(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Communication"]})]}),s.communications&&s.communications.length>0?e.jsx("div",{className:"space-y-4",children:s.communications.sort((x,U)=>P(U.occurred_at).valueOf()-P(x.occurred_at).valueOf()).map(x=>{var Te;const O=(x.kind||"").toLowerCase().trim()||(x.is_internal?"note_decision":x.is_final_response?"final_response":(Te=x.summary)!=null&&Te.startsWith("Acknowledgement email sent.")?"acknowledgement":"general"),J=O==="acknowledgement"?"Acknowledgement":O==="final_response"?"Final Response":O==="note_decision"?"Note / Decision":O==="phone_call"?"Phone call":O==="letter"?"Letter":"General",le=(x.summary||"").replace(/\s+/g," ").trim(),ue=le.length>160?le.slice(0,160)+"":le,xe=O==="acknowledgement"?"bg-semantic-info/10 text-semantic-info border-semantic-info/20":O==="final_response"?"bg-semantic-warning/10 text-semantic-warning border-semantic-warning/20":O==="note_decision"?"bg-purple-100 text-purple-700 border-purple-200":"bg-app text-text-primary border-border",Re=!!tn[x.id];return e.jsx(de,{children:e.jsxs(me,{children:[e.jsx("button",{type:"button",className:"w-full text-left",onClick:()=>sn(he=>ee(q({},he),{[x.id]:!he[x.id]})),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium border ${xe}`,children:J}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-primary border border-border",children:x.channel}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${String(x.direction).toLowerCase()==="inbound"?"bg-semantic-info/10 text-semantic-info":"bg-semantic-success/10 text-semantic-success"}`,children:String(x.direction).replace(/_/g," ").replace(/^\w/,he=>he.toUpperCase())}),x.attachments&&x.attachments.length>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-muted border border-border",children:[x.attachments.length," attachment",x.attachments.length===1?"":"s"]})]}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary truncate",children:ue})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-text-muted",children:P(x.occurred_at).format("MMM D, YYYY h:mm A")}),e.jsx("span",{className:"text-xs text-text-muted",children:Re?"Collapse":"Expand"})]})]})}),Re&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[e.jsx("div",{className:"text-sm text-text-primary whitespace-pre-wrap",children:x.summary}),x.attachments&&x.attachments.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:x.attachments.map(he=>e.jsxs("a",{href:he.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1 rounded-lg bg-app text-text-primary hover:bg-border text-xs transition",onClick:Rt=>Rt.stopPropagation(),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),he.file_name]},he.id))})]})]})},x.id)})}):e.jsxs("div",{className:"text-center py-12 rounded-lg border border-border bg-surface",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No communications yet"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:'Click "Add Communication" to log your first interaction'})]})]}),i==="outcome"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(fe,{children:"Outcome"})}),(n==null?void 0:n.role)!=="read_only"&&e.jsx(A,{variant:"primary",size:"sm",onClick:Sn,className:"ml-3",children:s.outcome?"Update Outcome":"Record Outcome"})]})}),e.jsx(me,{children:s.outcome?e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Outcome Type"}),e.jsx("p",{className:"text-sm text-text-primary capitalize",children:s.outcome.outcome.replace(/_/g," ")})]}),s.outcome.rationale&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Rationale"}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.outcome.rationale})]}),s.outcome.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:s.outcome.notes})]})]}):e.jsx("p",{className:"text-sm text-text-secondary mt-4",children:"No outcome recorded yet"})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(fe,{children:"Redress Payments"})}),(n==null?void 0:n.role)!=="read_only"&&e.jsxs(A,{variant:"primary",size:"sm",onClick:()=>nt(!0),className:"ml-3",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Redress"]})]})}),e.jsx(me,{children:s.redress_payments&&s.redress_payments.length>0?e.jsx("div",{className:"space-y-4 mt-4",children:s.redress_payments.map(x=>e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-surface",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary capitalize",children:x.payment_type.replace(/_/g," ")}),x.amount&&e.jsxs("p",{className:"text-lg font-bold text-text-primary mt-1",children:["",x.amount.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[x.paid_at?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-success/10 text-semantic-success border border-semantic-success/20",children:[" Paid ",P(x.paid_at).format("MMM D, YYYY")]}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-secondary border border-border",children:"Recorded"}),(n==null?void 0:n.role)!=="read_only"&&x.amount&&!x.paid_at&&e.jsx(A,{variant:"secondary",size:"sm",onClick:()=>kn(x.id),children:"Record payment date"})]})]}),x.rationale&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Rationale"}),e.jsx("p",{className:"text-sm text-text-secondary",children:x.rationale})]}),x.action_description&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Action"}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsx("p",{className:"text-sm text-text-secondary flex-1",children:x.action_description})})]})]},x.id))}):e.jsxs("div",{className:"text-center py-12 mt-4",children:[e.jsx("div",{className:"mx-auto h-12 w-12 rounded-full border-2 border-text-muted flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-text-muted",children:""})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No redress payments"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"No redress payments have been recorded for this complaint"})]})})]}),(n==null?void 0:n.role)!=="read_only"&&s.status!=="Closed"&&e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Close Complaint"})}),e.jsxs(me,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[s.final_response_at&&e.jsx(A,{variant:"primary",onClick:()=>ss("close"),children:" Close Complaint"}),e.jsx(A,{variant:"secondary",onClick:()=>ss("close-non-reportable"),children:" Close as Non-Reportable"})]}),!s.final_response_at&&e.jsx("p",{className:"text-xs text-text-muted mt-3",children:"Note: Final response must be issued before closing the complaint normally."})]})]})]}),i==="history"&&e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx("div",{className:"flex items-start justify-between gap-4 w-full",children:e.jsxs("div",{children:[e.jsx(fe,{children:"Activity History"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"Filter noise to review key compliance events quickly."})]})})}),e.jsx(me,{children:c&&c.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 mb-4 rounded-lg border border-border bg-surface p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 justify-between",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:[{key:"all",label:"All"},{key:"status",label:"Status changes"},{key:"communications",label:"Communications"},{key:"decisions",label:"Outcome / Redress / FOS"},{key:"assignment",label:"Assignment"}].map(x=>e.jsx("button",{onClick:()=>b(x.key),className:`px-3 py-1.5 rounded-lg text-sm font-medium border transition ${N===x.key?"bg-app border-border text-text-primary":"bg-surface border-border text-text-secondary hover:text-text-primary hover:bg-app"}`,children:x.label},x.key))}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:x=>I(x.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Show Viewed"})]}),e.jsx("button",{onClick:()=>{b("all"),I(!1)},className:"text-sm font-medium text-brand hover:text-brand-dark",children:"Reset"})]})]})}),e.jsx("div",{className:"space-y-0",children:(()=>{const x=[...c].sort((xe,Re)=>P(Re.created_at).valueOf()-P(xe.created_at).valueOf()),U=new Set(["created","updated","acknowledged","investigation_started","response_drafted","final_response_issued","closed","closed_non_reportable","reopened","escalated"]),O=new Set(["communication_added"]),J=new Set(["outcome_recorded","redress_added","redress_updated","referred_to_fos"]),le=new Set(["assigned"]),ue=x.filter(xe=>!y&&xe.event_type==="accessed"?!1:N==="status"?U.has(xe.event_type):N==="communications"?O.has(xe.event_type):N==="decisions"?J.has(xe.event_type):N==="assignment"?le.has(xe.event_type):!0);return ue.length===0?e.jsxs("div",{className:"text-center py-10 rounded-lg border border-border bg-surface",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"No events match your filters"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"Try resetting filters or enabling Viewed."})]}):ue.map(xe=>{const Re=he=>he==="created"?"":he==="accessed"?"":he==="updated"?"":he==="acknowledged"?"":he==="investigation_started"?"":he==="response_drafted"?"":he==="outcome_recorded"?"":he==="final_response_issued"?"":he==="closed"?"":he==="closed_non_reportable"?"":he==="reopened"?"":he==="escalated"?"":he==="assigned"?"":he==="referred_to_fos"?"":he==="communication_added"?"":he==="redress_added"||he==="redress_updated"?"":"",Te=he=>he.split("_").map(Rt=>Rt.charAt(0).toUpperCase()+Rt.slice(1)).join(" ");return e.jsxs("div",{className:"flex gap-4 py-3 border-b border-border last:border-0 hover:bg-surface/50 transition px-3 -mx-3 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 text-lg pt-0.5",children:Re(xe.event_type)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:Te(xe.event_type)}),xe.description&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:xe.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5 flex-wrap",children:[xe.created_by_name&&e.jsxs("span",{className:"text-xs text-text-muted",children:["by ",xe.created_by_name]}),e.jsx("span",{className:"text-xs text-text-muted",children:P(xe.created_at).format("MMM D, YYYY [at] h:mm A")})]})]})})})]},xe.id)})})()})]}):e.jsxs("div",{className:"text-center py-12 mt-4",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No history events recorded"})]})})]})]}),e.jsxs(ge,{open:se,onClose:()=>$(!1),children:[e.jsx(ye,{onClose:()=>$(!1),children:"Assign Complaint"}),e.jsxs(je,{children:[be&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:be}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"assign-handler",className:"block text-xs font-medium text-text-primary",children:"Select Handler *"}),e.jsxs("select",{id:"assign-handler",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:re,onChange:x=>E(x.target.value),children:[e.jsx("option",{value:"",children:"-- Select a user --"}),m.map(x=>e.jsxs("option",{value:x.id,children:[x.full_name," (",x.role.replace(/_/g," "),")"]},x.id))]})]})})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>$(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:bn,disabled:!re||ie,children:ie?"Assigning...":"Assign"})]})]}),e.jsxs(ge,{open:dn,onClose:()=>lt(!1),children:[e.jsx(ye,{onClose:()=>lt(!1),children:"Acknowledge complaint"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border border-border bg-app p-3 text-sm text-text-secondary",children:"Copy this template into Outlook, or use Open email client to prefill a draft (works best when Outlook is your default mail app)."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"To"}),e.jsx(te,{value:Kt,onChange:x=>Ds(x.target.value),placeholder:"customer@email.com"}),!((Qs=s==null?void 0:s.complainant)!=null&&Qs.email)&&e.jsx("p",{className:"text-xs text-text-muted",children:"No email is stored for this complainant  add it in the complaint details if available."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"ack-sent-at",className:"block text-xs font-medium text-text-primary",children:"Email sent at *"}),e.jsx(te,{id:"ack-sent-at",type:"datetime-local",value:Jt,onChange:x=>$s(x.target.value)}),e.jsx("p",{className:"text-xs text-text-muted",children:"This timestamp will be stored as the acknowledgement time for SLA purposes."})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:kt,onChange:x=>Is(x.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Log this email in Communications"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Subject"}),e.jsx(A,{variant:"secondary",size:"sm",onClick:()=>Js(ct,"Subject copied"),children:"Copy subject"})]}),e.jsx(te,{value:ct,onChange:x=>Ps(x.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Body"}),e.jsx(A,{variant:"secondary",size:"sm",onClick:()=>Js(dt,"Email body copied"),children:"Copy body"})]}),e.jsx("textarea",{className:"w-full min-h-[180px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:dt,onChange:x=>Ts(x.target.value)})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(A,{variant:"secondary",onClick:vn,disabled:!ct&&!dt,children:"Open email client"})})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>lt(!1),disabled:Qt,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:Nn,disabled:Qt,children:Qt?"Acknowledging...":"Mark acknowledged"})]})]}),e.jsxs(ge,{open:ln,onClose:()=>ot(!1),children:[e.jsx(ye,{onClose:()=>ot(!1),children:"Confirm Closure"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Please confirm the closure date for this complaint."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"close-date",className:"block text-xs font-medium text-text-primary",children:"Closure Date & Time *"}),e.jsx(te,{id:"close-date",type:"datetime-local",value:Ct,onChange:x=>Fs(x.target.value)})]})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>ot(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:Mn,disabled:Ls||!Ct,children:Ls?"Closing...":"Confirm Closure"})]})]}),e.jsxs(ge,{open:mn,onClose:()=>mt(!1),children:[e.jsx(ye,{onClose:()=>mt(!1),children:"Reopen Complaint"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Reopening will remove the closure date and set the status back to an active state."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"reopen-date",className:"block text-xs font-medium text-text-primary",children:"Reopen Date & Time *"}),e.jsx(te,{id:"reopen-date",type:"datetime-local",value:St,onChange:x=>Ys(x.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Reason (optional)"}),e.jsx("textarea",{className:"w-full min-h-[90px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:_t,onChange:x=>Us(x.target.value),placeholder:"Why is the complaint being reopened?"})]})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>mt(!1),disabled:Xt,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:Rn,disabled:Xt||!St,children:Xt?"Reopening...":"Reopen"})]})]}),e.jsxs(ge,{open:un,onClose:()=>ut(!1),children:[e.jsx(ye,{onClose:()=>ut(!1),children:"Refer to Ombudsman (FOS)"}),e.jsxs(je,{children:[Vs&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:Vs}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Record the referral details. This can only be done once per complaint."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"fos-reference",className:"block text-xs font-medium text-text-primary",children:"FOS Reference *"}),e.jsx(te,{id:"fos-reference",value:Mt,onChange:x=>Hs(x.target.value),placeholder:"e.g. FOS-12345678",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"fos-date",className:"block text-xs font-medium text-text-primary",children:"Date Referred *"}),e.jsx(te,{id:"fos-date",type:"datetime-local",value:Gt,onChange:x=>Ws(x.target.value)})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>ut(!1),disabled:Zt,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:Fn,disabled:Zt||!Mt.trim(),children:Zt?"Referring...":"Confirm Referral"})]})]}),e.jsxs(ge,{open:nn,onClose:()=>st(!1),children:[e.jsx(ye,{onClose:()=>st(!1),children:s!=null&&s.outcome?"Update Outcome":"Record Outcome"}),e.jsxs(je,{children:[Cs&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:Cs}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"outcome-type",className:"block text-xs font-medium text-text-primary",children:"Outcome *"}),e.jsxs("select",{id:"outcome-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Le.outcome,onChange:x=>rt(ee(q({},Le),{outcome:x.target.value})),children:[e.jsx("option",{value:"upheld",children:"Upheld"}),e.jsx("option",{value:"partially_upheld",children:"Partially Upheld"}),e.jsx("option",{value:"not_upheld",children:"Not Upheld"}),e.jsx("option",{value:"withdrawn",children:"Withdrawn"}),e.jsx("option",{value:"out_of_scope",children:"Out of Scope"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Rationale"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Le.rationale,onChange:x=>rt(ee(q({},Le),{rationale:x.target.value})),placeholder:"Why was this outcome selected?"}),e.jsx("p",{className:"text-xs text-text-muted",children:"This should capture the decision rationale for auditability."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Notes (optional)"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Le.notes,onChange:x=>rt(ee(q({},Le),{notes:x.target.value})),placeholder:"Any additional notes..."})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>st(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:wn,disabled:ws,children:ws?"Saving...":"Save Outcome"})]})]}),e.jsxs(ge,{open:an,onClose:()=>nt(!1),children:[e.jsx(ye,{onClose:()=>nt(!1),children:"Add Redress Payment"}),e.jsxs(je,{children:[_s&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:_s}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"redress-type",className:"block text-xs font-medium text-text-primary",children:"Redress Type *"}),e.jsxs("select",{id:"redress-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ee.payment_type,onChange:x=>at(ee(q({},Ee),{payment_type:x.target.value})),children:[e.jsx("option",{value:"financial_loss",children:"Financial Loss"}),e.jsx("option",{value:"interest_on_financial_loss",children:"Interest on Financial Loss"}),e.jsx("option",{value:"distress_and_inconvenience",children:"Distress and Inconvenience"}),e.jsx("option",{value:"consequential_loss",children:"Consequential Loss"}),e.jsx("option",{value:"premium_refund_adjustment",children:"Premium Refund/Adjustment"}),e.jsx("option",{value:"goodwill_payment",children:"Goodwill Payment"}),e.jsx("option",{value:"third_party_payment",children:"Third Party Payment"}),e.jsx("option",{value:"apology_or_explanation",children:"Apology or Explanation"}),e.jsx("option",{value:"remedial_action",children:"Remedial Action"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Amount ()"}),e.jsx(te,{type:"number",step:"0.01",value:Ee.amount,onChange:x=>at(ee(q({},Ee),{amount:x.target.value})),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Leave blank for non-monetary redress"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Rationale"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ee.rationale,onChange:x=>at(ee(q({},Ee),{rationale:x.target.value})),placeholder:"Why is this redress being offered?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Action Description"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ee.action_description,onChange:x=>at(ee(q({},Ee),{action_description:x.target.value})),placeholder:"What action needs to be taken?"})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>nt(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:Cn,disabled:ks,children:ks?"Adding...":"Add Redress"})]})]}),e.jsxs(ge,{open:on,onClose:()=>it(!1),children:[e.jsx(ye,{onClose:()=>it(!1),children:"Record Payment Date"}),e.jsxs(je,{children:[Rs&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:Rs}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Record the date the redress payment was made."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"paid-at-date",className:"block text-xs font-medium text-text-primary",children:"Payment Date *"}),e.jsx(te,{id:"paid-at-date",type:"date",value:wt,onChange:x=>Ms(x.target.value)})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>it(!1),disabled:qt,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:_n,disabled:qt||!wt||!Wt,children:qt?"Saving...":"Save payment date"})]})]}),e.jsxs(ge,{open:Z,onClose:()=>ae(!1),children:[e.jsx(ye,{onClose:()=>ae(!1),children:"Add Communication"}),e.jsxs(je,{children:[vs&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:vs}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-type",className:"block text-xs font-medium text-text-primary",children:"Audience *"}),e.jsxs("select",{id:"comm-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:z.is_internal?"note":"communication",onChange:x=>{const U=x.target.value==="note";Me(ee(q({},z),{is_internal:U,kind:U?"note_decision":z.kind==="note_decision"?"general":z.kind,channel:U?"other":z.channel,direction:U?"outbound":z.direction,is_final_response:U?!1:z.is_final_response}))},children:[e.jsx("option",{value:"communication",children:"Customer Communication"}),e.jsx("option",{value:"note",children:"Note / Decision (internal)"})]}),z.is_internal&&e.jsx("div",{className:"rounded-lg border border-semantic-info/30 bg-semantic-info/5 p-3 text-sm text-semantic-info",children:"This is an internal diary entry. It will not issue a final response and can be used for observations/decisions."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-kind",className:"block text-xs font-medium text-text-primary",children:"Tag"}),e.jsxs("select",{id:"comm-kind",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:z.is_internal?"note_decision":z.kind,onChange:x=>{const U=x.target.value;Me(ee(q({},z),{kind:U,is_final_response:U==="final_response"?!0:z.is_final_response}))},disabled:z.is_internal,children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"acknowledgement",children:"Acknowledgement"}),e.jsx("option",{value:"final_response",children:"Final Response"}),e.jsx("option",{value:"phone_call",children:"Phone call"}),e.jsx("option",{value:"letter",children:"Letter"})]}),e.jsx("p",{className:"text-xs text-text-muted",children:"Helps keep the Communications tab scannable (shown as a chip)."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-channel",className:"block text-xs font-medium text-text-primary",children:"Channel *"}),e.jsxs("select",{id:"comm-channel",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:z.channel,onChange:x=>Me(ee(q({},z),{channel:x.target.value})),disabled:z.is_internal,children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Phone"}),e.jsx("option",{value:"letter",children:"Letter"}),e.jsx("option",{value:"web",children:"Web Form"}),e.jsx("option",{value:"third_party",children:"Third Party"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-direction",className:"block text-xs font-medium text-text-primary",children:"Direction *"}),e.jsxs("select",{id:"comm-direction",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:z.direction,onChange:x=>Me(ee(q({},z),{direction:x.target.value})),disabled:z.is_internal,children:[e.jsx("option",{value:"inbound",children:"Inbound"}),e.jsx("option",{value:"outbound",children:"Outbound"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Date & Time *"}),e.jsx(te,{type:"datetime-local",value:z.occurred_at,onChange:x=>Me(ee(q({},z),{occurred_at:x.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Summary *"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:z.summary,onChange:x=>Me(ee(q({},z),{summary:x.target.value})),placeholder:"Describe the communication..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-attachments",className:"block text-xs font-medium text-text-primary",children:"Attachments"}),e.jsx("input",{id:"comm-attachments",type:"file",multiple:!0,onChange:x=>ys(x.target.files),className:"w-full text-sm text-text-primary file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-brand file:text-white hover:file:opacity-90 cursor-pointer"})]}),!z.is_internal&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:z.is_final_response,onChange:()=>Me(ee(q({},z),{is_final_response:!z.is_final_response})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Mark as Final Response"})]}),z.is_final_response&&e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"Final responses should normally have evidence attached (e.g., final response letter/email)."})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>ae(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:()=>Ks(),disabled:!z.summary||vt,children:vt?"Adding...":"Add Communication"})]})]}),e.jsxs(ge,{open:rn,onClose:()=>tt(!1),children:[e.jsx(ye,{onClose:()=>tt(!1),children:"Final Response without attachment?"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["You marked this communication as a ",e.jsx("strong",{className:"text-text-primary",children:"Final Response"}),", but no attachment was added."]}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"For auditability, attach the final response letter/email where possible."}),e.jsx("p",{className:"text-sm text-text-secondary",children:"You can continue without an attachment if the evidence is stored elsewhere, but this may increase operational risk."})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>tt(!1),disabled:vt,children:"Go back"}),e.jsx(A,{variant:"primary",onClick:gn,disabled:vt,children:"Continue anyway"})]})]}),e.jsxs(ge,{open:L,onClose:()=>Y(!1),children:[e.jsx(ye,{onClose:()=>Y(!1),children:"Edit Complaint"}),e.jsxs(je,{children:[G&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:G}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4",children:[e.jsx("p",{className:"text-xs font-semibold text-text-secondary mb-3",children:"Receipt Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Source"}),e.jsxs("select",{"aria-label":"Source",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:g.source,onChange:x=>C(ee(q({},g),{source:x.target.value})),children:[e.jsx("option",{value:"",children:"Select source"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Phone"}),e.jsx("option",{value:"letter",children:"Letter"}),e.jsx("option",{value:"web",children:"Web Form"}),e.jsx("option",{value:"third_party",children:"Third Party"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Received"}),e.jsx(te,{type:"datetime-local",value:g.received_at,onChange:x=>C(ee(q({},g),{received_at:x.target.value}))})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4",children:[e.jsx("p",{className:"text-xs font-semibold text-text-secondary mb-3",children:"Complaint Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Category"}),e.jsx(te,{value:g.category,onChange:x=>C(ee(q({},g),{category:x.target.value})),placeholder:"Category"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Reason"}),e.jsx(te,{value:g.reason,onChange:x=>C(ee(q({},g),{reason:x.target.value})),placeholder:"Reason"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Description"}),e.jsx("textarea",{className:"w-full min-h-[120px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:g.description,onChange:x=>C(ee(q({},g),{description:x.target.value})),placeholder:"Description"})]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4",children:[e.jsx("p",{className:"text-xs font-semibold text-text-secondary mb-3",children:"Complainant Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name"}),e.jsx(te,{value:g.complainant_full_name,onChange:x=>C(ee(q({},g),{complainant_full_name:x.target.value})),placeholder:"Full name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Date of Birth"}),e.jsx(te,{type:"date",value:g.complainant_dob,onChange:x=>C(ee(q({},g),{complainant_dob:x.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(te,{value:g.complainant_email,onChange:x=>C(ee(q({},g),{complainant_email:x.target.value})),placeholder:"Email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Phone"}),e.jsx(te,{value:g.complainant_phone,onChange:x=>C(ee(q({},g),{complainant_phone:x.target.value})),placeholder:"Phone"})]}),e.jsxs("div",{className:"md:col-span-2 space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Address"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:g.complainant_address,onChange:x=>C(ee(q({},g),{complainant_address:x.target.value})),placeholder:"Address"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer mt-4",children:[e.jsx("input",{type:"checkbox",checked:g.vulnerability_flag,onChange:()=>C(ee(q({},g),{vulnerability_flag:!g.vulnerability_flag})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Vulnerable Customer"})]}),g.vulnerability_flag&&e.jsxs("div",{className:"space-y-2 mt-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Vulnerability Notes"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:g.vulnerability_notes,onChange:x=>C(ee(q({},g),{vulnerability_notes:x.target.value})),placeholder:"Notes"})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-surface p-4",children:[e.jsx("p",{className:"text-xs font-semibold text-text-secondary mb-3",children:"Policy Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Policy Number"}),e.jsx(te,{value:g.policy_number,onChange:x=>C(ee(q({},g),{policy_number:x.target.value})),placeholder:"Policy number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Product"}),e.jsx(Qe,{value:g.product,onChange:x=>C(ee(q({},g),{product:x})),options:_,placeholder:"Select or type product..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Insurer"}),e.jsx(Qe,{value:g.insurer,onChange:x=>C(ee(q({},g),{insurer:x})),options:B,placeholder:"Select or type insurer..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Broker"}),e.jsx(Qe,{value:g.broker,onChange:x=>C(ee(q({},g),{broker:x})),options:S,placeholder:"Select or type broker..."})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Scheme"}),e.jsx(te,{value:g.scheme,onChange:x=>C(ee(q({},g),{scheme:x.target.value})),placeholder:"Scheme"})]})]})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>Y(!1),disabled:H,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:Pn,disabled:H,children:H?"Saving":"Save changes"})]})]}),e.jsxs(ge,{open:v,onClose:()=>k(!1),children:[e.jsx(ye,{onClose:()=>k(!1),children:"Delete Complaint"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:"This will permanently delete the complaint and all related records (including communications and attachments)."}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["To confirm, type the complaint reference:"," ",e.jsx("span",{className:"font-semibold text-text-primary",children:s.reference})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"delete-confirm",className:"block text-xs font-medium text-text-primary",children:"Type reference to confirm"}),e.jsx(te,{id:"delete-confirm",value:F,onChange:x=>M(x.target.value),placeholder:s.reference,autoFocus:!0})]})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>k(!1),disabled:W,children:"Cancel"}),e.jsx(A,{variant:"secondary",onClick:Ln,disabled:W||F.trim()!==s.reference,className:"border-semantic-error/40 text-semantic-error hover:bg-semantic-error/5",children:W?"Deleting...":"Delete permanently"})]})]})]})}function Oi(){const t=Ge(),[r,n]=f.useState(!1),[s,a]=f.useState(null),[c,o]=f.useState(!1),[u,l]=f.useState({}),[i,d]=f.useState(!1),[m,p]=f.useState([]),[w,h]=f.useState([]),[N,b]=f.useState([]);f.useEffect(()=>{Promise.all([K.get("/reference/products"),K.get("/reference/insurers"),K.get("/reference/brokers")]).then(([L,Y,H])=>{p(L.data.map(T=>T.name)),h(Y.data.map(T=>T.name)),b(H.data.map(T=>T.name))}).catch(L=>{console.error("Failed to load reference data",L)})},[]);const[y,I]=f.useState({source:"Email",received_at:P().format("YYYY-MM-DDTHH:mm"),description:"",category:"",reason:"",vulnerability_flag:!1,vulnerability_notes:"",policy_number:"",insurer:"",broker:"",product:"",scheme:"",complainant_name:"",complainant_email:"",complainant_phone:"",complainant_address:"",complainant_dob:""});f.useEffect(()=>{const L=!!(y.complainant_name||y.description||y.category);o(L)},[y]),f.useEffect(()=>{const L=Y=>{c&&(Y.preventDefault(),Y.returnValue="")};return window.addEventListener("beforeunload",L),()=>window.removeEventListener("beforeunload",L)},[c]),f.useEffect(()=>{const L=Y=>{var H;(Y.metaKey||Y.ctrlKey)&&Y.key==="s"&&(Y.preventDefault(),(H=document.getElementById("submit-btn"))==null||H.click())};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[]);const v=L=>L?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(L):!0,k=(L,Y)=>{if(I(ee(q({},y),{[L]:Y})),u[L]){const H=q({},u);delete H[L],l(H)}},F=()=>{if(c){d(!0);return}t("/complaints")},M=()=>{I(ee(q({},y),{received_at:P().format("YYYY-MM-DDTHH:mm")}))},W=L=>X(this,null,function*(){var H,T;L.preventDefault(),a(null),l({});const Y={};if(y.complainant_name.trim()||(Y.complainant_name="Full name is required"),y.complainant_email&&!v(y.complainant_email)&&(Y.complainant_email="Invalid email format"),y.description.trim()||(Y.description="Description is required"),y.category||(Y.category="Category is required"),Object.keys(Y).length>0){l(Y),a("Please fix the validation errors before submitting");return}n(!0);try{const G=yield K.post("/complaints",{source:y.source,received_at:P(y.received_at).toISOString(),description:y.description,category:y.category,reason:y.reason||null,fca_complaint:!0,fca_rationale:null,vulnerability_flag:y.vulnerability_flag,vulnerability_notes:y.vulnerability_notes||null,policy_number:y.policy_number||null,insurer:y.insurer||null,broker:y.broker||null,product:y.product||null,scheme:y.scheme||null,complainant:{full_name:y.complainant_name,email:y.complainant_email||null,phone:y.complainant_phone||null,address:y.complainant_address||null,date_of_birth:y.complainant_dob||null},policy:{policy_number:y.policy_number||null,insurer:y.insurer||null,broker:y.broker||null,product:y.product||null,scheme:y.scheme||null}});o(!1),t(`/complaints/${G.data.id}`,{state:{message:"Complaint created successfully!"}})}catch(G){a(((T=(H=G==null?void 0:G.response)==null?void 0:H.data)==null?void 0:T.detail)||"Failed to create complaint"),n(!1)}}),oe=(L,Y)=>{const H=Y-L.length,T=H<=50,G=H<0;return e.jsxs("span",{className:`text-xs ${G?"text-semantic-error":T?"text-semantic-warning":"text-text-muted"}`,children:[L.length," / ",Y]})};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Create New Complaint",actions:e.jsxs("div",{className:"flex items-center gap-4",children:[c&&e.jsx("span",{className:"text-xs text-text-muted",children:"Unsaved changes"}),e.jsx(A,{variant:"secondary",onClick:F,type:"button",children:"Cancel"})]})}),e.jsxs("div",{className:"px-10 py-6 max-w-4xl",children:[s&&e.jsx("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:s}),e.jsxs("div",{className:"mb-6 bg-surface rounded-lg border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary mb-2",children:[e.jsx("span",{children:"Complaint Creation Form"}),e.jsx("span",{className:"text-text-muted",children:"Tip: Press Cmd/Ctrl + S to submit"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Receipt Information"}),e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Complainant Details"}),e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Complaint Details"}),e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Policy Information"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-text-muted mt-2",children:[e.jsx("span",{children:"Receipt"}),e.jsx("span",{children:"Complainant"}),e.jsx("span",{children:"Complaint"}),e.jsx("span",{children:"Policy"})]})]}),e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Receipt Information"})}),e.jsx(me,{children:e.jsx("div",{className:"space-y-4 mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"source",className:"block text-xs font-medium text-text-primary",children:"Source *"}),e.jsxs("select",{id:"source",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:y.source,onChange:L=>k("source",L.target.value),required:!0,children:[e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"Phone",children:"Phone"}),e.jsx("option",{value:"Letter",children:"Letter"}),e.jsx("option",{value:"Web Form",children:"Web Form"}),e.jsx("option",{value:"In Person",children:"In Person"}),e.jsx("option",{value:"Social Media",children:"Social Media"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"received_at",className:"block text-xs font-medium text-text-primary",children:"Date Received *"}),e.jsx("button",{type:"button",onClick:M,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Set to Now"})]}),e.jsx(te,{id:"received_at",type:"datetime-local",value:y.received_at,onChange:L=>k("received_at",L.target.value),required:!0})]})]})})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Complainant Details"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_name",className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(te,{id:"complainant_name",value:y.complainant_name,onChange:L=>k("complainant_name",L.target.value),placeholder:"John Doe",required:!0,className:u.complainant_name?"border-semantic-error":""}),u.complainant_name&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.complainant_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_email",className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(te,{id:"complainant_email",type:"email",value:y.complainant_email,onChange:L=>k("complainant_email",L.target.value),placeholder:"john@example.com",className:u.complainant_email?"border-semantic-error":""}),u.complainant_email&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.complainant_email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_phone",className:"block text-xs font-medium text-text-primary",children:"Phone"}),e.jsx(te,{id:"complainant_phone",value:y.complainant_phone,onChange:L=>k("complainant_phone",L.target.value),placeholder:"+44 20 1234 5678"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"complainant_dob",className:"block text-xs font-medium text-text-primary",children:["Date of Birth",e.jsx("span",{className:"text-text-muted font-normal ml-1",children:"(for verification)"})]}),e.jsx(te,{id:"complainant_dob",type:"date",value:y.complainant_dob,onChange:L=>k("complainant_dob",L.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_address",className:"block text-xs font-medium text-text-primary",children:"Address"}),e.jsx(te,{id:"complainant_address",value:y.complainant_address,onChange:L=>k("complainant_address",L.target.value),placeholder:"Full address..."})]})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{id:"vulnerability_flag",type:"checkbox",checked:y.vulnerability_flag,onChange:()=>k("vulnerability_flag",!y.vulnerability_flag),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Vulnerable Customer"})]}),y.vulnerability_flag&&e.jsxs("div",{className:"pl-7 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"vulnerability_notes",className:"block text-xs font-medium text-text-primary",children:"Vulnerability Notes"}),oe(y.vulnerability_notes,500)]}),e.jsx("textarea",{id:"vulnerability_notes",className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:y.vulnerability_notes,onChange:L=>k("vulnerability_notes",L.target.value),placeholder:"Details about vulnerability...",maxLength:500})]})]})})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Complaint Details"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"description",className:"block text-xs font-medium text-text-primary",children:"Description *"}),oe(y.description,2e3)]}),e.jsx("textarea",{id:"description",className:`w-full min-h-[120px] rounded-lg border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${u.description?"border-semantic-error":"border-border"}`,value:y.description,onChange:L=>k("description",L.target.value),placeholder:"Detailed description of the complaint...",maxLength:2e3,required:!0}),u.description&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-xs font-medium text-text-primary",children:"Category *"}),e.jsxs("select",{id:"category",className:`w-full h-10 rounded-lg border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${u.category?"border-semantic-error":"border-border"}`,value:y.category,onChange:L=>k("category",L.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select category..."}),e.jsx("option",{value:"Claims",children:"Claims"}),e.jsx("option",{value:"Policy",children:"Policy"}),e.jsx("option",{value:"Service",children:"Service"}),e.jsx("option",{value:"Premium",children:"Premium"}),e.jsx("option",{value:"Communication",children:"Communication"}),e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Other",children:"Other"})]}),u.category&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.category})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"reason",className:"block text-xs font-medium text-text-primary",children:["Reason",e.jsx("span",{className:"text-text-muted font-normal ml-1",children:"(optional)"})]}),e.jsx(te,{id:"reason",value:y.reason,onChange:L=>k("reason",L.target.value),placeholder:"Specific reason..."})]})]})]})})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Policy Information"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"policy_number",className:"block text-xs font-medium text-text-primary",children:["Policy Number",e.jsx("span",{className:"text-text-muted font-normal ml-1",children:"(if known)"})]}),e.jsx(te,{id:"policy_number",value:y.policy_number,onChange:L=>k("policy_number",L.target.value),placeholder:"POL-12345"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"product",className:"block text-xs font-medium text-text-primary",children:"Product"}),e.jsx(Qe,{value:y.product,onChange:L=>k("product",L),options:m,placeholder:"Select or type product..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"insurer",className:"block text-xs font-medium text-text-primary",children:"Insurer"}),e.jsx(Qe,{value:y.insurer,onChange:L=>k("insurer",L),options:w,placeholder:"Select or type insurer..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"broker",className:"block text-xs font-medium text-text-primary",children:"Broker"}),e.jsx(Qe,{value:y.broker,onChange:L=>k("broker",L),options:N,placeholder:"Select or type broker..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"scheme",className:"block text-xs font-medium text-text-primary",children:"Scheme"}),e.jsx(te,{id:"scheme",value:y.scheme,onChange:L=>k("scheme",L.target.value),placeholder:"Scheme name..."})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 sticky bottom-6 bg-app/95 backdrop-blur-sm p-4 rounded-lg border border-border shadow-lg",children:[e.jsx(A,{variant:"secondary",onClick:F,type:"button",children:"Cancel"}),e.jsx(A,{id:"submit-btn",variant:"primary",type:"submit",disabled:r,children:r?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Complaint"})]})]})]}),e.jsxs(ge,{open:i,onClose:()=>d(!1),children:[e.jsx(ye,{onClose:()=>d(!1),children:"Discard changes?"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"You have unsaved changes. If you leave now, they will be lost."}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"This complaint has not been created yet."})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>d(!1),children:"Stay here"}),e.jsx(A,{variant:"primary",onClick:()=>{d(!1),t("/complaints")},children:"Discard & Exit"})]})]})]})}var Qr={exports:{}};(function(t,r){(function(n,s){t.exports=s()})(vr,function(){return function(n,s,a){n=n||{};var c=s.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function u(i,d,m,p){return c.fromToBase(i,d,m,p)}a.en.relativeTime=o,c.fromToBase=function(i,d,m,p,w){for(var h,N,b,y=m.$locale().relativeTime||o,I=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],v=I.length,k=0;k<v;k+=1){var F=I[k];F.d&&(h=p?a(i).diff(m,F.d,!0):m.diff(i,F.d,!0));var M=(n.rounding||Math.round)(Math.abs(h));if(b=h>0,M<=F.r||!F.r){M<=1&&k>0&&(F=I[k-1]);var W=y[F.l];w&&(M=w(""+M)),N=typeof W=="string"?W.replace("%d",M):W(M,d,F.l,b);break}}if(d)return N;var oe=b?y.future:y.past;return typeof oe=="function"?oe(N):oe.replace("%s",N)},c.to=function(i,d){return u(i,d,this,!0)},c.from=function(i,d){return u(i,d,this)};var l=function(i){return i.$u?a.utc():a()};c.toNow=function(i){return this.to(l(this),i)},c.fromNow=function(i){return this.from(l(this),i)}}})})(Qr);var Di=Qr.exports;const Pi=Nr(Di);P.extend(Pi);function Ti(){var w;const t=Ge(),{user:r}=qe(),[n,s]=f.useState(!0),[a,c]=f.useState(null),[o,u]=f.useState([]);f.useEffect(()=>{l()},[]);const l=()=>X(this,null,function*(){if(r!=null&&r.id){s(!0),c(null);try{const N=(yield K.get("/complaints",{params:{handler_id:r.id,page:1,page_size:100,_:Date.now()}})).data.filter(M=>M.status!=="Closed"),b=N.filter(M=>(M.status==="New"||M.status==="Reopened")&&!M.acknowledged_at&&M.ack_due_at&&P(M.ack_due_at).isAfter(P())),y=N.filter(M=>(M.status==="New"||M.status==="Reopened")&&!M.acknowledged_at&&M.ack_due_at&&P(M.ack_due_at).isBefore(P())),I=N.filter(M=>M.status==="In Investigation"||M.status==="Acknowledged"),v=N.filter(M=>M.status==="Response Drafted"&&!M.final_response_at&&M.final_due_at&&P(M.final_due_at).isAfter(P())),k=N.filter(M=>(M.status==="Response Drafted"||M.status==="In Investigation"||M.status==="Acknowledged")&&!M.final_response_at&&M.final_due_at&&P(M.final_due_at).isBefore(P())),F=[];y.length>0&&F.push({title:"Acknowledgements Overdue",description:"These complaints need acknowledgement urgently",icon:"",colorClass:"semantic-error",bgColorClass:"bg-semantic-error/10",textColorClass:"text-semantic-error",complaints:y.sort((M,W)=>P(M.ack_due_at).valueOf()-P(W.ack_due_at).valueOf())}),b.length>0&&F.push({title:"Acknowledgements Due",description:"These complaints need acknowledgement soon",icon:"",colorClass:"semantic-warning",bgColorClass:"bg-semantic-warning/10",textColorClass:"text-semantic-warning",complaints:b.sort((M,W)=>P(M.ack_due_at).valueOf()-P(W.ack_due_at).valueOf())}),k.length>0&&F.push({title:"Final Responses Overdue",description:"These complaints need final response urgently",icon:"",colorClass:"semantic-error",bgColorClass:"bg-semantic-error/10",textColorClass:"text-semantic-error",complaints:k.sort((M,W)=>P(M.final_due_at).valueOf()-P(W.final_due_at).valueOf())}),v.length>0&&F.push({title:"Final Responses Due",description:"These complaints are ready for final response",icon:"",colorClass:"semantic-info",bgColorClass:"bg-semantic-info/10",textColorClass:"text-semantic-info",complaints:v.sort((M,W)=>P(M.final_due_at).valueOf()-P(W.final_due_at).valueOf())}),I.length>0&&F.push({title:"In Investigation",description:"These complaints are actively being worked on",icon:"",colorClass:"brand",bgColorClass:"bg-brand/10",textColorClass:"text-brand",complaints:I.sort((M,W)=>P(M.received_at).valueOf()-P(W.received_at).valueOf())}),u(F)}catch(h){console.error("Failed to load tasks",h),c("Failed to load your tasks. Please try again.")}finally{s(!1)}}}),i=h=>{if(!h)return"";const N=P(),b=P(h);return b.isBefore(N)?`${P().to(b)} overdue`:`due ${P().to(b)}`},d=(h,N)=>X(this,null,function*(){N.stopPropagation();try{c(null),yield K.post(`/complaints/${h}/acknowledge`),l()}catch(b){console.error("Failed to acknowledge",b),c("Failed to acknowledge complaint. Please try again.")}}),m=()=>o.reduce((h,N)=>h+N.complaints.length,0),p=()=>o.filter(h=>h.title.includes("Overdue")).reduce((h,N)=>h+N.complaints.length,0);return n?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"My Tasks",actions:e.jsxs(A,{variant:"secondary",onClick:l,disabled:n,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading your tasks..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"My Tasks",actions:e.jsxs(A,{variant:"secondary",onClick:l,disabled:n,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),n?"Refreshing...":"Refresh"]})}),e.jsxs("div",{className:"px-10 py-6",children:[a&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:a}),e.jsx(A,{variant:"secondary",onClick:l,children:"Retry"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Your Work List"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:m()===0?"You're all caught up!":`You have ${m()} ${m()===1?"task":"tasks"} requiring attention`})]})}),m()>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"rounded-lg border border-border bg-app p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary",children:"Total Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-text-primary mt-1",children:m()})]}),e.jsx("div",{className:"text-3xl",children:""})]})}),e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-semantic-error",children:"Urgent (Overdue)"}),e.jsx("div",{className:"text-2xl font-bold text-semantic-error mt-1",children:p()})]}),e.jsx("div",{className:"text-3xl",children:""})]})}),e.jsx("div",{className:"rounded-lg border border-border bg-app p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary",children:"In Progress"}),e.jsx("div",{className:"text-2xl font-bold text-text-primary mt-1",children:((w=o.find(h=>h.title==="In Investigation"))==null?void 0:w.complaints.length)||0})]}),e.jsx("div",{className:"text-3xl",children:""})]})})]})]}),o.length===0?e.jsx(de,{children:e.jsx(me,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-4 text-lg font-semibold text-text-primary",children:"All caught up!"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"You don't have any tasks requiring immediate attention."})]})})}):e.jsx("div",{className:"space-y-6",children:o.map((h,N)=>e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:h.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx(fe,{children:h.title}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:h.description})]}),e.jsx("span",{className:`inline-flex items-center justify-center h-8 min-w-8 rounded-full ${h.bgColorClass} ${h.textColorClass} px-2 text-sm font-bold`,children:h.complaints.length})]})}),e.jsx(me,{children:e.jsx("div",{className:"space-y-3 mt-4",children:h.complaints.map(b=>{var F;const y=h.title.includes("Acknowledgement"),I=h.title.includes("Final Response"),v=y?b.ack_due_at:I?b.final_due_at:null,k=v?P(v).isBefore(P()):!1;return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4 rounded-lg border border-border hover:bg-surface transition cursor-pointer",onClick:()=>t(`/complaints/${b.id}`),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-text-primary",children:b.reference}),e.jsx(Tt,{status:b.status}),b.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-semantic-warning/10 text-semantic-warning",children:" Vulnerable"})]}),e.jsx("p",{className:"text-sm text-text-secondary truncate mb-2",children:b.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[((F=b.complainant)==null?void 0:F.full_name)&&e.jsxs("span",{className:"text-text-muted",children:[" ",b.complainant.full_name]}),e.jsxs("span",{className:"text-text-muted",children:[" Received ",P(b.received_at).format("MMM D, YYYY")]}),v&&e.jsxs("span",{className:`font-semibold ${k?"text-semantic-error":"text-semantic-warning"}`,children:[" ",y?"Ack":"Final"," ",i(v)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y&&!b.acknowledged_at&&e.jsx(A,{variant:"secondary",size:"sm",onClick:M=>d(b.id,M),children:"Acknowledge"}),e.jsx(A,{variant:"primary",size:"sm",onClick:M=>{M.stopPropagation(),t(`/complaints/${b.id}`)},children:"View"})]})]},b.id)})})})]},N))})]})]})}function $i(){const[t,r]=f.useState([]),[n,s]=f.useState(!0),[a,c]=f.useState(!1),[o,u]=f.useState(!1),[l,i]=f.useState(!1),[d,m]=f.useState(!1),[p,w]=f.useState(null),[h,N]=f.useState(null),[b,y]=f.useState(null),[I,v]=f.useState(null),[k,F]=f.useState(!1),[M,W]=f.useState(!1),[oe,L]=f.useState(!1),[Y,H]=f.useState(null),[T,G]=f.useState({email:"",full_name:"",role:"complaints_handler",password:"",is_active:!0});f.useEffect(()=>{D()},[]);const D=()=>X(this,null,function*(){s(!0);try{const E=yield K.get("/users");r(E.data)}catch(E){console.error("Failed to load users",E)}finally{s(!1)}}),g=()=>X(this,null,function*(){var E,ie;if(!T.email||!T.full_name||!T.password){v("Please fill in all required fields");return}F(!0),v(null);try{yield K.post("/users",T),c(!1),$(),D()}catch(ce){v(((ie=(E=ce==null?void 0:ce.response)==null?void 0:E.data)==null?void 0:ie.detail)||"Failed to create user")}finally{F(!1)}}),C=()=>X(this,null,function*(){var E,ie;if(!p||!T.email||!T.full_name){v("Please fill in all required fields");return}F(!0),v(null);try{yield K.patch(`/users/${p.id}`,q({email:T.email,full_name:T.full_name,role:T.role,is_active:T.is_active},T.password?{password:T.password}:{})),u(!1),w(null),$(),D()}catch(ce){v(((ie=(E=ce==null?void 0:ce.response)==null?void 0:E.data)==null?void 0:ie.detail)||"Failed to update user")}finally{F(!1)}}),_=()=>X(this,null,function*(){var E,ie;if(p){F(!0),v(null);try{const ce=yield K.post(`/users/${p.id}/reset-password`);N(ce.data.temporary_password),D()}catch(ce){v(((ie=(E=ce==null?void 0:ce.response)==null?void 0:E.data)==null?void 0:ie.detail)||"Failed to reset password")}finally{F(!1)}}}),R=()=>{$(),c(!0)},B=E=>{w(E),G({email:E.email,full_name:E.full_name,role:E.role,password:"",is_active:E.is_active}),v(null),u(!0)},V=E=>{w(E),N(null),v(null),i(!0)},S=E=>X(this,null,function*(){var ie,ce;W(!0),v(null);try{yield K.post(`/auth/mfa/reset/${E.id}`),D()}catch(be){v(((ce=(ie=be==null?void 0:be.response)==null?void 0:ie.data)==null?void 0:ce.detail)||"Failed to reset MFA")}finally{W(!1)}}),Q=E=>{H(E),L(!0)},se=E=>X(this,null,function*(){var ie,ce;W(!0),v(null),w(E);try{const be=yield K.post(`/auth/mfa/recovery/${E.id}/regenerate`);y(be.data.recovery_codes||[]),m(!0)}catch(be){v(((ce=(ie=be==null?void 0:be.response)==null?void 0:ie.data)==null?void 0:ce.detail)||"Failed to regenerate recovery codes")}finally{W(!1)}}),$=()=>{G({email:"",full_name:"",role:"complaints_handler",password:"",is_active:!0}),v(null)},re=E=>E==="admin"?"bg-semantic-error/10 text-semantic-error":E==="complaints_manager"?"bg-semantic-warning/10 text-semantic-warning":E==="reviewer"?"bg-semantic-info/10 text-semantic-info":E==="complaints_handler"?"bg-semantic-success/10 text-semantic-success":"bg-app text-text-muted border border-border";return n?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"User Management"}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading users..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"User Management",actions:e.jsxs(A,{variant:"primary",onClick:R,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Create User"]})}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs(fe,{children:["Users (",t.length,")"]})}),e.jsx(me,{children:e.jsxs("div",{className:"mt-4",children:[e.jsxs(Jr,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"MFA"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(E=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:E.full_name}),e.jsx("td",{className:"text-text-secondary",children:E.email}),e.jsx("td",{children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium capitalize ${re(E.role)}`,children:E.role.replace(/_/g," ")})}),e.jsx("td",{children:E.is_active?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-success/10 text-semantic-success",children:"Active"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-muted border border-border",children:"Inactive"})}),e.jsx("td",{children:E.mfa_enabled?e.jsx("span",{className:"text-semantic-success",children:" Enabled"}):e.jsx("span",{className:"text-text-muted",children:"Disabled"})}),e.jsx("td",{className:"text-text-secondary text-sm",children:P(E.created_at).format("MMM D, YYYY")}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(E),className:"text-brand hover:text-brand-dark text-sm font-medium",children:"Edit"}),e.jsx("button",{onClick:()=>V(E),className:"text-semantic-warning hover:opacity-80 text-sm font-medium",children:"Reset Password"}),e.jsx("button",{onClick:()=>Q(E),className:"text-semantic-error hover:opacity-80 text-sm font-medium disabled:opacity-50",disabled:M,children:"Reset MFA"}),e.jsx("button",{onClick:()=>se(E),className:"text-text-secondary hover:text-text-primary text-sm font-medium disabled:opacity-50",disabled:M,children:"Recovery Codes"})]})})]},E.id))})]}),t.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-text-secondary",children:"No users found"})})]})})]})}),e.jsxs(ge,{open:a,onClose:()=>c(!1),children:[e.jsx(ye,{onClose:()=>c(!1),children:"Create New User"}),e.jsxs(je,{children:[I&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:I}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(te,{type:"text",value:T.full_name,onChange:E=>G(ee(q({},T),{full_name:E.target.value})),placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email *"}),e.jsx(te,{type:"email",value:T.email,onChange:E=>G(ee(q({},T),{email:E.target.value})),placeholder:"john.doe@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"create-role",className:"block text-xs font-medium text-text-primary",children:"Role *"}),e.jsxs("select",{id:"create-role",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:T.role,onChange:E=>G(ee(q({},T),{role:E.target.value})),children:[e.jsx("option",{value:"complaints_handler",children:"Complaints Handler"}),e.jsx("option",{value:"complaints_manager",children:"Complaints Manager"}),e.jsx("option",{value:"reviewer",children:"Reviewer"}),e.jsx("option",{value:"read_only",children:"Read Only"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"create-password",className:"block text-xs font-medium text-text-primary",children:"Initial Password *"}),e.jsx(te,{id:"create-password",type:"password",value:T.password,onChange:E=>G(ee(q({},T),{password:E.target.value})),placeholder:""}),e.jsx("p",{className:"text-xs text-text-muted",children:"User will be required to change this on first login"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.is_active,onChange:()=>G(ee(q({},T),{is_active:!T.is_active})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Active"})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:g,disabled:k,children:k?"Creating...":"Create User"})]})]}),e.jsxs(ge,{open:o,onClose:()=>u(!1),children:[e.jsx(ye,{onClose:()=>u(!1),children:"Edit User"}),e.jsxs(je,{children:[I&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:I}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(te,{type:"text",value:T.full_name,onChange:E=>G(ee(q({},T),{full_name:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email *"}),e.jsx(te,{type:"email",value:T.email,onChange:E=>G(ee(q({},T),{email:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-role",className:"block text-xs font-medium text-text-primary",children:"Role *"}),e.jsxs("select",{id:"edit-role",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:T.role,onChange:E=>G(ee(q({},T),{role:E.target.value})),children:[e.jsx("option",{value:"complaints_handler",children:"Complaints Handler"}),e.jsx("option",{value:"complaints_manager",children:"Complaints Manager"}),e.jsx("option",{value:"reviewer",children:"Reviewer"}),e.jsx("option",{value:"read_only",children:"Read Only"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-password",className:"block text-xs font-medium text-text-primary",children:"New Password"}),e.jsx(te,{id:"edit-password",type:"password",value:T.password,onChange:E=>G(ee(q({},T),{password:E.target.value})),placeholder:"Leave blank to keep current password"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.is_active,onChange:()=>G(ee(q({},T),{is_active:!T.is_active})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Active"})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:C,disabled:k,children:k?"Saving...":"Save Changes"})]})]}),e.jsxs(ge,{open:d,onClose:()=>m(!1),children:[e.jsx(ye,{onClose:()=>m(!1),children:"Recovery Codes"}),e.jsxs(je,{children:[I&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:I}),b&&b.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["Provide these codes to ",e.jsx("strong",{className:"text-text-primary",children:p==null?void 0:p.full_name}),". Each code can be used once."]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:b.map(E=>e.jsx("code",{className:"text-sm font-mono bg-app border border-border rounded px-2 py-2 text-text-primary text-center",children:E},E))}),e.jsx("p",{className:"text-xs text-text-muted",children:"Users should store these codes securely. They can be used if the authenticator device is unavailable."})]}):e.jsx("p",{className:"text-sm text-text-secondary",children:"No recovery codes generated."})]}),e.jsx(ve,{children:e.jsx(A,{variant:"primary",onClick:()=>m(!1),children:"Close"})})]}),e.jsxs(ge,{open:oe,onClose:()=>L(!1),children:[e.jsx(ye,{onClose:()=>L(!1),children:"Reset MFA"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Resetting MFA will disable MFA for this user and require re-enrollment."}),e.jsxs("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:["User: ",e.jsx("strong",{className:"text-text-primary",children:Y==null?void 0:Y.full_name})]})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>L(!1),disabled:M,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:()=>X(this,null,function*(){Y&&(L(!1),yield S(Y))}),disabled:!Y||M,children:M?"Resetting...":"Confirm Reset"})]})]}),e.jsxs(ge,{open:l,onClose:()=>i(!1),children:[e.jsx(ye,{onClose:()=>i(!1),children:"Reset Password"}),e.jsxs(je,{children:[I&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:I}),h?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-semantic-success mb-2",children:"Password reset successful!"}),e.jsxs("p",{className:"text-sm text-text-secondary mb-3",children:["Please provide this temporary password to ",e.jsx("strong",{children:p==null?void 0:p.full_name}),":"]}),e.jsx("div",{className:"rounded-lg bg-app border border-border p-3",children:e.jsx("code",{className:"text-lg font-mono font-bold text-text-primary",children:h})}),e.jsx("p",{className:"text-xs text-text-muted mt-3",children:"The user will be required to change this password on their next login."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["Are you sure you want to reset the password for ",e.jsx("strong",{className:"text-text-primary",children:p==null?void 0:p.full_name}),"?"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"A temporary password will be generated that you can provide to the user. They will be required to change it on their next login."})]})]}),e.jsx(ve,{children:h?e.jsx(A,{variant:"primary",onClick:()=>i(!1),children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:_,disabled:k,children:k?"Resetting...":"Reset Password"})]})})]})]})}function Ii(){const{user:t}=qe(),r=(t==null?void 0:t.role)==="admin",[n,s]=f.useState("products"),[a,c]=f.useState([]),[o,u]=f.useState(!0),[l,i]=f.useState(""),[d,m]=f.useState(!1),[p,w]=f.useState(""),[h,N]=f.useState(!1),[b,y]=f.useState(null),[I,v]=f.useState(!1),[k,F]=f.useState(null),[M,W]=f.useState(!1),[oe,L]=f.useState(null),[Y,H]=f.useState(null);f.useEffect(()=>{T()},[n]);const T=()=>X(this,null,function*(){u(!0);try{const _=yield K.get(`/reference/${n}`);c(_.data||[])}catch(_){console.error("Failed to load reference items",_)}finally{u(!1)}}),G=()=>X(this,null,function*(){var _,R;if(p.trim()){N(!0),y(null);try{yield K.post(`/reference/${n}`,{name:p.trim()}),w(""),m(!1),T()}catch(B){y(((R=(_=B==null?void 0:B.response)==null?void 0:_.data)==null?void 0:R.detail)||"Failed to create item")}finally{N(!1)}}}),D=()=>X(this,null,function*(){var _,R;if(k){W(!0),L(null),H(null);try{const B=new FormData;B.append("file",k);const V=yield K.post(`/reference/${n}/import`,B,{headers:{"Content-Type":"multipart/form-data"}});H(`Successfully imported ${V.data.added} items`),F(null),T(),setTimeout(()=>v(!1),2e3)}catch(B){L(((R=(_=B==null?void 0:B.response)==null?void 0:_.data)==null?void 0:R.detail)||"Failed to import file")}finally{W(!1)}}}),g=a.filter(_=>_.name.toLowerCase().includes(l.toLowerCase())),C=_=>{switch(_){case"products":return"Products";case"brokers":return"Brokers";case"insurers":return"Insurers"}};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Reference Data Management"}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs(de,{children:[e.jsx(pe,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(fe,{children:"Reference Lists"}),r&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"secondary",size:"sm",onClick:()=>v(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Import CSV"]}),e.jsxs(A,{variant:"primary",size:"sm",onClick:()=>m(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add New"]})]})]})}),e.jsx("div",{className:"border-b border-border",children:e.jsx("div",{className:"flex gap-1 px-4",children:["products","brokers","insurers"].map(_=>e.jsxs("button",{onClick:()=>s(_),className:`px-4 py-3 text-sm font-medium capitalize transition border-b-2 ${n===_?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:[C(_),e.jsx("span",{className:"ml-2 inline-flex items-center justify-center h-5 min-w-5 px-1 rounded-full bg-app text-[11px] font-semibold text-text-secondary border border-border",children:_===n?g.length:a.length})]},_))})}),e.jsxs(me,{children:[e.jsx("div",{className:"mt-4 mb-6",children:e.jsx(te,{type:"search",placeholder:`Search ${C(n).toLowerCase()}...`,value:l,onChange:_=>i(_.target.value),leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),o?e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading..."}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:l?"No items match your search":`No ${C(n).toLowerCase()} yet`}),!l&&r&&e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:'Click "Add New" to create your first entry'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:g.map(_=>e.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border bg-surface hover:bg-app transition",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-text-primary truncate",children:_.name}),e.jsxs("div",{className:"text-xs text-text-muted",children:["ID: ",_.id.substring(0,8),"..."]})]})},_.id))})]})]})}),e.jsxs(ge,{open:d,onClose:()=>m(!1),children:[e.jsxs(ye,{onClose:()=>m(!1),children:["Add New ",C(n).slice(0,-1)]}),e.jsxs(je,{children:[b&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:b}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Name *"}),e.jsx(te,{value:p,onChange:_=>w(_.target.value),placeholder:`Enter ${C(n).slice(0,-1).toLowerCase()} name...`,autoFocus:!0,onKeyDown:_=>{_.key==="Enter"&&p.trim()&&G()}})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:G,disabled:!p.trim()||h,children:h?"Creating...":"Create"})]})]}),e.jsxs(ge,{open:I,onClose:()=>v(!1),children:[e.jsxs(ye,{onClose:()=>v(!1),children:["Import ",C(n)," from CSV"]}),e.jsxs(je,{children:[oe&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:oe}),Y&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-3 text-sm text-semantic-success",children:Y}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:'Upload a CSV file with a "name" column. Duplicate names will be skipped.'}),e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border p-6 text-center",children:[e.jsx("input",{type:"file",accept:".csv",onChange:_=>{var R;return F(((R=_.target.files)==null?void 0:R[0])||null)},className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("p",{className:"mt-2 text-sm font-medium text-text-primary",children:"Click to select CSV file"}),e.jsx("p",{className:"mt-1 text-xs text-text-muted",children:"or drag and drop"})]})]}),k&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-text-primary",children:[e.jsx("svg",{className:"h-5 w-5 text-semantic-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),k.name]})]}),e.jsxs("div",{className:"rounded-lg bg-app p-3 text-xs text-text-secondary",children:[e.jsx("p",{className:"font-semibold text-text-primary mb-1",children:"CSV Format Example:"}),e.jsxs("code",{className:"block bg-surface p-2 rounded border border-border font-mono",children:["name",e.jsx("br",{}),"Product A",e.jsx("br",{}),"Product B",e.jsx("br",{}),"Product C"]})]})]})]}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>v(!1),children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:D,disabled:!k||M,children:M?"Importing...":"Import"})]})]})]})}var Bi=Object.defineProperty,$t=Object.getOwnPropertySymbols,Xr=Object.prototype.hasOwnProperty,Gr=Object.prototype.propertyIsEnumerable,yr=(t,r,n)=>r in t?Bi(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,Ui=(t,r)=>{for(var n in r||(r={}))Xr.call(r,n)&&yr(t,n,r[n]);if($t)for(var n of $t(r))Gr.call(r,n)&&yr(t,n,r[n]);return t},Yi=(t,r)=>{var n={};for(var s in t)Xr.call(t,s)&&r.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&$t)for(var s of $t(t))r.indexOf(s)<0&&Gr.call(t,s)&&(n[s]=t[s]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var We;(t=>{const r=class{constructor(l,i,d,m){if(this.version=l,this.errorCorrectionLevel=i,this.modules=[],this.isFunction=[],l<r.MIN_VERSION||l>r.MAX_VERSION)throw new RangeError("Version value out of range");if(m<-1||m>7)throw new RangeError("Mask value out of range");this.size=l*4+17;let p=[];for(let h=0;h<this.size;h++)p.push(!1);for(let h=0;h<this.size;h++)this.modules.push(p.slice()),this.isFunction.push(p.slice());this.drawFunctionPatterns();const w=this.addEccAndInterleave(d);if(this.drawCodewords(w),m==-1){let h=1e9;for(let N=0;N<8;N++){this.applyMask(N),this.drawFormatBits(N);const b=this.getPenaltyScore();b<h&&(m=N,h=b),this.applyMask(N)}}c(0<=m&&m<=7),this.mask=m,this.applyMask(m),this.drawFormatBits(m),this.isFunction=[]}static encodeText(l,i){const d=t.QrSegment.makeSegments(l);return r.encodeSegments(d,i)}static encodeBinary(l,i){const d=t.QrSegment.makeBytes(l);return r.encodeSegments([d],i)}static encodeSegments(l,i,d=1,m=40,p=-1,w=!0){if(!(r.MIN_VERSION<=d&&d<=m&&m<=r.MAX_VERSION)||p<-1||p>7)throw new RangeError("Invalid value");let h,N;for(h=d;;h++){const v=r.getNumDataCodewords(h,i)*8,k=u.getTotalBits(l,h);if(k<=v){N=k;break}if(h>=m)throw new RangeError("Data too long")}for(const v of[r.Ecc.MEDIUM,r.Ecc.QUARTILE,r.Ecc.HIGH])w&&N<=r.getNumDataCodewords(h,v)*8&&(i=v);let b=[];for(const v of l){s(v.mode.modeBits,4,b),s(v.numChars,v.mode.numCharCountBits(h),b);for(const k of v.getData())b.push(k)}c(b.length==N);const y=r.getNumDataCodewords(h,i)*8;c(b.length<=y),s(0,Math.min(4,y-b.length),b),s(0,(8-b.length%8)%8,b),c(b.length%8==0);for(let v=236;b.length<y;v^=253)s(v,8,b);let I=[];for(;I.length*8<b.length;)I.push(0);return b.forEach((v,k)=>I[k>>>3]|=v<<7-(k&7)),new r(h,i,I,p)}getModule(l,i){return 0<=l&&l<this.size&&0<=i&&i<this.size&&this.modules[i][l]}getModules(){return this.modules}drawFunctionPatterns(){for(let d=0;d<this.size;d++)this.setFunctionModule(6,d,d%2==0),this.setFunctionModule(d,6,d%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const l=this.getAlignmentPatternPositions(),i=l.length;for(let d=0;d<i;d++)for(let m=0;m<i;m++)d==0&&m==0||d==0&&m==i-1||d==i-1&&m==0||this.drawAlignmentPattern(l[d],l[m]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(l){const i=this.errorCorrectionLevel.formatBits<<3|l;let d=i;for(let p=0;p<10;p++)d=d<<1^(d>>>9)*1335;const m=(i<<10|d)^21522;c(m>>>15==0);for(let p=0;p<=5;p++)this.setFunctionModule(8,p,a(m,p));this.setFunctionModule(8,7,a(m,6)),this.setFunctionModule(8,8,a(m,7)),this.setFunctionModule(7,8,a(m,8));for(let p=9;p<15;p++)this.setFunctionModule(14-p,8,a(m,p));for(let p=0;p<8;p++)this.setFunctionModule(this.size-1-p,8,a(m,p));for(let p=8;p<15;p++)this.setFunctionModule(8,this.size-15+p,a(m,p));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let l=this.version;for(let d=0;d<12;d++)l=l<<1^(l>>>11)*7973;const i=this.version<<12|l;c(i>>>18==0);for(let d=0;d<18;d++){const m=a(i,d),p=this.size-11+d%3,w=Math.floor(d/3);this.setFunctionModule(p,w,m),this.setFunctionModule(w,p,m)}}drawFinderPattern(l,i){for(let d=-4;d<=4;d++)for(let m=-4;m<=4;m++){const p=Math.max(Math.abs(m),Math.abs(d)),w=l+m,h=i+d;0<=w&&w<this.size&&0<=h&&h<this.size&&this.setFunctionModule(w,h,p!=2&&p!=4)}}drawAlignmentPattern(l,i){for(let d=-2;d<=2;d++)for(let m=-2;m<=2;m++)this.setFunctionModule(l+m,i+d,Math.max(Math.abs(m),Math.abs(d))!=1)}setFunctionModule(l,i,d){this.modules[i][l]=d,this.isFunction[i][l]=!0}addEccAndInterleave(l){const i=this.version,d=this.errorCorrectionLevel;if(l.length!=r.getNumDataCodewords(i,d))throw new RangeError("Invalid argument");const m=r.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][i],p=r.ECC_CODEWORDS_PER_BLOCK[d.ordinal][i],w=Math.floor(r.getNumRawDataModules(i)/8),h=m-w%m,N=Math.floor(w/m);let b=[];const y=r.reedSolomonComputeDivisor(p);for(let v=0,k=0;v<m;v++){let F=l.slice(k,k+N-p+(v<h?0:1));k+=F.length;const M=r.reedSolomonComputeRemainder(F,y);v<h&&F.push(0),b.push(F.concat(M))}let I=[];for(let v=0;v<b[0].length;v++)b.forEach((k,F)=>{(v!=N-p||F>=h)&&I.push(k[v])});return c(I.length==w),I}drawCodewords(l){if(l.length!=Math.floor(r.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let i=0;for(let d=this.size-1;d>=1;d-=2){d==6&&(d=5);for(let m=0;m<this.size;m++)for(let p=0;p<2;p++){const w=d-p,N=(d+1&2)==0?this.size-1-m:m;!this.isFunction[N][w]&&i<l.length*8&&(this.modules[N][w]=a(l[i>>>3],7-(i&7)),i++)}}c(i==l.length*8)}applyMask(l){if(l<0||l>7)throw new RangeError("Mask value out of range");for(let i=0;i<this.size;i++)for(let d=0;d<this.size;d++){let m;switch(l){case 0:m=(d+i)%2==0;break;case 1:m=i%2==0;break;case 2:m=d%3==0;break;case 3:m=(d+i)%3==0;break;case 4:m=(Math.floor(d/3)+Math.floor(i/2))%2==0;break;case 5:m=d*i%2+d*i%3==0;break;case 6:m=(d*i%2+d*i%3)%2==0;break;case 7:m=((d+i)%2+d*i%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[i][d]&&m&&(this.modules[i][d]=!this.modules[i][d])}}getPenaltyScore(){let l=0;for(let p=0;p<this.size;p++){let w=!1,h=0,N=[0,0,0,0,0,0,0];for(let b=0;b<this.size;b++)this.modules[p][b]==w?(h++,h==5?l+=r.PENALTY_N1:h>5&&l++):(this.finderPenaltyAddHistory(h,N),w||(l+=this.finderPenaltyCountPatterns(N)*r.PENALTY_N3),w=this.modules[p][b],h=1);l+=this.finderPenaltyTerminateAndCount(w,h,N)*r.PENALTY_N3}for(let p=0;p<this.size;p++){let w=!1,h=0,N=[0,0,0,0,0,0,0];for(let b=0;b<this.size;b++)this.modules[b][p]==w?(h++,h==5?l+=r.PENALTY_N1:h>5&&l++):(this.finderPenaltyAddHistory(h,N),w||(l+=this.finderPenaltyCountPatterns(N)*r.PENALTY_N3),w=this.modules[b][p],h=1);l+=this.finderPenaltyTerminateAndCount(w,h,N)*r.PENALTY_N3}for(let p=0;p<this.size-1;p++)for(let w=0;w<this.size-1;w++){const h=this.modules[p][w];h==this.modules[p][w+1]&&h==this.modules[p+1][w]&&h==this.modules[p+1][w+1]&&(l+=r.PENALTY_N2)}let i=0;for(const p of this.modules)i=p.reduce((w,h)=>w+(h?1:0),i);const d=this.size*this.size,m=Math.ceil(Math.abs(i*20-d*10)/d)-1;return c(0<=m&&m<=9),l+=m*r.PENALTY_N4,c(0<=l&&l<=2568888),l}getAlignmentPatternPositions(){if(this.version==1)return[];{const l=Math.floor(this.version/7)+2,i=this.version==32?26:Math.ceil((this.version*4+4)/(l*2-2))*2;let d=[6];for(let m=this.size-7;d.length<l;m-=i)d.splice(1,0,m);return d}}static getNumRawDataModules(l){if(l<r.MIN_VERSION||l>r.MAX_VERSION)throw new RangeError("Version number out of range");let i=(16*l+128)*l+64;if(l>=2){const d=Math.floor(l/7)+2;i-=(25*d-10)*d-55,l>=7&&(i-=36)}return c(208<=i&&i<=29648),i}static getNumDataCodewords(l,i){return Math.floor(r.getNumRawDataModules(l)/8)-r.ECC_CODEWORDS_PER_BLOCK[i.ordinal][l]*r.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][l]}static reedSolomonComputeDivisor(l){if(l<1||l>255)throw new RangeError("Degree out of range");let i=[];for(let m=0;m<l-1;m++)i.push(0);i.push(1);let d=1;for(let m=0;m<l;m++){for(let p=0;p<i.length;p++)i[p]=r.reedSolomonMultiply(i[p],d),p+1<i.length&&(i[p]^=i[p+1]);d=r.reedSolomonMultiply(d,2)}return i}static reedSolomonComputeRemainder(l,i){let d=i.map(m=>0);for(const m of l){const p=m^d.shift();d.push(0),i.forEach((w,h)=>d[h]^=r.reedSolomonMultiply(w,p))}return d}static reedSolomonMultiply(l,i){if(l>>>8||i>>>8)throw new RangeError("Byte out of range");let d=0;for(let m=7;m>=0;m--)d=d<<1^(d>>>7)*285,d^=(i>>>m&1)*l;return c(d>>>8==0),d}finderPenaltyCountPatterns(l){const i=l[1];c(i<=this.size*3);const d=i>0&&l[2]==i&&l[3]==i*3&&l[4]==i&&l[5]==i;return(d&&l[0]>=i*4&&l[6]>=i?1:0)+(d&&l[6]>=i*4&&l[0]>=i?1:0)}finderPenaltyTerminateAndCount(l,i,d){return l&&(this.finderPenaltyAddHistory(i,d),i=0),i+=this.size,this.finderPenaltyAddHistory(i,d),this.finderPenaltyCountPatterns(d)}finderPenaltyAddHistory(l,i){i[0]==0&&(l+=this.size),i.pop(),i.unshift(l)}};let n=r;n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=n;function s(l,i,d){if(i<0||i>31||l>>>i)throw new RangeError("Value out of range");for(let m=i-1;m>=0;m--)d.push(l>>>m&1)}function a(l,i){return(l>>>i&1)!=0}function c(l){if(!l)throw new Error("Assertion error")}const o=class{constructor(l,i,d){if(this.mode=l,this.numChars=i,this.bitData=d,i<0)throw new RangeError("Invalid argument");this.bitData=d.slice()}static makeBytes(l){let i=[];for(const d of l)s(d,8,i);return new o(o.Mode.BYTE,l.length,i)}static makeNumeric(l){if(!o.isNumeric(l))throw new RangeError("String contains non-numeric characters");let i=[];for(let d=0;d<l.length;){const m=Math.min(l.length-d,3);s(parseInt(l.substr(d,m),10),m*3+1,i),d+=m}return new o(o.Mode.NUMERIC,l.length,i)}static makeAlphanumeric(l){if(!o.isAlphanumeric(l))throw new RangeError("String contains unencodable characters in alphanumeric mode");let i=[],d;for(d=0;d+2<=l.length;d+=2){let m=o.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d))*45;m+=o.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d+1)),s(m,11,i)}return d<l.length&&s(o.ALPHANUMERIC_CHARSET.indexOf(l.charAt(d)),6,i),new o(o.Mode.ALPHANUMERIC,l.length,i)}static makeSegments(l){return l==""?[]:o.isNumeric(l)?[o.makeNumeric(l)]:o.isAlphanumeric(l)?[o.makeAlphanumeric(l)]:[o.makeBytes(o.toUtf8ByteArray(l))]}static makeEci(l){let i=[];if(l<0)throw new RangeError("ECI assignment value out of range");if(l<128)s(l,8,i);else if(l<16384)s(2,2,i),s(l,14,i);else if(l<1e6)s(6,3,i),s(l,21,i);else throw new RangeError("ECI assignment value out of range");return new o(o.Mode.ECI,0,i)}static isNumeric(l){return o.NUMERIC_REGEX.test(l)}static isAlphanumeric(l){return o.ALPHANUMERIC_REGEX.test(l)}getData(){return this.bitData.slice()}static getTotalBits(l,i){let d=0;for(const m of l){const p=m.mode.numCharCountBits(i);if(m.numChars>=1<<p)return 1/0;d+=4+p+m.bitData.length}return d}static toUtf8ByteArray(l){l=encodeURI(l);let i=[];for(let d=0;d<l.length;d++)l.charAt(d)!="%"?i.push(l.charCodeAt(d)):(i.push(parseInt(l.substr(d+1,2),16)),d+=2);return i}};let u=o;u.NUMERIC_REGEX=/^[0-9]*$/,u.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,u.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",t.QrSegment=u})(We||(We={}));(t=>{(r=>{const n=class{constructor(a,c){this.ordinal=a,this.formatBits=c}};let s=n;s.LOW=new n(0,1),s.MEDIUM=new n(1,0),s.QUARTILE=new n(2,3),s.HIGH=new n(3,2),r.Ecc=s})(t.QrCode||(t.QrCode={}))})(We||(We={}));(t=>{(r=>{const n=class{constructor(a,c){this.modeBits=a,this.numBitsCharCount=c}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};let s=n;s.NUMERIC=new n(1,[10,12,14]),s.ALPHANUMERIC=new n(2,[9,11,13]),s.BYTE=new n(4,[8,16,16]),s.KANJI=new n(8,[8,10,12]),s.ECI=new n(7,[0,0,0]),r.Mode=s})(t.QrSegment||(t.QrSegment={}))})(We||(We={}));var pt=We;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var zi={L:pt.QrCode.Ecc.LOW,M:pt.QrCode.Ecc.MEDIUM,Q:pt.QrCode.Ecc.QUARTILE,H:pt.QrCode.Ecc.HIGH},Hi=128,Wi="L",qi="#FFFFFF",Vi="#000000",Ki=!1,Zr=4,Ji=.1;function Qi(t,r=0){const n=[];return t.forEach(function(s,a){let c=null;s.forEach(function(o,u){if(!o&&c!==null){n.push(`M${c+r} ${a+r}h${u-c}v1H${c+r}z`),c=null;return}if(u===s.length-1){if(!o)return;c===null?n.push(`M${u+r},${a+r} h1v1H${u+r}z`):n.push(`M${c+r},${a+r} h${u+1-c}v1H${c+r}z`);return}o&&c===null&&(c=u)})}),n.join("")}function Xi(t,r){return t.slice().map((n,s)=>s<r.y||s>=r.y+r.h?n:n.map((a,c)=>c<r.x||c>=r.x+r.w?a:!1))}function Gi(t,r,n,s){if(s==null)return null;const a=n?Zr:0,c=t.length+a*2,o=Math.floor(r*Ji),u=c/r,l=(s.width||o)*u,i=(s.height||o)*u,d=s.x==null?t.length/2-l/2:s.x*u,m=s.y==null?t.length/2-i/2:s.y*u;let p=null;if(s.excavate){let w=Math.floor(d),h=Math.floor(m),N=Math.ceil(l+d-w),b=Math.ceil(i+m-h);p={x:w,y:h,w:N,h:b}}return{x:d,y:m,h:i,w:l,excavation:p}}(function(){try{new Path2D().addPath(new Path2D)}catch(t){return!1}return!0})();function en(t){const r=t,{value:n,size:s=Hi,level:a=Wi,bgColor:c=qi,fgColor:o=Vi,includeMargin:u=Ki,imageSettings:l}=r,i=Yi(r,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let d=pt.QrCode.encodeText(n,zi[a]).getModules();const m=u?Zr:0,p=d.length+m*2,w=Gi(d,s,u,l);let h=null;l!=null&&w!=null&&(w.excavation!=null&&(d=Xi(d,w.excavation)),h=ht.createElement("image",{xlinkHref:l.src,height:w.h,width:w.w,x:w.x+m,y:w.y+m,preserveAspectRatio:"none"}));const N=Qi(d,m);return ht.createElement("svg",Ui({height:s,width:s,viewBox:`0 0 ${p} ${p}`},i),ht.createElement("path",{fill:c,d:`M0,0 h${p}v${p}H0z`,shapeRendering:"crispEdges"}),ht.createElement("path",{fill:o,d:N,shapeRendering:"crispEdges"}),h)}function jr(){var be,Ne;const{user:t,refreshMe:r}=qe(),s=(be=hs().state)==null?void 0:be.forced,[a,c]=f.useState(""),[o,u]=f.useState(""),[l,i]=f.useState(""),[d,m]=f.useState(!1),[p,w]=f.useState(!1),[h,N]=f.useState(!1),[b,y]=f.useState(null),[I,v]=f.useState(!1),[k,F]=f.useState(!1),[M,W]=f.useState(!1),[oe,L]=f.useState(null),[Y,H]=f.useState(""),[T,G]=f.useState(null),[D,g]=f.useState(!1),[C,_]=f.useState(null),[R,B]=f.useState(null);f.useEffect(()=>{t&&F(t.mfa_enabled||!1)},[t]);const S=(Z=>{if(!Z)return{score:0,label:"",color:""};let ae=0;return Z.length>=8&&ae++,Z.length>=12&&ae++,/[a-z]/.test(Z)&&/[A-Z]/.test(Z)&&ae++,/\d/.test(Z)&&ae++,/[^a-zA-Z0-9]/.test(Z)&&ae++,ae<=2?{score:ae,label:"Weak",color:"bg-semantic-error"}:ae===3?{score:ae,label:"Fair",color:"bg-semantic-warning"}:ae===4?{score:ae,label:"Good",color:"bg-semantic-info"}:{score:ae,label:"Strong",color:"bg-semantic-success"}})(o),Q=Z=>X(this,null,function*(){var ae,z;if(Z.preventDefault(),y(null),o!==l){y({type:"error",text:"New passwords do not match"});return}if(o.length<8){y({type:"error",text:"Password must be at least 8 characters"});return}v(!0);try{yield K.post("/auth/password/change",{current_password:a,new_password:o}),yield r(),y({type:"success",text:"Password changed successfully"}),c(""),u(""),i("")}catch(Me){y({type:"error",text:((z=(ae=Me==null?void 0:Me.response)==null?void 0:ae.data)==null?void 0:z.detail)||"Failed to change password"})}finally{v(!1)}}),se=()=>X(this,null,function*(){var Z,ae;g(!0),_(null);try{const z=yield K.post("/auth/mfa/enroll");L(z.data),G(null),H(""),W(!0)}catch(z){_({type:"error",text:((ae=(Z=z==null?void 0:z.response)==null?void 0:Z.data)==null?void 0:ae.detail)||"Failed to start MFA enrollment"})}finally{g(!1)}}),$=()=>X(this,null,function*(){var Z,ae;g(!0),_(null);try{const z=yield K.post("/auth/mfa/verify",{code:Y});G(z.data.recovery_codes),F(!0),_({type:"success",text:"MFA enabled successfully! Save your recovery codes."})}catch(z){_({type:"error",text:((ae=(Z=z==null?void 0:z.response)==null?void 0:Z.data)==null?void 0:ae.detail)||"Invalid MFA code"})}finally{g(!1)}}),re=()=>X(this,null,function*(){var Z,ae;g(!0),_(null);try{yield K.post("/auth/mfa/disable"),F(!1),_({type:"success",text:"MFA disabled successfully"})}catch(z){_({type:"error",text:((ae=(Z=z==null?void 0:z.response)==null?void 0:Z.data)==null?void 0:ae.detail)||"Failed to disable MFA"})}finally{g(!1)}}),E=()=>X(this,null,function*(){var Z,ae;g(!0),_(null);try{const z=yield K.post("/auth/mfa/recovery/regenerate");G(z.data.recovery_codes),_({type:"success",text:"Recovery codes regenerated! Save them securely."})}catch(z){_({type:"error",text:((ae=(Z=z==null?void 0:z.response)==null?void 0:Z.data)==null?void 0:ae.detail)||"Failed to regenerate recovery codes"})}finally{g(!1)}}),ie=()=>{if(!T)return;const Z=T.join(`
`);navigator.clipboard.writeText(Z).then(()=>{_({type:"success",text:"Recovery codes copied to clipboard"})})},ce=()=>{W(!1),L(null),H(""),G(null),_(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Ae,{title:"Profile & Settings"}),e.jsxs("div",{className:"px-10 py-6 max-w-2xl",children:[s&&e.jsx("div",{className:"mb-6 rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"h-5 w-5 text-semantic-warning flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-semantic-warning",children:"Password change required"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"For security reasons, you must change your password before continuing."})]})]})}),e.jsxs(de,{className:"mb-6",children:[e.jsx(pe,{children:e.jsx(fe,{children:"User Information"})}),e.jsx(me,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Name"}),e.jsx("div",{className:"text-sm text-text-primary",children:t==null?void 0:t.full_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Email"}),e.jsx("div",{className:"text-sm text-text-primary",children:t==null?void 0:t.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Role"}),e.jsx("div",{className:"text-sm text-text-primary capitalize",children:(Ne=t==null?void 0:t.role)==null?void 0:Ne.replace("_"," ")})]}),(t==null?void 0:t.created_at)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Account Created"}),e.jsx("div",{className:"text-sm text-text-secondary",children:P(t.created_at).format("MMMM D, YYYY [at] h:mm A")})]}),(t==null?void 0:t.last_login)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Last Login"}),e.jsx("div",{className:"text-sm text-text-secondary",children:P(t.last_login).format("MMMM D, YYYY [at] h:mm A")})]})]})})]}),e.jsxs(de,{className:"mb-6",children:[e.jsx(pe,{children:e.jsx(fe,{children:"Multi-Factor Authentication"})}),e.jsxs(me,{children:[C&&e.jsx("div",{className:`mt-4 rounded-lg border p-3 text-sm ${C.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:C.text}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-text-primary",children:"MFA Status"}),e.jsx("div",{className:"text-xs text-text-secondary mt-1",children:k?"Your account is protected with MFA":"Add an extra layer of security"})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium ${k?"bg-semantic-success/10 text-semantic-success":"bg-gray-100 text-text-muted"}`,children:k?" Enabled":"Disabled"})]}),T&&e.jsxs("div",{className:"rounded-lg border border-border bg-app p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary",children:"Your Recovery Codes"}),e.jsx("button",{onClick:ie,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:T.map(Z=>e.jsx("code",{className:"text-xs bg-surface p-2 rounded border border-border font-mono",children:Z},Z))}),e.jsx("p",{className:"text-xs text-text-muted",children:" Save these codes in a secure location. Each code can only be used once."})]}),e.jsx("div",{className:"flex gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"secondary",onClick:()=>B("regen_recovery"),disabled:D,children:D?"Regenerating...":"Regenerate Recovery Codes"}),e.jsx(A,{variant:"secondary",onClick:()=>B("disable_mfa"),disabled:D,children:D?"Disabling...":"Disable MFA"})]}):e.jsx(A,{variant:"primary",onClick:se,disabled:D,children:D?"Setting up...":"Enable MFA"})})]})]})]}),e.jsxs(de,{children:[e.jsx(pe,{children:e.jsx(fe,{children:"Change Password"})}),e.jsxs(me,{children:[b&&e.jsx("div",{className:`mt-4 rounded-lg border p-3 text-sm ${b.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:b.text}),e.jsxs("form",{onSubmit:Q,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{type:d?"text":"password",value:a,onChange:Z=>c(Z.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>m(!d),"aria-label":d?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:d?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{type:p?"text":"password",value:o,onChange:Z=>u(Z.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>w(!p),"aria-label":p?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:p?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),o&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${S.color} transition-all duration-300`,style:{width:`${S.score/5*100}%`}})}),e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:S.label})]}),e.jsxs("ul",{className:"text-xs text-text-muted space-y-0.5",children:[e.jsxs("li",{className:o.length>=8?"text-semantic-success":"",children:[o.length>=8?"":""," At least 8 characters"]}),e.jsxs("li",{className:/[a-z]/.test(o)&&/[A-Z]/.test(o)?"text-semantic-success":"",children:[/[a-z]/.test(o)&&/[A-Z]/.test(o)?"":""," Mixed case letters"]}),e.jsxs("li",{className:/\d/.test(o)?"text-semantic-success":"",children:[/\d/.test(o)?"":""," At least one number"]}),e.jsxs("li",{className:/[^a-zA-Z0-9]/.test(o)?"text-semantic-success":"",children:[/[^a-zA-Z0-9]/.test(o)?"":""," Special character (!@#$%, etc.)"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{type:h?"text":"password",value:l,onChange:Z=>i(Z.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>N(!h),"aria-label":h?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:h?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),l&&o!==l&&e.jsx("p",{className:"text-xs text-semantic-error",children:"Passwords do not match"})]}),e.jsx(A,{type:"submit",variant:"primary",disabled:I,children:I?"Changing...":"Change Password"})]})]})]}),e.jsxs(ge,{open:M,onClose:ce,children:[e.jsx(ye,{onClose:ce,children:"Set up Multi-Factor Authentication"}),e.jsx(je,{children:e.jsx("div",{className:"space-y-4",children:oe&&!T?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx("div",{className:"flex justify-center p-4 bg-app rounded-lg",children:e.jsx(en,{value:oe.otpauth_url,size:200})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-1",children:"Manual entry secret"}),e.jsx("code",{className:"block text-xs bg-app p-2 rounded border border-border font-mono break-all",children:oe.secret})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Enter the 6-digit code from your app"}),e.jsx(te,{type:"text",autoFocus:!0,value:Y,onChange:Z=>H(Z.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",maxLength:6})]}),C&&e.jsx("div",{className:`rounded-lg border p-3 text-sm ${C.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:C.text})]}):T?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-3 text-sm text-semantic-success",children:" MFA enabled successfully!"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary",children:"Recovery Codes"}),e.jsx("button",{onClick:ie,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:T.map(Z=>e.jsx("code",{className:"text-xs bg-app p-2 rounded border border-border font-mono",children:Z},Z))}),e.jsx("p",{className:"text-xs text-text-muted",children:" Save these codes in a secure location. Each code can only be used once if you lose access to your authenticator app."})]})]}):e.jsx("p",{className:"text-sm text-text-muted",children:"Preparing MFA enrollment..."})})}),e.jsx(ve,{children:T?e.jsx(A,{variant:"primary",onClick:ce,children:"Done"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{variant:"secondary",onClick:ce,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:$,disabled:Y.length!==6||D,children:D?"Verifying...":"Verify & Enable"})]})})]}),e.jsxs(ge,{open:R!==null,onClose:()=>B(null),children:[e.jsx(ye,{onClose:()=>B(null),children:R==="disable_mfa"?"Disable MFA":"Regenerate Recovery Codes"}),e.jsx(je,{children:R==="disable_mfa"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Disabling MFA will make your account less secure. You will be able to re-enable MFA later."}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"This action reduces account security."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Regenerating recovery codes will invalidate your existing recovery codes."}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"Any previously issued recovery codes will stop working."})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:()=>B(null),disabled:D,children:"Cancel"}),e.jsx(A,{variant:"primary",onClick:()=>X(this,null,function*(){const Z=R;B(null),Z==="disable_mfa"&&(yield re()),Z==="regen_recovery"&&(yield E())}),disabled:D,children:"Confirm"})]})]})]})]})}function Zi(){const{token:t,role:r,name:n,login:s,logout:a,mustChangePassword:c,ready:o}=qe(),[u,l]=f.useState(""),[i,d]=f.useState(""),[m,p]=f.useState(!1),[w,h]=f.useState(!1),[N,b]=f.useState(""),[y,I]=f.useState(""),[v,k]=f.useState(null),[F,M]=f.useState(!1),[W,oe]=f.useState(!1),[L,Y]=f.useState(null),[H,T]=f.useState(null),[G,D]=f.useState(0),[g,C]=f.useState(!1),_=Ge(),R=hs();f.useEffect(()=>{o&&(t||R.pathname!=="/"&&_("/",{replace:!0}))},[o,t,R.pathname,_]),f.useEffect(()=>{t&&c&&R.pathname!=="/profile"&&_("/profile",{replace:!0,state:{forced:!0}})},[t,c,R.pathname,_]);const B=()=>X(this,null,function*(){var $,re;k(null),h(!0);try{const E=yield s(u,i,F?N:void 0,F?y:void 0);M(!1),b(""),I(""),E!=null&&E.mfa_enrollment_required?(D(E.mfa_remaining_skips||0),yield V()):_("/")}catch(E){const ie=(re=($=E==null?void 0:E.response)==null?void 0:$.data)==null?void 0:re.detail;ie==="MFA code required"||(ie==null?void 0:ie.code)==="mfa_required"?(M(!0),k("Enter your 6-digit MFA code or a recovery code.")):k(ie==="Invalid recovery code"||ie==="Invalid MFA code"||ie==="Invalid code"?"Invalid code. Please try again.":"Login failed. Check your credentials.")}finally{h(!1)}}),V=()=>X(this,null,function*(){var $,re;try{const E=yield K.post("/auth/mfa/enroll");Y(E.data),T(null),oe(!0)}catch(E){k(((re=($=E==null?void 0:E.response)==null?void 0:$.data)==null?void 0:re.detail)||"Could not start MFA enrollment")}}),S=()=>X(this,null,function*(){var $,re;C(!0);try{const E=yield K.post("/auth/mfa/verify",{code:N});T(E.data.recovery_codes),oe(!1),b(""),D(0),_("/")}catch(E){k(((re=($=E==null?void 0:E.response)==null?void 0:$.data)==null?void 0:re.detail)||"Invalid code")}finally{C(!1)}}),Q=()=>X(this,null,function*(){var $,re;try{const E=yield K.post("/auth/mfa/skip");D(E.data.remaining_skips),oe(!1),Y(null)}catch(E){k(((re=($=E==null?void 0:E.response)==null?void 0:$.data)==null?void 0:re.detail)||"Cannot skip MFA")}}),se=()=>{if(!H)return;const $=H.join(`
`);navigator.clipboard.writeText($).then(()=>{alert("Recovery codes copied to clipboard")})};return t?e.jsx(Mi,{children:e.jsxs(qn,{children:[e.jsx(De,{path:"/",element:e.jsx(Ai,{})}),e.jsx(De,{path:"/tasks",element:e.jsx(Ti,{})}),e.jsx(De,{path:"/complaints",element:e.jsx(Fi,{})}),e.jsx(De,{path:"/create",element:e.jsx(Oi,{})}),e.jsx(De,{path:"/complaints/:id",element:e.jsx(Li,{})}),e.jsx(De,{path:"/profile",element:e.jsx(jr,{})}),e.jsx(De,{path:"/users",element:e.jsx($i,{})}),e.jsx(De,{path:"/reference",element:e.jsx(Ii,{})}),e.jsx(De,{path:"/settings",element:e.jsx(jr,{})})]})}):e.jsxs("div",{className:"min-h-screen bg-app flex items-center justify-center p-4",children:[e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"rounded-card border border-border bg-surface shadow-card p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-text-primary mb-2",children:"Sign in to Compass"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Use your credentials to access the complaints workspace"})]}),v&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:v}),e.jsxs("form",{onSubmit:$=>{$.preventDefault(),B()},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(te,{type:"email",value:u,onChange:$=>l($.target.value),placeholder:"you@example.com",autoComplete:"email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{type:m?"text":"password",value:i,onChange:$=>d($.target.value),placeholder:"",autoComplete:"current-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>p(!m),"aria-label":m?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:m?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"MFA Code (6 digits)"}),e.jsx(te,{type:"text",autoFocus:!0,value:N,onChange:$=>b($.target.value),placeholder:"123456",maxLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Recovery Code (optional)"}),e.jsx(te,{type:"text",value:y,onChange:$=>I($.target.value),placeholder:"recovery-code"})]})]}),e.jsx(A,{type:"submit",variant:"primary",className:"w-full mt-6",disabled:w,children:w?"Signing in...":"Sign in"})]})]})}),e.jsxs(ge,{open:W,onClose:G>0?()=>{oe(!1),k(null)}:()=>{},children:[e.jsx(ye,{onClose:G>0?()=>{oe(!1),k(null)}:void 0,children:"Set up Multi-Factor Authentication"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[G<=0?e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:"You must enable MFA to continue."}):e.jsxs("p",{className:"text-sm text-text-secondary",children:["We recommend enabling MFA for enhanced security. You can skip up to ",G," more time(s)."]}),L?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-2",children:"Scan with your authenticator app"}),e.jsx("div",{className:"flex justify-center p-4 bg-app rounded-lg",children:e.jsx(en,{value:L.otpauth_url,size:180})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-1",children:"Manual entry secret"}),e.jsx("code",{className:"block text-xs bg-app p-2 rounded border border-border font-mono",children:L.secret})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Enter 6-digit code"}),e.jsx(te,{type:"text",autoFocus:!0,value:N,onChange:$=>b($.target.value),placeholder:"123456",maxLength:6})]}),H&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary",children:"Recovery codes (store securely)"}),e.jsx("button",{onClick:se,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:H.map($=>e.jsx("code",{className:"text-xs bg-app p-2 rounded border border-border font-mono",children:$},$))}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Save these codes in a secure location. They can be used to access your account if you lose your authenticator device."})]})]}):e.jsx("p",{className:"text-sm text-text-muted",children:"Preparing enrollment..."})]})}),e.jsxs(ve,{children:[e.jsx(A,{variant:"secondary",onClick:Q,disabled:G<=0,children:"Skip for now"}),e.jsx(A,{variant:"primary",onClick:S,disabled:!N||N.length<6||g,children:g?"Verifying...":"Verify & Enable"})]})]})]})}cs.createRoot(document.getElementById("root")).render(e.jsx(ht.StrictMode,{children:e.jsx(Vn,{children:e.jsx(_i,{children:e.jsx(Zi,{})})})}))});export default eo();
