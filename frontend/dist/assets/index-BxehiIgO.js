var Js=Object.defineProperty,Qs=Object.defineProperties;var Ks=Object.getOwnPropertyDescriptors;var Ze=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,Dt=Object.prototype.propertyIsEnumerable;var Ie=(t,s)=>(s=Symbol[t])?s:Symbol.for("Symbol."+t),Xs=t=>{throw TypeError(t)};var Ft=(t,s,n)=>s in t?Js(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,H=(t,s)=>{for(var n in s||(s={}))Pt.call(s,n)&&Ft(t,n,s[n]);if(Ze)for(var n of Ze(s))Dt.call(s,n)&&Ft(t,n,s[n]);return t},q=(t,s)=>Qs(t,Ks(s));var ut=(t,s)=>{var n={};for(var r in t)Pt.call(t,r)&&s.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Ze)for(var r of Ze(t))s.indexOf(r)<0&&Dt.call(t,r)&&(n[r]=t[r]);return n};var Gs=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);var X=(t,s,n)=>new Promise((r,a)=>{var l=c=>{try{x(n.next(c))}catch(o){a(o)}},u=c=>{try{x(n.throw(c))}catch(o){a(o)}},x=c=>c.done?r(c.value):Promise.resolve(c.value).then(l,u);x((n=n.apply(t,s)).next())}),Ae=function(t,s){this[0]=t,this[1]=s},mt=(t,s,n)=>{var r=(u,x,c,o)=>{try{var d=n[u](x),i=(x=d.value)instanceof Ae,h=d.done;Promise.resolve(i?x[0]:x).then(j=>i?r(u==="return"?u:"next",x[1]?{done:j.done,value:j.value}:j,c,o):c({value:j,done:h})).catch(j=>r("throw",j,c,o))}catch(j){o(j)}},a=u=>l[u]=x=>new Promise((c,o)=>r(u,x,c,o)),l={};return n=n.apply(t,s),l[Ie("asyncIterator")]=()=>l,a("next"),a("throw"),a("return"),l},xt=t=>{var s=t[Ie("asyncIterator")],n=!1,r,a={};return s==null?(s=t[Ie("iterator")](),r=l=>a[l]=u=>s[l](u)):(s=s.call(t),r=l=>a[l]=u=>{if(n){if(n=!1,l==="throw")throw u;return u}return n=!0,{done:!1,value:new Ae(new Promise(x=>{var c=s[l](u);c instanceof Object||Xs("Object expected"),x(c)}),1)}}),a[Ie("iterator")]=()=>a,r("next"),"throw"in s?r("throw"):a.throw=l=>{throw l},"return"in s&&r("return"),a},Tt=(t,s,n)=>(s=t[Ie("asyncIterator")])?s.call(t):(t=t[Ie("iterator")](),s={},n=(r,a)=>(a=t[r])&&(s[r]=l=>new Promise((u,x,c)=>(l=a.call(t,l),c=l.done,Promise.resolve(l.value).then(o=>u({value:o,done:c}),x)))),n("next"),n("return"),s);import{j as e}from"./mui-BpRHmZTB.js";import{a as Zs,c as ns,g as as,r as g,u as wt,L as er,b as Ue,d as tr,R as We,e as sr,f as Se,B as rr}from"./vendor-BaIKwp6E.js";var ua=Gs(Me=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();var gt={},$t=Zs;gt.createRoot=$t.createRoot,gt.hydrateRoot=$t.hydrateRoot;var is={exports:{}};(function(t,s){(function(n,r){t.exports=r()})(ns,function(){var n=1e3,r=6e4,a=36e5,l="millisecond",u="second",x="minute",c="hour",o="day",d="week",i="month",h="quarter",j="year",m="date",b="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(O){var L=["th","st","nd","rd"],w=O%100;return"["+O+(L[(w-20)%10]||L[w]||L[0])+"]"}},y=function(O,L,w){var k=String(O);return!k||k.length>=L?O:""+Array(L+1-k.length).join(w)+O},A={s:y,z:function(O){var L=-O.utcOffset(),w=Math.abs(L),k=Math.floor(w/60),_=w%60;return(L<=0?"+":"-")+y(k,2,"0")+":"+y(_,2,"0")},m:function O(L,w){if(L.date()<w.date())return-O(w,L);var k=12*(w.year()-L.year())+(w.month()-L.month()),_=L.clone().add(k,i),D=w-_<0,C=L.clone().add(k+(D?-1:1),i);return+(-(k+(w-_)/(D?_-C:C-_))||0)},a:function(O){return O<0?Math.ceil(O)||0:Math.floor(O)},p:function(O){return{M:i,y:j,w:d,d:o,D:m,h:c,m:x,s:u,ms:l,Q:h}[O]||String(O||"").toLowerCase().replace(/s$/,"")},u:function(O){return O===void 0}},R="en",E={};E[R]=M;var $="$isDayjsObject",F=function(O){return O instanceof oe||!(!O||!O[$])},Z=function O(L,w,k){var _;if(!L)return R;if(typeof L=="string"){var D=L.toLowerCase();E[D]&&(_=D),w&&(E[D]=w,_=D);var C=L.split("-");if(!_&&C.length>1)return O(C[0])}else{var v=L.name;E[v]=L,_=v}return!k&&_&&(R=_),_||!k&&R},Q=function(O,L){if(F(O))return O.clone();var w=typeof L=="object"?L:{};return w.date=O,w.args=arguments,new oe(w)},z=A;z.l=Z,z.i=F,z.w=function(O,L){return Q(O,{locale:L.$L,utc:L.$u,x:L.$x,$offset:L.$offset})};var oe=function(){function O(w){this.$L=Z(w.locale,null,!0),this.parse(w),this.$x=this.$x||w.x||{},this[$]=!0}var L=O.prototype;return L.parse=function(w){this.$d=function(k){var _=k.date,D=k.utc;if(_===null)return new Date(NaN);if(z.u(_))return new Date;if(_ instanceof Date)return new Date(_);if(typeof _=="string"&&!/Z$/i.test(_)){var C=_.match(f);if(C){var v=C[2]-1||0,B=(C[7]||"0").substring(0,3);return D?new Date(Date.UTC(C[1],v,C[3]||1,C[4]||0,C[5]||0,C[6]||0,B)):new Date(C[1],v,C[3]||1,C[4]||0,C[5]||0,C[6]||0,B)}}return new Date(_)}(w),this.init()},L.init=function(){var w=this.$d;this.$y=w.getFullYear(),this.$M=w.getMonth(),this.$D=w.getDate(),this.$W=w.getDay(),this.$H=w.getHours(),this.$m=w.getMinutes(),this.$s=w.getSeconds(),this.$ms=w.getMilliseconds()},L.$utils=function(){return z},L.isValid=function(){return this.$d.toString()!==b},L.isSame=function(w,k){var _=Q(w);return this.startOf(k)<=_&&_<=this.endOf(k)},L.isAfter=function(w,k){return Q(w)<this.startOf(k)},L.isBefore=function(w,k){return this.endOf(k)<Q(w)},L.$g=function(w,k,_){return z.u(w)?this[k]:this.set(_,w)},L.unix=function(){return Math.floor(this.valueOf()/1e3)},L.valueOf=function(){return this.$d.getTime()},L.startOf=function(w,k){var _=this,D=!!z.u(k)||k,C=z.p(w),v=function(te,K){var he=z.w(_.$u?Date.UTC(_.$y,K,te):new Date(_.$y,K,te),_);return D?he:he.endOf(o)},B=function(te,K){return z.w(_.toDate()[te].apply(_.toDate("s"),(D?[0,0,0,0]:[23,59,59,999]).slice(K)),_)},U=this.$W,P=this.$M,I=this.$D,W="set"+(this.$u?"UTC":"");switch(C){case j:return D?v(1,0):v(31,11);case i:return D?v(1,P):v(0,P+1);case d:var ue=this.$locale().weekStart||0,J=(U<ue?U+7:U)-ue;return v(D?I-J:I+(6-J),P);case o:case m:return B(W+"Hours",0);case c:return B(W+"Minutes",1);case x:return B(W+"Seconds",2);case u:return B(W+"Milliseconds",3);default:return this.clone()}},L.endOf=function(w){return this.startOf(w,!1)},L.$set=function(w,k){var _,D=z.p(w),C="set"+(this.$u?"UTC":""),v=(_={},_[o]=C+"Date",_[m]=C+"Date",_[i]=C+"Month",_[j]=C+"FullYear",_[c]=C+"Hours",_[x]=C+"Minutes",_[u]=C+"Seconds",_[l]=C+"Milliseconds",_)[D],B=D===o?this.$D+(k-this.$W):k;if(D===i||D===j){var U=this.clone().set(m,1);U.$d[v](B),U.init(),this.$d=U.set(m,Math.min(this.$D,U.daysInMonth())).$d}else v&&this.$d[v](B);return this.init(),this},L.set=function(w,k){return this.clone().$set(w,k)},L.get=function(w){return this[z.p(w)]()},L.add=function(w,k){var _,D=this;w=Number(w);var C=z.p(k),v=function(P){var I=Q(D);return z.w(I.date(I.date()+Math.round(P*w)),D)};if(C===i)return this.set(i,this.$M+w);if(C===j)return this.set(j,this.$y+w);if(C===o)return v(1);if(C===d)return v(7);var B=(_={},_[x]=r,_[c]=a,_[u]=n,_)[C]||1,U=this.$d.getTime()+w*B;return z.w(U,this)},L.subtract=function(w,k){return this.add(-1*w,k)},L.format=function(w){var k=this,_=this.$locale();if(!this.isValid())return _.invalidDate||b;var D=w||"YYYY-MM-DDTHH:mm:ssZ",C=z.z(this),v=this.$H,B=this.$m,U=this.$M,P=_.weekdays,I=_.months,W=_.meridiem,ue=function(K,he,Ne,Ee){return K&&(K[he]||K(k,D))||Ne[he].slice(0,Ee)},J=function(K){return z.s(v%12||12,K,"0")},te=W||function(K,he,Ne){var Ee=K<12?"AM":"PM";return Ne?Ee.toLowerCase():Ee};return D.replace(S,function(K,he){return he||function(Ne){switch(Ne){case"YY":return String(k.$y).slice(-2);case"YYYY":return z.s(k.$y,4,"0");case"M":return U+1;case"MM":return z.s(U+1,2,"0");case"MMM":return ue(_.monthsShort,U,I,3);case"MMMM":return ue(I,U);case"D":return k.$D;case"DD":return z.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return ue(_.weekdaysMin,k.$W,P,2);case"ddd":return ue(_.weekdaysShort,k.$W,P,3);case"dddd":return P[k.$W];case"H":return String(v);case"HH":return z.s(v,2,"0");case"h":return J(1);case"hh":return J(2);case"a":return te(v,B,!0);case"A":return te(v,B,!1);case"m":return String(B);case"mm":return z.s(B,2,"0");case"s":return String(k.$s);case"ss":return z.s(k.$s,2,"0");case"SSS":return z.s(k.$ms,3,"0");case"Z":return C}return null}(K)||C.replace(":","")})},L.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},L.diff=function(w,k,_){var D,C=this,v=z.p(k),B=Q(w),U=(B.utcOffset()-this.utcOffset())*r,P=this-B,I=function(){return z.m(C,B)};switch(v){case j:D=I()/12;break;case i:D=I();break;case h:D=I()/3;break;case d:D=(P-U)/6048e5;break;case o:D=(P-U)/864e5;break;case c:D=P/a;break;case x:D=P/r;break;case u:D=P/n;break;default:D=P}return _?D:z.a(D)},L.daysInMonth=function(){return this.endOf(i).$D},L.$locale=function(){return E[this.$L]},L.locale=function(w,k){if(!w)return this.$L;var _=this.clone(),D=Z(w,k,!0);return D&&(_.$L=D),_},L.clone=function(){return z.w(this.$d,this)},L.toDate=function(){return new Date(this.valueOf())},L.toJSON=function(){return this.isValid()?this.toISOString():null},L.toISOString=function(){return this.$d.toISOString()},L.toString=function(){return this.$d.toUTCString()},O}(),re=oe.prototype;return Q.prototype=re,[["$ms",l],["$s",u],["$m",x],["$H",c],["$W",o],["$M",i],["$y",j],["$D",m]].forEach(function(O){re[O[1]]=function(L){return this.$g(L,O[0],O[1])}}),Q.extend=function(O,L){return O.$i||(O(L,oe,Q),O.$i=!0),Q},Q.locale=Z,Q.isDayjs=F,Q.unix=function(O){return Q(1e3*O)},Q.en=E[R],Q.Ls=E,Q.p={},Q})})(is);var nr=is.exports;const Y=as(nr);function os(t,s){return function(){return t.apply(s,arguments)}}const{toString:ar}=Object.prototype,{getPrototypeOf:Ct}=Object,{iterator:it,toStringTag:ls}=Symbol,ot=(t=>s=>{const n=ar.call(s);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ce=t=>(t=t.toLowerCase(),s=>ot(s)===t),lt=t=>s=>typeof s===t,{isArray:ze}=Array,Be=lt("undefined");function Ve(t){return t!==null&&!Be(t)&&t.constructor!==null&&!Be(t.constructor)&&fe(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const cs=Ce("ArrayBuffer");function ir(t){let s;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&cs(t.buffer),s}const or=lt("string"),fe=lt("function"),ds=lt("number"),Je=t=>t!==null&&typeof t=="object",lr=t=>t===!0||t===!1,tt=t=>{if(ot(t)!=="object")return!1;const s=Ct(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(ls in t)&&!(it in t)},cr=t=>{if(!Je(t)||Ve(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch(s){return!1}},dr=Ce("Date"),ur=Ce("File"),mr=Ce("Blob"),xr=Ce("FileList"),hr=t=>Je(t)&&fe(t.pipe),fr=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||fe(t.append)&&((s=ot(t))==="formdata"||s==="object"&&fe(t.toString)&&t.toString()==="[object FormData]"))},pr=Ce("URLSearchParams"),[br,gr,jr,yr]=["ReadableStream","Request","Response","Headers"].map(Ce),vr=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qe(t,s,{allOwnKeys:n=!1}={}){if(t===null||typeof t=="undefined")return;let r,a;if(typeof t!="object"&&(t=[t]),ze(t))for(r=0,a=t.length;r<a;r++)s.call(null,t[r],r,t);else{if(Ve(t))return;const l=n?Object.getOwnPropertyNames(t):Object.keys(t),u=l.length;let x;for(r=0;r<u;r++)x=l[r],s.call(null,t[x],x,t)}}function us(t,s){if(Ve(t))return null;s=s.toLowerCase();const n=Object.keys(t);let r=n.length,a;for(;r-- >0;)if(a=n[r],s===a.toLowerCase())return a;return null}const Fe=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,ms=t=>!Be(t)&&t!==Fe;function jt(){const{caseless:t,skipUndefined:s}=ms(this)&&this||{},n={},r=(a,l)=>{const u=t&&us(n,l)||l;tt(n[u])&&tt(a)?n[u]=jt(n[u],a):tt(a)?n[u]=jt({},a):ze(a)?n[u]=a.slice():(!s||!Be(a))&&(n[u]=a)};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&Qe(arguments[a],r);return n}const Nr=(t,s,n,{allOwnKeys:r}={})=>(Qe(s,(a,l)=>{n&&fe(a)?t[l]=os(a,n):t[l]=a},{allOwnKeys:r}),t),wr=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Cr=(t,s,n,r)=>{t.prototype=Object.create(s.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),n&&Object.assign(t.prototype,n)},kr=(t,s,n,r)=>{let a,l,u;const x={};if(s=s||{},t==null)return s;do{for(a=Object.getOwnPropertyNames(t),l=a.length;l-- >0;)u=a[l],(!r||r(u,t,s))&&!x[u]&&(s[u]=t[u],x[u]=!0);t=n!==!1&&Ct(t)}while(t&&(!n||n(t,s))&&t!==Object.prototype);return s},_r=(t,s,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=s.length;const r=t.indexOf(s,n);return r!==-1&&r===n},Sr=t=>{if(!t)return null;if(ze(t))return t;let s=t.length;if(!ds(s))return null;const n=new Array(s);for(;s-- >0;)n[s]=t[s];return n},Mr=(t=>s=>t&&s instanceof t)(typeof Uint8Array!="undefined"&&Ct(Uint8Array)),Er=(t,s)=>{const r=(t&&t[it]).call(t);let a;for(;(a=r.next())&&!a.done;){const l=a.value;s.call(t,l[0],l[1])}},Ar=(t,s)=>{let n;const r=[];for(;(n=t.exec(s))!==null;)r.push(n);return r},Rr=Ce("HTMLFormElement"),Lr=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,a){return r.toUpperCase()+a}),It=(({hasOwnProperty:t})=>(s,n)=>t.call(s,n))(Object.prototype),Or=Ce("RegExp"),xs=(t,s)=>{const n=Object.getOwnPropertyDescriptors(t),r={};Qe(n,(a,l)=>{let u;(u=s(a,l,t))!==!1&&(r[l]=u||a)}),Object.defineProperties(t,r)},Fr=t=>{xs(t,(s,n)=>{if(fe(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(fe(r)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Pr=(t,s)=>{const n={},r=a=>{a.forEach(l=>{n[l]=!0})};return ze(t)?r(t):r(String(t).split(s)),n},Dr=()=>{},Tr=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function $r(t){return!!(t&&fe(t.append)&&t[ls]==="FormData"&&t[it])}const Ir=t=>{const s=new Array(10),n=(r,a)=>{if(Je(r)){if(s.indexOf(r)>=0)return;if(Ve(r))return r;if(!("toJSON"in r)){s[a]=r;const l=ze(r)?[]:{};return Qe(r,(u,x)=>{const c=n(u,a+1);!Be(c)&&(l[x]=c)}),s[a]=void 0,l}}return r};return n(t,0)},Br=Ce("AsyncFunction"),Ur=t=>t&&(Je(t)||fe(t))&&fe(t.then)&&fe(t.catch),hs=((t,s)=>t?setImmediate:s?((n,r)=>(Fe.addEventListener("message",({source:a,data:l})=>{a===Fe&&l===n&&r.length&&r.shift()()},!1),a=>{r.push(a),Fe.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",fe(Fe.postMessage)),zr=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Fe):typeof process!="undefined"&&process.nextTick||hs,Hr=t=>t!=null&&fe(t[it]),p={isArray:ze,isArrayBuffer:cs,isBuffer:Ve,isFormData:fr,isArrayBufferView:ir,isString:or,isNumber:ds,isBoolean:lr,isObject:Je,isPlainObject:tt,isEmptyObject:cr,isReadableStream:br,isRequest:gr,isResponse:jr,isHeaders:yr,isUndefined:Be,isDate:dr,isFile:ur,isBlob:mr,isRegExp:Or,isFunction:fe,isStream:hr,isURLSearchParams:pr,isTypedArray:Mr,isFileList:xr,forEach:Qe,merge:jt,extend:Nr,trim:vr,stripBOM:wr,inherits:Cr,toFlatObject:kr,kindOf:ot,kindOfTest:Ce,endsWith:_r,toArray:Sr,forEachEntry:Er,matchAll:Ar,isHTMLForm:Rr,hasOwnProperty:It,hasOwnProp:It,reduceDescriptors:xs,freezeMethods:Fr,toObjectSet:Pr,toCamelCase:Lr,noop:Dr,toFiniteNumber:Tr,findKey:us,global:Fe,isContextDefined:ms,isSpecCompliantForm:$r,toJSONObject:Ir,isAsyncFn:Br,isThenable:Ur,setImmediate:hs,asap:zr,isIterable:Hr};function G(t,s,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}p.inherits(G,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:p.toJSONObject(this.config),code:this.code,status:this.status}}});const fs=G.prototype,ps={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{ps[t]={value:t}});Object.defineProperties(G,ps);Object.defineProperty(fs,"isAxiosError",{value:!0});G.from=(t,s,n,r,a,l)=>{const u=Object.create(fs);p.toFlatObject(t,u,function(d){return d!==Error.prototype},o=>o!=="isAxiosError");const x=t&&t.message?t.message:"Error",c=s==null&&t?t.code:s;return G.call(u,x,c,n,r,a),t&&u.cause==null&&Object.defineProperty(u,"cause",{value:t,configurable:!0}),u.name=t&&t.name||"Error",l&&Object.assign(u,l),u};const Yr=null;function yt(t){return p.isPlainObject(t)||p.isArray(t)}function bs(t){return p.endsWith(t,"[]")?t.slice(0,-2):t}function Bt(t,s,n){return t?t.concat(s).map(function(a,l){return a=bs(a),!n&&l?"["+a+"]":a}).join(n?".":""):s}function Wr(t){return p.isArray(t)&&!t.some(yt)}const qr=p.toFlatObject(p,{},null,function(s){return/^is[A-Z]/.test(s)});function ct(t,s,n){if(!p.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,n=p.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,f){return!p.isUndefined(f[b])});const r=n.metaTokens,a=n.visitor||d,l=n.dots,u=n.indexes,c=(n.Blob||typeof Blob!="undefined"&&Blob)&&p.isSpecCompliantForm(s);if(!p.isFunction(a))throw new TypeError("visitor must be a function");function o(m){if(m===null)return"";if(p.isDate(m))return m.toISOString();if(p.isBoolean(m))return m.toString();if(!c&&p.isBlob(m))throw new G("Blob is not supported. Use a Buffer instead.");return p.isArrayBuffer(m)||p.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function d(m,b,f){let S=m;if(m&&!f&&typeof m=="object"){if(p.endsWith(b,"{}"))b=r?b:b.slice(0,-2),m=JSON.stringify(m);else if(p.isArray(m)&&Wr(m)||(p.isFileList(m)||p.endsWith(b,"[]"))&&(S=p.toArray(m)))return b=bs(b),S.forEach(function(y,A){!(p.isUndefined(y)||y===null)&&s.append(u===!0?Bt([b],A,l):u===null?b:b+"[]",o(y))}),!1}return yt(m)?!0:(s.append(Bt(f,b,l),o(m)),!1)}const i=[],h=Object.assign(qr,{defaultVisitor:d,convertValue:o,isVisitable:yt});function j(m,b){if(!p.isUndefined(m)){if(i.indexOf(m)!==-1)throw Error("Circular reference detected in "+b.join("."));i.push(m),p.forEach(m,function(S,M){(!(p.isUndefined(S)||S===null)&&a.call(s,S,p.isString(M)?M.trim():M,b,h))===!0&&j(S,b?b.concat(M):[M])}),i.pop()}}if(!p.isObject(t))throw new TypeError("data must be an object");return j(t),s}function Ut(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return s[r]})}function kt(t,s){this._pairs=[],t&&ct(t,this,s)}const gs=kt.prototype;gs.append=function(s,n){this._pairs.push([s,n])};gs.toString=function(s){const n=s?function(r){return s.call(this,r,Ut)}:Ut;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Vr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function js(t,s,n){if(!s)return t;const r=n&&n.encode||Vr;p.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(a?l=a(s,n):l=p.isURLSearchParams(s)?s.toString():new kt(s,n).toString(r),l){const u=t.indexOf("#");u!==-1&&(t=t.slice(0,u)),t+=(t.indexOf("?")===-1?"?":"&")+l}return t}class zt{constructor(){this.handlers=[]}use(s,n,r){return this.handlers.push({fulfilled:s,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){p.forEach(this.handlers,function(r){r!==null&&s(r)})}}const ys={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Jr=typeof URLSearchParams!="undefined"?URLSearchParams:kt,Qr=typeof FormData!="undefined"?FormData:null,Kr=typeof Blob!="undefined"?Blob:null,Xr={isBrowser:!0,classes:{URLSearchParams:Jr,FormData:Qr,Blob:Kr},protocols:["http","https","file","blob","url","data"]},_t=typeof window!="undefined"&&typeof document!="undefined",vt=typeof navigator=="object"&&navigator||void 0,Gr=_t&&(!vt||["ReactNative","NativeScript","NS"].indexOf(vt.product)<0),Zr=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",en=_t&&window.location.href||"http://localhost",tn=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:_t,hasStandardBrowserEnv:Gr,hasStandardBrowserWebWorkerEnv:Zr,navigator:vt,origin:en},Symbol.toStringTag,{value:"Module"})),xe=H(H({},tn),Xr);function sn(t,s){return ct(t,new xe.classes.URLSearchParams,H({visitor:function(n,r,a,l){return xe.isNode&&p.isBuffer(n)?(this.append(r,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},s))}function rn(t){return p.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function nn(t){const s={},n=Object.keys(t);let r;const a=n.length;let l;for(r=0;r<a;r++)l=n[r],s[l]=t[l];return s}function vs(t){function s(n,r,a,l){let u=n[l++];if(u==="__proto__")return!0;const x=Number.isFinite(+u),c=l>=n.length;return u=!u&&p.isArray(a)?a.length:u,c?(p.hasOwnProp(a,u)?a[u]=[a[u],r]:a[u]=r,!x):((!a[u]||!p.isObject(a[u]))&&(a[u]=[]),s(n,r,a[u],l)&&p.isArray(a[u])&&(a[u]=nn(a[u])),!x)}if(p.isFormData(t)&&p.isFunction(t.entries)){const n={};return p.forEachEntry(t,(r,a)=>{s(rn(r),a,n,0)}),n}return null}function an(t,s,n){if(p.isString(t))try{return(s||JSON.parse)(t),p.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const Ke={transitional:ys,adapter:["xhr","http","fetch"],transformRequest:[function(s,n){const r=n.getContentType()||"",a=r.indexOf("application/json")>-1,l=p.isObject(s);if(l&&p.isHTMLForm(s)&&(s=new FormData(s)),p.isFormData(s))return a?JSON.stringify(vs(s)):s;if(p.isArrayBuffer(s)||p.isBuffer(s)||p.isStream(s)||p.isFile(s)||p.isBlob(s)||p.isReadableStream(s))return s;if(p.isArrayBufferView(s))return s.buffer;if(p.isURLSearchParams(s))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let x;if(l){if(r.indexOf("application/x-www-form-urlencoded")>-1)return sn(s,this.formSerializer).toString();if((x=p.isFileList(s))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return ct(x?{"files[]":s}:s,c&&new c,this.formSerializer)}}return l||a?(n.setContentType("application/json",!1),an(s)):s}],transformResponse:[function(s){const n=this.transitional||Ke.transitional,r=n&&n.forcedJSONParsing,a=this.responseType==="json";if(p.isResponse(s)||p.isReadableStream(s))return s;if(s&&p.isString(s)&&(r&&!this.responseType||a)){const u=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(s,this.parseReviver)}catch(x){if(u)throw x.name==="SyntaxError"?G.from(x,G.ERR_BAD_RESPONSE,this,null,this.response):x}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:xe.classes.FormData,Blob:xe.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};p.forEach(["delete","get","head","post","put","patch"],t=>{Ke.headers[t]={}});const on=p.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ln=t=>{const s={};let n,r,a;return t&&t.split(`
`).forEach(function(u){a=u.indexOf(":"),n=u.substring(0,a).trim().toLowerCase(),r=u.substring(a+1).trim(),!(!n||s[n]&&on[n])&&(n==="set-cookie"?s[n]?s[n].push(r):s[n]=[r]:s[n]=s[n]?s[n]+", "+r:r)}),s},Ht=Symbol("internals");function Ye(t){return t&&String(t).trim().toLowerCase()}function st(t){return t===!1||t==null?t:p.isArray(t)?t.map(st):String(t)}function cn(t){const s=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)s[r[1]]=r[2];return s}const dn=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ht(t,s,n,r,a){if(p.isFunction(r))return r.call(this,s,n);if(a&&(s=n),!!p.isString(s)){if(p.isString(r))return s.indexOf(r)!==-1;if(p.isRegExp(r))return r.test(s)}}function un(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,n,r)=>n.toUpperCase()+r)}function mn(t,s){const n=p.toCamelCase(" "+s);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(a,l,u){return this[r].call(this,s,a,l,u)},configurable:!0})})}let pe=class{constructor(s){s&&this.set(s)}set(s,n,r){const a=this;function l(x,c,o){const d=Ye(c);if(!d)throw new Error("header name must be a non-empty string");const i=p.findKey(a,d);(!i||a[i]===void 0||o===!0||o===void 0&&a[i]!==!1)&&(a[i||c]=st(x))}const u=(x,c)=>p.forEach(x,(o,d)=>l(o,d,c));if(p.isPlainObject(s)||s instanceof this.constructor)u(s,n);else if(p.isString(s)&&(s=s.trim())&&!dn(s))u(ln(s),n);else if(p.isObject(s)&&p.isIterable(s)){let x={},c,o;for(const d of s){if(!p.isArray(d))throw TypeError("Object iterator must return a key-value pair");x[o=d[0]]=(c=x[o])?p.isArray(c)?[...c,d[1]]:[c,d[1]]:d[1]}u(x,n)}else s!=null&&l(n,s,r);return this}get(s,n){if(s=Ye(s),s){const r=p.findKey(this,s);if(r){const a=this[r];if(!n)return a;if(n===!0)return cn(a);if(p.isFunction(n))return n.call(this,a,r);if(p.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,n){if(s=Ye(s),s){const r=p.findKey(this,s);return!!(r&&this[r]!==void 0&&(!n||ht(this,this[r],r,n)))}return!1}delete(s,n){const r=this;let a=!1;function l(u){if(u=Ye(u),u){const x=p.findKey(r,u);x&&(!n||ht(r,r[x],x,n))&&(delete r[x],a=!0)}}return p.isArray(s)?s.forEach(l):l(s),a}clear(s){const n=Object.keys(this);let r=n.length,a=!1;for(;r--;){const l=n[r];(!s||ht(this,this[l],l,s,!0))&&(delete this[l],a=!0)}return a}normalize(s){const n=this,r={};return p.forEach(this,(a,l)=>{const u=p.findKey(r,l);if(u){n[u]=st(a),delete n[l];return}const x=s?un(l):String(l).trim();x!==l&&delete n[l],n[x]=st(a),r[x]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const n=Object.create(null);return p.forEach(this,(r,a)=>{r!=null&&r!==!1&&(n[a]=s&&p.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,n])=>s+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...n){const r=new this(s);return n.forEach(a=>r.set(a)),r}static accessor(s){const r=(this[Ht]=this[Ht]={accessors:{}}).accessors,a=this.prototype;function l(u){const x=Ye(u);r[x]||(mn(a,u),r[x]=!0)}return p.isArray(s)?s.forEach(l):l(s),this}};pe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);p.reduceDescriptors(pe.prototype,({value:t},s)=>{let n=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(r){this[n]=r}}});p.freezeMethods(pe);function ft(t,s){const n=this||Ke,r=s||n,a=pe.from(r.headers);let l=r.data;return p.forEach(t,function(x){l=x.call(n,l,a.normalize(),s?s.status:void 0)}),a.normalize(),l}function Ns(t){return!!(t&&t.__CANCEL__)}function He(t,s,n){G.call(this,t==null?"canceled":t,G.ERR_CANCELED,s,n),this.name="CanceledError"}p.inherits(He,G,{__CANCEL__:!0});function ws(t,s,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):s(new G("Request failed with status code "+n.status,[G.ERR_BAD_REQUEST,G.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function xn(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function hn(t,s){t=t||10;const n=new Array(t),r=new Array(t);let a=0,l=0,u;return s=s!==void 0?s:1e3,function(c){const o=Date.now(),d=r[l];u||(u=o),n[a]=c,r[a]=o;let i=l,h=0;for(;i!==a;)h+=n[i++],i=i%t;if(a=(a+1)%t,a===l&&(l=(l+1)%t),o-u<s)return;const j=d&&o-d;return j?Math.round(h*1e3/j):void 0}}function fn(t,s){let n=0,r=1e3/s,a,l;const u=(o,d=Date.now())=>{n=d,a=null,l&&(clearTimeout(l),l=null),t(...o)};return[(...o)=>{const d=Date.now(),i=d-n;i>=r?u(o,d):(a=o,l||(l=setTimeout(()=>{l=null,u(a)},r-i)))},()=>a&&u(a)]}const nt=(t,s,n=3)=>{let r=0;const a=hn(50,250);return fn(l=>{const u=l.loaded,x=l.lengthComputable?l.total:void 0,c=u-r,o=a(c),d=u<=x;r=u;const i={loaded:u,total:x,progress:x?u/x:void 0,bytes:c,rate:o||void 0,estimated:o&&x&&d?(x-u)/o:void 0,event:l,lengthComputable:x!=null,[s?"download":"upload"]:!0};t(i)},n)},Yt=(t,s)=>{const n=t!=null;return[r=>s[0]({lengthComputable:n,total:t,loaded:r}),s[1]]},Wt=t=>(...s)=>p.asap(()=>t(...s)),pn=xe.hasStandardBrowserEnv?((t,s)=>n=>(n=new URL(n,xe.origin),t.protocol===n.protocol&&t.host===n.host&&(s||t.port===n.port)))(new URL(xe.origin),xe.navigator&&/(msie|trident)/i.test(xe.navigator.userAgent)):()=>!0,bn=xe.hasStandardBrowserEnv?{write(t,s,n,r,a,l,u){if(typeof document=="undefined")return;const x=[`${t}=${encodeURIComponent(s)}`];p.isNumber(n)&&x.push(`expires=${new Date(n).toUTCString()}`),p.isString(r)&&x.push(`path=${r}`),p.isString(a)&&x.push(`domain=${a}`),l===!0&&x.push("secure"),p.isString(u)&&x.push(`SameSite=${u}`),document.cookie=x.join("; ")},read(t){if(typeof document=="undefined")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function gn(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function jn(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function Cs(t,s,n){let r=!gn(s);return t&&(r||n==!1)?jn(t,s):s}const qt=t=>t instanceof pe?H({},t):t;function De(t,s){s=s||{};const n={};function r(o,d,i,h){return p.isPlainObject(o)&&p.isPlainObject(d)?p.merge.call({caseless:h},o,d):p.isPlainObject(d)?p.merge({},d):p.isArray(d)?d.slice():d}function a(o,d,i,h){if(p.isUndefined(d)){if(!p.isUndefined(o))return r(void 0,o,i,h)}else return r(o,d,i,h)}function l(o,d){if(!p.isUndefined(d))return r(void 0,d)}function u(o,d){if(p.isUndefined(d)){if(!p.isUndefined(o))return r(void 0,o)}else return r(void 0,d)}function x(o,d,i){if(i in s)return r(o,d);if(i in t)return r(void 0,o)}const c={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:x,headers:(o,d,i)=>a(qt(o),qt(d),i,!0)};return p.forEach(Object.keys(H(H({},t),s)),function(d){const i=c[d]||a,h=i(t[d],s[d],d);p.isUndefined(h)&&i!==x||(n[d]=h)}),n}const ks=t=>{const s=De({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:l,headers:u,auth:x}=s;if(s.headers=u=pe.from(u),s.url=js(Cs(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),x&&u.set("Authorization","Basic "+btoa((x.username||"")+":"+(x.password?unescape(encodeURIComponent(x.password)):""))),p.isFormData(n)){if(xe.hasStandardBrowserEnv||xe.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if(p.isFunction(n.getHeaders)){const c=n.getHeaders(),o=["content-type","content-length"];Object.entries(c).forEach(([d,i])=>{o.includes(d.toLowerCase())&&u.set(d,i)})}}if(xe.hasStandardBrowserEnv&&(r&&p.isFunction(r)&&(r=r(s)),r||r!==!1&&pn(s.url))){const c=a&&l&&bn.read(l);c&&u.set(a,c)}return s},yn=typeof XMLHttpRequest!="undefined",vn=yn&&function(t){return new Promise(function(n,r){const a=ks(t);let l=a.data;const u=pe.from(a.headers).normalize();let{responseType:x,onUploadProgress:c,onDownloadProgress:o}=a,d,i,h,j,m;function b(){j&&j(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let f=new XMLHttpRequest;f.open(a.method.toUpperCase(),a.url,!0),f.timeout=a.timeout;function S(){if(!f)return;const y=pe.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),R={data:!x||x==="text"||x==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:y,config:t,request:f};ws(function($){n($),b()},function($){r($),b()},R),f=null}"onloadend"in f?f.onloadend=S:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(S)},f.onabort=function(){f&&(r(new G("Request aborted",G.ECONNABORTED,t,f)),f=null)},f.onerror=function(A){const R=A&&A.message?A.message:"Network Error",E=new G(R,G.ERR_NETWORK,t,f);E.event=A||null,r(E),f=null},f.ontimeout=function(){let A=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const R=a.transitional||ys;a.timeoutErrorMessage&&(A=a.timeoutErrorMessage),r(new G(A,R.clarifyTimeoutError?G.ETIMEDOUT:G.ECONNABORTED,t,f)),f=null},l===void 0&&u.setContentType(null),"setRequestHeader"in f&&p.forEach(u.toJSON(),function(A,R){f.setRequestHeader(R,A)}),p.isUndefined(a.withCredentials)||(f.withCredentials=!!a.withCredentials),x&&x!=="json"&&(f.responseType=a.responseType),o&&([h,m]=nt(o,!0),f.addEventListener("progress",h)),c&&f.upload&&([i,j]=nt(c),f.upload.addEventListener("progress",i),f.upload.addEventListener("loadend",j)),(a.cancelToken||a.signal)&&(d=y=>{f&&(r(!y||y.type?new He(null,t,f):y),f.abort(),f=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const M=xn(a.url);if(M&&xe.protocols.indexOf(M)===-1){r(new G("Unsupported protocol "+M+":",G.ERR_BAD_REQUEST,t));return}f.send(l||null)})},Nn=(t,s)=>{const{length:n}=t=t?t.filter(Boolean):[];if(s||n){let r=new AbortController,a;const l=function(o){if(!a){a=!0,x();const d=o instanceof Error?o:this.reason;r.abort(d instanceof G?d:new He(d instanceof Error?d.message:d))}};let u=s&&setTimeout(()=>{u=null,l(new G(`timeout ${s} of ms exceeded`,G.ETIMEDOUT))},s);const x=()=>{t&&(u&&clearTimeout(u),u=null,t.forEach(o=>{o.unsubscribe?o.unsubscribe(l):o.removeEventListener("abort",l)}),t=null)};t.forEach(o=>o.addEventListener("abort",l));const{signal:c}=r;return c.unsubscribe=()=>p.asap(x),c}},wn=function*(t,s){let n=t.byteLength;if(n<s){yield t;return}let r=0,a;for(;r<n;)a=r+s,yield t.slice(r,a),r=a},Cn=function(t,s){return mt(this,null,function*(){try{for(var n=Tt(kn(t)),r,a,l;r=!(a=yield new Ae(n.next())).done;r=!1){const u=a.value;yield*xt(wn(u,s))}}catch(a){l=[a]}finally{try{r&&(a=n.return)&&(yield new Ae(a.call(n)))}finally{if(l)throw l[0]}}})},kn=function(t){return mt(this,null,function*(){if(t[Symbol.asyncIterator]){yield*xt(t);return}const s=t.getReader();try{for(;;){const{done:n,value:r}=yield new Ae(s.read());if(n)break;yield r}}finally{yield new Ae(s.cancel())}})},Vt=(t,s,n,r)=>{const a=Cn(t,s);let l=0,u,x=o=>{u||(u=!0,r&&r(o))};return new ReadableStream({pull(o){return X(this,null,function*(){try{const{done:d,value:i}=yield a.next();if(d){x(),o.close();return}let h=i.byteLength;if(n){let j=l+=h;n(j)}o.enqueue(new Uint8Array(i))}catch(d){throw x(d),d}})},cancel(o){return x(o),a.return()}},{highWaterMark:2})},Jt=64*1024,{isFunction:et}=p,_n=(({Request:t,Response:s})=>({Request:t,Response:s}))(p.global),{ReadableStream:Qt,TextEncoder:Kt}=p.global,Xt=(t,...s)=>{try{return!!t(...s)}catch(n){return!1}},Sn=t=>{t=p.merge.call({skipUndefined:!0},_n,t);const{fetch:s,Request:n,Response:r}=t,a=s?et(s):typeof fetch=="function",l=et(n),u=et(r);if(!a)return!1;const x=a&&et(Qt),c=a&&(typeof Kt=="function"?(m=>b=>m.encode(b))(new Kt):m=>X(Me,null,function*(){return new Uint8Array(yield new n(m).arrayBuffer())})),o=l&&x&&Xt(()=>{let m=!1;const b=new n(xe.origin,{body:new Qt,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!b}),d=u&&x&&Xt(()=>p.isReadableStream(new r("").body)),i={stream:d&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!i[m]&&(i[m]=(b,f)=>{let S=b&&b[m];if(S)return S.call(b);throw new G(`Response type '${m}' is not supported`,G.ERR_NOT_SUPPORT,f)})});const h=m=>X(Me,null,function*(){if(m==null)return 0;if(p.isBlob(m))return m.size;if(p.isSpecCompliantForm(m))return(yield new n(xe.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(p.isArrayBufferView(m)||p.isArrayBuffer(m))return m.byteLength;if(p.isURLSearchParams(m)&&(m=m+""),p.isString(m))return(yield c(m)).byteLength}),j=(m,b)=>X(Me,null,function*(){const f=p.toFiniteNumber(m.getContentLength());return f==null?h(b):f});return m=>X(Me,null,function*(){let{url:b,method:f,data:S,signal:M,cancelToken:y,timeout:A,onDownloadProgress:R,onUploadProgress:E,responseType:$,headers:F,withCredentials:Z="same-origin",fetchOptions:Q}=ks(m),z=s||fetch;$=$?($+"").toLowerCase():"text";let oe=Nn([M,y&&y.toAbortSignal()],A),re=null;const O=oe&&oe.unsubscribe&&(()=>{oe.unsubscribe()});let L;try{if(E&&o&&f!=="get"&&f!=="head"&&(L=yield j(F,S))!==0){let v=new n(b,{method:"POST",body:S,duplex:"half"}),B;if(p.isFormData(S)&&(B=v.headers.get("content-type"))&&F.setContentType(B),v.body){const[U,P]=Yt(L,nt(Wt(E)));S=Vt(v.body,Jt,U,P)}}p.isString(Z)||(Z=Z?"include":"omit");const w=l&&"credentials"in n.prototype,k=q(H({},Q),{signal:oe,method:f.toUpperCase(),headers:F.normalize().toJSON(),body:S,duplex:"half",credentials:w?Z:void 0});re=l&&new n(b,k);let _=yield l?z(re,Q):z(b,k);const D=d&&($==="stream"||$==="response");if(d&&(R||D&&O)){const v={};["status","statusText","headers"].forEach(I=>{v[I]=_[I]});const B=p.toFiniteNumber(_.headers.get("content-length")),[U,P]=R&&Yt(B,nt(Wt(R),!0))||[];_=new r(Vt(_.body,Jt,U,()=>{P&&P(),O&&O()}),v)}$=$||"text";let C=yield i[p.findKey(i,$)||"text"](_,m);return!D&&O&&O(),yield new Promise((v,B)=>{ws(v,B,{data:C,headers:pe.from(_.headers),status:_.status,statusText:_.statusText,config:m,request:re})})}catch(w){throw O&&O(),w&&w.name==="TypeError"&&/Load failed|fetch/i.test(w.message)?Object.assign(new G("Network Error",G.ERR_NETWORK,m,re),{cause:w.cause||w}):G.from(w,w&&w.code,m,re)}})},Mn=new Map,_s=t=>{let s=t&&t.env||{};const{fetch:n,Request:r,Response:a}=s,l=[r,a,n];let u=l.length,x=u,c,o,d=Mn;for(;x--;)c=l[x],o=d.get(c),o===void 0&&d.set(c,o=x?new Map:Sn(s)),d=o;return o};_s();const St={http:Yr,xhr:vn,fetch:{get:_s}};p.forEach(St,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch(n){}Object.defineProperty(t,"adapterName",{value:s})}});const Gt=t=>`- ${t}`,En=t=>p.isFunction(t)||t===null||t===!1;function An(t,s){t=p.isArray(t)?t:[t];const{length:n}=t;let r,a;const l={};for(let u=0;u<n;u++){r=t[u];let x;if(a=r,!En(r)&&(a=St[(x=String(r)).toLowerCase()],a===void 0))throw new G(`Unknown adapter '${x}'`);if(a&&(p.isFunction(a)||(a=a.get(s))))break;l[x||"#"+u]=a}if(!a){const u=Object.entries(l).map(([c,o])=>`adapter ${c} `+(o===!1?"is not supported by the environment":"is not available in the build"));let x=n?u.length>1?`since :
`+u.map(Gt).join(`
`):" "+Gt(u[0]):"as no adapter specified";throw new G("There is no suitable adapter to dispatch the request "+x,"ERR_NOT_SUPPORT")}return a}const Ss={getAdapter:An,adapters:St};function pt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new He(null,t)}function Zt(t){return pt(t),t.headers=pe.from(t.headers),t.data=ft.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ss.getAdapter(t.adapter||Ke.adapter,t)(t).then(function(r){return pt(t),r.data=ft.call(t,t.transformResponse,r),r.headers=pe.from(r.headers),r},function(r){return Ns(r)||(pt(t),r&&r.response&&(r.response.data=ft.call(t,t.transformResponse,r.response),r.response.headers=pe.from(r.response.headers))),Promise.reject(r)})}const Ms="1.13.2",dt={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{dt[t]=function(r){return typeof r===t||"a"+(s<1?"n ":" ")+t}});const es={};dt.transitional=function(s,n,r){function a(l,u){return"[Axios v"+Ms+"] Transitional option '"+l+"'"+u+(r?". "+r:"")}return(l,u,x)=>{if(s===!1)throw new G(a(u," has been removed"+(n?" in "+n:"")),G.ERR_DEPRECATED);return n&&!es[u]&&(es[u]=!0,console.warn(a(u," has been deprecated since v"+n+" and will be removed in the near future"))),s?s(l,u,x):!0}};dt.spelling=function(s){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${s}`),!0)};function Rn(t,s,n){if(typeof t!="object")throw new G("options must be an object",G.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let a=r.length;for(;a-- >0;){const l=r[a],u=s[l];if(u){const x=t[l],c=x===void 0||u(x,l,t);if(c!==!0)throw new G("option "+l+" must be "+c,G.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new G("Unknown option "+l,G.ERR_BAD_OPTION)}}const rt={assertOptions:Rn,validators:dt},ke=rt.validators;let Pe=class{constructor(s){this.defaults=s||{},this.interceptors={request:new zt,response:new zt}}request(s,n){return X(this,null,function*(){try{return yield this._request(s,n)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?l&&!String(r.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+l):r.stack=l}catch(u){}}throw r}})}_request(s,n){typeof s=="string"?(n=n||{},n.url=s):n=s||{},n=De(this.defaults,n);const{transitional:r,paramsSerializer:a,headers:l}=n;r!==void 0&&rt.assertOptions(r,{silentJSONParsing:ke.transitional(ke.boolean),forcedJSONParsing:ke.transitional(ke.boolean),clarifyTimeoutError:ke.transitional(ke.boolean)},!1),a!=null&&(p.isFunction(a)?n.paramsSerializer={serialize:a}:rt.assertOptions(a,{encode:ke.function,serialize:ke.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),rt.assertOptions(n,{baseUrl:ke.spelling("baseURL"),withXsrfToken:ke.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=l&&p.merge(l.common,l[n.method]);l&&p.forEach(["delete","get","head","post","put","patch","common"],m=>{delete l[m]}),n.headers=pe.concat(u,l);const x=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(n)===!1||(c=c&&b.synchronous,x.unshift(b.fulfilled,b.rejected))});const o=[];this.interceptors.response.forEach(function(b){o.push(b.fulfilled,b.rejected)});let d,i=0,h;if(!c){const m=[Zt.bind(this),void 0];for(m.unshift(...x),m.push(...o),h=m.length,d=Promise.resolve(n);i<h;)d=d.then(m[i++],m[i++]);return d}h=x.length;let j=n;for(;i<h;){const m=x[i++],b=x[i++];try{j=m(j)}catch(f){b.call(this,f);break}}try{d=Zt.call(this,j)}catch(m){return Promise.reject(m)}for(i=0,h=o.length;i<h;)d=d.then(o[i++],o[i++]);return d}getUri(s){s=De(this.defaults,s);const n=Cs(s.baseURL,s.url,s.allowAbsoluteUrls);return js(n,s.params,s.paramsSerializer)}};p.forEach(["delete","get","head","options"],function(s){Pe.prototype[s]=function(n,r){return this.request(De(r||{},{method:s,url:n,data:(r||{}).data}))}});p.forEach(["post","put","patch"],function(s){function n(r){return function(l,u,x){return this.request(De(x||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:l,data:u}))}}Pe.prototype[s]=n(),Pe.prototype[s+"Form"]=n(!0)});let Ln=class Es{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const r=this;this.promise.then(a=>{if(!r._listeners)return;let l=r._listeners.length;for(;l-- >0;)r._listeners[l](a);r._listeners=null}),this.promise.then=a=>{let l;const u=new Promise(x=>{r.subscribe(x),l=x}).then(a);return u.cancel=function(){r.unsubscribe(l)},u},s(function(l,u,x){r.reason||(r.reason=new He(l,u,x),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const s=new AbortController,n=r=>{s.abort(r)};return this.subscribe(n),s.signal.unsubscribe=()=>this.unsubscribe(n),s.signal}static source(){let s;return{token:new Es(function(a){s=a}),cancel:s}}};function On(t){return function(n){return t.apply(null,n)}}function Fn(t){return p.isObject(t)&&t.isAxiosError===!0}const Nt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Nt).forEach(([t,s])=>{Nt[s]=t});function As(t){const s=new Pe(t),n=os(Pe.prototype.request,s);return p.extend(n,Pe.prototype,s,{allOwnKeys:!0}),p.extend(n,s,null,{allOwnKeys:!0}),n.create=function(a){return As(De(t,a))},n}const me=As(Ke);me.Axios=Pe;me.CanceledError=He;me.CancelToken=Ln;me.isCancel=Ns;me.VERSION=Ms;me.toFormData=ct;me.AxiosError=G;me.Cancel=me.CanceledError;me.all=function(s){return Promise.all(s)};me.spread=On;me.isAxiosError=Fn;me.mergeConfig=De;me.AxiosHeaders=pe;me.formToJSON=t=>vs(p.isHTMLForm(t)?new FormData(t):t);me.getAdapter=Ss.getAdapter;me.HttpStatusCode=Nt;me.default=me;const{Axios:ba,AxiosError:ga,CanceledError:ja,isCancel:ya,CancelToken:va,VERSION:Na,all:wa,Cancel:Ca,isAxiosError:ka,spread:_a,toFormData:Sa,AxiosHeaders:Ma,HttpStatusCode:Ea,formToJSON:Aa,getAdapter:Ra,mergeConfig:La}=me,Pn="/api",Dn=Pn,V=me.create({baseURL:Dn});V.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&(t.headers=q(H({},t.headers),{Authorization:`Bearer ${s}`})),t});V.interceptors.response.use(t=>t,t=>{var n;return((n=t==null?void 0:t.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("name"),localStorage.removeItem("userId"),typeof window!="undefined"&&window.location.pathname!=="/"&&window.location.assign("/")),Promise.reject(t)});const Rs=g.createContext(void 0),Tn=({children:t})=>{const[s,n]=g.useState({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!1});g.useEffect(()=>{X(Me,null,function*(){const x=localStorage.getItem("token"),c=localStorage.getItem("role"),o=localStorage.getItem("name"),d=localStorage.getItem("userId");if(x)try{const i=yield V.get("/auth/me",{headers:{Authorization:`Bearer ${x}`}}),h=i.data.role;localStorage.setItem("role",h),localStorage.setItem("name",i.data.full_name),localStorage.setItem("userId",i.data.id),n({token:x,role:h,name:i.data.full_name,userId:i.data.id,user:i.data,mustChangePassword:!!i.data.must_change_password,ready:!0});return}catch(i){localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0});return}(c||o||d)&&localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0})})},[]);const r=()=>X(Me,null,function*(){const u=localStorage.getItem("token");if(!u)return;const x=yield V.get("/auth/me",{headers:{Authorization:`Bearer ${u}`}}),c=x.data.role;localStorage.setItem("role",c),localStorage.setItem("name",x.data.full_name),localStorage.setItem("userId",x.data.id),n({token:u,role:c,name:x.data.full_name,userId:x.data.id,mustChangePassword:!!x.data.must_change_password,ready:!0})}),a=(u,x,c,o)=>X(Me,null,function*(){const d=yield V.post("/auth/token",{email:u,password:x,mfa_code:c,recovery_code:o}),i=d.data.access_token;localStorage.setItem("token",i);const h=yield V.get("/auth/me",{headers:{Authorization:`Bearer ${i}`}}),j=h.data.role;return localStorage.setItem("role",j),localStorage.setItem("name",h.data.full_name),localStorage.setItem("userId",h.data.id),n({token:i,role:j,name:h.data.full_name,userId:h.data.id,user:h.data,mustChangePassword:!!h.data.must_change_password,ready:!0}),d.data}),l=()=>{localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0})};return e.jsx(Rs.Provider,{value:q(H({},s),{login:a,logout:l,refreshMe:r}),children:t})},$e=()=>{const t=g.useContext(Rs);if(!t)throw new Error("useAuth must be used within AuthProvider");return t};function Re({to:t,icon:s,label:n,badge:r}){const l=wt().pathname===t;return e.jsxs(er,{to:t,className:`flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition ${l?"bg-app text-text-primary":"text-text-secondary hover:bg-app hover:text-text-primary"}`,children:[e.jsx("span",{className:"h-5 w-5",children:s}),e.jsx("span",{className:"flex-1",children:n}),r!==void 0&&r>0&&e.jsx("span",{className:"ml-auto inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-app px-1 text-[11px] font-semibold text-text-secondary border border-border",children:r})]})}function $n(){var n,r,a;const{user:t,logout:s}=$e();return e.jsxs("div",{className:"fixed inset-y-0 left-0 w-64 bg-surface border-r border-border px-6 py-6 flex flex-col gap-6 overflow-y-auto scrollbar-thin",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-brand flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"C"})}),e.jsx("span",{className:"text-lg font-semibold text-text-primary",children:"Compass"})]}),e.jsxs("nav",{className:"flex flex-col gap-1",children:[e.jsx(Re,{to:"/",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),label:"Dashboard"}),e.jsx(Re,{to:"/tasks",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),label:"My Tasks"}),e.jsx(Re,{to:"/complaints",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),label:"Complaints"}),e.jsx(Re,{to:"/create",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),label:"New Complaint"}),(t==null?void 0:t.role)!=="read_only"&&e.jsx(Re,{to:"/reference",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),label:"Reference Data"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="complaints_manager")&&e.jsx(Re,{to:"/users",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),label:"Users"}),e.jsx(Re,{to:"/settings",icon:e.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),label:"Settings"})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-brand flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:((r=(n=t==null?void 0:t.full_name)==null?void 0:n.charAt(0))==null?void 0:r.toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:(t==null?void 0:t.full_name)||"User"}),e.jsx("div",{className:"text-xs text-text-secondary truncate capitalize",children:((a=t==null?void 0:t.role)==null?void 0:a.replace(/_/g," "))||"User"})]})]}),e.jsxs("button",{onClick:s,className:"flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-text-secondary hover:bg-app hover:text-text-primary transition",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Sign out"})]})]})]})}function In({children:t}){return e.jsxs("div",{className:"min-h-screen bg-app text-text-primary",children:[e.jsx($n,{}),e.jsx("div",{className:"ml-64 min-h-screen flex flex-col",children:t})]})}function T(l){var u=l,{variant:t="primary",size:s="md",className:n="",children:r}=u,a=ut(u,["variant","size","className","children"]);const x="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-offset-2 focus-visible:ring-offset-app disabled:opacity-40 disabled:pointer-events-none",c={sm:"h-8 px-3 text-xs",md:"h-10 px-4 text-sm"},o={primary:"bg-brand text-white hover:opacity-90 active:translate-y-px",secondary:"bg-surface text-text-primary border border-border hover:bg-app active:translate-y-px",ghost:"bg-transparent text-text-primary hover:bg-app active:translate-y-px",icon:"h-10 w-10 p-0 rounded-full hover:bg-app active:translate-y-px"};return e.jsx("button",q(H({className:`${x} ${c[s]} ${o[t]} ${n}`},a),{children:r}))}function ie(a){var l=a,{error:t,leadingIcon:s,className:n=""}=l,r=ut(l,["error","leadingIcon","className"]);const u="w-full h-10 rounded-lg border bg-surface px-3 text-sm text-text-primary placeholder:text-text-muted outline-none transition",x=t?"border-semantic-error focus:border-semantic-error focus:ring-2 focus:ring-semantic-error/15":"border-border focus:border-brand focus:ring-2 focus:ring-brand/15",c=s?"pl-10":"px-3";return e.jsxs("div",{className:"relative",children:[s&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-text-muted",children:s}),e.jsx("input",H({className:`${u} ${x} ${c} ${n}`},r))]})}function ae({children:t,className:s="",onClick:n,selected:r,inverse:a}){const l="rounded-card border shadow-card p-4",u=a?"bg-brand text-white border-transparent":"bg-surface text-text-primary border-border",x=r?"ring-2 ring-brand/15":"",c=n?"cursor-pointer hover:shadow-sm active:translate-y-px transition":"";return e.jsx("div",{className:`${l} ${u} ${x} ${c} ${s}`,onClick:n,children:t})}function ce({children:t,className:s=""}){return e.jsx("div",{className:`flex items-start justify-between gap-3 ${s}`,children:t})}function de({children:t,className:s="",inverse:n}){const r=n?"text-white":"text-text-primary";return e.jsx("h3",{className:`text-sm font-semibold ${r} ${s}`,children:t})}function le({children:t,className:s="",inverse:n}){const r=n?"text-white/80":"text-text-secondary";return e.jsx("div",{className:`mt-2 text-xs leading-relaxed ${r} ${s}`,children:t})}function be({open:t,onClose:s,children:n}){return g.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:s}),e.jsx("div",{className:"fixed left-1/2 top-1/2 w-[min(560px,calc(100%-2rem))] -translate-x-1/2 -translate-y-1/2 rounded-modal border border-border bg-surface p-6 shadow-xl z-50",children:n})]}):null}function ge({children:t,onClose:s}){return e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:t}),s&&e.jsx("button",{onClick:s,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-text-muted hover:bg-app hover:text-text-primary transition",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function je({children:t}){return e.jsx("div",{className:"text-sm text-text-secondary",children:t})}function ye({children:t}){return e.jsx("div",{className:"mt-6 flex justify-end gap-3",children:t})}function Ls({children:t,className:s=""}){return e.jsx("div",{className:`overflow-hidden rounded-card border border-border bg-surface ${s}`,children:e.jsx("table",{className:"w-full table-auto",children:t})})}function Bn({children:t}){return e.jsx("thead",{className:"bg-app",children:t})}function Un({children:t}){return e.jsx("tbody",{children:t})}function ts({children:t,onClick:s,className:n=""}){const r=s?"cursor-pointer hover:bg-app/60":"hover:bg-app/60";return e.jsx("tr",{className:`border-t border-border ${r} ${n}`,onClick:s,children:t})}function Le({children:t,className:s=""}){return e.jsx("th",{className:`h-10 px-4 text-left text-xs font-semibold text-text-secondary ${s}`,children:t})}function Oe({children:t,className:s=""}){return e.jsx("td",{className:`h-12 px-4 text-sm text-text-primary ${s}`,children:t})}function bt({value:t,onChange:s,options:n,placeholder:r,className:a=""}){const[l,u]=g.useState(!1),[x,c]=g.useState(t),[o,d]=g.useState(0),i=g.useRef(null),h=g.useRef(null);g.useEffect(()=>{c(t)},[t]);const j=n.filter(M=>M.toLowerCase().includes(x.toLowerCase()));g.useEffect(()=>{const M=y=>{h.current&&!h.current.contains(y.target)&&i.current&&!i.current.contains(y.target)&&(u(!1),s(x))};return document.addEventListener("mousedown",M),()=>document.removeEventListener("mousedown",M)},[x,s]);const m=M=>{const y=M.target.value;c(y),u(!0),d(0)},b=M=>{var y;c(M),s(M),u(!1),(y=i.current)==null||y.blur()},f=M=>{var y;if(!l&&(M.key==="ArrowDown"||M.key==="ArrowUp")){u(!0);return}if(l)switch(M.key){case"ArrowDown":M.preventDefault(),d(A=>A<j.length-1?A+1:A);break;case"ArrowUp":M.preventDefault(),d(A=>A>0?A-1:0);break;case"Enter":M.preventDefault(),j[o]&&b(j[o]);break;case"Escape":M.preventDefault(),u(!1),(y=i.current)==null||y.blur();break}},S=()=>{setTimeout(()=>{var M;(M=h.current)!=null&&M.contains(document.activeElement)||(u(!1),s(x))},200)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:i,type:"text",value:x,onChange:m,onFocus:()=>u(!0),onBlur:S,onKeyDown:f,placeholder:r,className:`w-full h-10 rounded-lg border border-border bg-surface pl-3 pr-10 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${a}`}),e.jsx("button",{type:"button",onClick:()=>{var M;u(!l),(M=i.current)==null||M.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:e.jsx("svg",{className:`h-4 w-4 transition-transform ${l?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),l&&j.length>0&&e.jsx("div",{ref:h,className:"absolute z-50 mt-1 w-full rounded-lg border border-border bg-surface shadow-lg max-h-60 overflow-auto scrollbar-thin",children:j.map((M,y)=>e.jsx("button",{type:"button",onClick:()=>b(M),onMouseEnter:()=>d(y),className:`w-full text-left px-3 py-2 text-sm transition ${y===o?"bg-app text-text-primary":"text-text-secondary hover:bg-app hover:text-text-primary"}`,children:M},M))}),l&&x&&j.length===0&&e.jsx("div",{ref:h,className:"absolute z-50 mt-1 w-full rounded-lg border border-border bg-surface shadow-lg p-3",children:e.jsxs("p",{className:"text-sm text-text-secondary",children:['No matches found. Type to create "',x,'"']})})]})}function ve({title:t,actions:s}){return e.jsxs("div",{className:"h-16 px-10 flex items-center justify-between gap-6 bg-app border-b border-border",children:[t?e.jsx("h1",{className:"text-2xl font-semibold text-text-primary",children:t}):e.jsx("div",{className:"w-full max-w-md",children:e.jsx(ie,{type:"search",placeholder:"Search complaints...",leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),e.jsx("div",{className:"flex items-center gap-3",children:s})]})}function zn(){const t=Ue(),{userId:s,token:n}=$e(),[r,a]=g.useState(null),[l,u]=g.useState([]),[x,c]=g.useState("mine"),[o,d]=g.useState(!1),[i,h]=g.useState(!0),[j,m]=g.useState(null),b=()=>X(this,null,function*(){var S;if(n){h(!0),m(null);try{const M=yield V.get("/complaints/metrics",{params:{_:Date.now()}});a(M.data)}catch(M){if(((S=M==null?void 0:M.response)==null?void 0:S.status)===401)return;console.error("Failed to load dashboard metrics",M),m("Failed to load metrics. Please try again.")}finally{h(!1)}}});g.useEffect(()=>{b()},[n]),g.useEffect(()=>{if(!s||!n)return;X(this,null,function*(){var M;d(!0);try{let y=[];x==="mine"?y=((yield V.get("/complaints",{params:{handler_id:s,page:1,page_size:50,_:Date.now()}})).data||[]).filter(R=>R.status!=="Closed"):x==="unassigned"?y=((yield V.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(R=>R.status!=="Closed").filter(R=>!R.assigned_handler_id):x==="breached"?y=((yield V.get("/complaints",{params:{overdue:!0,page:1,page_size:100,_:Date.now()}})).data||[]).filter(R=>R.status!=="Closed"):x==="oldest"&&(y=((yield V.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(R=>R.status!=="Closed"),y.sort((R,E)=>Y(R.received_at).valueOf()-Y(E.received_at).valueOf()),y=y.slice(0,20)),u(y)}catch(y){if(((M=y==null?void 0:y.response)==null?void 0:M.status)===401)return;console.error("Failed to load queue",y)}finally{d(!1)}})},[s,n,x]);const f=S=>S===null?"N/A":`${Math.round(S)}%`;return e.jsxs(e.Fragment,{children:[e.jsx(ve,{actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"secondary",onClick:b,disabled:i,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),i?"Refreshing...":"Refresh"]}),e.jsxs(T,{variant:"primary",onClick:()=>t("/create"),children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"New Complaint"]})]})}),e.jsxs("div",{className:"px-10 py-6",children:[j&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:j}),e.jsx(T,{variant:"secondary",onClick:b,children:"Retry"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Open Cases"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-text-primary",children:i?"":(r==null?void 0:r.kpis.open)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"Total open complaints"})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"My Open"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-text-primary",children:i?"":(r==null?void 0:r.kpis.my_open)||0}),e.jsxs("div",{className:"mt-2 text-xs text-text-secondary",children:["Assigned to me",!i&&r&&e.jsx("button",{onClick:()=>t("/tasks"),className:"ml-2 text-brand hover:text-brand-dark font-medium",children:"View "})]})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"SLA Breaches"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-semantic-error",children:i?"":(r==null?void 0:r.kpis.open_sla_breaches)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"Open breaches"})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Stale (21d+)"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-semantic-warning",children:i?"":(r==null?void 0:r.kpis.open_stale_21d)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"No activity"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"7-Day Flow"})}),e.jsx(le,{children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-semantic-success"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"New complaints"})]}),e.jsx("span",{className:"text-xl font-semibold text-text-primary",children:(r==null?void 0:r.flow_7d.new)||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Closed"})]}),e.jsx("span",{className:"text-xl font-semibold text-text-primary",children:(r==null?void 0:r.flow_7d.closed)||0})]}),e.jsx("div",{className:"pt-2 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:"Net change"}),e.jsxs("span",{className:`text-lg font-semibold ${((r==null?void 0:r.flow_7d.new)||0)-((r==null?void 0:r.flow_7d.closed)||0)>0?"text-semantic-warning":"text-semantic-success"}`,children:[((r==null?void 0:r.flow_7d.new)||0)-((r==null?void 0:r.flow_7d.closed)||0)>0?"+":"",((r==null?void 0:r.flow_7d.new)||0)-((r==null?void 0:r.flow_7d.closed)||0)]})]})})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Age of Open Cases"})}),e.jsx(le,{children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsx("div",{className:"space-y-3",children:[{label:"0-7 days",key:"0-7",color:"bg-semantic-success"},{label:"8-21 days",key:"8-21",color:"bg-semantic-info"},{label:"22-56 days",key:"22-56",color:"bg-semantic-warning"},{label:"56+ days",key:"56+",color:"bg-semantic-error"}].map(({label:S,key:M,color:y})=>{const A=r==null?void 0:r.aging_open;if(!A)return null;const R=A[M]||0,E=Object.values(A).reduce((F,Z)=>F+Z,0),$=E>0?R/E*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:S}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:R})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${y} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,$))}%`}})})]},M)})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(ae,{children:e.jsxs(le,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Vulnerable Customers"}),e.jsx("div",{className:"text-2xl font-semibold text-text-primary",children:i?"":(r==null?void 0:r.risk.open_vulnerable.count)||0}),!i&&r&&r.risk.open_vulnerable.pct_of_open!==null&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:[f(r.risk.open_vulnerable.pct_of_open)," of open"]})]})}),e.jsx(ae,{children:e.jsxs(le,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Reopened Cases"}),e.jsx("div",{className:"text-2xl font-semibold text-semantic-warning",children:i?"":(r==null?void 0:r.risk.reopened.count)||0}),!i&&r&&r.risk.reopened.pct_all_time!==null&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:[f(r.risk.reopened.pct_all_time)," of all time"]})]})}),e.jsx(ae,{children:e.jsxs(le,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Escalated (Open)"}),e.jsx("div",{className:"text-2xl font-semibold text-semantic-error",children:i?"":(r==null?void 0:r.risk.escalated_open)||0}),e.jsx("div",{className:"mt-1 text-xs text-text-muted",children:"Requires attention"})]})}),e.jsx(ae,{children:e.jsxs(le,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Final Response Rate"}),e.jsx("div",{className:"text-2xl font-semibold text-text-primary",children:i?"":f((r==null?void 0:r.risk.final_attachment_open_pct)||null)}),e.jsx("div",{className:"mt-1 text-xs text-text-muted",children:"Open with attachments"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Acknowledgement SLA (30d)"})}),e.jsx(le,{children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"On-time rate"}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:f((r==null?void 0:r.sla_30d.ack.on_time_pct)||null)})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-semantic-success transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(r==null?void 0:r.sla_30d.ack.on_time_pct)||0))}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:[(r==null?void 0:r.sla_30d.ack.on_time)||0," / ",(r==null?void 0:r.sla_30d.ack.total)||0," on time"]})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Final Response SLA (30d)"})}),e.jsx(le,{children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"On-time rate"}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:f((r==null?void 0:r.sla_30d.final.on_time_pct)||null)})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-semantic-success transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(r==null?void 0:r.sla_30d.final.on_time_pct)||0))}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:[(r==null?void 0:r.sla_30d.final.on_time)||0," / ",(r==null?void 0:r.sla_30d.final.total)||0," on time"]})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Team Workload"})}),e.jsx(le,{children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4 space-y-2",children:[((r==null?void 0:r.workload_open_by_handler)||[]).slice(0,5).map(S=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary truncate pr-2",children:S.name}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:S.count})]},S.id)),(!(r!=null&&r.workload_open_by_handler)||r.workload_open_by_handler.length===0)&&e.jsx("div",{className:"text-xs text-text-muted text-center py-4",children:"No workload data"})]})})]})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"My Queue"})}),e.jsx("div",{className:"mt-4 border-b border-border",children:e.jsx("div",{className:"flex gap-1 px-4",children:["mine","unassigned","breached","oldest"].map(S=>e.jsx("button",{onClick:()=>c(S),className:`px-4 py-2 text-sm font-medium capitalize transition border-b-2 ${x===S?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:S},S))})}),e.jsx("div",{className:"p-4",children:o?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):l.length===0?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"No complaints in this queue"}):e.jsx("div",{className:"space-y-2",children:l.map(S=>e.jsxs("div",{onClick:()=>t(`/complaints/${S.id}`),className:"flex items-center justify-between p-3 rounded-lg border border-border hover:bg-app cursor-pointer transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:S.reference}),e.jsx("div",{className:"text-xs text-text-secondary truncate mt-1",children:S.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsx("span",{className:"text-xs text-text-muted whitespace-nowrap",children:Y(S.received_at).format("MMM D")}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${S.status==="New"?"bg-semantic-info/10 text-semantic-info":S.status==="Acknowledged"?"bg-semantic-success/10 text-semantic-success":"bg-app text-text-secondary"}`,children:S.status})]})]},S.id))})})]})]})]})}function Mt({status:t,className:s=""}){const n=r=>{switch(r){case"New":return"bg-semantic-info/10 text-semantic-info border-semantic-info/20";case"Acknowledged":return"bg-semantic-success/10 text-semantic-success border-semantic-success/20";case"In Investigation":return"bg-blue-50 text-blue-700 border-blue-200";case"Response Drafted":return"bg-purple-50 text-purple-700 border-purple-200";case"Awaiting Customer":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"Escalated":return"bg-semantic-warning/10 text-semantic-warning border-semantic-warning/20";case"Closed":return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-app text-text-secondary border-border"}};return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium border ${n(t)} ${s}`,children:t})}function Hn(){const t=Ue(),[s,n]=g.useState([]),[r,a]=g.useState(!0),[l,u]=g.useState(null),[x,c]=g.useState(""),[o,d]=g.useState("all"),[i,h]=g.useState("all"),[j,m]=g.useState(!1),[b,f]=g.useState(!1),[S,M]=g.useState("received_at"),[y,A]=g.useState("desc"),[R,E]=g.useState(1),[$]=g.useState(50),[F,Z]=g.useState(1),[Q,z]=g.useState([]),oe=()=>X(this,null,function*(){a(!0),u(null);try{const C={page:R,page_size:$,_:Date.now()};i!=="all"&&(C.handler_id=i),j&&(C.overdue=!0);const v=yield V.get("/complaints",{params:C});n(v.data||[]),v.data&&v.data.length===$?Z(R+1):Z(R)}catch(C){console.error("Failed to load complaints",C),u("Failed to load complaints. Please try again.")}finally{a(!1)}}),re=()=>X(this,null,function*(){try{const C=yield V.get("/users");z(C.data||[])}catch(C){console.error("Failed to load handlers",C)}});g.useEffect(()=>{re()},[]),g.useEffect(()=>{oe()},[R,i,j]);const O=C=>{S===C?A(y==="asc"?"desc":"asc"):(M(C),A("asc"))},L=C=>S!==C?e.jsx("svg",{className:"h-4 w-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):y==="asc"?e.jsx("svg",{className:"h-4 w-4 text-brand",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"h-4 w-4 text-brand",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),w=s.filter(C=>{var I,W,ue;const v=x.toLowerCase(),B=!x||C.reference.toLowerCase().includes(v)||((I=C.description)==null?void 0:I.toLowerCase().includes(v))||((ue=(W=C.complainant)==null?void 0:W.full_name)==null?void 0:ue.toLowerCase().includes(v)),U=o==="all"||C.status===o,P=!b||C.vulnerability_flag;return B&&U&&P}).sort((C,v)=>{var P,I;let B,U;switch(S){case"reference":B=C.reference,U=v.reference;break;case"status":B=C.status,U=v.status;break;case"received_at":B=new Date(C.received_at).getTime(),U=new Date(v.received_at).getTime();break;case"handler":B=C.assigned_handler_name||"zzz",U=v.assigned_handler_name||"zzz";break;case"complainant":B=((P=C.complainant)==null?void 0:P.full_name)||"zzz",U=((I=v.complainant)==null?void 0:I.full_name)||"zzz";break;default:return 0}return B<U?y==="asc"?-1:1:B>U?y==="asc"?1:-1:0}),k=C=>{if(C.status==="Closed")return!1;const v=Y();return!C.acknowledged_at&&C.ack_due_at?Y(C.ack_due_at).isBefore(v):!C.final_response_at&&C.final_due_at?Y(C.final_due_at).isBefore(v):!1},_=()=>{c(""),d("all"),h("all"),m(!1),f(!1),E(1)},D=[x!=="",o!=="all",i!=="all",j,b].filter(Boolean).length;return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Complaints",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"secondary",onClick:oe,disabled:r,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),r?"Refreshing...":"Refresh"]}),e.jsxs(T,{variant:"primary",onClick:()=>t("/create"),children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"New Complaint"]})]})}),e.jsxs("div",{className:"px-10 py-6",children:[e.jsx(ae,{className:"mb-6",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Filters & Search"}),D>0&&e.jsxs(T,{variant:"secondary",onClick:_,children:["Clear all (",D,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(ie,{type:"search",placeholder:"Search by reference, description, or complainant...",value:x,onChange:C=>c(C.target.value),leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-medium text-text-primary mb-1",children:"Status"}),e.jsxs("select",{id:"status-filter",value:o,onChange:C=>d(C.target.value),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-surface text-text-primary focus:outline-none focus:ring-2 focus:ring-brand",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"Acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"Investigating",children:"Investigating"}),e.jsx("option",{value:"Response Drafted",children:"Response Drafted"}),e.jsx("option",{value:"Final Response Issued",children:"Final Response Issued"}),e.jsx("option",{value:"Closed",children:"Closed"}),e.jsx("option",{value:"Escalated",children:"Escalated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"handler-filter",className:"block text-xs font-medium text-text-primary mb-1",children:"Handler"}),e.jsxs("select",{id:"handler-filter",value:i,onChange:C=>h(C.target.value),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-surface text-text-primary focus:outline-none focus:ring-2 focus:ring-brand",children:[e.jsx("option",{value:"all",children:"All Handlers"}),e.jsx("option",{value:"unassigned",children:"Unassigned"}),Q.map(C=>e.jsx("option",{value:C.id,children:C.full_name},C.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:C=>m(C.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Overdue only"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:C=>f(C.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Vulnerable only"})]})]})]})]})}),l&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:l}),e.jsx(T,{variant:"secondary",onClick:oe,children:"Retry"})]}),r?e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading complaints..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-text-secondary",children:["Showing ",w.length," complaint",w.length!==1?"s":""]}),F>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{variant:"secondary",onClick:()=>E(R-1),disabled:R===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["Page ",R," of ",F]}),e.jsx(T,{variant:"secondary",onClick:()=>E(R+1),disabled:R===F,children:"Next"})]})]}),e.jsxs(Ls,{children:[e.jsx(Bn,{children:e.jsxs(ts,{children:[e.jsx(Le,{children:e.jsxs("button",{onClick:()=>O("reference"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Reference ",L("reference")]})}),e.jsx(Le,{children:e.jsxs("button",{onClick:()=>O("status"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Status ",L("status")]})}),e.jsx(Le,{children:e.jsxs("button",{onClick:()=>O("complainant"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Complainant ",L("complainant")]})}),e.jsx(Le,{children:"Description"}),e.jsx(Le,{children:e.jsxs("button",{onClick:()=>O("received_at"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Received ",L("received_at")]})}),e.jsx(Le,{children:e.jsxs("button",{onClick:()=>O("handler"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Handler ",L("handler")]})}),e.jsx(Le,{children:"Flags"})]})}),e.jsx(Un,{children:w.map(C=>{var B;const v=k(C);return e.jsxs(ts,{onClick:()=>t(`/complaints/${C.id}`),children:[e.jsx(Oe,{children:e.jsx("span",{className:"font-semibold",children:C.reference})}),e.jsx(Oe,{children:e.jsx(Mt,{status:C.status})}),e.jsx(Oe,{children:e.jsx("span",{className:"text-text-primary",children:((B=C.complainant)==null?void 0:B.full_name)||"Unknown"})}),e.jsx(Oe,{children:e.jsx("span",{className:"truncate max-w-xs block text-text-secondary",children:C.description||"No description"})}),e.jsx(Oe,{children:e.jsx("span",{className:"text-text-muted",children:Y(C.received_at).format("MMM D, YYYY")})}),e.jsx(Oe,{children:e.jsx("span",{className:"text-text-muted",children:C.assigned_handler_name||"Unassigned"})}),e.jsx(Oe,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[v&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-semantic-error/10 text-semantic-error",title:"SLA breach",children:" Overdue"}),C.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-semantic-warning/10 text-semantic-warning",title:"Vulnerable customer",children:" Vulnerable"}),C.fos_complaint&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-700",title:"Referred to FOS",children:"FOS"})]})})]},C.id)})})]}),F>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx(T,{variant:"secondary",onClick:()=>E(R-1),disabled:R===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["Page ",R," of ",F]}),e.jsx(T,{variant:"secondary",onClick:()=>E(R+1),disabled:R===F,children:"Next"})]})]}),!r&&w.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"No complaints found"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:D>0?"Try adjusting your filters or search criteria":"No complaints have been created yet"}),D>0&&e.jsx(T,{variant:"secondary",onClick:_,className:"mt-4",children:"Clear all filters"})]})]})]})}function Yn(){const{id:t}=tr(),s=Ue(),{user:n}=$e(),[r,a]=g.useState(null),[l,u]=g.useState([]),[x,c]=g.useState(!0),[o,d]=g.useState("overview"),[i,h]=g.useState([]),[j,m]=g.useState(!1),[b,f]=g.useState(""),[S,M]=g.useState(!1),[y,A]=g.useState(null),[R,E]=g.useState(!1),[$,F]=g.useState({channel:"email",direction:"inbound",summary:"",occurred_at:Y().format("YYYY-MM-DDTHH:mm"),is_final_response:!1}),[Z,Q]=g.useState(null),[z,oe]=g.useState(!1),[re,O]=g.useState(null),[L,w]=g.useState(!1),[k,_]=g.useState({outcome:"upheld",notes:""}),[D,C]=g.useState(!1),[v,B]=g.useState(null),[U,P]=g.useState(!1),[I,W]=g.useState({payment_type:"financial_loss",amount:"",status:"pending",rationale:"",action_description:"",action_status:"not_started",notes:"",approved:!1}),[ue,J]=g.useState(!1),[te,K]=g.useState(null),[he,Ne]=g.useState(!1),[Ee,$s]=g.useState(null),[Xe,Et]=g.useState(Y().format("YYYY-MM-DDTHH:mm")),[At,Rt]=g.useState(!1);g.useEffect(()=>{t&&(_e(),Bs())},[t]);const Is=()=>{t&&V.get(`/complaints/${t}/events`).then(N=>u(N.data)).catch(N=>console.error("Failed to load events",N))},_e=()=>{t&&(c(!0),V.get(`/complaints/${t}`).then(N=>{a(N.data),Is(),c(!1)}).catch(N=>{console.error("Failed to load complaint",N),c(!1)}))},Bs=()=>{V.get("/users").then(N=>{const ne=N.data.filter(se=>se.is_active&&["admin","complaints_handler","complaints_manager","reviewer"].includes(se.role));h(ne)}).catch(N=>{console.error("Failed to load users",N)})},Us=()=>X(this,null,function*(){var N,ne;if(!(!t||!n)){M(!0),A(null);try{yield V.post(`/complaints/${t}/assign`,null,{params:{handler_id:n.id}}),_e()}catch(se){A(((ne=(N=se==null?void 0:se.response)==null?void 0:N.data)==null?void 0:ne.detail)||"Failed to assign complaint")}finally{M(!1)}}}),zs=()=>X(this,null,function*(){var N,ne;if(!(!t||!b)){M(!0),A(null);try{yield V.post(`/complaints/${t}/assign`,null,{params:{handler_id:b}}),m(!1),f(""),_e()}catch(se){A(((ne=(N=se==null?void 0:se.response)==null?void 0:N.data)==null?void 0:ne.detail)||"Failed to assign complaint")}finally{M(!1)}}}),Hs=()=>X(this,null,function*(){var N,ne;if(!(!t||!$.summary)){oe(!0),O(null);try{const se=new FormData;se.append("channel",$.channel),se.append("direction",$.direction),se.append("summary",$.summary),se.append("occurred_at",Y($.occurred_at).toISOString()),se.append("is_final_response",$.is_final_response.toString()),Z&&Array.from(Z).forEach(ee=>{se.append("files",ee)}),yield V.post(`/complaints/${t}/communications`,se,{headers:{"Content-Type":"multipart/form-data"}}),E(!1),F({channel:"email",direction:"inbound",summary:"",occurred_at:Y().format("YYYY-MM-DDTHH:mm"),is_final_response:!1}),Q(null),_e()}catch(se){const ee=(ne=(N=se==null?void 0:se.response)==null?void 0:N.data)==null?void 0:ne.detail;let we="Failed to add communication";typeof ee=="string"?we=ee:Array.isArray(ee)?we=ee.map(Ot=>Ot.msg||JSON.stringify(Ot)).join(", "):ee&&typeof ee=="object"&&(we=JSON.stringify(ee)),O(we)}finally{oe(!1)}}});if(x)return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Loading..."}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading complaint details..."})})]});if(!r)return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Not Found"}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"Complaint not found"}),e.jsx(T,{variant:"secondary",onClick:()=>s("/complaints"),className:"mt-4",children:"Back to Complaints"})]})})]});const Ge=(N,ne)=>X(this,null,function*(){var se,ee;if(t)try{yield V.post(`/complaints/${t}/${N}`),alert(ne),_e()}catch(we){alert(((ee=(se=we==null?void 0:we.response)==null?void 0:se.data)==null?void 0:ee.detail)||`Failed to ${ne.toLowerCase()}`)}}),Ys=()=>X(this,null,function*(){var N,ne;if(t){C(!0),B(null);try{yield V.post(`/complaints/${t}/outcome`,{outcome:k.outcome,notes:k.notes||null}),w(!1),_e()}catch(se){B(((ne=(N=se==null?void 0:se.response)==null?void 0:N.data)==null?void 0:ne.detail)||"Failed to save outcome")}finally{C(!1)}}}),Ws=()=>X(this,null,function*(){var N,ne,se;if(t){J(!0),K(null);try{yield V.post(`/complaints/${t}/redress`,{payment_type:I.payment_type,amount:I.amount?parseFloat(I.amount):null,status:I.status,rationale:I.rationale||null,action_description:I.action_description||null,action_status:I.action_status,notes:I.notes||null,approved:I.approved,outcome_id:((N=r==null?void 0:r.outcome)==null?void 0:N.id)||null}),P(!1),W({payment_type:"financial_loss",amount:"",status:"pending",rationale:"",action_description:"",action_status:"not_started",notes:"",approved:!1}),_e()}catch(ee){K(((se=(ne=ee==null?void 0:ee.response)==null?void 0:ne.data)==null?void 0:se.detail)||"Failed to add redress")}finally{J(!1)}}}),qs=()=>{r!=null&&r.outcome?_({outcome:r.outcome.outcome,notes:r.outcome.notes||""}):_({outcome:"upheld",notes:""}),B(null),w(!0)},Lt=N=>{$s(N),Et(Y().format("YYYY-MM-DDTHH:mm")),Ne(!0)},Vs=()=>X(this,null,function*(){if(!(!t||!Ee)){Rt(!0);try{yield V.post(`/complaints/${t}/${Ee}`,{closed_at:Xe?Y(Xe).toISOString():null}),Ne(!1),_e()}catch(N){console.error("Failed to close complaint",N)}finally{Rt(!1)}}});return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:r.reference,actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Mt,{status:r.status}),e.jsx(T,{variant:"secondary",onClick:()=>s("/complaints"),children:"Back"})]})}),e.jsxs("div",{className:"px-10 py-6",children:[e.jsx("div",{className:"border-b border-border mb-6",children:e.jsx("div",{className:"flex gap-1",children:["overview","communications","outcome","history"].map(N=>e.jsx("button",{onClick:()=>d(N),className:`px-4 py-3 text-sm font-medium capitalize transition border-b-2 ${o===N?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:N},N))})}),o==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[(n==null?void 0:n.role)!=="read_only"&&e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Actions"})}),e.jsx(le,{children:e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[!r.acknowledged_at&&(r.status==="New"||r.status==="Reopened")&&e.jsx(T,{variant:"primary",size:"sm",onClick:()=>Ge("acknowledge","Complaint acknowledged"),children:" Acknowledge"}),(r.status==="Acknowledged"||r.status==="New"||r.status==="Reopened")&&e.jsx(T,{variant:"primary",size:"sm",onClick:()=>Ge("investigate","Investigation started"),children:" Start Investigation"}),r.status==="In Investigation"&&e.jsx(T,{variant:"secondary",size:"sm",onClick:()=>s(`/complaints/${t}`),children:" Draft Response"}),r.outcome&&!r.final_response_at&&e.jsx(T,{variant:"primary",size:"sm",onClick:()=>Ge("final-response","Final response issued"),children:" Issue Final Response"}),r.status!=="Closed"&&e.jsx(T,{variant:"secondary",size:"sm",onClick:()=>Ge("close-non-reportable","Closed as non-reportable"),children:" Close as Non-Reportable"}),r.fos_complaint?e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-semantic-info/10 text-semantic-info border border-semantic-info/20",children:[e.jsx("span",{className:"text-sm font-medium",children:" Referred to FOS"}),r.fos_reference&&e.jsxs("span",{className:"text-xs",children:["(",r.fos_reference,")"]})]}):e.jsx(T,{variant:"secondary",size:"sm",onClick:()=>{const N=prompt("Enter FOS Reference:");N&&V.post(`/complaints/${t}/refer-to-fos`,{fos_reference:N,fos_referred_at:new Date().toISOString()}).then(()=>{alert("Complaint referred to FOS"),_e()}).catch(ne=>{var se,ee;alert(((ee=(se=ne==null?void 0:ne.response)==null?void 0:se.data)==null?void 0:ee.detail)||"Failed to refer to FOS")})},children:" Refer to Ombudsman"})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Complaint Details"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.description||"No description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Category"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Reason"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.reason||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Product"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.product||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Scheme"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.scheme||"N/A"})]})]})]})})]}),r.complainant&&e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Complainant"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-sm text-text-primary font-medium",children:r.complainant.full_name}),r.complainant.email&&e.jsx("p",{className:"text-sm text-text-secondary",children:r.complainant.email}),r.complainant.phone&&e.jsx("p",{className:"text-sm text-text-secondary",children:r.complainant.phone})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Timeline"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Received"}),e.jsx("p",{className:"text-sm text-text-primary",children:Y(r.received_at).format("MMM D, YYYY h:mm A")})]}),r.acknowledged_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Acknowledged"}),e.jsx("p",{className:"text-sm text-text-primary",children:Y(r.acknowledged_at).format("MMM D, YYYY h:mm A")})]}),r.closed_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Closed"}),e.jsx("p",{className:"text-sm text-text-primary",children:Y(r.closed_at).format("MMM D, YYYY h:mm A")})]})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Assignment"})}),e.jsx(le,{children:e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Current Handler"}),e.jsx("p",{className:"text-sm text-text-primary font-semibold",children:r.assigned_handler_name||"Unassigned"})]}),(n==null?void 0:n.role)!=="read_only"&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[(!r.assigned_handler_id||r.assigned_handler_id!==(n==null?void 0:n.id))&&e.jsxs(T,{variant:"secondary",size:"sm",onClick:Us,disabled:S,className:"w-full",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Assign to Me"]}),((n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="complaints_manager"||(n==null?void 0:n.role)==="reviewer")&&e.jsxs(T,{variant:"secondary",size:"sm",onClick:()=>m(!0),disabled:S,className:"w-full",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),"Assign to User"]})]})]})})]})]})]}),o==="communications"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Communications"}),e.jsxs(T,{variant:"primary",onClick:()=>E(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Communication"]})]}),r.communications&&r.communications.length>0?e.jsx("div",{className:"space-y-4",children:r.communications.sort((N,ne)=>Y(ne.occurred_at).valueOf()-Y(N.occurred_at).valueOf()).map(N=>e.jsx(ae,{children:e.jsxs(le,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-primary border border-border",children:N.channel}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${N.direction==="Inbound"?"bg-semantic-info/10 text-semantic-info":"bg-semantic-success/10 text-semantic-success"}`,children:N.direction}),N.is_final_response&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-warning/10 text-semantic-warning border border-semantic-warning/20",children:"Final Response"})]}),e.jsx("span",{className:"text-xs text-text-muted",children:Y(N.occurred_at).format("MMM D, YYYY h:mm A")})]}),e.jsx("p",{className:"text-sm text-text-primary mt-2",children:N.summary}),N.attachments&&N.attachments.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:N.attachments.map(ne=>e.jsxs("a",{href:ne.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1 rounded-lg bg-app text-text-primary hover:bg-border text-xs transition",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),ne.file_name]},ne.id))})]})},N.id))}):e.jsxs("div",{className:"text-center py-12 rounded-lg border border-border bg-surface",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No communications yet"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:'Click "Add Communication" to log your first interaction'})]})]}),o==="outcome"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(de,{children:"Outcome"}),(n==null?void 0:n.role)!=="read_only"&&e.jsx(T,{variant:"primary",size:"sm",onClick:qs,children:r.outcome?"Update Outcome":"Record Outcome"})]})}),e.jsx(le,{children:r.outcome?e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Outcome Type"}),e.jsx("p",{className:"text-sm text-text-primary capitalize",children:r.outcome.outcome.replace(/_/g," ")})]}),r.outcome.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:r.outcome.notes})]})]}):e.jsx("p",{className:"text-sm text-text-secondary mt-4",children:"No outcome recorded yet"})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(de,{children:"Redress Payments"}),(n==null?void 0:n.role)!=="read_only"&&e.jsxs(T,{variant:"primary",size:"sm",onClick:()=>P(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Redress"]})]})}),e.jsx(le,{children:r.redress_payments&&r.redress_payments.length>0?e.jsx("div",{className:"space-y-4 mt-4",children:r.redress_payments.map(N=>e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-surface",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary capitalize",children:N.payment_type.replace(/_/g," ")}),N.amount&&e.jsxs("p",{className:"text-lg font-bold text-text-primary mt-1",children:["",N.amount.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${N.status==="paid"?"bg-semantic-success/10 text-semantic-success":N.status==="authorised"?"bg-semantic-warning/10 text-semantic-warning":"bg-app text-text-primary border border-border"}`,children:N.status.charAt(0).toUpperCase()+N.status.slice(1)}),N.approved&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-success/10 text-semantic-success border border-semantic-success/20",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),"Approved"]})]})]}),N.rationale&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Rationale"}),e.jsx("p",{className:"text-sm text-text-secondary",children:N.rationale})]}),N.action_description&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Action"}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("p",{className:"text-sm text-text-secondary flex-1",children:N.action_description}),N.action_status&&e.jsx("span",{className:`ml-3 inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium capitalize ${N.action_status==="completed"?"bg-semantic-success/10 text-semantic-success":N.action_status==="in_progress"?"bg-semantic-info/10 text-semantic-info":"bg-app text-text-muted border border-border"}`,children:N.action_status.replace(/_/g," ")})]})]}),N.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:N.notes})]})]},N.id))}):e.jsxs("div",{className:"text-center py-12 mt-4",children:[e.jsx("div",{className:"mx-auto h-12 w-12 rounded-full border-2 border-text-muted flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-text-muted",children:""})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No redress payments"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"No redress payments have been recorded for this complaint"})]})})]}),(n==null?void 0:n.role)!=="read_only"&&r.status!=="Closed"&&e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Close Complaint"})}),e.jsxs(le,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[r.final_response_at&&e.jsx(T,{variant:"primary",onClick:()=>Lt("close"),children:" Close Complaint"}),e.jsx(T,{variant:"secondary",onClick:()=>Lt("close-non-reportable"),children:" Close as Non-Reportable"})]}),!r.final_response_at&&e.jsx("p",{className:"text-xs text-text-muted mt-3",children:"Note: Final response must be issued before closing the complaint normally."})]})]})]}),o==="history"&&e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Activity History"})}),e.jsx(le,{children:l&&l.length>0?e.jsx("div",{className:"space-y-0 mt-4",children:l.sort((N,ne)=>Y(ne.created_at).valueOf()-Y(N.created_at).valueOf()).map(N=>{const ne=ee=>ee==="created"?"":ee==="accessed"?"":ee==="updated"?"":ee==="acknowledged"?"":ee==="investigation_started"?"":ee==="response_drafted"?"":ee==="outcome_recorded"?"":ee==="final_response_issued"?"":ee==="closed"?"":ee==="closed_non_reportable"?"":ee==="reopened"?"":ee==="escalated"?"":ee==="assigned"?"":ee==="referred_to_fos"?"":ee==="communication_added"?"":ee==="redress_added"||ee==="redress_updated"?"":"",se=ee=>ee.split("_").map(we=>we.charAt(0).toUpperCase()+we.slice(1)).join(" ");return e.jsxs("div",{className:"flex gap-4 py-3 border-b border-border last:border-0 hover:bg-surface/50 transition px-3 -mx-3 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 text-lg pt-0.5",children:ne(N.event_type)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:se(N.event_type)}),N.description&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:N.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5 flex-wrap",children:[N.created_by_name&&e.jsxs("span",{className:"text-xs text-text-muted",children:["by ",N.created_by_name]}),e.jsx("span",{className:"text-xs text-text-muted",children:Y(N.created_at).format("MMM D, YYYY [at] h:mm A")})]})]})})})]},N.id)})}):e.jsxs("div",{className:"text-center py-12 mt-4",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No history events recorded"})]})})]})]}),e.jsxs(be,{open:j,onClose:()=>m(!1),children:[e.jsx(ge,{onClose:()=>m(!1),children:"Assign Complaint"}),e.jsxs(je,{children:[y&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:y}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"assign-handler",className:"block text-xs font-medium text-text-primary",children:"Select Handler *"}),e.jsxs("select",{id:"assign-handler",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:b,onChange:N=>f(N.target.value),children:[e.jsx("option",{value:"",children:"-- Select a user --"}),i.map(N=>e.jsxs("option",{value:N.id,children:[N.full_name," (",N.role.replace(/_/g," "),")"]},N.id))]})]})})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:zs,disabled:!b||S,children:S?"Assigning...":"Assign"})]})]}),e.jsxs(be,{open:he,onClose:()=>Ne(!1),children:[e.jsx(ge,{onClose:()=>Ne(!1),children:"Confirm Closure"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Please confirm the closure date for this complaint."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"close-date",className:"block text-xs font-medium text-text-primary",children:"Closure Date & Time *"}),e.jsx(ie,{id:"close-date",type:"datetime-local",value:Xe,onChange:N=>Et(N.target.value)})]})]})}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>Ne(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:Vs,disabled:At||!Xe,children:At?"Closing...":"Confirm Closure"})]})]}),e.jsxs(be,{open:L,onClose:()=>w(!1),children:[e.jsx(ge,{onClose:()=>w(!1),children:r!=null&&r.outcome?"Update Outcome":"Record Outcome"}),e.jsxs(je,{children:[v&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:v}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"outcome-type",className:"block text-xs font-medium text-text-primary",children:"Outcome *"}),e.jsxs("select",{id:"outcome-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:k.outcome,onChange:N=>_(q(H({},k),{outcome:N.target.value})),children:[e.jsx("option",{value:"upheld",children:"Upheld"}),e.jsx("option",{value:"partially_upheld",children:"Partially Upheld"}),e.jsx("option",{value:"not_upheld",children:"Not Upheld"}),e.jsx("option",{value:"withdrawn",children:"Withdrawn"}),e.jsx("option",{value:"out_of_scope",children:"Out of Scope"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Notes"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:k.notes,onChange:N=>_(q(H({},k),{notes:N.target.value})),placeholder:"Add outcome notes..."})]})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>w(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:Ys,disabled:D,children:D?"Saving...":"Save Outcome"})]})]}),e.jsxs(be,{open:U,onClose:()=>P(!1),children:[e.jsx(ge,{onClose:()=>P(!1),children:"Add Redress Payment"}),e.jsxs(je,{children:[te&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:te}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"redress-type",className:"block text-xs font-medium text-text-primary",children:"Redress Type *"}),e.jsxs("select",{id:"redress-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I.payment_type,onChange:N=>W(q(H({},I),{payment_type:N.target.value})),children:[e.jsx("option",{value:"financial_loss",children:"Financial Loss"}),e.jsx("option",{value:"interest_on_financial_loss",children:"Interest on Financial Loss"}),e.jsx("option",{value:"distress_and_inconvenience",children:"Distress and Inconvenience"}),e.jsx("option",{value:"consequential_loss",children:"Consequential Loss"}),e.jsx("option",{value:"premium_refund_adjustment",children:"Premium Refund/Adjustment"}),e.jsx("option",{value:"goodwill_payment",children:"Goodwill Payment"}),e.jsx("option",{value:"third_party_payment",children:"Third Party Payment"}),e.jsx("option",{value:"apology_or_explanation",children:"Apology or Explanation"}),e.jsx("option",{value:"remedial_action",children:"Remedial Action"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Amount ()"}),e.jsx(ie,{type:"number",step:"0.01",value:I.amount,onChange:N=>W(q(H({},I),{amount:N.target.value})),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Leave blank for non-monetary redress"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"redress-status",className:"block text-xs font-medium text-text-primary",children:"Status *"}),e.jsxs("select",{id:"redress-status",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I.status,onChange:N=>W(q(H({},I),{status:N.target.value})),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"authorised",children:"Authorised"}),e.jsx("option",{value:"paid",children:"Paid"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Rationale"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I.rationale,onChange:N=>W(q(H({},I),{rationale:N.target.value})),placeholder:"Why is this redress being offered?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Action Description"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I.action_description,onChange:N=>W(q(H({},I),{action_description:N.target.value})),placeholder:"What action needs to be taken?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"action-status",className:"block text-xs font-medium text-text-primary",children:"Action Status *"}),e.jsxs("select",{id:"action-status",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I.action_status,onChange:N=>W(q(H({},I),{action_status:N.target.value})),children:[e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Notes"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I.notes,onChange:N=>W(q(H({},I),{notes:N.target.value})),placeholder:"Additional notes..."})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:I.approved,onChange:()=>W(q(H({},I),{approved:!I.approved})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Approved"})]})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:Ws,disabled:ue,children:ue?"Adding...":"Add Redress"})]})]}),e.jsxs(be,{open:R,onClose:()=>E(!1),children:[e.jsx(ge,{onClose:()=>E(!1),children:"Add Communication"}),e.jsxs(je,{children:[re&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:re}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-channel",className:"block text-xs font-medium text-text-primary",children:"Channel *"}),e.jsxs("select",{id:"comm-channel",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:$.channel,onChange:N=>F(q(H({},$),{channel:N.target.value})),children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Phone"}),e.jsx("option",{value:"letter",children:"Letter"}),e.jsx("option",{value:"web",children:"Web Form"}),e.jsx("option",{value:"third_party",children:"Third Party"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-direction",className:"block text-xs font-medium text-text-primary",children:"Direction *"}),e.jsxs("select",{id:"comm-direction",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:$.direction,onChange:N=>F(q(H({},$),{direction:N.target.value})),children:[e.jsx("option",{value:"inbound",children:"Inbound"}),e.jsx("option",{value:"outbound",children:"Outbound"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Date & Time *"}),e.jsx(ie,{type:"datetime-local",value:$.occurred_at,onChange:N=>F(q(H({},$),{occurred_at:N.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Summary *"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:$.summary,onChange:N=>F(q(H({},$),{summary:N.target.value})),placeholder:"Describe the communication..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-attachments",className:"block text-xs font-medium text-text-primary",children:"Attachments"}),e.jsx("input",{id:"comm-attachments",type:"file",multiple:!0,onChange:N=>Q(N.target.files),className:"w-full text-sm text-text-primary file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-brand file:text-white hover:file:opacity-90 cursor-pointer"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$.is_final_response,onChange:()=>F(q(H({},$),{is_final_response:!$.is_final_response})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Mark as Final Response"})]})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>E(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:Hs,disabled:!$.summary||z,children:z?"Adding...":"Add Communication"})]})]})]})}function Wn(){const t=Ue(),[s,n]=g.useState(!1),[r,a]=g.useState(null),[l,u]=g.useState([]),[x,c]=g.useState([]),[o,d]=g.useState([]);g.useEffect(()=>{Promise.all([V.get("/reference/products"),V.get("/reference/insurers"),V.get("/reference/brokers")]).then(([m,b,f])=>{u(m.data.map(S=>S.name)),c(b.data.map(S=>S.name)),d(f.data.map(S=>S.name))}).catch(m=>{console.error("Failed to load reference data",m)})},[]);const[i,h]=g.useState({source:"Email",received_at:Y().format("YYYY-MM-DDTHH:mm"),description:"",category:"",reason:"",vulnerability_flag:!1,vulnerability_notes:"",policy_number:"",insurer:"",broker:"",product:"",scheme:"",complainant_name:"",complainant_email:"",complainant_phone:"",complainant_address:"",complainant_dob:""}),j=m=>X(this,null,function*(){var b,f;m.preventDefault(),a(null),n(!0);try{const S=yield V.post("/complaints",{source:i.source,received_at:Y(i.received_at).toISOString(),description:i.description,category:i.category,reason:i.reason||null,fca_complaint:!0,fca_rationale:null,vulnerability_flag:i.vulnerability_flag,vulnerability_notes:i.vulnerability_notes||null,policy_number:i.policy_number||null,insurer:i.insurer||null,broker:i.broker||null,product:i.product||null,scheme:i.scheme||null,complainant:{full_name:i.complainant_name,email:i.complainant_email||null,phone:i.complainant_phone||null,address:i.complainant_address||null,date_of_birth:i.complainant_dob||null},policy:{policy_number:i.policy_number||null,insurer:i.insurer||null,broker:i.broker||null,product:i.product||null,scheme:i.scheme||null}});t(`/complaints/${S.data.id}`)}catch(S){a(((f=(b=S==null?void 0:S.response)==null?void 0:b.data)==null?void 0:f.detail)||"Failed to create complaint"),n(!1)}});return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Create New Complaint"}),e.jsxs("div",{className:"px-10 py-6 max-w-4xl",children:[r&&e.jsx("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:r}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Receipt Information"})}),e.jsx(le,{children:e.jsx("div",{className:"space-y-4 mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Source *"}),e.jsxs("select",{className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:i.source,onChange:m=>h(q(H({},i),{source:m.target.value})),required:!0,children:[e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"Phone",children:"Phone"}),e.jsx("option",{value:"Letter",children:"Letter"}),e.jsx("option",{value:"Web Form",children:"Web Form"}),e.jsx("option",{value:"In Person",children:"In Person"}),e.jsx("option",{value:"Social Media",children:"Social Media"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Date Received *"}),e.jsx(ie,{type:"datetime-local",value:i.received_at,onChange:m=>h(q(H({},i),{received_at:m.target.value})),required:!0})]})]})})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Complainant Details"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(ie,{value:i.complainant_name,onChange:m=>h(q(H({},i),{complainant_name:m.target.value})),placeholder:"John Doe",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(ie,{type:"email",value:i.complainant_email,onChange:m=>h(q(H({},i),{complainant_email:m.target.value})),placeholder:"john@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Phone"}),e.jsx(ie,{value:i.complainant_phone,onChange:m=>h(q(H({},i),{complainant_phone:m.target.value})),placeholder:"+44 20 1234 5678"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Date of Birth"}),e.jsx(ie,{type:"date",value:i.complainant_dob,onChange:m=>h(q(H({},i),{complainant_dob:m.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Address"}),e.jsx(ie,{value:i.complainant_address,onChange:m=>h(q(H({},i),{complainant_address:m.target.value})),placeholder:"Full address..."})]})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.vulnerability_flag,onChange:()=>h(q(H({},i),{vulnerability_flag:!i.vulnerability_flag})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Vulnerable Customer"})]}),i.vulnerability_flag&&e.jsxs("div",{className:"pl-7 space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Vulnerability Notes"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:i.vulnerability_notes,onChange:m=>h(q(H({},i),{vulnerability_notes:m.target.value})),placeholder:"Details about vulnerability..."})]})]})})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Complaint Details"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Description *"}),e.jsx("textarea",{className:"w-full min-h-[120px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:i.description,onChange:m=>h(q(H({},i),{description:m.target.value})),placeholder:"Detailed description of the complaint...",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Category *"}),e.jsxs("select",{className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:i.category,onChange:m=>h(q(H({},i),{category:m.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select category..."}),e.jsx("option",{value:"Claims",children:"Claims"}),e.jsx("option",{value:"Policy",children:"Policy"}),e.jsx("option",{value:"Service",children:"Service"}),e.jsx("option",{value:"Premium",children:"Premium"}),e.jsx("option",{value:"Communication",children:"Communication"}),e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Reason"}),e.jsx(ie,{value:i.reason,onChange:m=>h(q(H({},i),{reason:m.target.value})),placeholder:"Specific reason..."})]})]})]})})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Policy Information"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Policy Number"}),e.jsx(ie,{value:i.policy_number,onChange:m=>h(q(H({},i),{policy_number:m.target.value})),placeholder:"POL-12345"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Product"}),e.jsx(bt,{value:i.product,onChange:m=>h(q(H({},i),{product:m})),options:l,placeholder:"Select or type product..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Insurer"}),e.jsx(bt,{value:i.insurer,onChange:m=>h(q(H({},i),{insurer:m})),options:x,placeholder:"Select or type insurer..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Broker"}),e.jsx(bt,{value:i.broker,onChange:m=>h(q(H({},i),{broker:m})),options:o,placeholder:"Select or type broker..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Scheme"}),e.jsx(ie,{value:i.scheme,onChange:m=>h(q(H({},i),{scheme:m.target.value})),placeholder:"Scheme name..."})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 sticky bottom-6 bg-app/95 backdrop-blur-sm p-4 rounded-lg border border-border",children:[e.jsx(T,{variant:"secondary",onClick:()=>t("/complaints"),type:"button",children:"Cancel"}),e.jsx(T,{variant:"primary",type:"submit",disabled:s,children:s?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Complaint"})]})]})]})]})}var Os={exports:{}};(function(t,s){(function(n,r){t.exports=r()})(ns,function(){return function(n,r,a){n=n||{};var l=r.prototype,u={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function x(o,d,i,h){return l.fromToBase(o,d,i,h)}a.en.relativeTime=u,l.fromToBase=function(o,d,i,h,j){for(var m,b,f,S=i.$locale().relativeTime||u,M=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],y=M.length,A=0;A<y;A+=1){var R=M[A];R.d&&(m=h?a(o).diff(i,R.d,!0):i.diff(o,R.d,!0));var E=(n.rounding||Math.round)(Math.abs(m));if(f=m>0,E<=R.r||!R.r){E<=1&&A>0&&(R=M[A-1]);var $=S[R.l];j&&(E=j(""+E)),b=typeof $=="string"?$.replace("%d",E):$(E,d,R.l,f);break}}if(d)return b;var F=f?S.future:S.past;return typeof F=="function"?F(b):F.replace("%s",b)},l.to=function(o,d){return x(o,d,this,!0)},l.from=function(o,d){return x(o,d,this)};var c=function(o){return o.$u?a.utc():a()};l.toNow=function(o){return this.to(c(this),o)},l.fromNow=function(o){return this.from(c(this),o)}}})})(Os);var qn=Os.exports;const Vn=as(qn);Y.extend(Vn);function Jn(){var j;const t=Ue(),{user:s}=$e(),[n,r]=g.useState(!0),[a,l]=g.useState(null),[u,x]=g.useState([]);g.useEffect(()=>{c()},[]);const c=()=>X(this,null,function*(){if(s!=null&&s.id){r(!0),l(null);try{const b=(yield V.get("/complaints",{params:{handler_id:s.id,page:1,page_size:100,_:Date.now()}})).data.filter(E=>E.status!=="Closed"),f=b.filter(E=>(E.status==="New"||E.status==="Reopened")&&!E.acknowledged_at&&E.ack_due_at&&Y(E.ack_due_at).isAfter(Y())),S=b.filter(E=>(E.status==="New"||E.status==="Reopened")&&!E.acknowledged_at&&E.ack_due_at&&Y(E.ack_due_at).isBefore(Y())),M=b.filter(E=>E.status==="Investigating"||E.status==="Acknowledged"),y=b.filter(E=>E.status==="Response Drafted"&&!E.final_response_at&&E.final_due_at&&Y(E.final_due_at).isAfter(Y())),A=b.filter(E=>(E.status==="Response Drafted"||E.status==="Investigating"||E.status==="Acknowledged")&&!E.final_response_at&&E.final_due_at&&Y(E.final_due_at).isBefore(Y())),R=[];S.length>0&&R.push({title:"Acknowledgements Overdue",description:"These complaints need acknowledgement urgently",icon:"",colorClass:"semantic-error",bgColorClass:"bg-semantic-error/10",textColorClass:"text-semantic-error",complaints:S.sort((E,$)=>Y(E.ack_due_at).valueOf()-Y($.ack_due_at).valueOf())}),f.length>0&&R.push({title:"Acknowledgements Due",description:"These complaints need acknowledgement soon",icon:"",colorClass:"semantic-warning",bgColorClass:"bg-semantic-warning/10",textColorClass:"text-semantic-warning",complaints:f.sort((E,$)=>Y(E.ack_due_at).valueOf()-Y($.ack_due_at).valueOf())}),A.length>0&&R.push({title:"Final Responses Overdue",description:"These complaints need final response urgently",icon:"",colorClass:"semantic-error",bgColorClass:"bg-semantic-error/10",textColorClass:"text-semantic-error",complaints:A.sort((E,$)=>Y(E.final_due_at).valueOf()-Y($.final_due_at).valueOf())}),y.length>0&&R.push({title:"Final Responses Due",description:"These complaints are ready for final response",icon:"",colorClass:"semantic-info",bgColorClass:"bg-semantic-info/10",textColorClass:"text-semantic-info",complaints:y.sort((E,$)=>Y(E.final_due_at).valueOf()-Y($.final_due_at).valueOf())}),M.length>0&&R.push({title:"In Investigation",description:"These complaints are actively being worked on",icon:"",colorClass:"brand",bgColorClass:"bg-brand/10",textColorClass:"text-brand",complaints:M.sort((E,$)=>Y(E.received_at).valueOf()-Y($.received_at).valueOf())}),x(R)}catch(m){console.error("Failed to load tasks",m),l("Failed to load your tasks. Please try again.")}finally{r(!1)}}}),o=m=>{if(!m)return"";const b=Y(),f=Y(m);return f.isBefore(b)?`${Y().to(f)} overdue`:`due ${Y().to(f)}`},d=(m,b)=>X(this,null,function*(){b.stopPropagation();try{yield V.post(`/complaints/${m}/acknowledge`),c()}catch(f){console.error("Failed to acknowledge",f),alert("Failed to acknowledge complaint")}}),i=()=>u.reduce((m,b)=>m+b.complaints.length,0),h=()=>u.filter(m=>m.title.includes("Overdue")).reduce((m,b)=>m+b.complaints.length,0);return n?e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"My Tasks",actions:e.jsxs(T,{variant:"secondary",onClick:c,disabled:n,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading your tasks..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"My Tasks",actions:e.jsxs(T,{variant:"secondary",onClick:c,disabled:n,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),n?"Refreshing...":"Refresh"]})}),e.jsxs("div",{className:"px-10 py-6",children:[a&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:a}),e.jsx(T,{variant:"secondary",onClick:c,children:"Retry"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Your Work List"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:i()===0?"You're all caught up!":`You have ${i()} ${i()===1?"task":"tasks"} requiring attention`})]})}),i()>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"rounded-lg border border-border bg-app p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary",children:"Total Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-text-primary mt-1",children:i()})]}),e.jsx("div",{className:"text-3xl",children:""})]})}),e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-semantic-error",children:"Urgent (Overdue)"}),e.jsx("div",{className:"text-2xl font-bold text-semantic-error mt-1",children:h()})]}),e.jsx("div",{className:"text-3xl",children:""})]})}),e.jsx("div",{className:"rounded-lg border border-border bg-app p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary",children:"In Progress"}),e.jsx("div",{className:"text-2xl font-bold text-text-primary mt-1",children:((j=u.find(m=>m.title==="In Investigation"))==null?void 0:j.complaints.length)||0})]}),e.jsx("div",{className:"text-3xl",children:""})]})})]})]}),u.length===0?e.jsx(ae,{children:e.jsx(le,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-4 text-lg font-semibold text-text-primary",children:"All caught up!"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"You don't have any tasks requiring immediate attention."})]})})}):e.jsx("div",{className:"space-y-6",children:u.map((m,b)=>e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:m.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx(de,{children:m.title}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:m.description})]}),e.jsx("span",{className:`inline-flex items-center justify-center h-8 min-w-8 rounded-full ${m.bgColorClass} ${m.textColorClass} px-2 text-sm font-bold`,children:m.complaints.length})]})}),e.jsx(le,{children:e.jsx("div",{className:"space-y-3 mt-4",children:m.complaints.map(f=>{var R;const S=m.title.includes("Acknowledgement"),M=m.title.includes("Final Response"),y=S?f.ack_due_at:M?f.final_due_at:null,A=y?Y(y).isBefore(Y()):!1;return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4 rounded-lg border border-border hover:bg-surface transition cursor-pointer",onClick:()=>t(`/complaints/${f.id}`),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-text-primary",children:f.reference}),e.jsx(Mt,{status:f.status}),f.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-semantic-warning/10 text-semantic-warning",children:" Vulnerable"})]}),e.jsx("p",{className:"text-sm text-text-secondary truncate mb-2",children:f.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[((R=f.complainant)==null?void 0:R.full_name)&&e.jsxs("span",{className:"text-text-muted",children:[" ",f.complainant.full_name]}),e.jsxs("span",{className:"text-text-muted",children:[" Received ",Y(f.received_at).format("MMM D, YYYY")]}),y&&e.jsxs("span",{className:`font-semibold ${A?"text-semantic-error":"text-semantic-warning"}`,children:[" ",S?"Ack":"Final"," ",o(y)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S&&!f.acknowledged_at&&e.jsx(T,{variant:"secondary",size:"sm",onClick:E=>d(f.id,E),children:"Acknowledge"}),e.jsx(T,{variant:"primary",size:"sm",onClick:E=>{E.stopPropagation(),t(`/complaints/${f.id}`)},children:"View"})]})]},f.id)})})})]},b))})]})]})}function Qn(){const[t,s]=g.useState([]),[n,r]=g.useState(!0),[a,l]=g.useState(!1),[u,x]=g.useState(!1),[c,o]=g.useState(!1),[d,i]=g.useState(!1),[h,j]=g.useState(null),[m,b]=g.useState(null),[f,S]=g.useState(null),[M,y]=g.useState(null),[A,R]=g.useState(!1),[E,$]=g.useState(!1),[F,Z]=g.useState({email:"",full_name:"",role:"complaints_handler",password:"",is_active:!0});g.useEffect(()=>{Q()},[]);const Q=()=>X(this,null,function*(){r(!0);try{const v=yield V.get("/users");s(v.data)}catch(v){console.error("Failed to load users",v)}finally{r(!1)}}),z=()=>X(this,null,function*(){var v,B;if(!F.email||!F.full_name||!F.password){y("Please fill in all required fields");return}R(!0),y(null);try{yield V.post("/users",F),l(!1),D(),Q()}catch(U){y(((B=(v=U==null?void 0:U.response)==null?void 0:v.data)==null?void 0:B.detail)||"Failed to create user")}finally{R(!1)}}),oe=()=>X(this,null,function*(){var v,B;if(!h||!F.email||!F.full_name){y("Please fill in all required fields");return}R(!0),y(null);try{yield V.patch(`/users/${h.id}`,H({email:F.email,full_name:F.full_name,role:F.role,is_active:F.is_active},F.password?{password:F.password}:{})),x(!1),j(null),D(),Q()}catch(U){y(((B=(v=U==null?void 0:U.response)==null?void 0:v.data)==null?void 0:B.detail)||"Failed to update user")}finally{R(!1)}}),re=()=>X(this,null,function*(){var v,B;if(h){R(!0),y(null);try{const U=yield V.post(`/users/${h.id}/reset-password`);b(U.data.temporary_password),Q()}catch(U){y(((B=(v=U==null?void 0:U.response)==null?void 0:v.data)==null?void 0:B.detail)||"Failed to reset password")}finally{R(!1)}}}),O=()=>{D(),l(!0)},L=v=>{j(v),Z({email:v.email,full_name:v.full_name,role:v.role,password:"",is_active:v.is_active}),y(null),x(!0)},w=v=>{j(v),b(null),y(null),o(!0)},k=v=>X(this,null,function*(){var B,U;if(window.confirm(`Reset MFA for ${v.full_name}? This will disable MFA and require re-enrollment.`)){$(!0),y(null);try{yield V.post(`/auth/mfa/reset/${v.id}`),Q()}catch(P){y(((U=(B=P==null?void 0:P.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to reset MFA")}finally{$(!1)}}}),_=v=>X(this,null,function*(){var B,U;$(!0),y(null),j(v);try{const P=yield V.post(`/auth/mfa/recovery/${v.id}/regenerate`);S(P.data.recovery_codes||[]),i(!0)}catch(P){y(((U=(B=P==null?void 0:P.response)==null?void 0:B.data)==null?void 0:U.detail)||"Failed to regenerate recovery codes")}finally{$(!1)}}),D=()=>{Z({email:"",full_name:"",role:"complaints_handler",password:"",is_active:!0}),y(null)},C=v=>v==="admin"?"bg-semantic-error/10 text-semantic-error":v==="complaints_manager"?"bg-semantic-warning/10 text-semantic-warning":v==="reviewer"?"bg-semantic-info/10 text-semantic-info":v==="complaints_handler"?"bg-semantic-success/10 text-semantic-success":"bg-app text-text-muted border border-border";return n?e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"User Management"}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading users..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"User Management",actions:e.jsxs(T,{variant:"primary",onClick:O,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Create User"]})}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsxs(de,{children:["Users (",t.length,")"]})}),e.jsx(le,{children:e.jsxs("div",{className:"mt-4",children:[e.jsxs(Ls,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"MFA"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(v=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:v.full_name}),e.jsx("td",{className:"text-text-secondary",children:v.email}),e.jsx("td",{children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium capitalize ${C(v.role)}`,children:v.role.replace(/_/g," ")})}),e.jsx("td",{children:v.is_active?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-success/10 text-semantic-success",children:"Active"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-muted border border-border",children:"Inactive"})}),e.jsx("td",{children:v.mfa_enabled?e.jsx("span",{className:"text-semantic-success",children:" Enabled"}):e.jsx("span",{className:"text-text-muted",children:"Disabled"})}),e.jsx("td",{className:"text-text-secondary text-sm",children:Y(v.created_at).format("MMM D, YYYY")}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(v),className:"text-brand hover:text-brand-dark text-sm font-medium",children:"Edit"}),e.jsx("button",{onClick:()=>w(v),className:"text-semantic-warning hover:opacity-80 text-sm font-medium",children:"Reset Password"}),e.jsx("button",{onClick:()=>k(v),className:"text-semantic-error hover:opacity-80 text-sm font-medium disabled:opacity-50",disabled:E,children:"Reset MFA"}),e.jsx("button",{onClick:()=>_(v),className:"text-text-secondary hover:text-text-primary text-sm font-medium disabled:opacity-50",disabled:E,children:"Recovery Codes"})]})})]},v.id))})]}),t.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-text-secondary",children:"No users found"})})]})})]})}),e.jsxs(be,{open:a,onClose:()=>l(!1),children:[e.jsx(ge,{onClose:()=>l(!1),children:"Create New User"}),e.jsxs(je,{children:[M&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:M}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(ie,{type:"text",value:F.full_name,onChange:v=>Z(q(H({},F),{full_name:v.target.value})),placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email *"}),e.jsx(ie,{type:"email",value:F.email,onChange:v=>Z(q(H({},F),{email:v.target.value})),placeholder:"john.doe@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Role *"}),e.jsxs("select",{className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:F.role,onChange:v=>Z(q(H({},F),{role:v.target.value})),children:[e.jsx("option",{value:"complaints_handler",children:"Complaints Handler"}),e.jsx("option",{value:"complaints_manager",children:"Complaints Manager"}),e.jsx("option",{value:"reviewer",children:"Reviewer"}),e.jsx("option",{value:"read_only",children:"Read Only"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Initial Password *"}),e.jsx(ie,{type:"password",value:F.password,onChange:v=>Z(q(H({},F),{password:v.target.value})),placeholder:""}),e.jsx("p",{className:"text-xs text-text-muted",children:"User will be required to change this on first login"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:F.is_active,onChange:()=>Z(q(H({},F),{is_active:!F.is_active})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Active"})]})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>l(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:z,disabled:A,children:A?"Creating...":"Create User"})]})]}),e.jsxs(be,{open:u,onClose:()=>x(!1),children:[e.jsx(ge,{onClose:()=>x(!1),children:"Edit User"}),e.jsxs(je,{children:[M&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:M}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(ie,{type:"text",value:F.full_name,onChange:v=>Z(q(H({},F),{full_name:v.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email *"}),e.jsx(ie,{type:"email",value:F.email,onChange:v=>Z(q(H({},F),{email:v.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Role *"}),e.jsxs("select",{className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:F.role,onChange:v=>Z(q(H({},F),{role:v.target.value})),children:[e.jsx("option",{value:"complaints_handler",children:"Complaints Handler"}),e.jsx("option",{value:"complaints_manager",children:"Complaints Manager"}),e.jsx("option",{value:"reviewer",children:"Reviewer"}),e.jsx("option",{value:"read_only",children:"Read Only"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"New Password"}),e.jsx(ie,{type:"password",value:F.password,onChange:v=>Z(q(H({},F),{password:v.target.value})),placeholder:"Leave blank to keep current password"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:F.is_active,onChange:()=>Z(q(H({},F),{is_active:!F.is_active})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Active"})]})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:oe,disabled:A,children:A?"Saving...":"Save Changes"})]})]}),e.jsxs(be,{open:d,onClose:()=>i(!1),children:[e.jsx(ge,{onClose:()=>i(!1),children:"Recovery Codes"}),e.jsxs(je,{children:[M&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:M}),f&&f.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["Provide these codes to ",e.jsx("strong",{className:"text-text-primary",children:h==null?void 0:h.full_name}),". Each code can be used once."]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:f.map(v=>e.jsx("code",{className:"text-sm font-mono bg-app border border-border rounded px-2 py-2 text-text-primary text-center",children:v},v))}),e.jsx("p",{className:"text-xs text-text-muted",children:"Users should store these codes securely. They can be used if the authenticator device is unavailable."})]}):e.jsx("p",{className:"text-sm text-text-secondary",children:"No recovery codes generated."})]}),e.jsx(ye,{children:e.jsx(T,{variant:"primary",onClick:()=>i(!1),children:"Close"})})]}),e.jsxs(be,{open:c,onClose:()=>o(!1),children:[e.jsx(ge,{onClose:()=>o(!1),children:"Reset Password"}),e.jsxs(je,{children:[M&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:M}),m?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-semantic-success mb-2",children:"Password reset successful!"}),e.jsxs("p",{className:"text-sm text-text-secondary mb-3",children:["Please provide this temporary password to ",e.jsx("strong",{children:h==null?void 0:h.full_name}),":"]}),e.jsx("div",{className:"rounded-lg bg-app border border-border p-3",children:e.jsx("code",{className:"text-lg font-mono font-bold text-text-primary",children:m})}),e.jsx("p",{className:"text-xs text-text-muted mt-3",children:"The user will be required to change this password on their next login."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["Are you sure you want to reset the password for ",e.jsx("strong",{className:"text-text-primary",children:h==null?void 0:h.full_name}),"?"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"A temporary password will be generated that you can provide to the user. They will be required to change it on their next login."})]})]}),e.jsx(ye,{children:m?e.jsx(T,{variant:"primary",onClick:()=>o(!1),children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:re,disabled:A,children:A?"Resetting...":"Reset Password"})]})})]})]})}function Kn(){const{user:t}=$e(),s=(t==null?void 0:t.role)==="admin",[n,r]=g.useState("products"),[a,l]=g.useState([]),[u,x]=g.useState(!0),[c,o]=g.useState(""),[d,i]=g.useState(!1),[h,j]=g.useState(""),[m,b]=g.useState(!1),[f,S]=g.useState(null),[M,y]=g.useState(!1),[A,R]=g.useState(null),[E,$]=g.useState(!1),[F,Z]=g.useState(null),[Q,z]=g.useState(null);g.useEffect(()=>{oe()},[n]);const oe=()=>X(this,null,function*(){x(!0);try{const k=yield V.get(`/reference/${n}`);l(k.data||[])}catch(k){console.error("Failed to load reference items",k)}finally{x(!1)}}),re=()=>X(this,null,function*(){var k,_;if(h.trim()){b(!0),S(null);try{yield V.post(`/reference/${n}`,{name:h.trim()}),j(""),i(!1),oe()}catch(D){S(((_=(k=D==null?void 0:D.response)==null?void 0:k.data)==null?void 0:_.detail)||"Failed to create item")}finally{b(!1)}}}),O=()=>X(this,null,function*(){var k,_;if(A){$(!0),Z(null),z(null);try{const D=new FormData;D.append("file",A);const C=yield V.post(`/reference/${n}/import`,D,{headers:{"Content-Type":"multipart/form-data"}});z(`Successfully imported ${C.data.added} items`),R(null),oe(),setTimeout(()=>y(!1),2e3)}catch(D){Z(((_=(k=D==null?void 0:D.response)==null?void 0:k.data)==null?void 0:_.detail)||"Failed to import file")}finally{$(!1)}}}),L=a.filter(k=>k.name.toLowerCase().includes(c.toLowerCase())),w=k=>{switch(k){case"products":return"Products";case"brokers":return"Brokers";case"insurers":return"Insurers"}};return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Reference Data Management"}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(de,{children:"Reference Lists"}),s&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"secondary",size:"sm",onClick:()=>y(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Import CSV"]}),e.jsxs(T,{variant:"primary",size:"sm",onClick:()=>i(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add New"]})]})]})}),e.jsx("div",{className:"border-b border-border",children:e.jsx("div",{className:"flex gap-1 px-4",children:["products","brokers","insurers"].map(k=>e.jsxs("button",{onClick:()=>r(k),className:`px-4 py-3 text-sm font-medium capitalize transition border-b-2 ${n===k?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:[w(k),e.jsx("span",{className:"ml-2 inline-flex items-center justify-center h-5 min-w-5 px-1 rounded-full bg-app text-[11px] font-semibold text-text-secondary border border-border",children:k===n?L.length:a.length})]},k))})}),e.jsxs(le,{children:[e.jsx("div",{className:"mt-4 mb-6",children:e.jsx(ie,{type:"search",placeholder:`Search ${w(n).toLowerCase()}...`,value:c,onChange:k=>o(k.target.value),leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),u?e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading..."}):L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:c?"No items match your search":`No ${w(n).toLowerCase()} yet`}),!c&&s&&e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:'Click "Add New" to create your first entry'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:L.map(k=>e.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border bg-surface hover:bg-app transition",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-text-primary truncate",children:k.name}),e.jsxs("div",{className:"text-xs text-text-muted",children:["ID: ",k.id.substring(0,8),"..."]})]})},k.id))})]})]})}),e.jsxs(be,{open:d,onClose:()=>i(!1),children:[e.jsxs(ge,{onClose:()=>i(!1),children:["Add New ",w(n).slice(0,-1)]}),e.jsxs(je,{children:[f&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:f}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Name *"}),e.jsx(ie,{value:h,onChange:k=>j(k.target.value),placeholder:`Enter ${w(n).slice(0,-1).toLowerCase()} name...`,autoFocus:!0,onKeyDown:k=>{k.key==="Enter"&&h.trim()&&re()}})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:re,disabled:!h.trim()||m,children:m?"Creating...":"Create"})]})]}),e.jsxs(be,{open:M,onClose:()=>y(!1),children:[e.jsxs(ge,{onClose:()=>y(!1),children:["Import ",w(n)," from CSV"]}),e.jsxs(je,{children:[F&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:F}),Q&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-3 text-sm text-semantic-success",children:Q}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:'Upload a CSV file with a "name" column. Duplicate names will be skipped.'}),e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border p-6 text-center",children:[e.jsx("input",{type:"file",accept:".csv",onChange:k=>{var _;return R(((_=k.target.files)==null?void 0:_[0])||null)},className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("p",{className:"mt-2 text-sm font-medium text-text-primary",children:"Click to select CSV file"}),e.jsx("p",{className:"mt-1 text-xs text-text-muted",children:"or drag and drop"})]})]}),A&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-text-primary",children:[e.jsx("svg",{className:"h-5 w-5 text-semantic-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),A.name]})]}),e.jsxs("div",{className:"rounded-lg bg-app p-3 text-xs text-text-secondary",children:[e.jsx("p",{className:"font-semibold text-text-primary mb-1",children:"CSV Format Example:"}),e.jsxs("code",{className:"block bg-surface p-2 rounded border border-border font-mono",children:["name",e.jsx("br",{}),"Product A",e.jsx("br",{}),"Product B",e.jsx("br",{}),"Product C"]})]})]})]}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:O,disabled:!A||E,children:E?"Importing...":"Import"})]})]})]})}var Xn=Object.defineProperty,at=Object.getOwnPropertySymbols,Fs=Object.prototype.hasOwnProperty,Ps=Object.prototype.propertyIsEnumerable,ss=(t,s,n)=>s in t?Xn(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,Gn=(t,s)=>{for(var n in s||(s={}))Fs.call(s,n)&&ss(t,n,s[n]);if(at)for(var n of at(s))Ps.call(s,n)&&ss(t,n,s[n]);return t},Zn=(t,s)=>{var n={};for(var r in t)Fs.call(t,r)&&s.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&at)for(var r of at(t))s.indexOf(r)<0&&Ps.call(t,r)&&(n[r]=t[r]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Te;(t=>{const s=class{constructor(c,o,d,i){if(this.version=c,this.errorCorrectionLevel=o,this.modules=[],this.isFunction=[],c<s.MIN_VERSION||c>s.MAX_VERSION)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=c*4+17;let h=[];for(let m=0;m<this.size;m++)h.push(!1);for(let m=0;m<this.size;m++)this.modules.push(h.slice()),this.isFunction.push(h.slice());this.drawFunctionPatterns();const j=this.addEccAndInterleave(d);if(this.drawCodewords(j),i==-1){let m=1e9;for(let b=0;b<8;b++){this.applyMask(b),this.drawFormatBits(b);const f=this.getPenaltyScore();f<m&&(i=b,m=f),this.applyMask(b)}}l(0<=i&&i<=7),this.mask=i,this.applyMask(i),this.drawFormatBits(i),this.isFunction=[]}static encodeText(c,o){const d=t.QrSegment.makeSegments(c);return s.encodeSegments(d,o)}static encodeBinary(c,o){const d=t.QrSegment.makeBytes(c);return s.encodeSegments([d],o)}static encodeSegments(c,o,d=1,i=40,h=-1,j=!0){if(!(s.MIN_VERSION<=d&&d<=i&&i<=s.MAX_VERSION)||h<-1||h>7)throw new RangeError("Invalid value");let m,b;for(m=d;;m++){const y=s.getNumDataCodewords(m,o)*8,A=x.getTotalBits(c,m);if(A<=y){b=A;break}if(m>=i)throw new RangeError("Data too long")}for(const y of[s.Ecc.MEDIUM,s.Ecc.QUARTILE,s.Ecc.HIGH])j&&b<=s.getNumDataCodewords(m,y)*8&&(o=y);let f=[];for(const y of c){r(y.mode.modeBits,4,f),r(y.numChars,y.mode.numCharCountBits(m),f);for(const A of y.getData())f.push(A)}l(f.length==b);const S=s.getNumDataCodewords(m,o)*8;l(f.length<=S),r(0,Math.min(4,S-f.length),f),r(0,(8-f.length%8)%8,f),l(f.length%8==0);for(let y=236;f.length<S;y^=253)r(y,8,f);let M=[];for(;M.length*8<f.length;)M.push(0);return f.forEach((y,A)=>M[A>>>3]|=y<<7-(A&7)),new s(m,o,M,h)}getModule(c,o){return 0<=c&&c<this.size&&0<=o&&o<this.size&&this.modules[o][c]}getModules(){return this.modules}drawFunctionPatterns(){for(let d=0;d<this.size;d++)this.setFunctionModule(6,d,d%2==0),this.setFunctionModule(d,6,d%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const c=this.getAlignmentPatternPositions(),o=c.length;for(let d=0;d<o;d++)for(let i=0;i<o;i++)d==0&&i==0||d==0&&i==o-1||d==o-1&&i==0||this.drawAlignmentPattern(c[d],c[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(c){const o=this.errorCorrectionLevel.formatBits<<3|c;let d=o;for(let h=0;h<10;h++)d=d<<1^(d>>>9)*1335;const i=(o<<10|d)^21522;l(i>>>15==0);for(let h=0;h<=5;h++)this.setFunctionModule(8,h,a(i,h));this.setFunctionModule(8,7,a(i,6)),this.setFunctionModule(8,8,a(i,7)),this.setFunctionModule(7,8,a(i,8));for(let h=9;h<15;h++)this.setFunctionModule(14-h,8,a(i,h));for(let h=0;h<8;h++)this.setFunctionModule(this.size-1-h,8,a(i,h));for(let h=8;h<15;h++)this.setFunctionModule(8,this.size-15+h,a(i,h));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let c=this.version;for(let d=0;d<12;d++)c=c<<1^(c>>>11)*7973;const o=this.version<<12|c;l(o>>>18==0);for(let d=0;d<18;d++){const i=a(o,d),h=this.size-11+d%3,j=Math.floor(d/3);this.setFunctionModule(h,j,i),this.setFunctionModule(j,h,i)}}drawFinderPattern(c,o){for(let d=-4;d<=4;d++)for(let i=-4;i<=4;i++){const h=Math.max(Math.abs(i),Math.abs(d)),j=c+i,m=o+d;0<=j&&j<this.size&&0<=m&&m<this.size&&this.setFunctionModule(j,m,h!=2&&h!=4)}}drawAlignmentPattern(c,o){for(let d=-2;d<=2;d++)for(let i=-2;i<=2;i++)this.setFunctionModule(c+i,o+d,Math.max(Math.abs(i),Math.abs(d))!=1)}setFunctionModule(c,o,d){this.modules[o][c]=d,this.isFunction[o][c]=!0}addEccAndInterleave(c){const o=this.version,d=this.errorCorrectionLevel;if(c.length!=s.getNumDataCodewords(o,d))throw new RangeError("Invalid argument");const i=s.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][o],h=s.ECC_CODEWORDS_PER_BLOCK[d.ordinal][o],j=Math.floor(s.getNumRawDataModules(o)/8),m=i-j%i,b=Math.floor(j/i);let f=[];const S=s.reedSolomonComputeDivisor(h);for(let y=0,A=0;y<i;y++){let R=c.slice(A,A+b-h+(y<m?0:1));A+=R.length;const E=s.reedSolomonComputeRemainder(R,S);y<m&&R.push(0),f.push(R.concat(E))}let M=[];for(let y=0;y<f[0].length;y++)f.forEach((A,R)=>{(y!=b-h||R>=m)&&M.push(A[y])});return l(M.length==j),M}drawCodewords(c){if(c.length!=Math.floor(s.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let o=0;for(let d=this.size-1;d>=1;d-=2){d==6&&(d=5);for(let i=0;i<this.size;i++)for(let h=0;h<2;h++){const j=d-h,b=(d+1&2)==0?this.size-1-i:i;!this.isFunction[b][j]&&o<c.length*8&&(this.modules[b][j]=a(c[o>>>3],7-(o&7)),o++)}}l(o==c.length*8)}applyMask(c){if(c<0||c>7)throw new RangeError("Mask value out of range");for(let o=0;o<this.size;o++)for(let d=0;d<this.size;d++){let i;switch(c){case 0:i=(d+o)%2==0;break;case 1:i=o%2==0;break;case 2:i=d%3==0;break;case 3:i=(d+o)%3==0;break;case 4:i=(Math.floor(d/3)+Math.floor(o/2))%2==0;break;case 5:i=d*o%2+d*o%3==0;break;case 6:i=(d*o%2+d*o%3)%2==0;break;case 7:i=((d+o)%2+d*o%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[o][d]&&i&&(this.modules[o][d]=!this.modules[o][d])}}getPenaltyScore(){let c=0;for(let h=0;h<this.size;h++){let j=!1,m=0,b=[0,0,0,0,0,0,0];for(let f=0;f<this.size;f++)this.modules[h][f]==j?(m++,m==5?c+=s.PENALTY_N1:m>5&&c++):(this.finderPenaltyAddHistory(m,b),j||(c+=this.finderPenaltyCountPatterns(b)*s.PENALTY_N3),j=this.modules[h][f],m=1);c+=this.finderPenaltyTerminateAndCount(j,m,b)*s.PENALTY_N3}for(let h=0;h<this.size;h++){let j=!1,m=0,b=[0,0,0,0,0,0,0];for(let f=0;f<this.size;f++)this.modules[f][h]==j?(m++,m==5?c+=s.PENALTY_N1:m>5&&c++):(this.finderPenaltyAddHistory(m,b),j||(c+=this.finderPenaltyCountPatterns(b)*s.PENALTY_N3),j=this.modules[f][h],m=1);c+=this.finderPenaltyTerminateAndCount(j,m,b)*s.PENALTY_N3}for(let h=0;h<this.size-1;h++)for(let j=0;j<this.size-1;j++){const m=this.modules[h][j];m==this.modules[h][j+1]&&m==this.modules[h+1][j]&&m==this.modules[h+1][j+1]&&(c+=s.PENALTY_N2)}let o=0;for(const h of this.modules)o=h.reduce((j,m)=>j+(m?1:0),o);const d=this.size*this.size,i=Math.ceil(Math.abs(o*20-d*10)/d)-1;return l(0<=i&&i<=9),c+=i*s.PENALTY_N4,l(0<=c&&c<=2568888),c}getAlignmentPatternPositions(){if(this.version==1)return[];{const c=Math.floor(this.version/7)+2,o=this.version==32?26:Math.ceil((this.version*4+4)/(c*2-2))*2;let d=[6];for(let i=this.size-7;d.length<c;i-=o)d.splice(1,0,i);return d}}static getNumRawDataModules(c){if(c<s.MIN_VERSION||c>s.MAX_VERSION)throw new RangeError("Version number out of range");let o=(16*c+128)*c+64;if(c>=2){const d=Math.floor(c/7)+2;o-=(25*d-10)*d-55,c>=7&&(o-=36)}return l(208<=o&&o<=29648),o}static getNumDataCodewords(c,o){return Math.floor(s.getNumRawDataModules(c)/8)-s.ECC_CODEWORDS_PER_BLOCK[o.ordinal][c]*s.NUM_ERROR_CORRECTION_BLOCKS[o.ordinal][c]}static reedSolomonComputeDivisor(c){if(c<1||c>255)throw new RangeError("Degree out of range");let o=[];for(let i=0;i<c-1;i++)o.push(0);o.push(1);let d=1;for(let i=0;i<c;i++){for(let h=0;h<o.length;h++)o[h]=s.reedSolomonMultiply(o[h],d),h+1<o.length&&(o[h]^=o[h+1]);d=s.reedSolomonMultiply(d,2)}return o}static reedSolomonComputeRemainder(c,o){let d=o.map(i=>0);for(const i of c){const h=i^d.shift();d.push(0),o.forEach((j,m)=>d[m]^=s.reedSolomonMultiply(j,h))}return d}static reedSolomonMultiply(c,o){if(c>>>8||o>>>8)throw new RangeError("Byte out of range");let d=0;for(let i=7;i>=0;i--)d=d<<1^(d>>>7)*285,d^=(o>>>i&1)*c;return l(d>>>8==0),d}finderPenaltyCountPatterns(c){const o=c[1];l(o<=this.size*3);const d=o>0&&c[2]==o&&c[3]==o*3&&c[4]==o&&c[5]==o;return(d&&c[0]>=o*4&&c[6]>=o?1:0)+(d&&c[6]>=o*4&&c[0]>=o?1:0)}finderPenaltyTerminateAndCount(c,o,d){return c&&(this.finderPenaltyAddHistory(o,d),o=0),o+=this.size,this.finderPenaltyAddHistory(o,d),this.finderPenaltyCountPatterns(d)}finderPenaltyAddHistory(c,o){o[0]==0&&(c+=this.size),o.pop(),o.unshift(c)}};let n=s;n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=n;function r(c,o,d){if(o<0||o>31||c>>>o)throw new RangeError("Value out of range");for(let i=o-1;i>=0;i--)d.push(c>>>i&1)}function a(c,o){return(c>>>o&1)!=0}function l(c){if(!c)throw new Error("Assertion error")}const u=class{constructor(c,o,d){if(this.mode=c,this.numChars=o,this.bitData=d,o<0)throw new RangeError("Invalid argument");this.bitData=d.slice()}static makeBytes(c){let o=[];for(const d of c)r(d,8,o);return new u(u.Mode.BYTE,c.length,o)}static makeNumeric(c){if(!u.isNumeric(c))throw new RangeError("String contains non-numeric characters");let o=[];for(let d=0;d<c.length;){const i=Math.min(c.length-d,3);r(parseInt(c.substr(d,i),10),i*3+1,o),d+=i}return new u(u.Mode.NUMERIC,c.length,o)}static makeAlphanumeric(c){if(!u.isAlphanumeric(c))throw new RangeError("String contains unencodable characters in alphanumeric mode");let o=[],d;for(d=0;d+2<=c.length;d+=2){let i=u.ALPHANUMERIC_CHARSET.indexOf(c.charAt(d))*45;i+=u.ALPHANUMERIC_CHARSET.indexOf(c.charAt(d+1)),r(i,11,o)}return d<c.length&&r(u.ALPHANUMERIC_CHARSET.indexOf(c.charAt(d)),6,o),new u(u.Mode.ALPHANUMERIC,c.length,o)}static makeSegments(c){return c==""?[]:u.isNumeric(c)?[u.makeNumeric(c)]:u.isAlphanumeric(c)?[u.makeAlphanumeric(c)]:[u.makeBytes(u.toUtf8ByteArray(c))]}static makeEci(c){let o=[];if(c<0)throw new RangeError("ECI assignment value out of range");if(c<128)r(c,8,o);else if(c<16384)r(2,2,o),r(c,14,o);else if(c<1e6)r(6,3,o),r(c,21,o);else throw new RangeError("ECI assignment value out of range");return new u(u.Mode.ECI,0,o)}static isNumeric(c){return u.NUMERIC_REGEX.test(c)}static isAlphanumeric(c){return u.ALPHANUMERIC_REGEX.test(c)}getData(){return this.bitData.slice()}static getTotalBits(c,o){let d=0;for(const i of c){const h=i.mode.numCharCountBits(o);if(i.numChars>=1<<h)return 1/0;d+=4+h+i.bitData.length}return d}static toUtf8ByteArray(c){c=encodeURI(c);let o=[];for(let d=0;d<c.length;d++)c.charAt(d)!="%"?o.push(c.charCodeAt(d)):(o.push(parseInt(c.substr(d+1,2),16)),d+=2);return o}};let x=u;x.NUMERIC_REGEX=/^[0-9]*$/,x.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,x.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",t.QrSegment=x})(Te||(Te={}));(t=>{(s=>{const n=class{constructor(a,l){this.ordinal=a,this.formatBits=l}};let r=n;r.LOW=new n(0,1),r.MEDIUM=new n(1,0),r.QUARTILE=new n(2,3),r.HIGH=new n(3,2),s.Ecc=r})(t.QrCode||(t.QrCode={}))})(Te||(Te={}));(t=>{(s=>{const n=class{constructor(a,l){this.modeBits=a,this.numBitsCharCount=l}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};let r=n;r.NUMERIC=new n(1,[10,12,14]),r.ALPHANUMERIC=new n(2,[9,11,13]),r.BYTE=new n(4,[8,16,16]),r.KANJI=new n(8,[8,10,12]),r.ECI=new n(7,[0,0,0]),s.Mode=r})(t.QrSegment||(t.QrSegment={}))})(Te||(Te={}));var qe=Te;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var ea={L:qe.QrCode.Ecc.LOW,M:qe.QrCode.Ecc.MEDIUM,Q:qe.QrCode.Ecc.QUARTILE,H:qe.QrCode.Ecc.HIGH},ta=128,sa="L",ra="#FFFFFF",na="#000000",aa=!1,Ds=4,ia=.1;function oa(t,s=0){const n=[];return t.forEach(function(r,a){let l=null;r.forEach(function(u,x){if(!u&&l!==null){n.push(`M${l+s} ${a+s}h${x-l}v1H${l+s}z`),l=null;return}if(x===r.length-1){if(!u)return;l===null?n.push(`M${x+s},${a+s} h1v1H${x+s}z`):n.push(`M${l+s},${a+s} h${x+1-l}v1H${l+s}z`);return}u&&l===null&&(l=x)})}),n.join("")}function la(t,s){return t.slice().map((n,r)=>r<s.y||r>=s.y+s.h?n:n.map((a,l)=>l<s.x||l>=s.x+s.w?a:!1))}function ca(t,s,n,r){if(r==null)return null;const a=n?Ds:0,l=t.length+a*2,u=Math.floor(s*ia),x=l/s,c=(r.width||u)*x,o=(r.height||u)*x,d=r.x==null?t.length/2-c/2:r.x*x,i=r.y==null?t.length/2-o/2:r.y*x;let h=null;if(r.excavate){let j=Math.floor(d),m=Math.floor(i),b=Math.ceil(c+d-j),f=Math.ceil(o+i-m);h={x:j,y:m,w:b,h:f}}return{x:d,y:i,h:o,w:c,excavation:h}}(function(){try{new Path2D().addPath(new Path2D)}catch(t){return!1}return!0})();function Ts(t){const s=t,{value:n,size:r=ta,level:a=sa,bgColor:l=ra,fgColor:u=na,includeMargin:x=aa,imageSettings:c}=s,o=Zn(s,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let d=qe.QrCode.encodeText(n,ea[a]).getModules();const i=x?Ds:0,h=d.length+i*2,j=ca(d,r,x,c);let m=null;c!=null&&j!=null&&(j.excavation!=null&&(d=la(d,j.excavation)),m=We.createElement("image",{xlinkHref:c.src,height:j.h,width:j.w,x:j.x+i,y:j.y+i,preserveAspectRatio:"none"}));const b=oa(d,i);return We.createElement("svg",Gn({height:r,width:r,viewBox:`0 0 ${h} ${h}`},o),We.createElement("path",{fill:l,d:`M0,0 h${h}v${h}H0z`,shapeRendering:"crispEdges"}),We.createElement("path",{fill:u,d:b,shapeRendering:"crispEdges"}),m)}function rs(){var W,ue;const{user:t}=$e(),n=(W=wt().state)==null?void 0:W.forced,[r,a]=g.useState(""),[l,u]=g.useState(""),[x,c]=g.useState(""),[o,d]=g.useState(!1),[i,h]=g.useState(!1),[j,m]=g.useState(!1),[b,f]=g.useState(null),[S,M]=g.useState(!1),[y,A]=g.useState(!1),[R,E]=g.useState(!1),[$,F]=g.useState(null),[Z,Q]=g.useState(""),[z,oe]=g.useState(null),[re,O]=g.useState(!1),[L,w]=g.useState(null);g.useEffect(()=>{t&&A(t.mfa_enabled||!1)},[t]);const _=(J=>{if(!J)return{score:0,label:"",color:""};let te=0;return J.length>=8&&te++,J.length>=12&&te++,/[a-z]/.test(J)&&/[A-Z]/.test(J)&&te++,/\d/.test(J)&&te++,/[^a-zA-Z0-9]/.test(J)&&te++,te<=2?{score:te,label:"Weak",color:"bg-semantic-error"}:te===3?{score:te,label:"Fair",color:"bg-semantic-warning"}:te===4?{score:te,label:"Good",color:"bg-semantic-info"}:{score:te,label:"Strong",color:"bg-semantic-success"}})(l),D=J=>X(this,null,function*(){var te,K;if(J.preventDefault(),f(null),l!==x){f({type:"error",text:"New passwords do not match"});return}if(l.length<8){f({type:"error",text:"Password must be at least 8 characters"});return}M(!0);try{yield V.post("/auth/change-password",{current_password:r,new_password:l}),f({type:"success",text:"Password changed successfully"}),a(""),u(""),c("")}catch(he){f({type:"error",text:((K=(te=he==null?void 0:he.response)==null?void 0:te.data)==null?void 0:K.detail)||"Failed to change password"})}finally{M(!1)}}),C=()=>X(this,null,function*(){var J,te;O(!0),w(null);try{const K=yield V.post("/auth/mfa/enroll");F(K.data),oe(null),Q(""),E(!0)}catch(K){w({type:"error",text:((te=(J=K==null?void 0:K.response)==null?void 0:J.data)==null?void 0:te.detail)||"Failed to start MFA enrollment"})}finally{O(!1)}}),v=()=>X(this,null,function*(){var J,te;O(!0),w(null);try{const K=yield V.post("/auth/mfa/verify",{code:Z});oe(K.data.recovery_codes),A(!0),w({type:"success",text:"MFA enabled successfully! Save your recovery codes."})}catch(K){w({type:"error",text:((te=(J=K==null?void 0:K.response)==null?void 0:J.data)==null?void 0:te.detail)||"Invalid MFA code"})}finally{O(!1)}}),B=()=>X(this,null,function*(){var J,te;if(confirm("Are you sure you want to disable MFA? This will make your account less secure.")){O(!0),w(null);try{yield V.post("/auth/mfa/disable"),A(!1),w({type:"success",text:"MFA disabled successfully"})}catch(K){w({type:"error",text:((te=(J=K==null?void 0:K.response)==null?void 0:J.data)==null?void 0:te.detail)||"Failed to disable MFA"})}finally{O(!1)}}}),U=()=>X(this,null,function*(){var J,te;if(confirm("This will invalidate your existing recovery codes. Continue?")){O(!0),w(null);try{const K=yield V.post("/auth/mfa/recovery/regenerate");oe(K.data.recovery_codes),w({type:"success",text:"Recovery codes regenerated! Save them securely."})}catch(K){w({type:"error",text:((te=(J=K==null?void 0:K.response)==null?void 0:J.data)==null?void 0:te.detail)||"Failed to regenerate recovery codes"})}finally{O(!1)}}}),P=()=>{if(!z)return;const J=z.join(`
`);navigator.clipboard.writeText(J).then(()=>{w({type:"success",text:"Recovery codes copied to clipboard"})})},I=()=>{E(!1),F(null),Q(""),oe(null),w(null)};return e.jsxs(e.Fragment,{children:[e.jsx(ve,{title:"Profile & Settings"}),e.jsxs("div",{className:"px-10 py-6 max-w-2xl",children:[n&&e.jsx("div",{className:"mb-6 rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"h-5 w-5 text-semantic-warning flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-semantic-warning",children:"Password change required"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"For security reasons, you must change your password before continuing."})]})]})}),e.jsxs(ae,{className:"mb-6",children:[e.jsx(ce,{children:e.jsx(de,{children:"User Information"})}),e.jsx(le,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Name"}),e.jsx("div",{className:"text-sm text-text-primary",children:t==null?void 0:t.full_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Email"}),e.jsx("div",{className:"text-sm text-text-primary",children:t==null?void 0:t.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Role"}),e.jsx("div",{className:"text-sm text-text-primary capitalize",children:(ue=t==null?void 0:t.role)==null?void 0:ue.replace("_"," ")})]}),(t==null?void 0:t.created_at)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Account Created"}),e.jsx("div",{className:"text-sm text-text-secondary",children:Y(t.created_at).format("MMMM D, YYYY [at] h:mm A")})]}),(t==null?void 0:t.last_login)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Last Login"}),e.jsx("div",{className:"text-sm text-text-secondary",children:Y(t.last_login).format("MMMM D, YYYY [at] h:mm A")})]})]})})]}),e.jsxs(ae,{className:"mb-6",children:[e.jsx(ce,{children:e.jsx(de,{children:"Multi-Factor Authentication"})}),e.jsxs(le,{children:[L&&e.jsx("div",{className:`mt-4 rounded-lg border p-3 text-sm ${L.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:L.text}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-text-primary",children:"MFA Status"}),e.jsx("div",{className:"text-xs text-text-secondary mt-1",children:y?"Your account is protected with MFA":"Add an extra layer of security"})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium ${y?"bg-semantic-success/10 text-semantic-success":"bg-gray-100 text-text-muted"}`,children:y?" Enabled":"Disabled"})]}),z&&e.jsxs("div",{className:"rounded-lg border border-border bg-app p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary",children:"Your Recovery Codes"}),e.jsx("button",{onClick:P,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:z.map(J=>e.jsx("code",{className:"text-xs bg-surface p-2 rounded border border-border font-mono",children:J},J))}),e.jsx("p",{className:"text-xs text-text-muted",children:" Save these codes in a secure location. Each code can only be used once."})]}),e.jsx("div",{className:"flex gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"secondary",onClick:U,disabled:re,children:re?"Regenerating...":"Regenerate Recovery Codes"}),e.jsx(T,{variant:"secondary",onClick:B,disabled:re,children:re?"Disabling...":"Disable MFA"})]}):e.jsx(T,{variant:"primary",onClick:C,disabled:re,children:re?"Setting up...":"Enable MFA"})})]})]})]}),e.jsxs(ae,{children:[e.jsx(ce,{children:e.jsx(de,{children:"Change Password"})}),e.jsxs(le,{children:[b&&e.jsx("div",{className:`mt-4 rounded-lg border p-3 text-sm ${b.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:b.text}),e.jsxs("form",{onSubmit:D,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{type:o?"text":"password",value:r,onChange:J=>a(J.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>d(!o),"aria-label":o?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:o?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{type:i?"text":"password",value:l,onChange:J=>u(J.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!i),"aria-label":i?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:i?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),l&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${_.color} transition-all duration-300`,style:{width:`${_.score/5*100}%`}})}),e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:_.label})]}),e.jsxs("ul",{className:"text-xs text-text-muted space-y-0.5",children:[e.jsxs("li",{className:l.length>=8?"text-semantic-success":"",children:[l.length>=8?"":""," At least 8 characters"]}),e.jsxs("li",{className:/[a-z]/.test(l)&&/[A-Z]/.test(l)?"text-semantic-success":"",children:[/[a-z]/.test(l)&&/[A-Z]/.test(l)?"":""," Mixed case letters"]}),e.jsxs("li",{className:/\d/.test(l)?"text-semantic-success":"",children:[/\d/.test(l)?"":""," At least one number"]}),e.jsxs("li",{className:/[^a-zA-Z0-9]/.test(l)?"text-semantic-success":"",children:[/[^a-zA-Z0-9]/.test(l)?"":""," Special character (!@#$%, etc.)"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{type:j?"text":"password",value:x,onChange:J=>c(J.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>m(!j),"aria-label":j?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:j?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),x&&l!==x&&e.jsx("p",{className:"text-xs text-semantic-error",children:"Passwords do not match"})]}),e.jsx(T,{type:"submit",variant:"primary",disabled:S,children:S?"Changing...":"Change Password"})]})]})]}),e.jsxs(be,{open:R,onClose:I,children:[e.jsx(ge,{onClose:I,children:"Set up Multi-Factor Authentication"}),e.jsx(je,{children:e.jsx("div",{className:"space-y-4",children:$&&!z?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx("div",{className:"flex justify-center p-4 bg-app rounded-lg",children:e.jsx(Ts,{value:$.otpauth_url,size:200})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-1",children:"Manual entry secret"}),e.jsx("code",{className:"block text-xs bg-app p-2 rounded border border-border font-mono break-all",children:$.secret})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Enter the 6-digit code from your app"}),e.jsx(ie,{type:"text",autoFocus:!0,value:Z,onChange:J=>Q(J.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",maxLength:6})]}),L&&e.jsx("div",{className:`rounded-lg border p-3 text-sm ${L.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:L.text})]}):z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-3 text-sm text-semantic-success",children:" MFA enabled successfully!"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary",children:"Recovery Codes"}),e.jsx("button",{onClick:P,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:z.map(J=>e.jsx("code",{className:"text-xs bg-app p-2 rounded border border-border font-mono",children:J},J))}),e.jsx("p",{className:"text-xs text-text-muted",children:" Save these codes in a secure location. Each code can only be used once if you lose access to your authenticator app."})]})]}):e.jsx("p",{className:"text-sm text-text-muted",children:"Preparing MFA enrollment..."})})}),e.jsx(ye,{children:z?e.jsx(T,{variant:"primary",onClick:I,children:"Done"}):e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"secondary",onClick:I,children:"Cancel"}),e.jsx(T,{variant:"primary",onClick:v,disabled:Z.length!==6||re,children:re?"Verifying...":"Verify & Enable"})]})})]})]})]})}function da(){const{token:t,role:s,name:n,login:r,logout:a,mustChangePassword:l,ready:u}=$e(),[x,c]=g.useState(""),[o,d]=g.useState(""),[i,h]=g.useState(!1),[j,m]=g.useState(!1),[b,f]=g.useState(""),[S,M]=g.useState(""),[y,A]=g.useState(null),[R,E]=g.useState(!1),[$,F]=g.useState(!1),[Z,Q]=g.useState(null),[z,oe]=g.useState(null),[re,O]=g.useState(0),[L,w]=g.useState(!1),k=Ue(),_=wt();g.useEffect(()=>{u&&(t||_.pathname!=="/"&&k("/",{replace:!0}))},[u,t,_.pathname,k]),g.useEffect(()=>{t&&l&&_.pathname!=="/profile"&&k("/profile",{replace:!0,state:{forced:!0}})},[t,l,_.pathname,k]);const D=()=>X(this,null,function*(){var P,I;A(null),m(!0);try{const W=yield r(x,o,R?b:void 0,R?S:void 0);E(!1),f(""),M(""),W!=null&&W.mfa_enrollment_required?(O(W.mfa_remaining_skips||0),yield C()):k("/")}catch(W){const ue=(I=(P=W==null?void 0:W.response)==null?void 0:P.data)==null?void 0:I.detail;ue==="MFA code required"||(ue==null?void 0:ue.code)==="mfa_required"?(E(!0),A("Enter your 6-digit MFA code or a recovery code.")):A(ue==="Invalid recovery code"||ue==="Invalid MFA code"||ue==="Invalid code"?"Invalid code. Please try again.":"Login failed. Check your credentials.")}finally{m(!1)}}),C=()=>X(this,null,function*(){var P,I;try{const W=yield V.post("/auth/mfa/enroll");Q(W.data),oe(null),F(!0)}catch(W){A(((I=(P=W==null?void 0:W.response)==null?void 0:P.data)==null?void 0:I.detail)||"Could not start MFA enrollment")}}),v=()=>X(this,null,function*(){var P,I;w(!0);try{const W=yield V.post("/auth/mfa/verify",{code:b});oe(W.data.recovery_codes),F(!1),f(""),O(0),k("/")}catch(W){A(((I=(P=W==null?void 0:W.response)==null?void 0:P.data)==null?void 0:I.detail)||"Invalid code")}finally{w(!1)}}),B=()=>X(this,null,function*(){var P,I;try{const W=yield V.post("/auth/mfa/skip");O(W.data.remaining_skips),F(!1),Q(null)}catch(W){A(((I=(P=W==null?void 0:W.response)==null?void 0:P.data)==null?void 0:I.detail)||"Cannot skip MFA")}}),U=()=>{if(!z)return;const P=z.join(`
`);navigator.clipboard.writeText(P).then(()=>{alert("Recovery codes copied to clipboard")})};return t?e.jsx(In,{children:e.jsxs(sr,{children:[e.jsx(Se,{path:"/",element:e.jsx(zn,{})}),e.jsx(Se,{path:"/tasks",element:e.jsx(Jn,{})}),e.jsx(Se,{path:"/complaints",element:e.jsx(Hn,{})}),e.jsx(Se,{path:"/create",element:e.jsx(Wn,{})}),e.jsx(Se,{path:"/complaints/:id",element:e.jsx(Yn,{})}),e.jsx(Se,{path:"/profile",element:e.jsx(rs,{})}),e.jsx(Se,{path:"/users",element:e.jsx(Qn,{})}),e.jsx(Se,{path:"/reference",element:e.jsx(Kn,{})}),e.jsx(Se,{path:"/settings",element:e.jsx(rs,{})})]})}):e.jsxs("div",{className:"min-h-screen bg-app flex items-center justify-center p-4",children:[e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"rounded-card border border-border bg-surface shadow-card p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-text-primary mb-2",children:"Sign in to Compass"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Use your credentials to access the complaints workspace"})]}),y&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:y}),e.jsxs("form",{onSubmit:P=>{P.preventDefault(),D()},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(ie,{type:"email",value:x,onChange:P=>c(P.target.value),placeholder:"you@example.com",autoComplete:"email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{type:i?"text":"password",value:o,onChange:P=>d(P.target.value),placeholder:"",autoComplete:"current-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!i),"aria-label":i?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:i?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"MFA Code (6 digits)"}),e.jsx(ie,{type:"text",autoFocus:!0,value:b,onChange:P=>f(P.target.value),placeholder:"123456",maxLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Recovery Code (optional)"}),e.jsx(ie,{type:"text",value:S,onChange:P=>M(P.target.value),placeholder:"recovery-code"})]})]}),e.jsx(T,{type:"submit",variant:"primary",className:"w-full mt-6",disabled:j,children:j?"Signing in...":"Sign in"})]})]})}),e.jsxs(be,{open:$,onClose:re>0?()=>{F(!1),A(null)}:()=>{},children:[e.jsx(ge,{onClose:re>0?()=>{F(!1),A(null)}:void 0,children:"Set up Multi-Factor Authentication"}),e.jsx(je,{children:e.jsxs("div",{className:"space-y-4",children:[re<=0?e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:"You must enable MFA to continue."}):e.jsxs("p",{className:"text-sm text-text-secondary",children:["We recommend enabling MFA for enhanced security. You can skip up to ",re," more time(s)."]}),Z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-2",children:"Scan with your authenticator app"}),e.jsx("div",{className:"flex justify-center p-4 bg-app rounded-lg",children:e.jsx(Ts,{value:Z.otpauth_url,size:180})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-1",children:"Manual entry secret"}),e.jsx("code",{className:"block text-xs bg-app p-2 rounded border border-border font-mono",children:Z.secret})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Enter 6-digit code"}),e.jsx(ie,{type:"text",autoFocus:!0,value:b,onChange:P=>f(P.target.value),placeholder:"123456",maxLength:6})]}),z&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary",children:"Recovery codes (store securely)"}),e.jsx("button",{onClick:U,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:z.map(P=>e.jsx("code",{className:"text-xs bg-app p-2 rounded border border-border font-mono",children:P},P))}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Save these codes in a secure location. They can be used to access your account if you lose your authenticator device."})]})]}):e.jsx("p",{className:"text-sm text-text-muted",children:"Preparing enrollment..."})]})}),e.jsxs(ye,{children:[e.jsx(T,{variant:"secondary",onClick:B,disabled:re<=0,children:"Skip for now"}),e.jsx(T,{variant:"primary",onClick:v,disabled:!b||b.length<6||L,children:L?"Verifying...":"Verify & Enable"})]})]})]})}gt.createRoot(document.getElementById("root")).render(e.jsx(We.StrictMode,{children:e.jsx(rr,{children:e.jsx(Tn,{children:e.jsx(da,{})})})}))});export default ua();
