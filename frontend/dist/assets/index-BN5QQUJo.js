var cr=Object.defineProperty,dr=Object.defineProperties;var ur=Object.getOwnPropertyDescriptors;var Mn=Object.getOwnPropertySymbols;var hr=Object.prototype.hasOwnProperty,fr=Object.prototype.propertyIsEnumerable;var ze=(t,n)=>(n=Symbol[t])?n:Symbol.for("Symbol."+t),mr=t=>{throw TypeError(t)};var Pn=(t,n,s)=>n in t?cr(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,ne=(t,n)=>{for(var s in n||(n={}))hr.call(n,s)&&Pn(t,s,n[s]);if(Mn)for(var s of Mn(n))fr.call(n,s)&&Pn(t,s,n[s]);return t},me=(t,n)=>dr(t,ur(n));var Y=(t,n,s)=>new Promise((r,a)=>{var u=c=>{try{h(s.next(c))}catch(o){a(o)}},l=c=>{try{h(s.throw(c))}catch(o){a(o)}},h=c=>c.done?r(c.value):Promise.resolve(c.value).then(u,l);h((s=s.apply(t,n)).next())}),ke=function(t,n){this[0]=t,this[1]=n},Wt=(t,n,s)=>{var r=(l,h,c,o)=>{try{var i=s[l](h),d=(h=i.value)instanceof ke,p=i.done;Promise.resolve(d?h[0]:h).then(b=>d?r(l==="return"?l:"next",h[1]?{done:b.done,value:b.value}:b,c,o):c({value:b,done:p})).catch(b=>r("throw",b,c,o))}catch(b){o(b)}},a=l=>u[l]=h=>new Promise((c,o)=>r(l,h,c,o)),u={};return s=s.apply(t,n),u[ze("asyncIterator")]=()=>u,a("next"),a("throw"),a("return"),u},zt=t=>{var n=t[ze("asyncIterator")],s=!1,r,a={};return n==null?(n=t[ze("iterator")](),r=u=>a[u]=l=>n[u](l)):(n=n.call(t),r=u=>a[u]=l=>{if(s){if(s=!1,u==="throw")throw l;return l}return s=!0,{done:!1,value:new ke(new Promise(h=>{var c=n[u](l);c instanceof Object||mr("Object expected"),h(c)}),1)}}),a[ze("iterator")]=()=>a,r("next"),"throw"in n?r("throw"):a.throw=u=>{throw u},"return"in n&&r("return"),a},Dn=(t,n,s)=>(n=t[ze("asyncIterator")])?n.call(t):(t=t[ze("iterator")](),n={},s=(r,a)=>(a=t[r])&&(n[r]=u=>new Promise((l,h,c)=>(u=a.call(t,u),c=u.done,Promise.resolve(u.value).then(o=>l({value:o,done:c}),h)))),s("next"),s("return"),n);import{j as e,C as ge,B as te,S as W,T as j,G as O,a as ae,b as le,c as pr,D as us,d as I,e as hs,f as Pe,L as en,g as Ct,h as Ne,i as Ie,k as xr,l as U,M as G,m as tn,n as nn,o as Re,p as Q,q as sn,F as rt,r as kn,s as Tn,I as Nn,t as In,u as Ye,v as qe,w as Ve,x as Je,A as De,y as gr,z as yr,E as br,H as Jt,J as jr,K as Fn,N as wr,O as vr,P as Cr,V as Sr,Q as _r,R as Er,U as Rr,W as Ar}from"./mui-C-WAG5RB.js";import{c as Or,d as Mr,e as Pr,r as w,u as at,f as rn,L as Me,h as Dr,a as He,i as kr,j as Te,B as Tr}from"./vendor-CgeKSuOn.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=s(a);fetch(a.href,u)}})();var Qt={},$n=Or;Qt.createRoot=$n.createRoot,Qt.hydrateRoot=$n.hydrateRoot;var fs={exports:{}};(function(t,n){(function(s,r){t.exports=r()})(Mr,function(){var s=1e3,r=6e4,a=36e5,u="millisecond",l="second",h="minute",c="hour",o="day",i="week",d="month",p="quarter",b="year",f="date",y="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,E=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,A={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var S=["th","st","nd","rd"],_=M%100;return"["+M+(S[(_-20)%10]||S[_]||S[0])+"]"}},v=function(M,S,_){var T=String(M);return!T||T.length>=S?M:""+Array(S+1-T.length).join(_)+M},P={s:v,z:function(M){var S=-M.utcOffset(),_=Math.abs(S),T=Math.floor(_/60),R=_%60;return(S<=0?"+":"-")+v(T,2,"0")+":"+v(R,2,"0")},m:function M(S,_){if(S.date()<_.date())return-M(_,S);var T=12*(_.year()-S.year())+(_.month()-S.month()),R=S.clone().add(T,d),L=_-R<0,B=S.clone().add(T+(L?-1:1),d);return+(-(T+(_-R)/(L?R-B:B-R))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:d,y:b,w:i,d:o,D:f,h:c,m:h,s:l,ms:u,Q:p}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},k="en",V={};V[k]=A;var ee="$isDayjsObject",ue=function(M){return M instanceof z||!(!M||!M[ee])},oe=function M(S,_,T){var R;if(!S)return k;if(typeof S=="string"){var L=S.toLowerCase();V[L]&&(R=L),_&&(V[L]=_,R=L);var B=S.split("-");if(!R&&B.length>1)return M(B[0])}else{var D=S.name;V[D]=S,R=D}return!T&&R&&(k=R),R||!T&&k},Z=function(M,S){if(ue(M))return M.clone();var _=typeof S=="object"?S:{};return _.date=M,_.args=arguments,new z(_)},C=P;C.l=oe,C.i=ue,C.w=function(M,S){return Z(M,{locale:S.$L,utc:S.$u,x:S.$x,$offset:S.$offset})};var z=function(){function M(_){this.$L=oe(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[ee]=!0}var S=M.prototype;return S.parse=function(_){this.$d=function(T){var R=T.date,L=T.utc;if(R===null)return new Date(NaN);if(C.u(R))return new Date;if(R instanceof Date)return new Date(R);if(typeof R=="string"&&!/Z$/i.test(R)){var B=R.match(g);if(B){var D=B[2]-1||0,H=(B[7]||"0").substring(0,3);return L?new Date(Date.UTC(B[1],D,B[3]||1,B[4]||0,B[5]||0,B[6]||0,H)):new Date(B[1],D,B[3]||1,B[4]||0,B[5]||0,B[6]||0,H)}}return new Date(R)}(_),this.init()},S.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},S.$utils=function(){return C},S.isValid=function(){return this.$d.toString()!==y},S.isSame=function(_,T){var R=Z(_);return this.startOf(T)<=R&&R<=this.endOf(T)},S.isAfter=function(_,T){return Z(_)<this.startOf(T)},S.isBefore=function(_,T){return this.endOf(T)<Z(_)},S.$g=function(_,T,R){return C.u(_)?this[T]:this.set(R,_)},S.unix=function(){return Math.floor(this.valueOf()/1e3)},S.valueOf=function(){return this.$d.getTime()},S.startOf=function(_,T){var R=this,L=!!C.u(T)||T,B=C.p(_),D=function(ve,de){var ye=C.w(R.$u?Date.UTC(R.$y,de,ve):new Date(R.$y,de,ve),R);return L?ye:ye.endOf(o)},H=function(ve,de){return C.w(R.toDate()[ve].apply(R.toDate("s"),(L?[0,0,0,0]:[23,59,59,999]).slice(de)),R)},N=this.$W,K=this.$M,ce=this.$D,Se="set"+(this.$u?"UTC":"");switch(B){case b:return L?D(1,0):D(31,11);case d:return L?D(1,K):D(0,K+1);case i:var we=this.$locale().weekStart||0,Ae=(N<we?N+7:N)-we;return D(L?ce-Ae:ce+(6-Ae),K);case o:case f:return H(Se+"Hours",0);case c:return H(Se+"Minutes",1);case h:return H(Se+"Seconds",2);case l:return H(Se+"Milliseconds",3);default:return this.clone()}},S.endOf=function(_){return this.startOf(_,!1)},S.$set=function(_,T){var R,L=C.p(_),B="set"+(this.$u?"UTC":""),D=(R={},R[o]=B+"Date",R[f]=B+"Date",R[d]=B+"Month",R[b]=B+"FullYear",R[c]=B+"Hours",R[h]=B+"Minutes",R[l]=B+"Seconds",R[u]=B+"Milliseconds",R)[L],H=L===o?this.$D+(T-this.$W):T;if(L===d||L===b){var N=this.clone().set(f,1);N.$d[D](H),N.init(),this.$d=N.set(f,Math.min(this.$D,N.daysInMonth())).$d}else D&&this.$d[D](H);return this.init(),this},S.set=function(_,T){return this.clone().$set(_,T)},S.get=function(_){return this[C.p(_)]()},S.add=function(_,T){var R,L=this;_=Number(_);var B=C.p(T),D=function(K){var ce=Z(L);return C.w(ce.date(ce.date()+Math.round(K*_)),L)};if(B===d)return this.set(d,this.$M+_);if(B===b)return this.set(b,this.$y+_);if(B===o)return D(1);if(B===i)return D(7);var H=(R={},R[h]=r,R[c]=a,R[l]=s,R)[B]||1,N=this.$d.getTime()+_*H;return C.w(N,this)},S.subtract=function(_,T){return this.add(-1*_,T)},S.format=function(_){var T=this,R=this.$locale();if(!this.isValid())return R.invalidDate||y;var L=_||"YYYY-MM-DDTHH:mm:ssZ",B=C.z(this),D=this.$H,H=this.$m,N=this.$M,K=R.weekdays,ce=R.months,Se=R.meridiem,we=function(de,ye,_e,Ue){return de&&(de[ye]||de(T,L))||_e[ye].slice(0,Ue)},Ae=function(de){return C.s(D%12||12,de,"0")},ve=Se||function(de,ye,_e){var Ue=de<12?"AM":"PM";return _e?Ue.toLowerCase():Ue};return L.replace(E,function(de,ye){return ye||function(_e){switch(_e){case"YY":return String(T.$y).slice(-2);case"YYYY":return C.s(T.$y,4,"0");case"M":return N+1;case"MM":return C.s(N+1,2,"0");case"MMM":return we(R.monthsShort,N,ce,3);case"MMMM":return we(ce,N);case"D":return T.$D;case"DD":return C.s(T.$D,2,"0");case"d":return String(T.$W);case"dd":return we(R.weekdaysMin,T.$W,K,2);case"ddd":return we(R.weekdaysShort,T.$W,K,3);case"dddd":return K[T.$W];case"H":return String(D);case"HH":return C.s(D,2,"0");case"h":return Ae(1);case"hh":return Ae(2);case"a":return ve(D,H,!0);case"A":return ve(D,H,!1);case"m":return String(H);case"mm":return C.s(H,2,"0");case"s":return String(T.$s);case"ss":return C.s(T.$s,2,"0");case"SSS":return C.s(T.$ms,3,"0");case"Z":return B}return null}(de)||B.replace(":","")})},S.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},S.diff=function(_,T,R){var L,B=this,D=C.p(T),H=Z(_),N=(H.utcOffset()-this.utcOffset())*r,K=this-H,ce=function(){return C.m(B,H)};switch(D){case b:L=ce()/12;break;case d:L=ce();break;case p:L=ce()/3;break;case i:L=(K-N)/6048e5;break;case o:L=(K-N)/864e5;break;case c:L=K/a;break;case h:L=K/r;break;case l:L=K/s;break;default:L=K}return R?L:C.a(L)},S.daysInMonth=function(){return this.endOf(d).$D},S.$locale=function(){return V[this.$L]},S.locale=function(_,T){if(!_)return this.$L;var R=this.clone(),L=oe(_,T,!0);return L&&(R.$L=L),R},S.clone=function(){return C.w(this.$d,this)},S.toDate=function(){return new Date(this.valueOf())},S.toJSON=function(){return this.isValid()?this.toISOString():null},S.toISOString=function(){return this.$d.toISOString()},S.toString=function(){return this.$d.toUTCString()},M}(),F=z.prototype;return Z.prototype=F,[["$ms",u],["$s",l],["$m",h],["$H",c],["$W",o],["$M",d],["$y",b],["$D",f]].forEach(function(M){F[M[1]]=function(S){return this.$g(S,M[0],M[1])}}),Z.extend=function(M,S){return M.$i||(M(S,z,Z),M.$i=!0),Z},Z.locale=oe,Z.isDayjs=ue,Z.unix=function(M){return Z(1e3*M)},Z.en=V[k],Z.Ls=V,Z.p={},Z})})(fs);var Nr=fs.exports;const se=Pr(Nr);function ms(t,n){return function(){return t.apply(n,arguments)}}const{toString:Ir}=Object.prototype,{getPrototypeOf:an}=Object,{iterator:Pt,toStringTag:ps}=Symbol,Dt=(t=>n=>{const s=Ir.call(n);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),je=t=>(t=t.toLowerCase(),n=>Dt(n)===t),kt=t=>n=>typeof n===t,{isArray:Ke}=Array,Qe=kt("undefined");function it(t){return t!==null&&!Qe(t)&&t.constructor!==null&&!Qe(t.constructor)&&pe(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const xs=je("ArrayBuffer");function Fr(t){let n;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?n=ArrayBuffer.isView(t):n=t&&t.buffer&&xs(t.buffer),n}const $r=kt("string"),pe=kt("function"),gs=kt("number"),ot=t=>t!==null&&typeof t=="object",Lr=t=>t===!0||t===!1,St=t=>{if(Dt(t)!=="object")return!1;const n=an(t);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(ps in t)&&!(Pt in t)},Br=t=>{if(!ot(t)||it(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch(n){return!1}},Ur=je("Date"),Wr=je("File"),zr=je("Blob"),Hr=je("FileList"),Yr=t=>ot(t)&&pe(t.pipe),qr=t=>{let n;return t&&(typeof FormData=="function"&&t instanceof FormData||pe(t.append)&&((n=Dt(t))==="formdata"||n==="object"&&pe(t.toString)&&t.toString()==="[object FormData]"))},Vr=je("URLSearchParams"),[Jr,Qr,Kr,Gr]=["ReadableStream","Request","Response","Headers"].map(je),Xr=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function lt(t,n,{allOwnKeys:s=!1}={}){if(t===null||typeof t=="undefined")return;let r,a;if(typeof t!="object"&&(t=[t]),Ke(t))for(r=0,a=t.length;r<a;r++)n.call(null,t[r],r,t);else{if(it(t))return;const u=s?Object.getOwnPropertyNames(t):Object.keys(t),l=u.length;let h;for(r=0;r<l;r++)h=u[r],n.call(null,t[h],h,t)}}function ys(t,n){if(it(t))return null;n=n.toLowerCase();const s=Object.keys(t);let r=s.length,a;for(;r-- >0;)if(a=s[r],n===a.toLowerCase())return a;return null}const Fe=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,bs=t=>!Qe(t)&&t!==Fe;function Kt(){const{caseless:t,skipUndefined:n}=bs(this)&&this||{},s={},r=(a,u)=>{const l=t&&ys(s,u)||u;St(s[l])&&St(a)?s[l]=Kt(s[l],a):St(a)?s[l]=Kt({},a):Ke(a)?s[l]=a.slice():(!n||!Qe(a))&&(s[l]=a)};for(let a=0,u=arguments.length;a<u;a++)arguments[a]&&lt(arguments[a],r);return s}const Zr=(t,n,s,{allOwnKeys:r}={})=>(lt(n,(a,u)=>{s&&pe(a)?t[u]=ms(a,s):t[u]=a},{allOwnKeys:r}),t),ea=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ta=(t,n,s,r)=>{t.prototype=Object.create(n.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:n.prototype}),s&&Object.assign(t.prototype,s)},na=(t,n,s,r)=>{let a,u,l;const h={};if(n=n||{},t==null)return n;do{for(a=Object.getOwnPropertyNames(t),u=a.length;u-- >0;)l=a[u],(!r||r(l,t,n))&&!h[l]&&(n[l]=t[l],h[l]=!0);t=s!==!1&&an(t)}while(t&&(!s||s(t,n))&&t!==Object.prototype);return n},sa=(t,n,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=n.length;const r=t.indexOf(n,s);return r!==-1&&r===s},ra=t=>{if(!t)return null;if(Ke(t))return t;let n=t.length;if(!gs(n))return null;const s=new Array(n);for(;n-- >0;)s[n]=t[n];return s},aa=(t=>n=>t&&n instanceof t)(typeof Uint8Array!="undefined"&&an(Uint8Array)),ia=(t,n)=>{const r=(t&&t[Pt]).call(t);let a;for(;(a=r.next())&&!a.done;){const u=a.value;n.call(t,u[0],u[1])}},oa=(t,n)=>{let s;const r=[];for(;(s=t.exec(n))!==null;)r.push(s);return r},la=je("HTMLFormElement"),ca=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,r,a){return r.toUpperCase()+a}),Ln=(({hasOwnProperty:t})=>(n,s)=>t.call(n,s))(Object.prototype),da=je("RegExp"),js=(t,n)=>{const s=Object.getOwnPropertyDescriptors(t),r={};lt(s,(a,u)=>{let l;(l=n(a,u,t))!==!1&&(r[u]=l||a)}),Object.defineProperties(t,r)},ua=t=>{js(t,(n,s)=>{if(pe(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const r=t[s];if(pe(r)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},ha=(t,n)=>{const s={},r=a=>{a.forEach(u=>{s[u]=!0})};return Ke(t)?r(t):r(String(t).split(n)),s},fa=()=>{},ma=(t,n)=>t!=null&&Number.isFinite(t=+t)?t:n;function pa(t){return!!(t&&pe(t.append)&&t[ps]==="FormData"&&t[Pt])}const xa=t=>{const n=new Array(10),s=(r,a)=>{if(ot(r)){if(n.indexOf(r)>=0)return;if(it(r))return r;if(!("toJSON"in r)){n[a]=r;const u=Ke(r)?[]:{};return lt(r,(l,h)=>{const c=s(l,a+1);!Qe(c)&&(u[h]=c)}),n[a]=void 0,u}}return r};return s(t,0)},ga=je("AsyncFunction"),ya=t=>t&&(ot(t)||pe(t))&&pe(t.then)&&pe(t.catch),ws=((t,n)=>t?setImmediate:n?((s,r)=>(Fe.addEventListener("message",({source:a,data:u})=>{a===Fe&&u===s&&r.length&&r.shift()()},!1),a=>{r.push(a),Fe.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",pe(Fe.postMessage)),ba=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Fe):typeof process!="undefined"&&process.nextTick||ws,ja=t=>t!=null&&pe(t[Pt]),x={isArray:Ke,isArrayBuffer:xs,isBuffer:it,isFormData:qr,isArrayBufferView:Fr,isString:$r,isNumber:gs,isBoolean:Lr,isObject:ot,isPlainObject:St,isEmptyObject:Br,isReadableStream:Jr,isRequest:Qr,isResponse:Kr,isHeaders:Gr,isUndefined:Qe,isDate:Ur,isFile:Wr,isBlob:zr,isRegExp:da,isFunction:pe,isStream:Yr,isURLSearchParams:Vr,isTypedArray:aa,isFileList:Hr,forEach:lt,merge:Kt,extend:Zr,trim:Xr,stripBOM:ea,inherits:ta,toFlatObject:na,kindOf:Dt,kindOfTest:je,endsWith:sa,toArray:ra,forEachEntry:ia,matchAll:oa,isHTMLForm:la,hasOwnProperty:Ln,hasOwnProp:Ln,reduceDescriptors:js,freezeMethods:ua,toObjectSet:ha,toCamelCase:ca,noop:fa,toFiniteNumber:ma,findKey:ys,global:Fe,isContextDefined:bs,isSpecCompliantForm:pa,toJSONObject:xa,isAsyncFn:ga,isThenable:ya,setImmediate:ws,asap:ba,isIterable:ja};function q(t,n,s,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",n&&(this.code=n),s&&(this.config=s),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}x.inherits(q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:x.toJSONObject(this.config),code:this.code,status:this.status}}});const vs=q.prototype,Cs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Cs[t]={value:t}});Object.defineProperties(q,Cs);Object.defineProperty(vs,"isAxiosError",{value:!0});q.from=(t,n,s,r,a,u)=>{const l=Object.create(vs);x.toFlatObject(t,l,function(i){return i!==Error.prototype},o=>o!=="isAxiosError");const h=t&&t.message?t.message:"Error",c=n==null&&t?t.code:n;return q.call(l,h,c,s,r,a),t&&l.cause==null&&Object.defineProperty(l,"cause",{value:t,configurable:!0}),l.name=t&&t.name||"Error",u&&Object.assign(l,u),l};const wa=null;function Gt(t){return x.isPlainObject(t)||x.isArray(t)}function Ss(t){return x.endsWith(t,"[]")?t.slice(0,-2):t}function Bn(t,n,s){return t?t.concat(n).map(function(a,u){return a=Ss(a),!s&&u?"["+a+"]":a}).join(s?".":""):n}function va(t){return x.isArray(t)&&!t.some(Gt)}const Ca=x.toFlatObject(x,{},null,function(n){return/^is[A-Z]/.test(n)});function Tt(t,n,s){if(!x.isObject(t))throw new TypeError("target must be an object");n=n||new FormData,s=x.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,g){return!x.isUndefined(g[y])});const r=s.metaTokens,a=s.visitor||i,u=s.dots,l=s.indexes,c=(s.Blob||typeof Blob!="undefined"&&Blob)&&x.isSpecCompliantForm(n);if(!x.isFunction(a))throw new TypeError("visitor must be a function");function o(f){if(f===null)return"";if(x.isDate(f))return f.toISOString();if(x.isBoolean(f))return f.toString();if(!c&&x.isBlob(f))throw new q("Blob is not supported. Use a Buffer instead.");return x.isArrayBuffer(f)||x.isTypedArray(f)?c&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function i(f,y,g){let E=f;if(f&&!g&&typeof f=="object"){if(x.endsWith(y,"{}"))y=r?y:y.slice(0,-2),f=JSON.stringify(f);else if(x.isArray(f)&&va(f)||(x.isFileList(f)||x.endsWith(y,"[]"))&&(E=x.toArray(f)))return y=Ss(y),E.forEach(function(v,P){!(x.isUndefined(v)||v===null)&&n.append(l===!0?Bn([y],P,u):l===null?y:y+"[]",o(v))}),!1}return Gt(f)?!0:(n.append(Bn(g,y,u),o(f)),!1)}const d=[],p=Object.assign(Ca,{defaultVisitor:i,convertValue:o,isVisitable:Gt});function b(f,y){if(!x.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+y.join("."));d.push(f),x.forEach(f,function(E,A){(!(x.isUndefined(E)||E===null)&&a.call(n,E,x.isString(A)?A.trim():A,y,p))===!0&&b(E,y?y.concat(A):[A])}),d.pop()}}if(!x.isObject(t))throw new TypeError("data must be an object");return b(t),n}function Un(t){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return n[r]})}function on(t,n){this._pairs=[],t&&Tt(t,this,n)}const _s=on.prototype;_s.append=function(n,s){this._pairs.push([n,s])};_s.toString=function(n){const s=n?function(r){return n.call(this,r,Un)}:Un;return this._pairs.map(function(a){return s(a[0])+"="+s(a[1])},"").join("&")};function Sa(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Es(t,n,s){if(!n)return t;const r=s&&s.encode||Sa;x.isFunction(s)&&(s={serialize:s});const a=s&&s.serialize;let u;if(a?u=a(n,s):u=x.isURLSearchParams(n)?n.toString():new on(n,s).toString(r),u){const l=t.indexOf("#");l!==-1&&(t=t.slice(0,l)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}class Wn{constructor(){this.handlers=[]}use(n,s,r){return this.handlers.push({fulfilled:n,rejected:s,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){x.forEach(this.handlers,function(r){r!==null&&n(r)})}}const Rs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_a=typeof URLSearchParams!="undefined"?URLSearchParams:on,Ea=typeof FormData!="undefined"?FormData:null,Ra=typeof Blob!="undefined"?Blob:null,Aa={isBrowser:!0,classes:{URLSearchParams:_a,FormData:Ea,Blob:Ra},protocols:["http","https","file","blob","url","data"]},ln=typeof window!="undefined"&&typeof document!="undefined",Xt=typeof navigator=="object"&&navigator||void 0,Oa=ln&&(!Xt||["ReactNative","NativeScript","NS"].indexOf(Xt.product)<0),Ma=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Pa=ln&&window.location.href||"http://localhost",Da=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:ln,hasStandardBrowserEnv:Oa,hasStandardBrowserWebWorkerEnv:Ma,navigator:Xt,origin:Pa},Symbol.toStringTag,{value:"Module"})),he=ne(ne({},Da),Aa);function ka(t,n){return Tt(t,new he.classes.URLSearchParams,ne({visitor:function(s,r,a,u){return he.isNode&&x.isBuffer(s)?(this.append(r,s.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},n))}function Ta(t){return x.matchAll(/\w+|\[(\w*)]/g,t).map(n=>n[0]==="[]"?"":n[1]||n[0])}function Na(t){const n={},s=Object.keys(t);let r;const a=s.length;let u;for(r=0;r<a;r++)u=s[r],n[u]=t[u];return n}function As(t){function n(s,r,a,u){let l=s[u++];if(l==="__proto__")return!0;const h=Number.isFinite(+l),c=u>=s.length;return l=!l&&x.isArray(a)?a.length:l,c?(x.hasOwnProp(a,l)?a[l]=[a[l],r]:a[l]=r,!h):((!a[l]||!x.isObject(a[l]))&&(a[l]=[]),n(s,r,a[l],u)&&x.isArray(a[l])&&(a[l]=Na(a[l])),!h)}if(x.isFormData(t)&&x.isFunction(t.entries)){const s={};return x.forEachEntry(t,(r,a)=>{n(Ta(r),a,s,0)}),s}return null}function Ia(t,n,s){if(x.isString(t))try{return(n||JSON.parse)(t),x.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(s||JSON.stringify)(t)}const ct={transitional:Rs,adapter:["xhr","http","fetch"],transformRequest:[function(n,s){const r=s.getContentType()||"",a=r.indexOf("application/json")>-1,u=x.isObject(n);if(u&&x.isHTMLForm(n)&&(n=new FormData(n)),x.isFormData(n))return a?JSON.stringify(As(n)):n;if(x.isArrayBuffer(n)||x.isBuffer(n)||x.isStream(n)||x.isFile(n)||x.isBlob(n)||x.isReadableStream(n))return n;if(x.isArrayBufferView(n))return n.buffer;if(x.isURLSearchParams(n))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let h;if(u){if(r.indexOf("application/x-www-form-urlencoded")>-1)return ka(n,this.formSerializer).toString();if((h=x.isFileList(n))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Tt(h?{"files[]":n}:n,c&&new c,this.formSerializer)}}return u||a?(s.setContentType("application/json",!1),Ia(n)):n}],transformResponse:[function(n){const s=this.transitional||ct.transitional,r=s&&s.forcedJSONParsing,a=this.responseType==="json";if(x.isResponse(n)||x.isReadableStream(n))return n;if(n&&x.isString(n)&&(r&&!this.responseType||a)){const l=!(s&&s.silentJSONParsing)&&a;try{return JSON.parse(n,this.parseReviver)}catch(h){if(l)throw h.name==="SyntaxError"?q.from(h,q.ERR_BAD_RESPONSE,this,null,this.response):h}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:he.classes.FormData,Blob:he.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};x.forEach(["delete","get","head","post","put","patch"],t=>{ct.headers[t]={}});const Fa=x.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$a=t=>{const n={};let s,r,a;return t&&t.split(`
`).forEach(function(l){a=l.indexOf(":"),s=l.substring(0,a).trim().toLowerCase(),r=l.substring(a+1).trim(),!(!s||n[s]&&Fa[s])&&(s==="set-cookie"?n[s]?n[s].push(r):n[s]=[r]:n[s]=n[s]?n[s]+", "+r:r)}),n},zn=Symbol("internals");function nt(t){return t&&String(t).trim().toLowerCase()}function _t(t){return t===!1||t==null?t:x.isArray(t)?t.map(_t):String(t)}function La(t){const n=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=s.exec(t);)n[r[1]]=r[2];return n}const Ba=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ht(t,n,s,r,a){if(x.isFunction(r))return r.call(this,n,s);if(a&&(n=s),!!x.isString(n)){if(x.isString(r))return n.indexOf(r)!==-1;if(x.isRegExp(r))return r.test(n)}}function Ua(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,s,r)=>s.toUpperCase()+r)}function Wa(t,n){const s=x.toCamelCase(" "+n);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+s,{value:function(a,u,l){return this[r].call(this,n,a,u,l)},configurable:!0})})}let xe=class{constructor(n){n&&this.set(n)}set(n,s,r){const a=this;function u(h,c,o){const i=nt(c);if(!i)throw new Error("header name must be a non-empty string");const d=x.findKey(a,i);(!d||a[d]===void 0||o===!0||o===void 0&&a[d]!==!1)&&(a[d||c]=_t(h))}const l=(h,c)=>x.forEach(h,(o,i)=>u(o,i,c));if(x.isPlainObject(n)||n instanceof this.constructor)l(n,s);else if(x.isString(n)&&(n=n.trim())&&!Ba(n))l($a(n),s);else if(x.isObject(n)&&x.isIterable(n)){let h={},c,o;for(const i of n){if(!x.isArray(i))throw TypeError("Object iterator must return a key-value pair");h[o=i[0]]=(c=h[o])?x.isArray(c)?[...c,i[1]]:[c,i[1]]:i[1]}l(h,s)}else n!=null&&u(s,n,r);return this}get(n,s){if(n=nt(n),n){const r=x.findKey(this,n);if(r){const a=this[r];if(!s)return a;if(s===!0)return La(a);if(x.isFunction(s))return s.call(this,a,r);if(x.isRegExp(s))return s.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,s){if(n=nt(n),n){const r=x.findKey(this,n);return!!(r&&this[r]!==void 0&&(!s||Ht(this,this[r],r,s)))}return!1}delete(n,s){const r=this;let a=!1;function u(l){if(l=nt(l),l){const h=x.findKey(r,l);h&&(!s||Ht(r,r[h],h,s))&&(delete r[h],a=!0)}}return x.isArray(n)?n.forEach(u):u(n),a}clear(n){const s=Object.keys(this);let r=s.length,a=!1;for(;r--;){const u=s[r];(!n||Ht(this,this[u],u,n,!0))&&(delete this[u],a=!0)}return a}normalize(n){const s=this,r={};return x.forEach(this,(a,u)=>{const l=x.findKey(r,u);if(l){s[l]=_t(a),delete s[u];return}const h=n?Ua(u):String(u).trim();h!==u&&delete s[u],s[h]=_t(a),r[h]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const s=Object.create(null);return x.forEach(this,(r,a)=>{r!=null&&r!==!1&&(s[a]=n&&x.isArray(r)?r.join(", "):r)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,s])=>n+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...s){const r=new this(n);return s.forEach(a=>r.set(a)),r}static accessor(n){const r=(this[zn]=this[zn]={accessors:{}}).accessors,a=this.prototype;function u(l){const h=nt(l);r[h]||(Wa(a,l),r[h]=!0)}return x.isArray(n)?n.forEach(u):u(n),this}};xe.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);x.reduceDescriptors(xe.prototype,({value:t},n)=>{let s=n[0].toUpperCase()+n.slice(1);return{get:()=>t,set(r){this[s]=r}}});x.freezeMethods(xe);function Yt(t,n){const s=this||ct,r=n||s,a=xe.from(r.headers);let u=r.data;return x.forEach(t,function(h){u=h.call(s,u,a.normalize(),n?n.status:void 0)}),a.normalize(),u}function Os(t){return!!(t&&t.__CANCEL__)}function Ge(t,n,s){q.call(this,t==null?"canceled":t,q.ERR_CANCELED,n,s),this.name="CanceledError"}x.inherits(Ge,q,{__CANCEL__:!0});function Ms(t,n,s){const r=s.config.validateStatus;!s.status||!r||r(s.status)?t(s):n(new q("Request failed with status code "+s.status,[q.ERR_BAD_REQUEST,q.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function za(t){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return n&&n[1]||""}function Ha(t,n){t=t||10;const s=new Array(t),r=new Array(t);let a=0,u=0,l;return n=n!==void 0?n:1e3,function(c){const o=Date.now(),i=r[u];l||(l=o),s[a]=c,r[a]=o;let d=u,p=0;for(;d!==a;)p+=s[d++],d=d%t;if(a=(a+1)%t,a===u&&(u=(u+1)%t),o-l<n)return;const b=i&&o-i;return b?Math.round(p*1e3/b):void 0}}function Ya(t,n){let s=0,r=1e3/n,a,u;const l=(o,i=Date.now())=>{s=i,a=null,u&&(clearTimeout(u),u=null),t(...o)};return[(...o)=>{const i=Date.now(),d=i-s;d>=r?l(o,i):(a=o,u||(u=setTimeout(()=>{u=null,l(a)},r-d)))},()=>a&&l(a)]}const At=(t,n,s=3)=>{let r=0;const a=Ha(50,250);return Ya(u=>{const l=u.loaded,h=u.lengthComputable?u.total:void 0,c=l-r,o=a(c),i=l<=h;r=l;const d={loaded:l,total:h,progress:h?l/h:void 0,bytes:c,rate:o||void 0,estimated:o&&h&&i?(h-l)/o:void 0,event:u,lengthComputable:h!=null,[n?"download":"upload"]:!0};t(d)},s)},Hn=(t,n)=>{const s=t!=null;return[r=>n[0]({lengthComputable:s,total:t,loaded:r}),n[1]]},Yn=t=>(...n)=>x.asap(()=>t(...n)),qa=he.hasStandardBrowserEnv?((t,n)=>s=>(s=new URL(s,he.origin),t.protocol===s.protocol&&t.host===s.host&&(n||t.port===s.port)))(new URL(he.origin),he.navigator&&/(msie|trident)/i.test(he.navigator.userAgent)):()=>!0,Va=he.hasStandardBrowserEnv?{write(t,n,s,r,a,u,l){if(typeof document=="undefined")return;const h=[`${t}=${encodeURIComponent(n)}`];x.isNumber(s)&&h.push(`expires=${new Date(s).toUTCString()}`),x.isString(r)&&h.push(`path=${r}`),x.isString(a)&&h.push(`domain=${a}`),u===!0&&h.push("secure"),x.isString(l)&&h.push(`SameSite=${l}`),document.cookie=h.join("; ")},read(t){if(typeof document=="undefined")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Ja(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Qa(t,n){return n?t.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):t}function Ps(t,n,s){let r=!Ja(n);return t&&(r||s==!1)?Qa(t,n):n}const qn=t=>t instanceof xe?ne({},t):t;function Le(t,n){n=n||{};const s={};function r(o,i,d,p){return x.isPlainObject(o)&&x.isPlainObject(i)?x.merge.call({caseless:p},o,i):x.isPlainObject(i)?x.merge({},i):x.isArray(i)?i.slice():i}function a(o,i,d,p){if(x.isUndefined(i)){if(!x.isUndefined(o))return r(void 0,o,d,p)}else return r(o,i,d,p)}function u(o,i){if(!x.isUndefined(i))return r(void 0,i)}function l(o,i){if(x.isUndefined(i)){if(!x.isUndefined(o))return r(void 0,o)}else return r(void 0,i)}function h(o,i,d){if(d in n)return r(o,i);if(d in t)return r(void 0,o)}const c={url:u,method:u,data:u,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:h,headers:(o,i,d)=>a(qn(o),qn(i),d,!0)};return x.forEach(Object.keys(ne(ne({},t),n)),function(i){const d=c[i]||a,p=d(t[i],n[i],i);x.isUndefined(p)&&d!==h||(s[i]=p)}),s}const Ds=t=>{const n=Le({},t);let{data:s,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:u,headers:l,auth:h}=n;if(n.headers=l=xe.from(l),n.url=Es(Ps(n.baseURL,n.url,n.allowAbsoluteUrls),t.params,t.paramsSerializer),h&&l.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),x.isFormData(s)){if(he.hasStandardBrowserEnv||he.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(x.isFunction(s.getHeaders)){const c=s.getHeaders(),o=["content-type","content-length"];Object.entries(c).forEach(([i,d])=>{o.includes(i.toLowerCase())&&l.set(i,d)})}}if(he.hasStandardBrowserEnv&&(r&&x.isFunction(r)&&(r=r(n)),r||r!==!1&&qa(n.url))){const c=a&&u&&Va.read(u);c&&l.set(a,c)}return n},Ka=typeof XMLHttpRequest!="undefined",Ga=Ka&&function(t){return new Promise(function(s,r){const a=Ds(t);let u=a.data;const l=xe.from(a.headers).normalize();let{responseType:h,onUploadProgress:c,onDownloadProgress:o}=a,i,d,p,b,f;function y(){b&&b(),f&&f(),a.cancelToken&&a.cancelToken.unsubscribe(i),a.signal&&a.signal.removeEventListener("abort",i)}let g=new XMLHttpRequest;g.open(a.method.toUpperCase(),a.url,!0),g.timeout=a.timeout;function E(){if(!g)return;const v=xe.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),k={data:!h||h==="text"||h==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:v,config:t,request:g};Ms(function(ee){s(ee),y()},function(ee){r(ee),y()},k),g=null}"onloadend"in g?g.onloadend=E:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(E)},g.onabort=function(){g&&(r(new q("Request aborted",q.ECONNABORTED,t,g)),g=null)},g.onerror=function(P){const k=P&&P.message?P.message:"Network Error",V=new q(k,q.ERR_NETWORK,t,g);V.event=P||null,r(V),g=null},g.ontimeout=function(){let P=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const k=a.transitional||Rs;a.timeoutErrorMessage&&(P=a.timeoutErrorMessage),r(new q(P,k.clarifyTimeoutError?q.ETIMEDOUT:q.ECONNABORTED,t,g)),g=null},u===void 0&&l.setContentType(null),"setRequestHeader"in g&&x.forEach(l.toJSON(),function(P,k){g.setRequestHeader(k,P)}),x.isUndefined(a.withCredentials)||(g.withCredentials=!!a.withCredentials),h&&h!=="json"&&(g.responseType=a.responseType),o&&([p,f]=At(o,!0),g.addEventListener("progress",p)),c&&g.upload&&([d,b]=At(c),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",b)),(a.cancelToken||a.signal)&&(i=v=>{g&&(r(!v||v.type?new Ge(null,t,g):v),g.abort(),g=null)},a.cancelToken&&a.cancelToken.subscribe(i),a.signal&&(a.signal.aborted?i():a.signal.addEventListener("abort",i)));const A=za(a.url);if(A&&he.protocols.indexOf(A)===-1){r(new q("Unsupported protocol "+A+":",q.ERR_BAD_REQUEST,t));return}g.send(u||null)})},Xa=(t,n)=>{const{length:s}=t=t?t.filter(Boolean):[];if(n||s){let r=new AbortController,a;const u=function(o){if(!a){a=!0,h();const i=o instanceof Error?o:this.reason;r.abort(i instanceof q?i:new Ge(i instanceof Error?i.message:i))}};let l=n&&setTimeout(()=>{l=null,u(new q(`timeout ${n} of ms exceeded`,q.ETIMEDOUT))},n);const h=()=>{t&&(l&&clearTimeout(l),l=null,t.forEach(o=>{o.unsubscribe?o.unsubscribe(u):o.removeEventListener("abort",u)}),t=null)};t.forEach(o=>o.addEventListener("abort",u));const{signal:c}=r;return c.unsubscribe=()=>x.asap(h),c}},Za=function*(t,n){let s=t.byteLength;if(s<n){yield t;return}let r=0,a;for(;r<s;)a=r+n,yield t.slice(r,a),r=a},ei=function(t,n){return Wt(this,null,function*(){try{for(var s=Dn(ti(t)),r,a,u;r=!(a=yield new ke(s.next())).done;r=!1){const l=a.value;yield*zt(Za(l,n))}}catch(a){u=[a]}finally{try{r&&(a=s.return)&&(yield new ke(a.call(s)))}finally{if(u)throw u[0]}}})},ti=function(t){return Wt(this,null,function*(){if(t[Symbol.asyncIterator]){yield*zt(t);return}const n=t.getReader();try{for(;;){const{done:s,value:r}=yield new ke(n.read());if(s)break;yield r}}finally{yield new ke(n.cancel())}})},Vn=(t,n,s,r)=>{const a=ei(t,n);let u=0,l,h=o=>{l||(l=!0,r&&r(o))};return new ReadableStream({pull(o){return Y(this,null,function*(){try{const{done:i,value:d}=yield a.next();if(i){h(),o.close();return}let p=d.byteLength;if(s){let b=u+=p;s(b)}o.enqueue(new Uint8Array(d))}catch(i){throw h(i),i}})},cancel(o){return h(o),a.return()}},{highWaterMark:2})},Jn=64*1024,{isFunction:bt}=x,ni=(({Request:t,Response:n})=>({Request:t,Response:n}))(x.global),{ReadableStream:Qn,TextEncoder:Kn}=x.global,Gn=(t,...n)=>{try{return!!t(...n)}catch(s){return!1}},si=t=>{t=x.merge.call({skipUndefined:!0},ni,t);const{fetch:n,Request:s,Response:r}=t,a=n?bt(n):typeof fetch=="function",u=bt(s),l=bt(r);if(!a)return!1;const h=a&&bt(Qn),c=a&&(typeof Kn=="function"?(f=>y=>f.encode(y))(new Kn):f=>Y(void 0,null,function*(){return new Uint8Array(yield new s(f).arrayBuffer())})),o=u&&h&&Gn(()=>{let f=!1;const y=new s(he.origin,{body:new Qn,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!y}),i=l&&h&&Gn(()=>x.isReadableStream(new r("").body)),d={stream:i&&(f=>f.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(f=>{!d[f]&&(d[f]=(y,g)=>{let E=y&&y[f];if(E)return E.call(y);throw new q(`Response type '${f}' is not supported`,q.ERR_NOT_SUPPORT,g)})});const p=f=>Y(void 0,null,function*(){if(f==null)return 0;if(x.isBlob(f))return f.size;if(x.isSpecCompliantForm(f))return(yield new s(he.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(x.isArrayBufferView(f)||x.isArrayBuffer(f))return f.byteLength;if(x.isURLSearchParams(f)&&(f=f+""),x.isString(f))return(yield c(f)).byteLength}),b=(f,y)=>Y(void 0,null,function*(){const g=x.toFiniteNumber(f.getContentLength());return g==null?p(y):g});return f=>Y(void 0,null,function*(){let{url:y,method:g,data:E,signal:A,cancelToken:v,timeout:P,onDownloadProgress:k,onUploadProgress:V,responseType:ee,headers:ue,withCredentials:oe="same-origin",fetchOptions:Z}=Ds(f),C=n||fetch;ee=ee?(ee+"").toLowerCase():"text";let z=Xa([A,v&&v.toAbortSignal()],P),F=null;const M=z&&z.unsubscribe&&(()=>{z.unsubscribe()});let S;try{if(V&&o&&g!=="get"&&g!=="head"&&(S=yield b(ue,E))!==0){let D=new s(y,{method:"POST",body:E,duplex:"half"}),H;if(x.isFormData(E)&&(H=D.headers.get("content-type"))&&ue.setContentType(H),D.body){const[N,K]=Hn(S,At(Yn(V)));E=Vn(D.body,Jn,N,K)}}x.isString(oe)||(oe=oe?"include":"omit");const _=u&&"credentials"in s.prototype,T=me(ne({},Z),{signal:z,method:g.toUpperCase(),headers:ue.normalize().toJSON(),body:E,duplex:"half",credentials:_?oe:void 0});F=u&&new s(y,T);let R=yield u?C(F,Z):C(y,T);const L=i&&(ee==="stream"||ee==="response");if(i&&(k||L&&M)){const D={};["status","statusText","headers"].forEach(ce=>{D[ce]=R[ce]});const H=x.toFiniteNumber(R.headers.get("content-length")),[N,K]=k&&Hn(H,At(Yn(k),!0))||[];R=new r(Vn(R.body,Jn,N,()=>{K&&K(),M&&M()}),D)}ee=ee||"text";let B=yield d[x.findKey(d,ee)||"text"](R,f);return!L&&M&&M(),yield new Promise((D,H)=>{Ms(D,H,{data:B,headers:xe.from(R.headers),status:R.status,statusText:R.statusText,config:f,request:F})})}catch(_){throw M&&M(),_&&_.name==="TypeError"&&/Load failed|fetch/i.test(_.message)?Object.assign(new q("Network Error",q.ERR_NETWORK,f,F),{cause:_.cause||_}):q.from(_,_&&_.code,f,F)}})},ri=new Map,ks=t=>{let n=t&&t.env||{};const{fetch:s,Request:r,Response:a}=n,u=[r,a,s];let l=u.length,h=l,c,o,i=ri;for(;h--;)c=u[h],o=i.get(c),o===void 0&&i.set(c,o=h?new Map:si(n)),i=o;return o};ks();const cn={http:wa,xhr:Ga,fetch:{get:ks}};x.forEach(cn,(t,n)=>{if(t){try{Object.defineProperty(t,"name",{value:n})}catch(s){}Object.defineProperty(t,"adapterName",{value:n})}});const Xn=t=>`- ${t}`,ai=t=>x.isFunction(t)||t===null||t===!1;function ii(t,n){t=x.isArray(t)?t:[t];const{length:s}=t;let r,a;const u={};for(let l=0;l<s;l++){r=t[l];let h;if(a=r,!ai(r)&&(a=cn[(h=String(r)).toLowerCase()],a===void 0))throw new q(`Unknown adapter '${h}'`);if(a&&(x.isFunction(a)||(a=a.get(n))))break;u[h||"#"+l]=a}if(!a){const l=Object.entries(u).map(([c,o])=>`adapter ${c} `+(o===!1?"is not supported by the environment":"is not available in the build"));let h=s?l.length>1?`since :
`+l.map(Xn).join(`
`):" "+Xn(l[0]):"as no adapter specified";throw new q("There is no suitable adapter to dispatch the request "+h,"ERR_NOT_SUPPORT")}return a}const Ts={getAdapter:ii,adapters:cn};function qt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Ge(null,t)}function Zn(t){return qt(t),t.headers=xe.from(t.headers),t.data=Yt.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ts.getAdapter(t.adapter||ct.adapter,t)(t).then(function(r){return qt(t),r.data=Yt.call(t,t.transformResponse,r),r.headers=xe.from(r.headers),r},function(r){return Os(r)||(qt(t),r&&r.response&&(r.response.data=Yt.call(t,t.transformResponse,r.response),r.response.headers=xe.from(r.response.headers))),Promise.reject(r)})}const Ns="1.13.2",Nt={};["object","boolean","number","function","string","symbol"].forEach((t,n)=>{Nt[t]=function(r){return typeof r===t||"a"+(n<1?"n ":" ")+t}});const es={};Nt.transitional=function(n,s,r){function a(u,l){return"[Axios v"+Ns+"] Transitional option '"+u+"'"+l+(r?". "+r:"")}return(u,l,h)=>{if(n===!1)throw new q(a(l," has been removed"+(s?" in "+s:"")),q.ERR_DEPRECATED);return s&&!es[l]&&(es[l]=!0,console.warn(a(l," has been deprecated since v"+s+" and will be removed in the near future"))),n?n(u,l,h):!0}};Nt.spelling=function(n){return(s,r)=>(console.warn(`${r} is likely a misspelling of ${n}`),!0)};function oi(t,n,s){if(typeof t!="object")throw new q("options must be an object",q.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let a=r.length;for(;a-- >0;){const u=r[a],l=n[u];if(l){const h=t[u],c=h===void 0||l(h,u,t);if(c!==!0)throw new q("option "+u+" must be "+c,q.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new q("Unknown option "+u,q.ERR_BAD_OPTION)}}const Et={assertOptions:oi,validators:Nt},Ce=Et.validators;let $e=class{constructor(n){this.defaults=n||{},this.interceptors={request:new Wn,response:new Wn}}request(n,s){return Y(this,null,function*(){try{return yield this._request(n,s)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const u=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?u&&!String(r.stack).endsWith(u.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+u):r.stack=u}catch(l){}}throw r}})}_request(n,s){typeof n=="string"?(s=s||{},s.url=n):s=n||{},s=Le(this.defaults,s);const{transitional:r,paramsSerializer:a,headers:u}=s;r!==void 0&&Et.assertOptions(r,{silentJSONParsing:Ce.transitional(Ce.boolean),forcedJSONParsing:Ce.transitional(Ce.boolean),clarifyTimeoutError:Ce.transitional(Ce.boolean)},!1),a!=null&&(x.isFunction(a)?s.paramsSerializer={serialize:a}:Et.assertOptions(a,{encode:Ce.function,serialize:Ce.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),Et.assertOptions(s,{baseUrl:Ce.spelling("baseURL"),withXsrfToken:Ce.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let l=u&&x.merge(u.common,u[s.method]);u&&x.forEach(["delete","get","head","post","put","patch","common"],f=>{delete u[f]}),s.headers=xe.concat(l,u);const h=[];let c=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(s)===!1||(c=c&&y.synchronous,h.unshift(y.fulfilled,y.rejected))});const o=[];this.interceptors.response.forEach(function(y){o.push(y.fulfilled,y.rejected)});let i,d=0,p;if(!c){const f=[Zn.bind(this),void 0];for(f.unshift(...h),f.push(...o),p=f.length,i=Promise.resolve(s);d<p;)i=i.then(f[d++],f[d++]);return i}p=h.length;let b=s;for(;d<p;){const f=h[d++],y=h[d++];try{b=f(b)}catch(g){y.call(this,g);break}}try{i=Zn.call(this,b)}catch(f){return Promise.reject(f)}for(d=0,p=o.length;d<p;)i=i.then(o[d++],o[d++]);return i}getUri(n){n=Le(this.defaults,n);const s=Ps(n.baseURL,n.url,n.allowAbsoluteUrls);return Es(s,n.params,n.paramsSerializer)}};x.forEach(["delete","get","head","options"],function(n){$e.prototype[n]=function(s,r){return this.request(Le(r||{},{method:n,url:s,data:(r||{}).data}))}});x.forEach(["post","put","patch"],function(n){function s(r){return function(u,l,h){return this.request(Le(h||{},{method:n,headers:r?{"Content-Type":"multipart/form-data"}:{},url:u,data:l}))}}$e.prototype[n]=s(),$e.prototype[n+"Form"]=s(!0)});let li=class Is{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(u){s=u});const r=this;this.promise.then(a=>{if(!r._listeners)return;let u=r._listeners.length;for(;u-- >0;)r._listeners[u](a);r._listeners=null}),this.promise.then=a=>{let u;const l=new Promise(h=>{r.subscribe(h),u=h}).then(a);return l.cancel=function(){r.unsubscribe(u)},l},n(function(u,l,h){r.reason||(r.reason=new Ge(u,l,h),s(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const s=this._listeners.indexOf(n);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const n=new AbortController,s=r=>{n.abort(r)};return this.subscribe(s),n.signal.unsubscribe=()=>this.unsubscribe(s),n.signal}static source(){let n;return{token:new Is(function(a){n=a}),cancel:n}}};function ci(t){return function(s){return t.apply(null,s)}}function di(t){return x.isObject(t)&&t.isAxiosError===!0}const Zt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Zt).forEach(([t,n])=>{Zt[n]=t});function Fs(t){const n=new $e(t),s=ms($e.prototype.request,n);return x.extend(s,$e.prototype,n,{allOwnKeys:!0}),x.extend(s,n,null,{allOwnKeys:!0}),s.create=function(a){return Fs(Le(t,a))},s}const ie=Fs(ct);ie.Axios=$e;ie.CanceledError=Ge;ie.CancelToken=li;ie.isCancel=Os;ie.VERSION=Ns;ie.toFormData=Tt;ie.AxiosError=q;ie.Cancel=ie.CanceledError;ie.all=function(n){return Promise.all(n)};ie.spread=ci;ie.isAxiosError=di;ie.mergeConfig=Le;ie.AxiosHeaders=xe;ie.formToJSON=t=>As(x.isHTMLForm(t)?new FormData(t):t);ie.getAdapter=Ts.getAdapter;ie.HttpStatusCode=Zt;ie.default=ie;const{Axios:Vi,AxiosError:Ji,CanceledError:Qi,isCancel:Ki,CancelToken:Gi,VERSION:Xi,all:Zi,Cancel:eo,isAxiosError:to,spread:no,toFormData:so,AxiosHeaders:ro,HttpStatusCode:ao,formToJSON:io,getAdapter:oo,mergeConfig:lo}=ie,ui="/api",hi=ui,$=ie.create({baseURL:hi});$.interceptors.request.use(t=>{const n=localStorage.getItem("token");return n&&(t.headers=me(ne({},t.headers),{Authorization:`Bearer ${n}`})),t});$.interceptors.response.use(t=>t,t=>{var s;return((s=t==null?void 0:t.response)==null?void 0:s.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("name"),localStorage.removeItem("userId"),typeof window!="undefined"&&window.location.pathname!=="/"&&window.location.assign("/")),Promise.reject(t)});const $s=w.createContext(void 0),fi=({children:t})=>{const[n,s]=w.useState({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!1});w.useEffect(()=>{Y(void 0,null,function*(){const h=localStorage.getItem("token"),c=localStorage.getItem("role"),o=localStorage.getItem("name"),i=localStorage.getItem("userId");if(h)try{const d=yield $.get("/auth/me",{headers:{Authorization:`Bearer ${h}`}}),p=d.data.role;localStorage.setItem("role",p),localStorage.setItem("name",d.data.full_name),localStorage.setItem("userId",d.data.id),s({token:h,role:p,name:d.data.full_name,userId:d.data.id,mustChangePassword:!!d.data.must_change_password,ready:!0});return}catch(d){localStorage.clear(),s({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!0});return}(c||o||i)&&localStorage.clear(),s({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!0})})},[]);const r=()=>Y(void 0,null,function*(){const l=localStorage.getItem("token");if(!l)return;const h=yield $.get("/auth/me",{headers:{Authorization:`Bearer ${l}`}}),c=h.data.role;localStorage.setItem("role",c),localStorage.setItem("name",h.data.full_name),localStorage.setItem("userId",h.data.id),s({token:l,role:c,name:h.data.full_name,userId:h.data.id,mustChangePassword:!!h.data.must_change_password,ready:!0})}),a=(l,h,c,o)=>Y(void 0,null,function*(){const i=yield $.post("/auth/token",{email:l,password:h,mfa_code:c,recovery_code:o}),d=i.data.access_token;localStorage.setItem("token",d);const p=yield $.get("/auth/me",{headers:{Authorization:`Bearer ${d}`}}),b=p.data.role;return localStorage.setItem("role",b),localStorage.setItem("name",p.data.full_name),localStorage.setItem("userId",p.data.id),s({token:d,role:b,name:p.data.full_name,userId:p.data.id,mustChangePassword:!!p.data.must_change_password,ready:!0}),i.data}),u=()=>{localStorage.clear(),s({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!0})};return e.jsx($s.Provider,{value:me(ne({},n),{login:a,logout:u,refreshMe:r}),children:t})},dt=()=>{const t=w.useContext($s);if(!t)throw new Error("useAuth must be used within AuthProvider");return t},mi={new:"default",acknowledged:"primary",in_investigation:"warning",response_drafted:"secondary",final_response_issued:"success",closed:"success",reopened:"default"},pi=t=>t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),Ot=({status:t})=>{const n=typeof t=="string"?t.toLowerCase():t;return e.jsx(ge,{size:"small",label:pi(n),color:mi[n]||"default"})};function xi(){const t=at(),n=rn(),{userId:s}=dt(),[r,a]=w.useState(null),[u,l]=w.useState([]),[h,c]=w.useState("mine"),[o,i]=w.useState(!1),[d,p]=w.useState(!1);w.useEffect(()=>{$.get("/complaints/metrics",{params:{_:Date.now()}}).then(f=>a(f.data)).catch(f=>{var y;((y=f==null?void 0:f.response)==null?void 0:y.status)!==401&&console.error("Failed to load dashboard metrics",f)})},[n.key]),w.useEffect(()=>{if(!s)return;Y(this,null,function*(){var y;p(!0);try{if(h==="mine"){const E=((yield $.get("/complaints",{params:{handler_id:s,page:1,page_size:50,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed");l(Vt(E));return}if(h==="unassigned"){const E=((yield $.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed").filter(A=>!A.assigned_handler_id);l(Vt(E));return}if(h==="breached"){const E=((yield $.get("/complaints",{params:{overdue:!0,page:1,page_size:100,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed");l(Vt(E));return}if(h==="oldest"){const E=((yield $.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed");E.sort((A,v)=>se(A.received_at).valueOf()-se(v.received_at).valueOf()),l(E.slice(0,20));return}}catch(g){if(((y=g==null?void 0:g.response)==null?void 0:y.status)===401)return;console.error("Failed to load dashboard queue",g)}finally{p(!1)}})},[h,s,n.key]);const b=w.useMemo(()=>r!=null&&r.as_of?se(r.as_of).format("DD MMM YYYY HH:mm"):null,[r==null?void 0:r.as_of]);return e.jsxs(te,{children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:1},children:[e.jsx(j,{variant:"h5",children:"Dashboard"}),b&&e.jsxs(j,{variant:"caption",color:"text.secondary",children:["As of ",b]})]}),e.jsxs(O,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(jt,{title:"Open now",value:r==null?void 0:r.kpis.open,subtitle:"All open complaints",onClick:()=>c("oldest")})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(jt,{title:"My open",value:r==null?void 0:r.kpis.my_open,subtitle:"Assigned to you",onClick:()=>c("mine")})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(jt,{title:"SLA breached (open)",value:r==null?void 0:r.kpis.open_sla_breaches,subtitle:"Ack or Final breached",onClick:()=>c("breached")})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(jt,{title:"Stale (21d+)",value:r==null?void 0:r.kpis.open_stale_21d,subtitle:"No activity 21+ days",onClick:()=>c("oldest")})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(wt,{title:"SLA & Aging",children:e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(ae,{sx:{height:"100%"},children:e.jsxs(le,{children:[e.jsx(j,{variant:"subtitle2",children:"SLA performance (30d)"}),e.jsxs(W,{spacing:1.5,sx:{mt:1},children:[e.jsx(ts,{label:"Ack",item:r.sla_30d.ack}),e.jsx(ts,{label:"Final",item:r.sla_30d.final})]})]})})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(ae,{sx:{height:"100%"},children:e.jsxs(le,{children:[e.jsx(j,{variant:"subtitle2",children:"Aging (open)"}),e.jsxs(W,{spacing:1.2,sx:{mt:1},children:[e.jsx(vt,{label:"07 days",value:r.aging_open["0-7"],total:r.kpis.open}),e.jsx(vt,{label:"821 days",value:r.aging_open["8-21"],total:r.kpis.open}),e.jsx(vt,{label:"2256 days",value:r.aging_open["22-56"],total:r.kpis.open}),e.jsx(vt,{label:"56+ days",value:r.aging_open["56+"],total:r.kpis.open})]})]})})})]})}),e.jsx(wt,{title:"Workload",children:e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(ae,{sx:{height:"100%"},children:e.jsxs(le,{children:[e.jsx(j,{variant:"subtitle2",children:"Open by handler"}),e.jsx(W,{spacing:.75,sx:{mt:1},children:r.workload_open_by_handler.slice(0,6).map(f=>e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(j,{variant:"body2",children:f.name}),e.jsx(j,{variant:"body2",fontWeight:700,children:f.count})]},f.id))})]})})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(ae,{sx:{height:"100%"},children:e.jsxs(le,{children:[e.jsx(j,{variant:"subtitle2",children:"Flow (last 7d)"}),e.jsxs(W,{direction:"row",spacing:2,sx:{mt:1},children:[e.jsx(ns,{label:"New",value:r.flow_7d.new}),e.jsx(ns,{label:"Closed",value:r.flow_7d.closed})]}),e.jsx(j,{variant:"subtitle2",sx:{mt:2},children:"Open status"}),e.jsx(W,{spacing:.6,sx:{mt:1},children:Object.entries(r.status_open).sort((f,y)=>y[1]-f[1]).slice(0,6).map(([f,y])=>e.jsxs(W,{direction:"row",justifyContent:"space-between",children:[e.jsx(j,{variant:"body2",children:f.replace(/_/g," ")}),e.jsx(j,{variant:"body2",fontWeight:700,children:y})]},f))})]})})})]})}),e.jsx(wt,{title:"Risk & Compliance",children:e.jsx(ae,{children:e.jsxs(le,{children:[e.jsxs(O,{container:!0,spacing:2,children:[e.jsxs(O,{item:!0,xs:12,md:3,children:[e.jsx(j,{variant:"subtitle2",children:"Vulnerable (open)"}),e.jsx(j,{variant:"h5",children:r.risk.open_vulnerable.count}),e.jsx(j,{variant:"caption",color:"text.secondary",children:Rt(r.risk.open_vulnerable.pct_of_open)})]}),e.jsxs(O,{item:!0,xs:12,md:3,children:[e.jsx(j,{variant:"subtitle2",children:"Escalated (open)"}),e.jsx(j,{variant:"h5",children:r.risk.escalated_open}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"Current open escalations"})]}),e.jsxs(O,{item:!0,xs:12,md:3,children:[e.jsx(j,{variant:"subtitle2",children:"Reopened (all time)"}),e.jsx(j,{variant:"h5",children:r.risk.reopened.count}),e.jsx(j,{variant:"caption",color:"text.secondary",children:Rt(r.risk.reopened.pct_all_time)})]}),e.jsxs(O,{item:!0,xs:12,md:3,children:[e.jsx(j,{variant:"subtitle2",children:"Final attachments (open)"}),e.jsx(j,{variant:"h5",children:Rt(r.risk.final_attachment_open_pct)}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"Coverage on open cases"})]})]}),e.jsxs(pr,{in:o,unmountOnExit:!0,children:[e.jsx(us,{sx:{my:2}}),e.jsx(j,{variant:"subtitle2",children:"Notes"}),e.jsx(j,{variant:"body2",color:"text.secondary",children:"Stale means no communications in 21+ days (or received date if no comms)."})]}),e.jsx(I,{size:"small",onClick:()=>i(f=>!f),sx:{mt:1},children:o?"Hide details":"View details"})]})})}),e.jsx(wt,{title:"My Queue",children:e.jsxs(ae,{children:[e.jsx(le,{sx:{pb:1},children:e.jsxs(hs,{value:h,onChange:(f,y)=>c(y),variant:"scrollable",scrollButtons:"auto",children:[e.jsx(Pe,{value:"mine",label:"Assigned to me"}),e.jsx(Pe,{value:"unassigned",label:"Unassigned"}),e.jsx(Pe,{value:"breached",label:"SLA breached"}),e.jsx(Pe,{value:"oldest",label:"Oldest open"})]})}),d&&e.jsx(en,{}),e.jsxs(Ct,{dense:!0,children:[!d&&u.length===0&&e.jsx(Ne,{children:e.jsx(Ie,{primary:"No items"})}),u.map(f=>{var y,g;return e.jsxs(Ne,{button:!0,onClick:()=>t(`/complaints/${f.id}`),children:[e.jsx(Ie,{primary:`${f.reference} - ${(g=(y=f.complainant)==null?void 0:y.full_name)!=null?g:"Unknown"}`,secondary:gi(f)}),e.jsxs(W,{direction:"row",spacing:1,alignItems:"center",children:[f.ack_breached||f.final_breached?e.jsx(ge,{size:"small",label:"Breach"}):null,e.jsx(Ot,{status:f.status})]})]},f.id)})]})]})})]})]})}function jt({title:t,value:n,subtitle:s,onClick:r}){const a=e.jsxs(le,{children:[e.jsx(j,{variant:"subtitle2",children:t}),e.jsx(j,{variant:"h4",children:n!=null?n:""}),s&&e.jsx(j,{variant:"caption",color:"text.secondary",children:s})]});return e.jsx(ae,{sx:{height:"100%"},children:r?e.jsx(xr,{onClick:r,sx:{height:"100%"},children:a}):a})}function wt({title:t,children:n}){return e.jsxs(te,{sx:{mb:3},children:[e.jsxs(W,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[e.jsx(j,{variant:"subtitle1",children:t}),e.jsx(us,{sx:{flexGrow:1}})]}),n]})}function ts({label:t,item:n}){const s=n.on_time_pct;return e.jsxs(te,{children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",children:[e.jsx(j,{variant:"body2",fontWeight:700,children:t}),e.jsx(j,{variant:"body2",color:"text.secondary",children:n.total>0?`${n.on_time}/${n.total}`:""})]}),e.jsx(W,{direction:"row",justifyContent:"space-between",sx:{mt:.3},children:e.jsx(j,{variant:"body1",children:Rt(s)})}),e.jsx(en,{variant:"determinate",value:s!=null?s:0,sx:{mt:.6}})]})}function vt({label:t,value:n,total:s}){const r=s>0?n/s*100:0;return e.jsxs(te,{children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",children:[e.jsx(j,{variant:"body2",children:t}),e.jsx(j,{variant:"body2",fontWeight:700,children:n})]}),e.jsx(en,{variant:"determinate",value:r,sx:{mt:.5}})]})}function ns({label:t,value:n}){return e.jsxs(te,{children:[e.jsx(j,{variant:"subtitle2",children:t}),e.jsx(j,{variant:"h5",children:n})]})}function Rt(t){return t!=null?`${t.toFixed(0)}%`:""}function gi(t){const n=t.received_at?se(t.received_at).format("DD MMM YYYY"):"";return[t.product?t.product:"",`Received ${n}`].filter(Boolean).join("  ")}function Vt(t){return[...t].sort((n,s)=>{const r=n.ack_breached||n.final_breached?1:0,a=s.ack_breached||s.final_breached?1:0;return r!==a?a-r:se(n.received_at).valueOf()-se(s.received_at).valueOf()})}const yi=["New","Acknowledged","In Investigation","Response Drafted","Final Response Issued","Closed","Reopened"];function bi(){const[t,n]=w.useState([]),[s,r]=w.useState([]),[a,u]=w.useState(""),[l,h]=w.useState(""),c=at(),o=()=>{$.get("/complaints",{params:{status_filter:a||void 0,search:l||void 0}}).then(i=>n(i.data))};return w.useEffect(()=>{o(),$.get("/users").then(i=>r(i.data))},[]),e.jsxs(te,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Complaints"}),e.jsx(ae,{sx:{mb:2},children:e.jsx(le,{children:e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(U,{select:!0,label:"Status",fullWidth:!0,size:"small",value:a,onChange:i=>u(i.target.value),children:[e.jsx(G,{value:"",children:"All"}),yi.map(i=>e.jsx(G,{value:i,children:i},i))]})}),e.jsx(O,{item:!0,xs:12,md:5,children:e.jsx(U,{label:"Search ref / policy / name",fullWidth:!0,size:"small",value:l,onChange:i=>h(i.target.value)})}),e.jsxs(O,{item:!0,xs:12,md:4,display:"flex",alignItems:"center",gap:1,children:[e.jsx(I,{variant:"contained",onClick:o,children:"Apply"}),e.jsx(I,{component:Me,to:"/complaints/new",children:"New complaint"})]})]})})}),e.jsx(ae,{children:e.jsxs(tn,{size:"small",children:[e.jsx(nn,{children:e.jsxs(Re,{children:[e.jsx(Q,{children:"Reference"}),e.jsx(Q,{children:"Complainant"}),e.jsx(Q,{children:"Product"}),e.jsx(Q,{children:"Handler"}),e.jsx(Q,{children:"Received"}),e.jsx(Q,{children:"Status"}),e.jsx(Q,{children:"Due (Final)"})]})}),e.jsx(sn,{children:t.map(i=>{var d;return e.jsxs(Re,{hover:!0,sx:{cursor:"pointer"},onClick:()=>c(`/complaints/${i.id}`),children:[e.jsx(Q,{children:i.reference}),e.jsx(Q,{children:(d=i.complainant)==null?void 0:d.full_name}),e.jsx(Q,{children:i.product}),e.jsx(Q,{children:i.assigned_handler_name||"Unassigned"}),e.jsx(Q,{children:se(i.received_at).format("DD MMM YYYY")}),e.jsx(Q,{children:e.jsx(Ot,{status:i.status})}),e.jsx(Q,{children:se(i.final_due_at).format("DD MMM YYYY")})]},i.id)})})]})})]})}const ss=[{value:"financial_loss",label:"Financial Loss (Direct Loss)"},{value:"interest_on_financial_loss",label:"Interest on Financial Loss"},{value:"distress_and_inconvenience",label:"Distress and Inconvenience"},{value:"consequential_loss",label:"Consequential Loss"},{value:"premium_refund_adjustment",label:"Premium Refund / Adjustment"},{value:"goodwill_payment",label:"Goodwill Payment"},{value:"third_party_payment",label:"Third-Party Payment"},{value:"apology_or_explanation",label:"Apology / Explanation (Non-monetary)"},{value:"remedial_action",label:"Remedial Action (Non-monetary)"}],rs=["financial_loss","interest_on_financial_loss","distress_and_inconvenience","consequential_loss","premium_refund_adjustment","goodwill_payment","third_party_payment"],ji="/api",as=ji.replace(/\/api$/,"");function wi(){var Rn,An;const{id:t}=Dr(),n=at(),[s,r]=w.useState(null),[a,u]=w.useState(0),{role:l,name:h,userId:c}=dt(),[o,i]=w.useState("email"),[d,p]=w.useState("outbound"),[b,f]=w.useState(""),[y,g]=w.useState(se().format("YYYY-MM-DDTHH:mm")),[E,A]=w.useState(null),[v,P]=w.useState(!1),[k,V]=w.useState(!1),[ee,ue]=w.useState("upheld"),[oe,Z]=w.useState(""),[C,z]=w.useState(!1),[F,M]=w.useState(""),[S,_]=w.useState("goodwill_payment"),[T,R]=w.useState("pending"),[L,B]=w.useState(""),[D,H]=w.useState(""),[N,K]=w.useState(""),[ce,Se]=w.useState("not_started"),[we,Ae]=w.useState(!1),[ve,de]=w.useState(!1),[ye,_e]=w.useState(null),[Ue,dn]=w.useState(!1),[un,hn]=w.useState(""),[It,fn]=w.useState(se().format("YYYY-MM-DD")),[mn,pn]=w.useState(!1),[We,Ws]=w.useState([]),[ut,Ft]=w.useState(""),[Xe,ht]=w.useState(!1),[zs,ft]=w.useState(!1),[mt,xn]=w.useState(""),[pt,gn]=w.useState(!1),[Hs,xt]=w.useState(!1),[$t,yn]=w.useState(!1),[bn,jn]=w.useState(!1),[Ys,Ze]=w.useState(!1),[gt,qs]=w.useState("standard"),[et,Vs]=w.useState(se().format("YYYY-MM-DD")),[Lt,Bt]=w.useState(""),[wn,yt]=w.useState(null),Ee=rs.includes(S),Js=m=>{var J;return((J=ss.find(X=>X.value===m))==null?void 0:J.label)||m},[vn,Qs]=w.useState([]),Cn=(m,J)=>Y(this,null,function*(){s&&(yield $.patch(`/complaints/${s.id}/redress/${m}`,J),fe())}),Sn=(Rn=s==null?void 0:s.communications)!=null&&Rn.length?s.communications.map(m=>m.occurred_at).sort().slice(-1)[0]:null,fe=()=>{$.get(`/complaints/${t}`,{params:{_:Date.now()}}).then(m=>r(m.data)),$.get(`/complaints/${t}/events`).then(m=>Qs(m.data))};w.useEffect(()=>{fe()},[t]),w.useEffect(()=>{l&&l!=="read_only"&&$.get("/users").then(m=>Ws(m.data))},[l]);const _n=m=>Y(this,null,function*(){yield $.post(`/complaints/${t}/${m}`),fe()}),Ks=()=>Y(this,null,function*(){if(s){z(!0);try{yield $.post(`/complaints/${s.id}/outcome`,{outcome:ee,notes:oe||null}),fe()}finally{z(!1)}}}),Gs=()=>Y(this,null,function*(){var J,X;if(!s)return;const m=Ee;if(!(m&&F==="")&&!(m&&!D.trim())&&!(!m&&!N.trim())){de(!0);try{yield $.post(`/complaints/${s.id}/redress`,{amount:m?Number(F):null,payment_type:S,status:m?T:"pending",notes:L||null,outcome_id:(X=(J=s.outcome)==null?void 0:J.id)!=null?X:null,rationale:D||null,action_description:N||null,action_status:ce,approved:m?we:!1}),M(""),B(""),_("goodwill_payment"),R("pending"),H(""),K(""),Se("not_started"),Ae(!1),fe()}finally{de(!1)}}}),Xs=()=>Y(this,null,function*(){var J,X;if(!s||!b||k&&!s.outcome)return;P(!0);const m=new FormData;m.append("channel",o),m.append("direction",d),m.append("summary",b),m.append("occurred_at",new Date(y).toISOString()),m.append("is_final_response",String(k)),E&&Array.from(E).forEach(re=>m.append("files",re));try{yield $.post(`/complaints/${s.id}/communications`,m),f(""),A(null),g(se().format("YYYY-MM-DDTHH:mm")),V(!1),fe()}catch(re){console.error("Failed to add communication",re);let Oe="Failed to add communication";if((X=(J=re==null?void 0:re.response)==null?void 0:J.data)!=null&&X.detail){const be=re.response.data.detail;Array.isArray(be)?Oe=be.map(tt=>{var On;const or=((On=tt.loc)==null?void 0:On.join("."))||"field",lr=tt.msg||"validation error";return`${or}: ${lr}`}).join(`
`):typeof be=="string"?Oe=be:Oe=JSON.stringify(be)}else re!=null&&re.message&&(Oe=re.message);alert(`Error: ${Oe}`)}finally{P(!1)}}),Zs=()=>Y(this,null,function*(){if(s){pn(!0);try{yield $.post(`/complaints/${s.id}/reopen`,{reason:un||null,reopened_at:It?new Date(It).toISOString():null}),dn(!1),hn(""),fn(se().format("YYYY-MM-DD")),fe()}finally{pn(!1)}}}),er=()=>{var X;const m=We.filter(re=>re.role==="complaints_manager"),J=(s!=null&&s.assigned_handler_id&&m.some(re=>re.id===s.assigned_handler_id)?s.assigned_handler_id:(X=m[0])==null?void 0:X.id)||"";xn(J),ft(!0)},tr=()=>Y(this,null,function*(){if(!(!s||!mt)){ht(!0);try{yield $.post(`/complaints/${s.id}/escalate`,{manager_id:mt}),ft(!1),fe()}finally{ht(!1)}}}),nr=()=>Y(this,null,function*(){if(s){ht(!0);try{yield $.patch(`/complaints/${s.id}`,{is_escalated:!1}),fe()}finally{ht(!1)}}}),sr=()=>Y(this,null,function*(){ut&&(yield $.post(`/complaints/${t}/assign`,null,{params:{handler_id:ut}}),Ft(""),fe())}),rr=()=>Y(this,null,function*(){var m,J;gn(!0),yt(null);try{yield $.post(`/complaints/${t}/close-non-reportable`,{closed_at:et?new Date(et).toISOString():null,comment:Lt||null}),Ze(!1),Bt(""),fe()}catch(X){const re=(J=(m=X==null?void 0:X.response)==null?void 0:m.data)==null?void 0:J.detail;yt(re||"Could not close as non-reportable")}finally{gn(!1)}}),ar=()=>Y(this,null,function*(){var m,J;jn(!0),yt(null);try{yield $.post(`/complaints/${t}/close`,{closed_at:et?new Date(et).toISOString():null,comment:Lt||null}),Ze(!1),Bt(""),fe()}catch(X){const re=(J=(m=X==null?void 0:X.response)==null?void 0:m.data)==null?void 0:J.detail;yt(re||"Could not close complaint")}finally{jn(!1)}}),En=m=>{qs(m),Ze(!0)},ir=()=>Y(this,null,function*(){var m,J;if(t){yn(!0);try{yield $.delete(`/complaints/${t}`),n("/complaints")}catch(X){console.error("Failed to delete complaint",X),alert(((J=(m=X==null?void 0:X.response)==null?void 0:m.data)==null?void 0:J.detail)||"Failed to delete complaint")}finally{yn(!1),xt(!1)}}});return s?e.jsxs(te,{children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs("div",{children:[e.jsx(j,{variant:"h5",children:s.reference}),e.jsx(j,{variant:"subtitle1",children:s.complainant.full_name})]}),e.jsx(Ot,{status:s.status})]}),e.jsxs(O,{container:!0,spacing:2,mb:2,children:[e.jsx(O,{item:!0,children:e.jsx(ge,{label:`Product: ${s.product||"n/a"}`})}),e.jsx(O,{item:!0,children:e.jsx(ge,{label:`Policy: ${s.policy_number||"n/a"}`})}),s.vulnerability_flag&&e.jsx(O,{item:!0,children:e.jsx(ge,{color:"warning",label:"Vulnerable"})})]}),e.jsxs(W,{direction:"row",spacing:1,mb:2,children:[e.jsx(I,{variant:"contained",size:"small",disabled:l==="read_only",onClick:()=>_n("acknowledge"),children:"Acknowledge"}),e.jsx(I,{variant:"outlined",size:"small",disabled:l==="read_only",onClick:()=>_n("investigate"),children:"Move to investigation"}),e.jsx(I,{variant:"outlined",size:"small",disabled:l==="read_only",onClick:()=>En("standard"),children:"Close"}),e.jsx(I,{variant:"outlined",size:"small",color:"warning",disabled:l==="read_only"||pt,onClick:()=>En("non_reportable"),children:pt?"Closing...":"Close as non-reportable"}),(s==null?void 0:s.status)==="closed"&&e.jsx(I,{variant:"outlined",size:"small",disabled:l==="read_only",onClick:()=>dn(m=>!m),children:"Reopen"}),e.jsx(I,{variant:"outlined",size:"small",color:"secondary",disabled:l==="read_only"||Xe||We.filter(m=>m.role==="complaints_manager").length===0,onClick:er,children:s.is_escalated?"Change escalation":"Escalate"}),s.is_escalated&&e.jsx(I,{variant:"text",size:"small",color:"inherit",onClick:nr,disabled:l==="read_only"||Xe,children:"Remove escalation"}),l==="admin"&&e.jsxs(W,{direction:"row",spacing:1,alignItems:"center",sx:{ml:{xs:0,md:2}},children:[e.jsxs(U,{select:!0,size:"small",label:"Assign handler",value:ut||s.assigned_handler_id||"",onChange:m=>Ft(m.target.value),sx:{minWidth:200},children:[e.jsx(G,{value:"",children:"(Unassigned)"}),We.map(m=>e.jsx(G,{value:m.id,children:m.full_name},m.id))]}),e.jsx(I,{variant:"contained",size:"small",onClick:sr,disabled:!ut,children:"Assign"}),e.jsx(I,{variant:"outlined",size:"small",onClick:()=>{const m=We.find(J=>J.full_name===h);m&&(Ft(m.id),$.post(`/complaints/${t}/assign`,null,{params:{handler_id:m.id}}).then(fe))},disabled:!We.length,children:"Assign to me"}),e.jsx(I,{variant:"outlined",size:"small",color:"error",onClick:()=>xt(!0),children:"Delete"})]}),l==="complaints_handler"&&!s.assigned_handler_id&&c&&e.jsx(I,{variant:"outlined",size:"small",onClick:()=>$.post(`/complaints/${t}/assign`,null,{params:{handler_id:c}}).then(fe),children:"Assign to me"})]}),Ue&&(s==null?void 0:s.status)==="closed"&&e.jsx(ae,{sx:{mb:2},children:e.jsxs(le,{children:[e.jsx(j,{variant:"subtitle2",children:"Reopen complaint"}),e.jsx(j,{variant:"caption",color:"text.secondary",children:"Leave the date blank to use today's date."}),e.jsxs(O,{container:!0,spacing:2,mt:1,children:[e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{fullWidth:!0,label:"Reason for reopen",multiline:!0,minRows:3,value:un,onChange:m=>hn(m.target.value)})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(U,{fullWidth:!0,label:"Reopen date",type:"date",value:It,onChange:m=>fn(m.target.value),helperText:"Blank = today"})}),e.jsx(O,{item:!0,xs:12,md:3,display:"flex",alignItems:"center",children:e.jsx(I,{variant:"contained",onClick:Zs,disabled:mn,children:mn?"Reopening...":"Confirm reopen"})})]})]})}),e.jsxs(hs,{value:a,onChange:(m,J)=>u(J),sx:{mb:2},children:[e.jsx(Pe,{label:"Overview"}),e.jsx(Pe,{label:"Communications"}),e.jsx(Pe,{label:"Outcome / Redress"}),e.jsx(Pe,{label:"History"})]}),a===0&&e.jsx(ae,{children:e.jsx(le,{sx:{p:3},children:e.jsxs(W,{spacing:3,children:[e.jsxs(W,{direction:"row",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",rowGap:1,children:[e.jsxs(te,{children:[e.jsx(j,{variant:"overline",color:"text.secondary",sx:{letterSpacing:.6},children:"Overview"}),e.jsxs(j,{variant:"h6",sx:{fontWeight:700,mt:.5},children:[s.reference,"  ",s.complainant.full_name]}),e.jsxs(j,{variant:"body2",color:"text.secondary",children:["Received ",se(s.received_at).format("DD MMM YYYY"),"  Source ",s.source||"n/a"]})]}),e.jsxs(W,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ot,{status:s.status}),s.vulnerability_flag&&e.jsx(ge,{size:"small",color:"warning",label:"Vulnerable"}),s.is_escalated&&e.jsx(ge,{size:"small",color:"error",label:"Escalated"}),s.ack_breached&&e.jsx(ge,{size:"small",color:"error",label:"Ack SLA breached"}),s.final_breached&&e.jsx(ge,{size:"small",color:"error",label:"Final SLA breached"})]})]}),e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:8,children:e.jsx(te,{sx:{p:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e5e7eb",minHeight:140},children:e.jsx(j,{variant:"body1",sx:{lineHeight:1.6},children:s.description})})}),e.jsx(O,{item:!0,xs:12,md:4,children:e.jsx(te,{sx:{p:2,borderRadius:2,background:"#0f4c81",color:"#f8fafc",height:"100%"},children:e.jsxs(W,{spacing:1,children:[e.jsxs(j,{variant:"body1",children:["Ack due: ",se(s.ack_due_at).format("DD MMM YYYY")]}),e.jsxs(j,{variant:"body1",children:["Final due: ",se(s.final_due_at).format("DD MMM YYYY")]}),e.jsxs(j,{variant:"body2",sx:{mt:1,color:"rgba(255,255,255,0.8)"},children:["Last updated: ",Sn?se(Sn).format("DD MMM YYYY HH:mm"):"No communications"]})]})})})]}),e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(te,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(j,{variant:"caption",color:"text.secondary",children:"Product"}),e.jsx(j,{variant:"body1",children:s.product||"n/a"})]})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(te,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(j,{variant:"caption",color:"text.secondary",children:"Policy"}),e.jsx(j,{variant:"body1",children:s.policy_number||"n/a"})]})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(te,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(j,{variant:"caption",color:"text.secondary",children:"Broker / Insurer"}),e.jsx(j,{variant:"body1",children:s.broker||"n/a"}),e.jsx(j,{variant:"body2",color:"text.secondary",children:s.insurer||""})]})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(te,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(j,{variant:"caption",color:"text.secondary",children:"Category / Reason"}),e.jsxs(j,{variant:"body1",children:[s.category||"n/a",s.reason?`  ${s.reason}`:""]})]})})]})]})})}),a===1&&e.jsxs(W,{spacing:2.5,children:[e.jsx(ae,{children:e.jsxs(le,{sx:{p:3},children:[e.jsx(j,{variant:"subtitle2",gutterBottom:!0,children:"Add communication"}),e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(U,{select:!0,fullWidth:!0,label:"Channel",value:o,onChange:m=>i(m.target.value),children:[{value:"phone",label:"Phone call"},{value:"email",label:"Email"},{value:"letter",label:"Letter"},{value:"web",label:"Web"},{value:"third_party",label:"Third party"},{value:"other",label:"Other"}].map(m=>e.jsx(G,{value:m.value,children:m.label},m.value))})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Direction",value:d,onChange:m=>p(m.target.value),children:[e.jsx(G,{value:"outbound",children:"Outbound"}),e.jsx(G,{value:"inbound",children:"Inbound"})]})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{fullWidth:!0,label:"When",type:"datetime-local",value:y,onChange:m=>g(m.target.value)})}),e.jsx(O,{item:!0,xs:12,children:e.jsx(U,{fullWidth:!0,multiline:!0,minRows:3,label:"Summary",value:b,onChange:m=>f(m.target.value)})}),e.jsxs(O,{item:!0,xs:12,md:6,display:"flex",alignItems:"center",children:[e.jsx(rt,{control:e.jsx(kn,{checked:k,onChange:m=>V(m.target.checked),disabled:!s.outcome}),label:"This is the final response"}),!s.outcome&&e.jsx(j,{variant:"caption",color:"text.secondary",sx:{ml:1},children:"Record an outcome first."})]}),e.jsxs(O,{item:!0,xs:12,md:6,display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsxs(I,{variant:"outlined",component:"label",size:"small",children:["Attach files",e.jsx("input",{hidden:!0,multiple:!0,type:"file",onChange:m=>A(m.target.files)})]}),E&&E.length>0&&e.jsxs(j,{variant:"caption",sx:{ml:1},children:[E.length," file(s) selected"]})]}),e.jsx(O,{item:!0,xs:12,children:e.jsx(I,{variant:"contained",onClick:Xs,disabled:v||!b||k&&!s.outcome,children:v?"Saving...":"Add communication"})})]})]})}),e.jsx(ae,{children:e.jsx(le,{sx:{p:0},children:e.jsxs(Ct,{dense:!0,children:[(An=s.communications)==null?void 0:An.map(m=>e.jsxs(Ne,{alignItems:"flex-start",sx:{borderBottom:"1px solid #e5e7eb",py:1.5,px:2},children:[e.jsx(Ie,{primaryTypographyProps:{sx:{fontWeight:600}},primary:`${m.direction} ${m.channel}`,secondary:e.jsxs(W,{spacing:.5,sx:{mt:.5},children:[e.jsx(j,{variant:"body2",color:"text.primary",children:m.summary}),e.jsx(j,{variant:"caption",color:"text.secondary",children:se(m.occurred_at).format("DD MMM YYYY HH:mm")})]})}),e.jsxs(W,{direction:"row",spacing:1,alignItems:"center",children:[m.is_final_response&&e.jsx(ge,{size:"small",color:"success",label:"Final response"}),m.attachments&&m.attachments.length>0&&e.jsx(W,{direction:"row",spacing:1,children:m.attachments.map(J=>e.jsx(I,{size:"small",component:"a",href:`${as}${J.url}`,target:"_blank",rel:"noreferrer",children:J.file_name},J.id))})]})]},m.id)),(!s.communications||s.communications.length===0)&&e.jsx(Ne,{sx:{py:2,px:2},children:e.jsx(Ie,{primary:"No communications recorded"})})]})})})]}),a===2&&e.jsxs(W,{spacing:2.5,children:[e.jsx(ae,{children:e.jsxs(le,{sx:{p:3},children:[e.jsx(j,{variant:"subtitle2",gutterBottom:!0,children:"Outcome"}),e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:4,children:e.jsx(U,{select:!0,fullWidth:!0,label:"Outcome",value:ee,onChange:m=>ue(m.target.value),children:[["upheld","Upheld"],["partially_upheld","Partially upheld"],["not_upheld","Not upheld"],["withdrawn","Withdrawn"],["out_of_scope","Out of scope"]].map(([m,J])=>e.jsx(G,{value:m,children:J},m))})}),e.jsx(O,{item:!0,xs:12,md:8,children:e.jsx(U,{fullWidth:!0,label:"Outcome notes",multiline:!0,minRows:3,value:oe,onChange:m=>Z(m.target.value)})}),e.jsxs(O,{item:!0,xs:12,children:[e.jsx(I,{variant:"contained",size:"small",onClick:Ks,disabled:C,children:C?"Saving...":"Save outcome"}),s.outcome&&e.jsxs(j,{variant:"body2",sx:{ml:2},component:"span",children:["Current: ",s.outcome.outcome]})]})]})]})}),e.jsx(ae,{children:e.jsxs(le,{sx:{p:3},children:[e.jsx(j,{variant:"subtitle2",gutterBottom:!0,children:"Redress"}),e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(U,{select:!0,fullWidth:!0,label:"Redress type",value:S,onChange:m=>_(m.target.value),children:ss.map(m=>e.jsx(G,{value:m.value,children:m.label},m.value))})}),Ee&&e.jsx(O,{item:!0,xs:12,md:3,children:e.jsx(U,{type:"number",fullWidth:!0,label:"Amount (monetary)",value:F,onChange:m=>M(m.target.value===""?"":Number(m.target.value))})}),Ee&&e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{fullWidth:!0,label:"Rationale (monetary)",multiline:!0,minRows:2,value:D,onChange:m=>H(m.target.value),helperText:"Required for monetary redress"})}),!Ee&&e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{fullWidth:!0,label:"Action description (non-monetary)",multiline:!0,minRows:2,value:N,onChange:m=>K(m.target.value),helperText:"Required for non-monetary redress"})}),Ee&&e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Status",value:T,onChange:m=>R(m.target.value),children:[e.jsx(G,{value:"pending",children:"Pending"}),e.jsx(G,{value:"authorised",children:"Authorised"}),e.jsx(G,{value:"paid",children:"Paid"})]})}),e.jsx(O,{item:!0,xs:12,md:3,children:e.jsxs(U,{select:!0,fullWidth:!0,label:"Action status",value:ce,onChange:m=>Se(m.target.value),children:[e.jsx(G,{value:"not_started",children:"Not Started"}),e.jsx(G,{value:"in_progress",children:"In Progress"}),e.jsx(G,{value:"completed",children:"Completed"})]})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{fullWidth:!0,label:"Notes",multiline:!0,minRows:3,value:L,onChange:m=>B(m.target.value)})}),Ee&&e.jsx(O,{item:!0,xs:12,md:3,display:"flex",alignItems:"center",children:e.jsx(rt,{control:e.jsx(kn,{checked:we,onChange:m=>Ae(m.target.checked)}),label:"Approved"})}),e.jsx(O,{item:!0,xs:12,children:e.jsx(I,{variant:"contained",size:"small",onClick:Gs,disabled:ve||Ee&&F===""||Ee&&!D.trim()||!Ee&&!N.trim(),children:ve?"Saving...":"Add redress"})})]}),s.redress_payments&&s.redress_payments.length>0?e.jsx(Ct,{dense:!0,sx:{mt:2},children:s.redress_payments.map(m=>e.jsxs(Ne,{alignItems:"flex-start",onClick:()=>_e(m.id),sx:{borderBottom:"1px solid #e5e7eb",py:1.5,px:0,cursor:"pointer"},children:[ye===m.id&&e.jsx(j,{variant:"caption",color:"text.secondary",sx:{position:"absolute",top:8,right:0},children:"Tap to select status"}),e.jsx(Ie,{primaryTypographyProps:{sx:{fontWeight:600}},secondaryTypographyProps:{component:"div"},primary:`${Js(m.payment_type)}${m.amount?`  ${m.amount}`:""}`,secondary:e.jsxs(W,{component:"div",spacing:.5,sx:{mt:.5},children:[rs.includes(m.payment_type)?ye===m.id?e.jsxs(Tn,{size:"small",sx:{minWidth:160},children:[e.jsx(Nn,{children:"Status"}),e.jsxs(In,{label:"Status",value:m.status,onChange:J=>Y(this,null,function*(){yield Cn(m.id,{status:J.target.value,approved:m.approved}),_e(null)}),children:[e.jsx(G,{value:"pending",children:"Pending"}),e.jsx(G,{value:"authorised",children:"Authorised"}),e.jsx(G,{value:"paid",children:"Paid"})]})]}):e.jsxs(j,{component:"span",variant:"caption",children:["Status: ",m.status," (click to update)"]}):ye===m.id?e.jsxs(Tn,{size:"small",sx:{minWidth:180},children:[e.jsx(Nn,{children:"Action status"}),e.jsxs(In,{label:"Action status",value:m.action_status||"not_started",onChange:J=>Y(this,null,function*(){yield Cn(m.id,{action_status:J.target.value}),_e(null)}),children:[e.jsx(G,{value:"not_started",children:"Not Started"}),e.jsx(G,{value:"in_progress",children:"In Progress"}),e.jsx(G,{value:"completed",children:"Completed"})]})]}):e.jsxs(j,{component:"span",variant:"caption",children:["Action: ",m.action_description||"n/a"," (",m.action_status||"not_started",")  click to update"]}),m.approved&&e.jsx(ge,{size:"small",label:"Approved",color:"success",sx:{maxWidth:"fit-content"}}),m.rationale&&e.jsxs(j,{component:"span",variant:"caption",display:"block",children:["Rationale: ",m.rationale]}),m.action_description&&e.jsxs(j,{component:"span",variant:"caption",display:"block",children:["Action: ",m.action_description," (",m.action_status,")"]}),m.notes&&e.jsxs(j,{component:"span",variant:"caption",display:"block",children:["Notes: ",m.notes]})]})})]},m.id))}):e.jsx(j,{color:"text.secondary",mt:2,children:"No redress recorded"})]})})]}),a===3&&e.jsx(ae,{children:e.jsxs(le,{sx:{p:3},children:[e.jsx(j,{variant:"subtitle2",gutterBottom:!0,children:"History / Audit trail"}),e.jsxs(Ct,{dense:!0,children:[vn.length===0&&e.jsx(Ne,{children:e.jsx(Ie,{primary:"No events recorded yet"})}),vn.map(m=>{var Oe;const X=m.event_type==="communication_added"&&((Oe=s==null?void 0:s.communications)==null?void 0:Oe.find(be=>{var Ut,tt;return be.summary===m.description||((tt=be.summary)==null?void 0:tt.includes(((Ut=m.description)==null?void 0:Ut.substring(0,50))||""))})),re=(X==null?void 0:X.attachments)&&X.attachments.length>0;return e.jsx(Ne,{sx:{borderBottom:"1px solid #e5e7eb"},children:e.jsx(Ie,{primaryTypographyProps:{sx:{fontWeight:600}},secondaryTypographyProps:{component:"div"},primary:m.event_type.replace(/_/g," "),secondary:e.jsxs(W,{spacing:.5,children:[m.description&&e.jsx(j,{variant:"body2",children:m.description}),re&&e.jsxs(W,{direction:"row",spacing:1,sx:{mt:.5,flexWrap:"wrap"},children:[e.jsx(j,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:"Attachments:"}),X.attachments.map(be=>e.jsx(I,{size:"small",component:"a",href:`${as}${be.url}`,target:"_blank",rel:"noreferrer",sx:{minWidth:"auto",p:.5,textTransform:"none",fontSize:"0.75rem"},children:be.file_name},be.id))]}),(m.created_by_name||m.created_by_id)&&e.jsx(j,{variant:"caption",color:"text.secondary",children:`By ${m.created_by_name||m.created_by_id}`}),e.jsx(j,{variant:"caption",color:"text.secondary",children:se(m.created_at).format("DD MMM YYYY HH:mm")})]})})},m.id)})]})]})}),e.jsxs(Ye,{open:zs,onClose:()=>ft(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(qe,{children:"Escalate to manager"}),e.jsx(Ve,{dividers:!0,children:e.jsxs(W,{spacing:2,sx:{mt:1},children:[e.jsx(U,{select:!0,fullWidth:!0,label:"Manager",value:mt,onChange:m=>xn(m.target.value),children:We.filter(m=>m.role==="complaints_manager").map(m=>e.jsx(G,{value:m.id,children:m.full_name},m.id))}),e.jsx(j,{variant:"body2",color:"text.secondary",children:"Selecting a manager will assign the complaint to them and mark it as escalated."})]})}),e.jsxs(Je,{children:[e.jsx(I,{onClick:()=>ft(!1),disabled:Xe,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:tr,disabled:Xe||!mt,children:Xe?"Escalating...":"Confirm escalation"})]})]}),e.jsxs(Ye,{open:Ys,onClose:()=>Ze(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(qe,{children:gt==="non_reportable"?"Close as non-reportable":"Close complaint"}),e.jsx(Ve,{dividers:!0,children:e.jsxs(W,{spacing:2,sx:{mt:1},children:[wn&&e.jsx(De,{severity:"error",children:wn}),e.jsx(U,{fullWidth:!0,label:"Closed date",type:"date",value:et,onChange:m=>Vs(m.target.value),helperText:"Choose the effective closed date"}),e.jsx(U,{fullWidth:!0,label:"Comments (optional)",multiline:!0,minRows:2,value:Lt,onChange:m=>Bt(m.target.value)})]})}),e.jsxs(Je,{children:[e.jsx(I,{onClick:()=>Ze(!1),children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:gt==="non_reportable"?rr:ar,disabled:gt==="non_reportable"?pt:bn,children:gt==="non_reportable"?pt?"Closing...":"Confirm close (non-reportable)":bn?"Closing...":"Confirm close"})]})]}),e.jsxs(Ye,{open:Hs,onClose:()=>xt(!1),children:[e.jsx(qe,{children:"Delete Complaint"}),e.jsxs(Ve,{children:[e.jsx(De,{severity:"warning",sx:{mb:2},children:"Are you sure you want to delete this complaint? This action cannot be undone. All related data (communications, events, outcomes, redress payments, etc.) will also be deleted."}),e.jsxs(j,{variant:"body2",color:"text.secondary",children:["Complaint: ",s==null?void 0:s.reference]})]}),e.jsxs(Je,{children:[e.jsx(I,{onClick:()=>xt(!1),disabled:$t,children:"Cancel"}),e.jsx(I,{onClick:ir,color:"error",variant:"contained",disabled:$t,children:$t?"Deleting...":"Delete"})]})]})]}):e.jsx(j,{children:"Loading..."})}const is=["Complainant","Complaint","Policy"],os=["Policy Administration","Sales and Advice","Pricing and Premiums","Claims Handling","Customer Service","Cancellations and Refunds","Disclosure and Documentation","Vulnerability and Customer Treatment","Data Protection and Privacy","Third-Party / Supplier Issues","Fraud or Financial Crime","Other / Unclassified"];function vi(){const[t,n]=w.useState(0),[s,r]=w.useState({source:"Web",received_at:se().toISOString(),description:"",category:os[0],reason:"",fca_complaint:!0,vulnerability_flag:!1,complainant:{full_name:""},policy:{}}),[a,u]=w.useState(null),[l,h]=w.useState({products:[],insurers:[],brokers:[]}),c=at();w.useEffect(()=>{Y(this,null,function*(){try{const[p,b,f]=yield Promise.all([$.get("/reference/products"),$.get("/reference/insurers"),$.get("/reference/brokers")]);h({products:p.data,insurers:b.data,brokers:f.data})}catch(p){}})},[]);const o=(d,p)=>{const b=d.split(".");r(f=>{const y=ne({},f);let g=y;return b.forEach((E,A)=>{A===b.length-1?g[E]=p:(g[E]=ne({},g[E]),g=g[E])}),y})},i=()=>Y(this,null,function*(){var b,f;if(s.category==="Other / Unclassified"&&!(s.reason&&s.reason.trim())){alert('Please provide a justification when selecting "Other / Unclassified".');return}const p=(yield $.post("/complaints",s)).data.id;if(a){const y=new FormData,E={Email:"email",Letter:"letter",Phone:"phone",Web:"web","In Person":"other",Other:"other"}[s.source]||"other";y.append("channel",E),y.append("direction","inbound"),y.append("summary",`Initial complaint via ${s.source}${a.name?` (with attachment: ${a.name})`:""}`),y.append("occurred_at",s.received_at),y.append("is_final_response","false"),y.append("files",a);try{yield $.post(`/complaints/${p}/communications`,y)}catch(A){console.error("Failed to upload attachment during complaint creation",A);let v="Unknown error";if((f=(b=A==null?void 0:A.response)==null?void 0:b.data)!=null&&f.detail){const P=A.response.data.detail;Array.isArray(P)?v=P.map(V=>{var oe;const ee=((oe=V.loc)==null?void 0:oe.join("."))||"field",ue=V.msg||"validation error";return`${ee}: ${ue}`}).join(`
`):typeof P=="string"?v=P:v=JSON.stringify(P)}else A!=null&&A.message&&(v=A.message);alert(`Complaint created successfully, but attachment upload failed: ${v}. You can add it manually in the Communications tab.`)}}c(`/complaints/${p}`,{state:{refreshDashboard:!0}})});return e.jsxs(te,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Create complaint"}),e.jsx(gr,{activeStep:t,sx:{mb:2},children:is.map(d=>e.jsx(yr,{children:e.jsx(br,{children:d})},d))}),e.jsx(ae,{children:e.jsxs(le,{children:[t===0&&e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Full name",fullWidth:!0,value:s.complainant.full_name,onChange:d=>o("complainant.full_name",d.target.value)})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Email",fullWidth:!0,value:s.complainant.email||"",onChange:d=>o("complainant.email",d.target.value)})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Phone",fullWidth:!0,value:s.complainant.phone||"",onChange:d=>o("complainant.phone",d.target.value)})}),e.jsx(O,{item:!0,xs:12,children:e.jsx(rt,{control:e.jsx(Jt,{checked:s.vulnerability_flag,onChange:d=>o("vulnerability_flag",d.target.checked)}),label:"Vulnerable customer"})})]}),t===1&&e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,children:e.jsx(U,{label:"Description",fullWidth:!0,multiline:!0,rows:3,helperText:"Brief summary of the complaint",value:s.description,onChange:d=>o("description",d.target.value)})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{select:!0,label:"Category (FCA-aligned)",fullWidth:!0,value:s.category,onChange:d=>{const p=d.target.value;o("category",p),p==="Vulnerability and Customer Treatment"&&o("vulnerability_flag",!0)},helperText:"Choose one primary category",children:os.map(d=>e.jsx(G,{value:d,children:d},d))})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Reason / sub-category",fullWidth:!0,multiline:!0,minRows:2,value:s.reason||"",onChange:d=>o("reason",d.target.value),helperText:"Add specific reason(s); multiple allowed"})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{select:!0,label:"Channel",fullWidth:!0,value:s.source,onChange:d=>o("source",d.target.value),helperText:"How the complaint was received",children:["Phone","Email","Letter","Web","In Person","Other"].map(d=>e.jsx(G,{value:d,children:d},d))})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Date complaint received",type:"date",fullWidth:!0,value:se(s.received_at).format("YYYY-MM-DD"),onChange:d=>o("received_at",se(d.target.value).toISOString()),InputLabelProps:{shrink:!0}})}),e.jsxs(O,{item:!0,xs:12,children:[e.jsxs(I,{variant:"outlined",component:"label",children:["Attach file (PDF preferred)",e.jsx("input",{hidden:!0,type:"file",accept:".pdf,.png,.jpg,.jpeg,.txt,.doc,.docx",onChange:d=>{var p;return u(((p=d.target.files)==null?void 0:p[0])||null)}})]}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:s.source==="Email"||s.source==="Letter"?`For emails/letters, please upload a PDF print (avoid .eml/.msg). Selected: ${(a==null?void 0:a.name)||"none"}`:`Upload supporting documents. Selected: ${(a==null?void 0:a.name)||"none"}`})]})]}),t===2&&e.jsxs(O,{container:!0,spacing:2,children:[e.jsx(O,{item:!0,xs:12,md:6,children:e.jsx(U,{label:"Policy number or Claim Reference",fullWidth:!0,value:s.policy.policy_number||"",onChange:d=>{o("policy.policy_number",d.target.value),o("policy_number",d.target.value)}})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsxs(U,{select:!0,label:"Product",fullWidth:!0,value:s.policy.product||"",onChange:d=>{o("policy.product",d.target.value),o("product",d.target.value)},helperText:"Select from reference data",children:[e.jsx(G,{value:"",children:"(None)"}),l.products.map(d=>e.jsx(G,{value:d.name,children:d.name},d.id))]})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsxs(U,{select:!0,label:"Insurer",fullWidth:!0,value:s.policy.insurer||"",onChange:d=>{o("policy.insurer",d.target.value),o("insurer",d.target.value)},helperText:"Select from reference data",children:[e.jsx(G,{value:"",children:"(None)"}),l.insurers.map(d=>e.jsx(G,{value:d.name,children:d.name},d.id))]})}),e.jsx(O,{item:!0,xs:12,md:6,children:e.jsxs(U,{select:!0,label:"Broker",fullWidth:!0,value:s.policy.broker||"",onChange:d=>{o("policy.broker",d.target.value),o("broker",d.target.value)},helperText:"Select from reference data",children:[e.jsx(G,{value:"",children:"(None)"}),l.brokers.map(d=>e.jsx(G,{value:d.name,children:d.name},d.id))]})})]})]})}),e.jsxs(te,{mt:2,display:"flex",justifyContent:"space-between",children:[e.jsx(I,{disabled:t===0,onClick:()=>n(d=>d-1),children:"Back"}),t<is.length-1?e.jsx(I,{variant:"contained",onClick:()=>n(d=>d+1),children:"Next"}):e.jsx(I,{variant:"contained",onClick:i,children:"Submit"})]})]})}const ls=[{value:"admin",label:"Admin"},{value:"complaints_handler",label:"Complaints Handler"},{value:"complaints_manager",label:"Complaints Manager"},{value:"reviewer",label:"Reviewer"},{value:"read_only",label:"Read only"}];function Ci(){const{role:t}=dt(),[n,s]=w.useState([]),[r,a]=w.useState(!1),[u,l]=w.useState(!1),[h,c]=w.useState(!1),[o,i]=w.useState(null),[d,p]=w.useState(null),[b,f]=w.useState({}),[y,g]=w.useState(null),[E,A]=w.useState(!1),[v,P]=w.useState({email:"",full_name:"",password:"",role:"complaints_handler",is_active:!0}),k=()=>Y(this,null,function*(){var C,z;a(!0),i(null);try{const F=yield $.get("/users");s(F.data)}catch(F){i(((z=(C=F==null?void 0:F.response)==null?void 0:C.data)==null?void 0:z.detail)||"Failed to load users")}finally{a(!1)}});w.useEffect(()=>{k()},[]);const V=()=>Y(this,null,function*(){var C,z;l(!0),i(null);try{yield $.post("/users",v),P({email:"",full_name:"",password:"",role:"complaints_handler",is_active:!0}),A(!1),yield k()}catch(F){i(((z=(C=F==null?void 0:F.response)==null?void 0:C.data)==null?void 0:z.detail)||"Failed to create user")}finally{l(!1)}}),ee=(C,z)=>Y(this,null,function*(){var F,M;l(!0),i(null);try{yield $.patch(`/users/${C}`,z),yield k()}catch(S){i(((M=(F=S==null?void 0:S.response)==null?void 0:F.data)==null?void 0:M.detail)||"Failed to update user")}finally{l(!1)}}),ue=C=>Y(this,null,function*(){var z,F;l(!0),i(null);try{yield $.post(`/auth/mfa/reset/${C}`),yield k()}catch(M){i(((F=(z=M==null?void 0:M.response)==null?void 0:z.data)==null?void 0:F.detail)||"Failed to reset MFA")}finally{l(!1)}}),oe=(C,z)=>Y(this,null,function*(){var F,M;l(!0),i(null);try{const S=yield $.post(`/users/${C}/reset-password`);g({open:!0,email:z,tempPassword:S.data.temporary_password}),yield k()}catch(S){i(((M=(F=S==null?void 0:S.response)==null?void 0:F.data)==null?void 0:M.detail)||"Failed to reset password")}finally{l(!1)}}),Z=C=>Y(this,null,function*(){var z,F;c(!0),i(null);try{const M=yield $.post(`/auth/mfa/recovery/${C}/regenerate`);f(S=>me(ne({},S),{[C]:M.data.recovery_codes})),p(C)}catch(M){i(((F=(z=M==null?void 0:M.response)==null?void 0:z.data)==null?void 0:F.detail)||"Failed to get recovery codes")}finally{c(!1)}});return t!=="admin"?e.jsxs(te,{children:[e.jsx(j,{variant:"h6",gutterBottom:!0,children:"Admin only"}),e.jsx(j,{color:"text.secondary",children:"You need admin rights to manage users."})]}):e.jsxs(te,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"User management"}),(y==null?void 0:y.open)&&e.jsxs(Ye,{open:!0,onClose:()=>g(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(qe,{children:"Password reset"}),e.jsx(Ve,{children:e.jsxs(W,{spacing:2,sx:{mt:1},children:[e.jsx(De,{severity:"warning",children:"This user will be forced to change their password on next login. Copy the temporary password and email it to them."}),e.jsxs(j,{variant:"body2",children:["User: ",e.jsx("strong",{children:y.email})]}),e.jsx(U,{label:"Temporary password",value:y.tempPassword,fullWidth:!0,InputProps:{readOnly:!0}}),e.jsx(I,{variant:"outlined",onClick:()=>Y(this,null,function*(){try{yield navigator.clipboard.writeText(y.tempPassword)}catch(C){}}),children:"Copy to clipboard"})]})}),e.jsx(Je,{children:e.jsx(I,{onClick:()=>g(null),children:"Done"})})]}),e.jsx(ae,{children:e.jsxs(le,{children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(j,{variant:"h6",children:"Users"}),e.jsxs(W,{direction:"row",spacing:1,children:[e.jsx(I,{variant:"contained",onClick:()=>A(!0),disabled:u,children:"Create user"}),e.jsx(I,{onClick:k,disabled:r||u,children:"Refresh"})]})]}),o&&e.jsx(j,{color:"error",variant:"body2",sx:{mb:2},children:o}),e.jsx(te,{sx:{overflowX:"auto"},children:e.jsxs(tn,{size:"small",sx:{minWidth:1e3},children:[e.jsx(nn,{children:e.jsxs(Re,{children:[e.jsx(Q,{sx:{minWidth:200},children:"Email"}),e.jsx(Q,{sx:{minWidth:150},children:"Name"}),e.jsx(Q,{sx:{minWidth:180},children:"Role"}),e.jsx(Q,{sx:{minWidth:100},children:"MFA"}),e.jsx(Q,{sx:{minWidth:100},children:"Status"}),e.jsx(Q,{align:"right",sx:{minWidth:400},children:"Actions"})]})}),e.jsxs(sn,{children:[n.map(C=>{const z=d===C.id;return e.jsxs(He.Fragment,{children:[e.jsxs(Re,{hover:!0,sx:{cursor:"pointer"},onClick:()=>z?p(null):Z(C.id),children:[e.jsx(Q,{sx:{py:.5},children:C.email}),e.jsx(Q,{sx:{py:.5},children:C.full_name}),e.jsx(Q,{onClick:F=>F.stopPropagation(),sx:{py:.5},children:e.jsx(U,{select:!0,size:"small",value:C.role,onChange:F=>ee(C.id,{role:F.target.value}),sx:{minWidth:160},children:ls.map(F=>e.jsx(G,{value:F.value,children:F.label},F.value))})}),e.jsx(Q,{sx:{py:.5},children:e.jsx(ge,{label:C.mfa_enabled?"Enabled":"Disabled",color:C.mfa_enabled?"success":"default",size:"small"})}),e.jsx(Q,{sx:{py:.5},children:e.jsx(ge,{label:C.is_active?"Active":"Disabled",color:C.is_active?"success":"default",size:"small"})}),e.jsx(Q,{align:"right",onClick:F=>F.stopPropagation(),sx:{py:.5},children:e.jsxs(W,{direction:"row",spacing:1,justifyContent:"flex-end",alignItems:"center",flexWrap:"wrap",children:[e.jsx(rt,{control:e.jsx(Jt,{checked:C.is_active,onChange:F=>ee(C.id,{is_active:F.target.checked}),size:"small"}),label:C.is_active?"Active":"Inactive",labelPlacement:"start",sx:{margin:0,mr:1}}),e.jsx(I,{variant:"outlined",size:"small",onClick:()=>oe(C.id,C.email),disabled:u,children:"Reset password"}),e.jsx(I,{variant:"outlined",size:"small",onClick:()=>ue(C.id),disabled:u,children:"Reset MFA"})]})})]}),z&&e.jsx(Re,{children:e.jsx(Q,{colSpan:6,children:e.jsxs(W,{spacing:1,children:[e.jsx(j,{variant:"subtitle2",children:"Recovery codes"}),h?e.jsx(j,{variant:"body2",color:"text.secondary",children:"Loading..."}):e.jsxs(W,{direction:"row",gap:1,flexWrap:"wrap",children:[(b[C.id]||[]).map(F=>e.jsx(te,{sx:{border:"1px solid #ddd",px:1.5,py:.5,borderRadius:1,fontFamily:"monospace"},children:F},F)),(!b[C.id]||b[C.id].length===0)&&e.jsx(j,{variant:"body2",color:"text.secondary",children:"No codes available."})]})]})})})]},C.id)}),n.length===0&&e.jsx(Re,{children:e.jsx(Q,{colSpan:6,children:r?"Loading...":"No users"})})]})]})})]})}),e.jsxs(Ye,{open:E,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(qe,{children:"Create user"}),e.jsx(Ve,{children:e.jsxs(W,{spacing:2.5,sx:{mt:1},children:[o&&e.jsx(De,{severity:"error",onClose:()=>i(null),children:o}),e.jsx(U,{label:"Email",value:v.email,onChange:C=>P(z=>me(ne({},z),{email:C.target.value})),fullWidth:!0,size:"small",autoComplete:"email"}),e.jsx(U,{label:"Full name",value:v.full_name,onChange:C=>P(z=>me(ne({},z),{full_name:C.target.value})),fullWidth:!0,size:"small"}),e.jsx(U,{label:"Password",type:"password",value:v.password,onChange:C=>P(z=>me(ne({},z),{password:C.target.value})),fullWidth:!0,size:"small",autoComplete:"new-password"}),e.jsx(U,{label:"Role",select:!0,value:v.role,onChange:C=>P(z=>me(ne({},z),{role:C.target.value})),fullWidth:!0,size:"small",children:ls.map(C=>e.jsx(G,{value:C.value,children:C.label},C.value))}),e.jsx(rt,{control:e.jsx(Jt,{checked:v.is_active,onChange:C=>P(z=>me(ne({},z),{is_active:C.target.checked})),size:"small"}),label:"Active"})]})}),e.jsxs(Je,{children:[e.jsx(I,{onClick:()=>A(!1),disabled:u,children:"Cancel"}),e.jsx(I,{variant:"contained",onClick:V,disabled:u||r,children:u?"Creating...":"Create user"})]})]})]})}const cs={products:"Products",brokers:"Brokers",insurers:"Insurers"};function Si(){const[t,n]=w.useState({products:[],brokers:[],insurers:[]}),[s,r]=w.useState(!1),[a,u]=w.useState(!1),[l,h]=w.useState(null),[c,o]=w.useState({products:"",brokers:"",insurers:""}),[i,d]=w.useState({products:null,brokers:null,insurers:null}),p=()=>Y(this,null,function*(){var E,A;r(!0),h(null);try{const[v,P,k]=yield Promise.all([$.get("/reference/products"),$.get("/reference/brokers"),$.get("/reference/insurers")]);n({products:v.data,brokers:P.data,insurers:k.data})}catch(v){h(((A=(E=v==null?void 0:v.response)==null?void 0:E.data)==null?void 0:A.detail)||"Failed to load reference data")}finally{r(!1)}});w.useEffect(()=>{p()},[]);const b=E=>Y(this,null,function*(){var v,P;const A=c[E].trim();if(A){u(!0),h(null);try{yield $.post(`/reference/${E}`,{name:A}),o(k=>me(ne({},k),{[E]:""})),yield p()}catch(k){h(((P=(v=k==null?void 0:k.response)==null?void 0:v.data)==null?void 0:P.detail)||"Failed to create item")}finally{u(!1)}}}),f=E=>Y(this,null,function*(){var v,P;const A=i[E];if(A){u(!0),h(null);try{const k=new FormData;k.append("file",A),yield $.post(`/reference/${E}/import`,k),d(V=>me(ne({},V),{[E]:null})),yield p()}catch(k){h(((P=(v=k==null?void 0:k.response)==null?void 0:v.data)==null?void 0:P.detail)||"Failed to import CSV")}finally{u(!1)}}}),y=E=>{const A=`name
Sample Name
`,v=new Blob([A],{type:"text/csv"}),P=URL.createObjectURL(v),k=document.createElement("a");k.href=P,k.download=`${E}_template.csv`,k.click(),URL.revokeObjectURL(P)},g=({kind:E})=>{var A;return e.jsx(ae,{sx:{flex:1},children:e.jsxs(le,{children:[e.jsxs(W,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(j,{variant:"h6",children:cs[E]}),e.jsx(I,{onClick:()=>y(E),children:"Download CSV template"})]}),e.jsxs(W,{direction:{xs:"column",md:"row"},spacing:2,mb:2,children:[e.jsx(U,{label:`Add ${cs[E].slice(0,-1)}`,size:"small",value:c[E],onChange:v=>o(P=>me(ne({},P),{[E]:v.target.value})),fullWidth:!0}),e.jsx(I,{variant:"contained",onClick:()=>b(E),disabled:a,children:"Add"})]}),e.jsxs(W,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",mb:2,children:[e.jsxs(I,{variant:"outlined",component:"label",disabled:a,children:["Choose CSV",e.jsx("input",{hidden:!0,type:"file",accept:".csv,text/csv",onChange:v=>d(P=>{var k;return me(ne({},P),{[E]:((k=v.target.files)==null?void 0:k[0])||null})})})]}),e.jsx(j,{variant:"body2",color:"text.secondary",children:((A=i[E])==null?void 0:A.name)||"No file selected"}),e.jsx(I,{variant:"contained",onClick:()=>f(E),disabled:a||!i[E],children:"Import CSV"})]}),l&&e.jsx(j,{variant:"body2",color:"error",sx:{mb:1},children:l}),e.jsxs(tn,{size:"small",children:[e.jsx(nn,{children:e.jsxs(Re,{children:[e.jsx(Q,{children:"Name"}),e.jsx(Q,{children:"Created"})]})}),e.jsxs(sn,{children:[t[E].map(v=>e.jsxs(Re,{children:[e.jsx(Q,{children:v.name}),e.jsx(Q,{children:new Date(v.created_at).toLocaleString()})]},v.id)),t[E].length===0&&e.jsx(Re,{children:e.jsx(Q,{colSpan:2,children:s?"Loading...":"No records"})})]})]})]})})};return e.jsxs(te,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Reference data"}),e.jsx(j,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage products, brokers, and insurers. Add individually or import via CSV (column: name)."}),e.jsxs(W,{spacing:3,children:[e.jsx(g,{kind:"products"}),e.jsx(g,{kind:"brokers"}),e.jsx(g,{kind:"insurers"})]})]})}function _i(){var v;const{name:t,mustChangePassword:n,refreshMe:s}=dt(),a=!!((v=rn().state)!=null&&v.forced)||n,[u,l]=w.useState(""),[h,c]=w.useState(""),[o,i]=w.useState(""),[d,p]=w.useState(!1),[b,f]=w.useState(null),[y,g]=w.useState(null),E=w.useMemo(()=>!(!h||h.length<8||h!==o||!u),[h,o,u]),A=()=>Y(this,null,function*(){var P,k;p(!0),f(null),g(null);try{yield $.post("/auth/password/change",{current_password:u,new_password:h}),l(""),c(""),i(""),yield s(),g("Password updated.")}catch(V){f(((k=(P=V==null?void 0:V.response)==null?void 0:P.data)==null?void 0:k.detail)||"Failed to update password")}finally{p(!1)}});return e.jsxs(te,{children:[e.jsx(j,{variant:"h5",gutterBottom:!0,children:"Profile"}),e.jsxs(j,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Signed in as ",t||""]}),e.jsx(ae,{sx:{maxWidth:520,mt:2},children:e.jsx(le,{children:e.jsxs(W,{spacing:2,children:[a&&e.jsx(De,{severity:"warning",children:"Your password has been reset by an admin. You must set a new password before continuing."}),b&&e.jsx(De,{severity:"error",children:b}),y&&e.jsx(De,{severity:"success",children:y}),e.jsx(j,{variant:"subtitle1",children:"Change password"}),e.jsx(U,{label:"Current password",type:"password",value:u,onChange:P=>l(P.target.value),fullWidth:!0}),e.jsx(U,{label:"New password (min 8 chars)",type:"password",value:h,onChange:P=>c(P.target.value),fullWidth:!0}),e.jsx(U,{label:"Confirm new password",type:"password",value:o,onChange:P=>i(P.target.value),fullWidth:!0}),e.jsx(I,{variant:"contained",onClick:A,disabled:!E||d,children:"Update password"})]})})})]})}var Ei=Object.defineProperty,Mt=Object.getOwnPropertySymbols,Ls=Object.prototype.hasOwnProperty,Bs=Object.prototype.propertyIsEnumerable,ds=(t,n,s)=>n in t?Ei(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,Ri=(t,n)=>{for(var s in n||(n={}))Ls.call(n,s)&&ds(t,s,n[s]);if(Mt)for(var s of Mt(n))Bs.call(n,s)&&ds(t,s,n[s]);return t},Ai=(t,n)=>{var s={};for(var r in t)Ls.call(t,r)&&n.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&Mt)for(var r of Mt(t))n.indexOf(r)<0&&Bs.call(t,r)&&(s[r]=t[r]);return s};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Be;(t=>{const n=class{constructor(c,o,i,d){if(this.version=c,this.errorCorrectionLevel=o,this.modules=[],this.isFunction=[],c<n.MIN_VERSION||c>n.MAX_VERSION)throw new RangeError("Version value out of range");if(d<-1||d>7)throw new RangeError("Mask value out of range");this.size=c*4+17;let p=[];for(let f=0;f<this.size;f++)p.push(!1);for(let f=0;f<this.size;f++)this.modules.push(p.slice()),this.isFunction.push(p.slice());this.drawFunctionPatterns();const b=this.addEccAndInterleave(i);if(this.drawCodewords(b),d==-1){let f=1e9;for(let y=0;y<8;y++){this.applyMask(y),this.drawFormatBits(y);const g=this.getPenaltyScore();g<f&&(d=y,f=g),this.applyMask(y)}}u(0<=d&&d<=7),this.mask=d,this.applyMask(d),this.drawFormatBits(d),this.isFunction=[]}static encodeText(c,o){const i=t.QrSegment.makeSegments(c);return n.encodeSegments(i,o)}static encodeBinary(c,o){const i=t.QrSegment.makeBytes(c);return n.encodeSegments([i],o)}static encodeSegments(c,o,i=1,d=40,p=-1,b=!0){if(!(n.MIN_VERSION<=i&&i<=d&&d<=n.MAX_VERSION)||p<-1||p>7)throw new RangeError("Invalid value");let f,y;for(f=i;;f++){const v=n.getNumDataCodewords(f,o)*8,P=h.getTotalBits(c,f);if(P<=v){y=P;break}if(f>=d)throw new RangeError("Data too long")}for(const v of[n.Ecc.MEDIUM,n.Ecc.QUARTILE,n.Ecc.HIGH])b&&y<=n.getNumDataCodewords(f,v)*8&&(o=v);let g=[];for(const v of c){r(v.mode.modeBits,4,g),r(v.numChars,v.mode.numCharCountBits(f),g);for(const P of v.getData())g.push(P)}u(g.length==y);const E=n.getNumDataCodewords(f,o)*8;u(g.length<=E),r(0,Math.min(4,E-g.length),g),r(0,(8-g.length%8)%8,g),u(g.length%8==0);for(let v=236;g.length<E;v^=253)r(v,8,g);let A=[];for(;A.length*8<g.length;)A.push(0);return g.forEach((v,P)=>A[P>>>3]|=v<<7-(P&7)),new n(f,o,A,p)}getModule(c,o){return 0<=c&&c<this.size&&0<=o&&o<this.size&&this.modules[o][c]}getModules(){return this.modules}drawFunctionPatterns(){for(let i=0;i<this.size;i++)this.setFunctionModule(6,i,i%2==0),this.setFunctionModule(i,6,i%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const c=this.getAlignmentPatternPositions(),o=c.length;for(let i=0;i<o;i++)for(let d=0;d<o;d++)i==0&&d==0||i==0&&d==o-1||i==o-1&&d==0||this.drawAlignmentPattern(c[i],c[d]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(c){const o=this.errorCorrectionLevel.formatBits<<3|c;let i=o;for(let p=0;p<10;p++)i=i<<1^(i>>>9)*1335;const d=(o<<10|i)^21522;u(d>>>15==0);for(let p=0;p<=5;p++)this.setFunctionModule(8,p,a(d,p));this.setFunctionModule(8,7,a(d,6)),this.setFunctionModule(8,8,a(d,7)),this.setFunctionModule(7,8,a(d,8));for(let p=9;p<15;p++)this.setFunctionModule(14-p,8,a(d,p));for(let p=0;p<8;p++)this.setFunctionModule(this.size-1-p,8,a(d,p));for(let p=8;p<15;p++)this.setFunctionModule(8,this.size-15+p,a(d,p));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let c=this.version;for(let i=0;i<12;i++)c=c<<1^(c>>>11)*7973;const o=this.version<<12|c;u(o>>>18==0);for(let i=0;i<18;i++){const d=a(o,i),p=this.size-11+i%3,b=Math.floor(i/3);this.setFunctionModule(p,b,d),this.setFunctionModule(b,p,d)}}drawFinderPattern(c,o){for(let i=-4;i<=4;i++)for(let d=-4;d<=4;d++){const p=Math.max(Math.abs(d),Math.abs(i)),b=c+d,f=o+i;0<=b&&b<this.size&&0<=f&&f<this.size&&this.setFunctionModule(b,f,p!=2&&p!=4)}}drawAlignmentPattern(c,o){for(let i=-2;i<=2;i++)for(let d=-2;d<=2;d++)this.setFunctionModule(c+d,o+i,Math.max(Math.abs(d),Math.abs(i))!=1)}setFunctionModule(c,o,i){this.modules[o][c]=i,this.isFunction[o][c]=!0}addEccAndInterleave(c){const o=this.version,i=this.errorCorrectionLevel;if(c.length!=n.getNumDataCodewords(o,i))throw new RangeError("Invalid argument");const d=n.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][o],p=n.ECC_CODEWORDS_PER_BLOCK[i.ordinal][o],b=Math.floor(n.getNumRawDataModules(o)/8),f=d-b%d,y=Math.floor(b/d);let g=[];const E=n.reedSolomonComputeDivisor(p);for(let v=0,P=0;v<d;v++){let k=c.slice(P,P+y-p+(v<f?0:1));P+=k.length;const V=n.reedSolomonComputeRemainder(k,E);v<f&&k.push(0),g.push(k.concat(V))}let A=[];for(let v=0;v<g[0].length;v++)g.forEach((P,k)=>{(v!=y-p||k>=f)&&A.push(P[v])});return u(A.length==b),A}drawCodewords(c){if(c.length!=Math.floor(n.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let o=0;for(let i=this.size-1;i>=1;i-=2){i==6&&(i=5);for(let d=0;d<this.size;d++)for(let p=0;p<2;p++){const b=i-p,y=(i+1&2)==0?this.size-1-d:d;!this.isFunction[y][b]&&o<c.length*8&&(this.modules[y][b]=a(c[o>>>3],7-(o&7)),o++)}}u(o==c.length*8)}applyMask(c){if(c<0||c>7)throw new RangeError("Mask value out of range");for(let o=0;o<this.size;o++)for(let i=0;i<this.size;i++){let d;switch(c){case 0:d=(i+o)%2==0;break;case 1:d=o%2==0;break;case 2:d=i%3==0;break;case 3:d=(i+o)%3==0;break;case 4:d=(Math.floor(i/3)+Math.floor(o/2))%2==0;break;case 5:d=i*o%2+i*o%3==0;break;case 6:d=(i*o%2+i*o%3)%2==0;break;case 7:d=((i+o)%2+i*o%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[o][i]&&d&&(this.modules[o][i]=!this.modules[o][i])}}getPenaltyScore(){let c=0;for(let p=0;p<this.size;p++){let b=!1,f=0,y=[0,0,0,0,0,0,0];for(let g=0;g<this.size;g++)this.modules[p][g]==b?(f++,f==5?c+=n.PENALTY_N1:f>5&&c++):(this.finderPenaltyAddHistory(f,y),b||(c+=this.finderPenaltyCountPatterns(y)*n.PENALTY_N3),b=this.modules[p][g],f=1);c+=this.finderPenaltyTerminateAndCount(b,f,y)*n.PENALTY_N3}for(let p=0;p<this.size;p++){let b=!1,f=0,y=[0,0,0,0,0,0,0];for(let g=0;g<this.size;g++)this.modules[g][p]==b?(f++,f==5?c+=n.PENALTY_N1:f>5&&c++):(this.finderPenaltyAddHistory(f,y),b||(c+=this.finderPenaltyCountPatterns(y)*n.PENALTY_N3),b=this.modules[g][p],f=1);c+=this.finderPenaltyTerminateAndCount(b,f,y)*n.PENALTY_N3}for(let p=0;p<this.size-1;p++)for(let b=0;b<this.size-1;b++){const f=this.modules[p][b];f==this.modules[p][b+1]&&f==this.modules[p+1][b]&&f==this.modules[p+1][b+1]&&(c+=n.PENALTY_N2)}let o=0;for(const p of this.modules)o=p.reduce((b,f)=>b+(f?1:0),o);const i=this.size*this.size,d=Math.ceil(Math.abs(o*20-i*10)/i)-1;return u(0<=d&&d<=9),c+=d*n.PENALTY_N4,u(0<=c&&c<=2568888),c}getAlignmentPatternPositions(){if(this.version==1)return[];{const c=Math.floor(this.version/7)+2,o=this.version==32?26:Math.ceil((this.version*4+4)/(c*2-2))*2;let i=[6];for(let d=this.size-7;i.length<c;d-=o)i.splice(1,0,d);return i}}static getNumRawDataModules(c){if(c<n.MIN_VERSION||c>n.MAX_VERSION)throw new RangeError("Version number out of range");let o=(16*c+128)*c+64;if(c>=2){const i=Math.floor(c/7)+2;o-=(25*i-10)*i-55,c>=7&&(o-=36)}return u(208<=o&&o<=29648),o}static getNumDataCodewords(c,o){return Math.floor(n.getNumRawDataModules(c)/8)-n.ECC_CODEWORDS_PER_BLOCK[o.ordinal][c]*n.NUM_ERROR_CORRECTION_BLOCKS[o.ordinal][c]}static reedSolomonComputeDivisor(c){if(c<1||c>255)throw new RangeError("Degree out of range");let o=[];for(let d=0;d<c-1;d++)o.push(0);o.push(1);let i=1;for(let d=0;d<c;d++){for(let p=0;p<o.length;p++)o[p]=n.reedSolomonMultiply(o[p],i),p+1<o.length&&(o[p]^=o[p+1]);i=n.reedSolomonMultiply(i,2)}return o}static reedSolomonComputeRemainder(c,o){let i=o.map(d=>0);for(const d of c){const p=d^i.shift();i.push(0),o.forEach((b,f)=>i[f]^=n.reedSolomonMultiply(b,p))}return i}static reedSolomonMultiply(c,o){if(c>>>8||o>>>8)throw new RangeError("Byte out of range");let i=0;for(let d=7;d>=0;d--)i=i<<1^(i>>>7)*285,i^=(o>>>d&1)*c;return u(i>>>8==0),i}finderPenaltyCountPatterns(c){const o=c[1];u(o<=this.size*3);const i=o>0&&c[2]==o&&c[3]==o*3&&c[4]==o&&c[5]==o;return(i&&c[0]>=o*4&&c[6]>=o?1:0)+(i&&c[6]>=o*4&&c[0]>=o?1:0)}finderPenaltyTerminateAndCount(c,o,i){return c&&(this.finderPenaltyAddHistory(o,i),o=0),o+=this.size,this.finderPenaltyAddHistory(o,i),this.finderPenaltyCountPatterns(i)}finderPenaltyAddHistory(c,o){o[0]==0&&(c+=this.size),o.pop(),o.unshift(c)}};let s=n;s.MIN_VERSION=1,s.MAX_VERSION=40,s.PENALTY_N1=3,s.PENALTY_N2=3,s.PENALTY_N3=40,s.PENALTY_N4=10,s.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],s.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=s;function r(c,o,i){if(o<0||o>31||c>>>o)throw new RangeError("Value out of range");for(let d=o-1;d>=0;d--)i.push(c>>>d&1)}function a(c,o){return(c>>>o&1)!=0}function u(c){if(!c)throw new Error("Assertion error")}const l=class{constructor(c,o,i){if(this.mode=c,this.numChars=o,this.bitData=i,o<0)throw new RangeError("Invalid argument");this.bitData=i.slice()}static makeBytes(c){let o=[];for(const i of c)r(i,8,o);return new l(l.Mode.BYTE,c.length,o)}static makeNumeric(c){if(!l.isNumeric(c))throw new RangeError("String contains non-numeric characters");let o=[];for(let i=0;i<c.length;){const d=Math.min(c.length-i,3);r(parseInt(c.substr(i,d),10),d*3+1,o),i+=d}return new l(l.Mode.NUMERIC,c.length,o)}static makeAlphanumeric(c){if(!l.isAlphanumeric(c))throw new RangeError("String contains unencodable characters in alphanumeric mode");let o=[],i;for(i=0;i+2<=c.length;i+=2){let d=l.ALPHANUMERIC_CHARSET.indexOf(c.charAt(i))*45;d+=l.ALPHANUMERIC_CHARSET.indexOf(c.charAt(i+1)),r(d,11,o)}return i<c.length&&r(l.ALPHANUMERIC_CHARSET.indexOf(c.charAt(i)),6,o),new l(l.Mode.ALPHANUMERIC,c.length,o)}static makeSegments(c){return c==""?[]:l.isNumeric(c)?[l.makeNumeric(c)]:l.isAlphanumeric(c)?[l.makeAlphanumeric(c)]:[l.makeBytes(l.toUtf8ByteArray(c))]}static makeEci(c){let o=[];if(c<0)throw new RangeError("ECI assignment value out of range");if(c<128)r(c,8,o);else if(c<16384)r(2,2,o),r(c,14,o);else if(c<1e6)r(6,3,o),r(c,21,o);else throw new RangeError("ECI assignment value out of range");return new l(l.Mode.ECI,0,o)}static isNumeric(c){return l.NUMERIC_REGEX.test(c)}static isAlphanumeric(c){return l.ALPHANUMERIC_REGEX.test(c)}getData(){return this.bitData.slice()}static getTotalBits(c,o){let i=0;for(const d of c){const p=d.mode.numCharCountBits(o);if(d.numChars>=1<<p)return 1/0;i+=4+p+d.bitData.length}return i}static toUtf8ByteArray(c){c=encodeURI(c);let o=[];for(let i=0;i<c.length;i++)c.charAt(i)!="%"?o.push(c.charCodeAt(i)):(o.push(parseInt(c.substr(i+1,2),16)),i+=2);return o}};let h=l;h.NUMERIC_REGEX=/^[0-9]*$/,h.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,h.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",t.QrSegment=h})(Be||(Be={}));(t=>{(n=>{const s=class{constructor(a,u){this.ordinal=a,this.formatBits=u}};let r=s;r.LOW=new s(0,1),r.MEDIUM=new s(1,0),r.QUARTILE=new s(2,3),r.HIGH=new s(3,2),n.Ecc=r})(t.QrCode||(t.QrCode={}))})(Be||(Be={}));(t=>{(n=>{const s=class{constructor(a,u){this.modeBits=a,this.numBitsCharCount=u}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};let r=s;r.NUMERIC=new s(1,[10,12,14]),r.ALPHANUMERIC=new s(2,[9,11,13]),r.BYTE=new s(4,[8,16,16]),r.KANJI=new s(8,[8,10,12]),r.ECI=new s(7,[0,0,0]),n.Mode=r})(t.QrSegment||(t.QrSegment={}))})(Be||(Be={}));var st=Be;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Oi={L:st.QrCode.Ecc.LOW,M:st.QrCode.Ecc.MEDIUM,Q:st.QrCode.Ecc.QUARTILE,H:st.QrCode.Ecc.HIGH},Mi=128,Pi="L",Di="#FFFFFF",ki="#000000",Ti=!1,Us=4,Ni=.1;function Ii(t,n=0){const s=[];return t.forEach(function(r,a){let u=null;r.forEach(function(l,h){if(!l&&u!==null){s.push(`M${u+n} ${a+n}h${h-u}v1H${u+n}z`),u=null;return}if(h===r.length-1){if(!l)return;u===null?s.push(`M${h+n},${a+n} h1v1H${h+n}z`):s.push(`M${u+n},${a+n} h${h+1-u}v1H${u+n}z`);return}l&&u===null&&(u=h)})}),s.join("")}function Fi(t,n){return t.slice().map((s,r)=>r<n.y||r>=n.y+n.h?s:s.map((a,u)=>u<n.x||u>=n.x+n.w?a:!1))}function $i(t,n,s,r){if(r==null)return null;const a=s?Us:0,u=t.length+a*2,l=Math.floor(n*Ni),h=u/n,c=(r.width||l)*h,o=(r.height||l)*h,i=r.x==null?t.length/2-c/2:r.x*h,d=r.y==null?t.length/2-o/2:r.y*h;let p=null;if(r.excavate){let b=Math.floor(i),f=Math.floor(d),y=Math.ceil(c+i-b),g=Math.ceil(o+d-f);p={x:b,y:f,w:y,h:g}}return{x:i,y:d,h:o,w:c,excavation:p}}(function(){try{new Path2D().addPath(new Path2D)}catch(t){return!1}return!0})();function Li(t){const n=t,{value:s,size:r=Mi,level:a=Pi,bgColor:u=Di,fgColor:l=ki,includeMargin:h=Ti,imageSettings:c}=n,o=Ai(n,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let i=st.QrCode.encodeText(s,Oi[a]).getModules();const d=h?Us:0,p=i.length+d*2,b=$i(i,r,h,c);let f=null;c!=null&&b!=null&&(b.excavation!=null&&(i=Fi(i,b.excavation)),f=He.createElement("image",{xlinkHref:c.src,height:b.h,width:b.w,x:b.x+d,y:b.y+d,preserveAspectRatio:"none"}));const y=Ii(i,d);return He.createElement("svg",Ri({height:r,width:r,viewBox:`0 0 ${p} ${p}`},o),He.createElement("path",{fill:u,d:`M0,0 h${p}v${p}H0z`,shapeRendering:"crispEdges"}),He.createElement("path",{fill:l,d:y,shapeRendering:"crispEdges"}),f)}new URL("/assets/compass-logo-D3WIe7Ai.png",import.meta.url).href;function Bi(){const{token:t,role:n,name:s,login:r,logout:a,mustChangePassword:u,ready:l}=dt(),[h,c]=w.useState(""),[o,i]=w.useState(""),[d,p]=w.useState(!1),[b,f]=w.useState(""),[y,g]=w.useState(""),[E,A]=w.useState(null),[v,P]=w.useState(!1),[k,V]=w.useState(!1),[ee,ue]=w.useState(null),[oe,Z]=w.useState(null),[C,z]=w.useState(0),[F,M]=w.useState(!1),S=at(),_=rn();w.useEffect(()=>{M(!t)},[t]),w.useEffect(()=>{l&&(t||_.pathname!=="/"&&S("/",{replace:!0}))},[l,t,_.pathname,S]),w.useEffect(()=>{t&&u&&_.pathname!=="/profile"&&S("/profile",{replace:!0,state:{forced:!0}})},[t,u,_.pathname,S]);const T=()=>Y(this,null,function*(){var D,H;A(null);try{const N=yield r(h,o,v?b:void 0,v?y:void 0);P(!1),f(""),g(""),N!=null&&N.mfa_enrollment_required?(z(N.mfa_remaining_skips||0),yield R()):S("/")}catch(N){const K=(H=(D=N==null?void 0:N.response)==null?void 0:D.data)==null?void 0:H.detail;K==="MFA code required"||(K==null?void 0:K.code)==="mfa_required"?(P(!0),A("Enter your 6-digit MFA code or a recovery code.")):A(K==="Invalid recovery code"||K==="Invalid MFA code"||K==="Invalid code"?"Invalid code. Please try again.":"Login failed. Check your credentials.")}}),R=()=>Y(this,null,function*(){var D,H;try{const N=yield $.post("/auth/mfa/enroll");ue(N.data),Z(null),V(!0)}catch(N){A(((H=(D=N==null?void 0:N.response)==null?void 0:D.data)==null?void 0:H.detail)||"Could not start MFA enrollment")}}),L=()=>Y(this,null,function*(){var D,H;try{const N=yield $.post("/auth/mfa/verify",{code:b});Z(N.data.recovery_codes),V(!1),f(""),z(0),S("/")}catch(N){A(((H=(D=N==null?void 0:N.response)==null?void 0:D.data)==null?void 0:H.detail)||"Invalid code")}}),B=()=>Y(this,null,function*(){var D,H;try{const N=yield $.post("/auth/mfa/skip");z(N.data.remaining_skips),V(!1),ue(null)}catch(N){A(((H=(D=N==null?void 0:N.response)==null?void 0:D.data)==null?void 0:H.detail)||"Cannot skip MFA")}});return e.jsxs(e.Fragment,{children:[e.jsx(jr,{position:"static",color:"transparent",elevation:0,sx:{borderBottom:"1px solid rgba(255,255,255,0.08)",background:"linear-gradient(135deg, #0f172a 0%, #0f4c81 100%)",color:"#e5e7eb"},children:e.jsx(Fn,{maxWidth:"lg",children:e.jsxs(wr,{disableGutters:!0,sx:{py:1.5,minHeight:72},children:[e.jsx(W,{direction:"row",alignItems:"center",spacing:1.6,sx:{flexGrow:1},children:e.jsx(j,{variant:"h5",sx:{fontWeight:800,letterSpacing:.4,color:"#f8fafc"},children:e.jsx(Me,{to:"/",style:{color:"inherit",textDecoration:"none"},children:"Compass"})})}),t&&e.jsxs(W,{direction:"row",gap:1.5,alignItems:"center",children:[e.jsx(j,{variant:"body2",sx:{color:"rgba(255,255,255,0.85)"},children:s}),e.jsx(I,{color:"inherit",component:Me,to:"/",sx:{fontWeight:700,color:"#f8fafc"},children:"Dashboard"}),e.jsx(I,{color:"inherit",component:Me,to:"/complaints",sx:{fontWeight:700,color:"#f8fafc"},children:"Complaints"}),e.jsx(I,{color:"inherit",component:Me,to:"/profile",sx:{fontWeight:700,color:"#f8fafc"},children:"Profile"}),e.jsx(I,{color:"inherit",component:Me,to:"/complaints/new",disabled:n==="read_only",sx:{fontWeight:700,color:"#f8fafc"},children:"New"}),n==="admin"&&e.jsx(I,{color:"inherit",component:Me,to:"/admin",sx:{fontWeight:700,color:"#f8fafc"},children:"Admin"}),n==="admin"&&e.jsx(I,{color:"inherit",component:Me,to:"/reference",sx:{fontWeight:700,color:"#f8fafc"},children:"Reference"}),e.jsx(I,{color:"inherit",onClick:a,sx:{fontWeight:700,color:"#f8fafc"},children:"Logout"})]})]})})}),e.jsx(Fn,{maxWidth:"lg",sx:{mt:4,mb:4},children:t?e.jsxs(kr,{children:[e.jsx(Te,{path:"/",element:e.jsx(xi,{})}),e.jsx(Te,{path:"/complaints",element:e.jsx(bi,{})}),e.jsx(Te,{path:"/complaints/new",element:e.jsx(vi,{})}),e.jsx(Te,{path:"/complaints/:id",element:e.jsx(wi,{})}),e.jsx(Te,{path:"/profile",element:e.jsx(_i,{})}),e.jsx(Te,{path:"/admin",element:e.jsx(Ci,{})}),e.jsx(Te,{path:"/reference",element:e.jsx(Si,{})})]}):e.jsx(te,{maxWidth:420,mx:"auto",mt:6,children:e.jsx(ae,{children:e.jsxs(le,{sx:{p:4},children:[F&&e.jsx(De,{severity:"info",sx:{mb:2},children:"Please log in to continue."}),e.jsxs(j,{variant:"h5",gutterBottom:!0,children:["Sign in ",!1]}),e.jsx(j,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Use your credentials to access the complaints workspace."}),E&&e.jsx(j,{variant:"body2",color:"error",sx:{mb:1},children:E}),e.jsxs(te,{component:"form",onSubmit:D=>{D.preventDefault(),T()},children:[e.jsx(U,{label:"Email",value:h,onChange:D=>c(D.target.value),fullWidth:!0,sx:{mb:2.5,mt:1},autoComplete:"email"}),e.jsx(U,{label:"Password",type:d?"text":"password",value:o,onChange:D=>i(D.target.value),fullWidth:!0,sx:{mb:3},autoComplete:"current-password",InputProps:{endAdornment:e.jsx(vr,{position:"end",children:e.jsx(Cr,{"aria-label":d?"Hide password":"Show password",onClick:()=>p(D=>!D),edge:"end",children:d?e.jsx(Sr,{}):e.jsx(_r,{})})})}}),v&&e.jsxs(e.Fragment,{children:[e.jsx(U,{label:"MFA code (6 digits)",value:b,onChange:D=>f(D.target.value),fullWidth:!0,sx:{mb:2}}),e.jsx(U,{label:"Recovery code (optional)",value:y,onChange:D=>g(D.target.value),fullWidth:!0,sx:{mb:3}})]}),e.jsx(I,{variant:"contained",fullWidth:!0,size:"large",type:"submit",children:"Login"})]})]})})})}),e.jsxs(Ye,{open:k,onClose:C>0?()=>V(!1):void 0,disableEscapeKeyDown:C<=0,children:[e.jsx(qe,{children:"Set up MFA"}),e.jsx(Ve,{children:e.jsxs(W,{spacing:2,sx:{mt:1},children:[C<=0?e.jsx(j,{color:"error",children:"You must enable MFA to continue."}):e.jsxs(j,{children:["We recommend enabling MFA. You can skip up to ",C," more time(s)."]}),ee?e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"subtitle2",children:"Scan in your authenticator app"}),e.jsx(te,{display:"flex",justifyContent:"center",children:e.jsx(Li,{value:ee.otpauth_url,size:180})}),e.jsxs(j,{variant:"body2",children:["Secret (manual entry): ",ee.secret]}),e.jsx(U,{label:"6-digit code",value:b,onChange:D=>f(D.target.value),size:"small",sx:{maxWidth:240}}),oe&&e.jsxs(te,{children:[e.jsx(j,{variant:"subtitle2",gutterBottom:!0,children:"Recovery codes (store securely)"}),e.jsx(W,{direction:"row",gap:1,flexWrap:"wrap",children:oe.map(D=>e.jsx(te,{sx:{border:"1px solid #ddd",px:1.5,py:.5,borderRadius:1,fontFamily:"monospace"},children:D},D))})]})]}):e.jsx(j,{color:"text.secondary",children:"Preparing enrollment..."})]})}),e.jsxs(Je,{sx:{px:3,pb:2},children:[e.jsx(I,{onClick:B,disabled:C<=0,children:"Skip for now"}),e.jsx(I,{variant:"contained",onClick:L,disabled:!b||b.length<6,children:"Verify & enable"})]})]})]})}const Ui=Er({palette:{mode:"light",primary:{main:"#0f4c81"},secondary:{main:"#0b6e4f"},background:{default:"#f5f7fb",paper:"#ffffff"},text:{primary:"#1b2430",secondary:"#4b5563"}},shape:{borderRadius:10},typography:{fontFamily:"'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif",h5:{fontWeight:600},h6:{fontWeight:600},subtitle2:{fontWeight:600,letterSpacing:.1}},components:{MuiCssBaseline:{styleOverrides:{body:{backgroundColor:"#f5f7fb"}}},MuiCard:{defaultProps:{elevation:0},styleOverrides:{root:{border:"1px solid #e5e7eb",boxShadow:"0 6px 18px rgba(15,76,129,0.06)"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:10,fontWeight:600}}},MuiTextField:{defaultProps:{size:"small"}},MuiPaper:{styleOverrides:{root:{borderRadius:12}}}}});Qt.createRoot(document.getElementById("root")).render(e.jsx(He.StrictMode,{children:e.jsxs(Rr,{theme:Ui,children:[e.jsx(Ar,{}),e.jsx(Tr,{children:e.jsx(fi,{children:e.jsx(Bi,{})})})]})}));
