var Or=Object.defineProperty,Dr=Object.defineProperties;var Mr=Object.getOwnPropertyDescriptors;var Jn=Object.getOwnPropertySymbols;var kr=Object.prototype.hasOwnProperty,Pr=Object.prototype.propertyIsEnumerable;var et=(t,n)=>(n=Symbol[t])?n:Symbol.for("Symbol."+t),Tr=t=>{throw TypeError(t)};var Qn=(t,n,s)=>n in t?Or(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,K=(t,n)=>{for(var s in n||(n={}))kr.call(n,s)&&Qn(t,s,n[s]);if(Jn)for(var s of Jn(n))Pr.call(n,s)&&Qn(t,s,n[s]);return t},ee=(t,n)=>Dr(t,Mr(n));var V=(t,n,s)=>new Promise((r,a)=>{var u=c=>{try{f(s.next(c))}catch(i){a(i)}},l=c=>{try{f(s.throw(c))}catch(i){a(i)}},f=c=>c.done?r(c.value):Promise.resolve(c.value).then(u,l);f((s=s.apply(t,n)).next())}),We=function(t,n){this[0]=t,this[1]=n},rn=(t,n,s)=>{var r=(l,f,c,i)=>{try{var o=s[l](f),d=(f=o.value)instanceof We,p=o.done;Promise.resolve(d?f[0]:f).then(b=>d?r(l==="return"?l:"next",f[1]?{done:b.done,value:b.value}:b,c,i):c({value:b,done:p})).catch(b=>r("throw",b,c,i))}catch(b){i(b)}},a=l=>u[l]=f=>new Promise((c,i)=>r(l,f,c,i)),u={};return s=s.apply(t,n),u[et("asyncIterator")]=()=>u,a("next"),a("throw"),a("return"),u},an=t=>{var n=t[et("asyncIterator")],s=!1,r,a={};return n==null?(n=t[et("iterator")](),r=u=>a[u]=l=>n[u](l)):(n=n.call(t),r=u=>a[u]=l=>{if(s){if(s=!1,u==="throw")throw l;return l}return s=!0,{done:!1,value:new We(new Promise(f=>{var c=n[u](l);c instanceof Object||Tr("Object expected"),f(c)}),1)}}),a[et("iterator")]=()=>a,r("next"),"throw"in n?r("throw"):a.throw=u=>{throw u},"return"in n&&r("return"),a},Kn=(t,n,s)=>(n=t[et("asyncIterator")])?n.call(t):(t=t[et("iterator")](),n={},s=(r,a)=>(a=t[r])&&(n[r]=u=>new Promise((l,f,c)=>(u=a.call(t,u),c=u.done,Promise.resolve(u.value).then(i=>l({value:i,done:c}),f)))),s("next"),s("return"),n);import{j as e,C as me,B as ae,S as z,T as w,G as S,a as le,b as ce,c as Fr,D as As,d as $,e as Os,f as Ie,L as yn,g as Tt,h as Ye,i as He,k as Ir,l as N,M as X,m as Lt,n as Bt,o as we,p as J,q as Ut,F as qe,r as Ot,s as Gn,I as Xn,t as Zn,u as Ne,v as $e,w as Le,x as Be,A as Pe,y as Nr,z as $r,E as Lr,H as un,J as hn,V as Ds,K as Br,N as Ur,O as es,P as Wr,Q as zr,R as Yr,U as Hr,W as qr,X as Vr}from"./mui--92LvHzN.js";import{c as Jr,d as Qr,e as Kr,r as v,u as ut,f as jn,L as Fe,h as Gr,a as tt,i as Xr,j as ze,B as Zr}from"./vendor-CgeKSuOn.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const l of u.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=s(a);fetch(a.href,u)}})();var fn={},ts=Jr;fn.createRoot=ts.createRoot,fn.hydrateRoot=ts.hydrateRoot;var Ms={exports:{}};(function(t,n){(function(s,r){t.exports=r()})(Qr,function(){var s=1e3,r=6e4,a=36e5,u="millisecond",l="second",f="minute",c="hour",i="day",o="week",d="month",p="quarter",b="year",m="date",g="Invalid Date",y=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,T=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(D){var _=["th","st","nd","rd"],E=D%100;return"["+D+(_[(E-20)%10]||_[E]||_[0])+"]"}},A=function(D,_,E){var I=String(D);return!I||I.length>=_?D:""+Array(_+1-I.length).join(E)+D},F={s:A,z:function(D){var _=-D.utcOffset(),E=Math.abs(_),I=Math.floor(E/60),j=E%60;return(_<=0?"+":"-")+A(I,2,"0")+":"+A(j,2,"0")},m:function D(_,E){if(_.date()<E.date())return-D(E,_);var I=12*(E.year()-_.year())+(E.month()-_.month()),j=_.clone().add(I,d),M=E-j<0,O=_.clone().add(I+(M?-1:1),d);return+(-(I+(E-j)/(M?j-O:O-j))||0)},a:function(D){return D<0?Math.ceil(D)||0:Math.floor(D)},p:function(D){return{M:d,y:b,w:o,d:i,D:m,h:c,m:f,s:l,ms:u,Q:p}[D]||String(D||"").toLowerCase().replace(/s$/,"")},u:function(D){return D===void 0}},Q="en",Z={};Z[Q]=k;var se="$isDayjsObject",ue=function(D){return D instanceof H||!(!D||!D[se])},oe=function D(_,E,I){var j;if(!_)return Q;if(typeof _=="string"){var M=_.toLowerCase();Z[M]&&(j=M),E&&(Z[M]=E,j=M);var O=_.split("-");if(!j&&O.length>1)return D(O[0])}else{var R=_.name;Z[R]=_,j=R}return!I&&j&&(Q=j),j||!I&&Q},te=function(D,_){if(ue(D))return D.clone();var E=typeof _=="object"?_:{};return E.date=D,E.args=arguments,new H(E)},C=F;C.l=oe,C.i=ue,C.w=function(D,_){return te(D,{locale:_.$L,utc:_.$u,x:_.$x,$offset:_.$offset})};var H=function(){function D(E){this.$L=oe(E.locale,null,!0),this.parse(E),this.$x=this.$x||E.x||{},this[se]=!0}var _=D.prototype;return _.parse=function(E){this.$d=function(I){var j=I.date,M=I.utc;if(j===null)return new Date(NaN);if(C.u(j))return new Date;if(j instanceof Date)return new Date(j);if(typeof j=="string"&&!/Z$/i.test(j)){var O=j.match(y);if(O){var R=O[2]-1||0,P=(O[7]||"0").substring(0,3);return M?new Date(Date.UTC(O[1],R,O[3]||1,O[4]||0,O[5]||0,O[6]||0,P)):new Date(O[1],R,O[3]||1,O[4]||0,O[5]||0,O[6]||0,P)}}return new Date(j)}(E),this.init()},_.init=function(){var E=this.$d;this.$y=E.getFullYear(),this.$M=E.getMonth(),this.$D=E.getDate(),this.$W=E.getDay(),this.$H=E.getHours(),this.$m=E.getMinutes(),this.$s=E.getSeconds(),this.$ms=E.getMilliseconds()},_.$utils=function(){return C},_.isValid=function(){return this.$d.toString()!==g},_.isSame=function(E,I){var j=te(E);return this.startOf(I)<=j&&j<=this.endOf(I)},_.isAfter=function(E,I){return te(E)<this.startOf(I)},_.isBefore=function(E,I){return this.endOf(I)<te(E)},_.$g=function(E,I,j){return C.u(E)?this[I]:this.set(j,E)},_.unix=function(){return Math.floor(this.valueOf()/1e3)},_.valueOf=function(){return this.$d.getTime()},_.startOf=function(E,I){var j=this,M=!!C.u(I)||I,O=C.p(E),R=function(Re,fe){var Ce=C.w(j.$u?Date.UTC(j.$y,fe,Re):new Date(j.$y,fe,Re),j);return M?Ce:Ce.endOf(i)},P=function(Re,fe){return C.w(j.toDate()[Re].apply(j.toDate("s"),(M?[0,0,0,0]:[23,59,59,999]).slice(fe)),j)},U=this.$W,ne=this.$M,he=this.$D,De="set"+(this.$u?"UTC":"");switch(O){case b:return M?R(1,0):R(31,11);case d:return M?R(1,ne):R(0,ne+1);case o:var Ee=this.$locale().weekStart||0,Te=(U<Ee?U+7:U)-Ee;return R(M?he-Te:he+(6-Te),ne);case i:case m:return P(De+"Hours",0);case c:return P(De+"Minutes",1);case f:return P(De+"Seconds",2);case l:return P(De+"Milliseconds",3);default:return this.clone()}},_.endOf=function(E){return this.startOf(E,!1)},_.$set=function(E,I){var j,M=C.p(E),O="set"+(this.$u?"UTC":""),R=(j={},j[i]=O+"Date",j[m]=O+"Date",j[d]=O+"Month",j[b]=O+"FullYear",j[c]=O+"Hours",j[f]=O+"Minutes",j[l]=O+"Seconds",j[u]=O+"Milliseconds",j)[M],P=M===i?this.$D+(I-this.$W):I;if(M===d||M===b){var U=this.clone().set(m,1);U.$d[R](P),U.init(),this.$d=U.set(m,Math.min(this.$D,U.daysInMonth())).$d}else R&&this.$d[R](P);return this.init(),this},_.set=function(E,I){return this.clone().$set(E,I)},_.get=function(E){return this[C.p(E)]()},_.add=function(E,I){var j,M=this;E=Number(E);var O=C.p(I),R=function(ne){var he=te(M);return C.w(he.date(he.date()+Math.round(ne*E)),M)};if(O===d)return this.set(d,this.$M+E);if(O===b)return this.set(b,this.$y+E);if(O===i)return R(1);if(O===o)return R(7);var P=(j={},j[f]=r,j[c]=a,j[l]=s,j)[O]||1,U=this.$d.getTime()+E*P;return C.w(U,this)},_.subtract=function(E,I){return this.add(-1*E,I)},_.format=function(E){var I=this,j=this.$locale();if(!this.isValid())return j.invalidDate||g;var M=E||"YYYY-MM-DDTHH:mm:ssZ",O=C.z(this),R=this.$H,P=this.$m,U=this.$M,ne=j.weekdays,he=j.months,De=j.meridiem,Ee=function(fe,Ce,Me,Ge){return fe&&(fe[Ce]||fe(I,M))||Me[Ce].slice(0,Ge)},Te=function(fe){return C.s(R%12||12,fe,"0")},Re=De||function(fe,Ce,Me){var Ge=fe<12?"AM":"PM";return Me?Ge.toLowerCase():Ge};return M.replace(T,function(fe,Ce){return Ce||function(Me){switch(Me){case"YY":return String(I.$y).slice(-2);case"YYYY":return C.s(I.$y,4,"0");case"M":return U+1;case"MM":return C.s(U+1,2,"0");case"MMM":return Ee(j.monthsShort,U,he,3);case"MMMM":return Ee(he,U);case"D":return I.$D;case"DD":return C.s(I.$D,2,"0");case"d":return String(I.$W);case"dd":return Ee(j.weekdaysMin,I.$W,ne,2);case"ddd":return Ee(j.weekdaysShort,I.$W,ne,3);case"dddd":return ne[I.$W];case"H":return String(R);case"HH":return C.s(R,2,"0");case"h":return Te(1);case"hh":return Te(2);case"a":return Re(R,P,!0);case"A":return Re(R,P,!1);case"m":return String(P);case"mm":return C.s(P,2,"0");case"s":return String(I.$s);case"ss":return C.s(I.$s,2,"0");case"SSS":return C.s(I.$ms,3,"0");case"Z":return O}return null}(fe)||O.replace(":","")})},_.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},_.diff=function(E,I,j){var M,O=this,R=C.p(I),P=te(E),U=(P.utcOffset()-this.utcOffset())*r,ne=this-P,he=function(){return C.m(O,P)};switch(R){case b:M=he()/12;break;case d:M=he();break;case p:M=he()/3;break;case o:M=(ne-U)/6048e5;break;case i:M=(ne-U)/864e5;break;case c:M=ne/a;break;case f:M=ne/r;break;case l:M=ne/s;break;default:M=ne}return j?M:C.a(M)},_.daysInMonth=function(){return this.endOf(d).$D},_.$locale=function(){return Z[this.$L]},_.locale=function(E,I){if(!E)return this.$L;var j=this.clone(),M=oe(E,I,!0);return M&&(j.$L=M),j},_.clone=function(){return C.w(this.$d,this)},_.toDate=function(){return new Date(this.valueOf())},_.toJSON=function(){return this.isValid()?this.toISOString():null},_.toISOString=function(){return this.$d.toISOString()},_.toString=function(){return this.$d.toUTCString()},D}(),B=H.prototype;return te.prototype=B,[["$ms",u],["$s",l],["$m",f],["$H",c],["$W",i],["$M",d],["$y",b],["$D",m]].forEach(function(D){B[D[1]]=function(_){return this.$g(_,D[0],D[1])}}),te.extend=function(D,_){return D.$i||(D(_,H,te),D.$i=!0),te},te.locale=oe,te.isDayjs=ue,te.unix=function(D){return te(1e3*D)},te.en=Z[Q],te.Ls=Z,te.p={},te})})(Ms);var ea=Ms.exports;const ie=Kr(ea);function ks(t,n){return function(){return t.apply(n,arguments)}}const{toString:ta}=Object.prototype,{getPrototypeOf:bn}=Object,{iterator:Ht,toStringTag:Ps}=Symbol,qt=(t=>n=>{const s=ta.call(n);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),_e=t=>(t=t.toLowerCase(),n=>qt(n)===t),Vt=t=>n=>typeof n===t,{isArray:st}=Array,nt=Vt("undefined");function ht(t){return t!==null&&!nt(t)&&t.constructor!==null&&!nt(t.constructor)&&je(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Ts=_e("ArrayBuffer");function na(t){let n;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?n=ArrayBuffer.isView(t):n=t&&t.buffer&&Ts(t.buffer),n}const sa=Vt("string"),je=Vt("function"),Fs=Vt("number"),ft=t=>t!==null&&typeof t=="object",ra=t=>t===!0||t===!1,Ft=t=>{if(qt(t)!=="object")return!1;const n=bn(t);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Ps in t)&&!(Ht in t)},aa=t=>{if(!ft(t)||ht(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch(n){return!1}},ia=_e("Date"),oa=_e("File"),la=_e("Blob"),ca=_e("FileList"),da=t=>ft(t)&&je(t.pipe),ua=t=>{let n;return t&&(typeof FormData=="function"&&t instanceof FormData||je(t.append)&&((n=qt(t))==="formdata"||n==="object"&&je(t.toString)&&t.toString()==="[object FormData]"))},ha=_e("URLSearchParams"),[fa,ma,pa,xa]=["ReadableStream","Request","Response","Headers"].map(_e),ga=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function mt(t,n,{allOwnKeys:s=!1}={}){if(t===null||typeof t=="undefined")return;let r,a;if(typeof t!="object"&&(t=[t]),st(t))for(r=0,a=t.length;r<a;r++)n.call(null,t[r],r,t);else{if(ht(t))return;const u=s?Object.getOwnPropertyNames(t):Object.keys(t),l=u.length;let f;for(r=0;r<l;r++)f=u[r],n.call(null,t[f],f,t)}}function Is(t,n){if(ht(t))return null;n=n.toLowerCase();const s=Object.keys(t);let r=s.length,a;for(;r-- >0;)if(a=s[r],n===a.toLowerCase())return a;return null}const Ve=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,Ns=t=>!nt(t)&&t!==Ve;function mn(){const{caseless:t,skipUndefined:n}=Ns(this)&&this||{},s={},r=(a,u)=>{const l=t&&Is(s,u)||u;Ft(s[l])&&Ft(a)?s[l]=mn(s[l],a):Ft(a)?s[l]=mn({},a):st(a)?s[l]=a.slice():(!n||!nt(a))&&(s[l]=a)};for(let a=0,u=arguments.length;a<u;a++)arguments[a]&&mt(arguments[a],r);return s}const ya=(t,n,s,{allOwnKeys:r}={})=>(mt(n,(a,u)=>{s&&je(a)?t[u]=ks(a,s):t[u]=a},{allOwnKeys:r}),t),ja=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ba=(t,n,s,r)=>{t.prototype=Object.create(n.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:n.prototype}),s&&Object.assign(t.prototype,s)},va=(t,n,s,r)=>{let a,u,l;const f={};if(n=n||{},t==null)return n;do{for(a=Object.getOwnPropertyNames(t),u=a.length;u-- >0;)l=a[u],(!r||r(l,t,n))&&!f[l]&&(n[l]=t[l],f[l]=!0);t=s!==!1&&bn(t)}while(t&&(!s||s(t,n))&&t!==Object.prototype);return n},wa=(t,n,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=n.length;const r=t.indexOf(n,s);return r!==-1&&r===s},Ca=t=>{if(!t)return null;if(st(t))return t;let n=t.length;if(!Fs(n))return null;const s=new Array(n);for(;n-- >0;)s[n]=t[n];return s},Sa=(t=>n=>t&&n instanceof t)(typeof Uint8Array!="undefined"&&bn(Uint8Array)),_a=(t,n)=>{const r=(t&&t[Ht]).call(t);let a;for(;(a=r.next())&&!a.done;){const u=a.value;n.call(t,u[0],u[1])}},Ea=(t,n)=>{let s;const r=[];for(;(s=t.exec(n))!==null;)r.push(s);return r},Ra=_e("HTMLFormElement"),Aa=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,r,a){return r.toUpperCase()+a}),ns=(({hasOwnProperty:t})=>(n,s)=>t.call(n,s))(Object.prototype),Oa=_e("RegExp"),$s=(t,n)=>{const s=Object.getOwnPropertyDescriptors(t),r={};mt(s,(a,u)=>{let l;(l=n(a,u,t))!==!1&&(r[u]=l||a)}),Object.defineProperties(t,r)},Da=t=>{$s(t,(n,s)=>{if(je(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const r=t[s];if(je(r)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},Ma=(t,n)=>{const s={},r=a=>{a.forEach(u=>{s[u]=!0})};return st(t)?r(t):r(String(t).split(n)),s},ka=()=>{},Pa=(t,n)=>t!=null&&Number.isFinite(t=+t)?t:n;function Ta(t){return!!(t&&je(t.append)&&t[Ps]==="FormData"&&t[Ht])}const Fa=t=>{const n=new Array(10),s=(r,a)=>{if(ft(r)){if(n.indexOf(r)>=0)return;if(ht(r))return r;if(!("toJSON"in r)){n[a]=r;const u=st(r)?[]:{};return mt(r,(l,f)=>{const c=s(l,a+1);!nt(c)&&(u[f]=c)}),n[a]=void 0,u}}return r};return s(t,0)},Ia=_e("AsyncFunction"),Na=t=>t&&(ft(t)||je(t))&&je(t.then)&&je(t.catch),Ls=((t,n)=>t?setImmediate:n?((s,r)=>(Ve.addEventListener("message",({source:a,data:u})=>{a===Ve&&u===s&&r.length&&r.shift()()},!1),a=>{r.push(a),Ve.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",je(Ve.postMessage)),$a=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Ve):typeof process!="undefined"&&process.nextTick||Ls,La=t=>t!=null&&je(t[Ht]),x={isArray:st,isArrayBuffer:Ts,isBuffer:ht,isFormData:ua,isArrayBufferView:na,isString:sa,isNumber:Fs,isBoolean:ra,isObject:ft,isPlainObject:Ft,isEmptyObject:aa,isReadableStream:fa,isRequest:ma,isResponse:pa,isHeaders:xa,isUndefined:nt,isDate:ia,isFile:oa,isBlob:la,isRegExp:Oa,isFunction:je,isStream:da,isURLSearchParams:ha,isTypedArray:Sa,isFileList:ca,forEach:mt,merge:mn,extend:ya,trim:ga,stripBOM:ja,inherits:ba,toFlatObject:va,kindOf:qt,kindOfTest:_e,endsWith:wa,toArray:Ca,forEachEntry:_a,matchAll:Ea,isHTMLForm:Ra,hasOwnProperty:ns,hasOwnProp:ns,reduceDescriptors:$s,freezeMethods:Da,toObjectSet:Ma,toCamelCase:Aa,noop:ka,toFiniteNumber:Pa,findKey:Is,global:Ve,isContextDefined:Ns,isSpecCompliantForm:Ta,toJSONObject:Fa,isAsyncFn:Ia,isThenable:Na,setImmediate:Ls,asap:$a,isIterable:La};function G(t,n,s,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",n&&(this.code=n),s&&(this.config=s),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}x.inherits(G,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:x.toJSONObject(this.config),code:this.code,status:this.status}}});const Bs=G.prototype,Us={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Us[t]={value:t}});Object.defineProperties(G,Us);Object.defineProperty(Bs,"isAxiosError",{value:!0});G.from=(t,n,s,r,a,u)=>{const l=Object.create(Bs);x.toFlatObject(t,l,function(o){return o!==Error.prototype},i=>i!=="isAxiosError");const f=t&&t.message?t.message:"Error",c=n==null&&t?t.code:n;return G.call(l,f,c,s,r,a),t&&l.cause==null&&Object.defineProperty(l,"cause",{value:t,configurable:!0}),l.name=t&&t.name||"Error",u&&Object.assign(l,u),l};const Ba=null;function pn(t){return x.isPlainObject(t)||x.isArray(t)}function Ws(t){return x.endsWith(t,"[]")?t.slice(0,-2):t}function ss(t,n,s){return t?t.concat(n).map(function(a,u){return a=Ws(a),!s&&u?"["+a+"]":a}).join(s?".":""):n}function Ua(t){return x.isArray(t)&&!t.some(pn)}const Wa=x.toFlatObject(x,{},null,function(n){return/^is[A-Z]/.test(n)});function Jt(t,n,s){if(!x.isObject(t))throw new TypeError("target must be an object");n=n||new FormData,s=x.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,y){return!x.isUndefined(y[g])});const r=s.metaTokens,a=s.visitor||o,u=s.dots,l=s.indexes,c=(s.Blob||typeof Blob!="undefined"&&Blob)&&x.isSpecCompliantForm(n);if(!x.isFunction(a))throw new TypeError("visitor must be a function");function i(m){if(m===null)return"";if(x.isDate(m))return m.toISOString();if(x.isBoolean(m))return m.toString();if(!c&&x.isBlob(m))throw new G("Blob is not supported. Use a Buffer instead.");return x.isArrayBuffer(m)||x.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function o(m,g,y){let T=m;if(m&&!y&&typeof m=="object"){if(x.endsWith(g,"{}"))g=r?g:g.slice(0,-2),m=JSON.stringify(m);else if(x.isArray(m)&&Ua(m)||(x.isFileList(m)||x.endsWith(g,"[]"))&&(T=x.toArray(m)))return g=Ws(g),T.forEach(function(A,F){!(x.isUndefined(A)||A===null)&&n.append(l===!0?ss([g],F,u):l===null?g:g+"[]",i(A))}),!1}return pn(m)?!0:(n.append(ss(y,g,u),i(m)),!1)}const d=[],p=Object.assign(Wa,{defaultVisitor:o,convertValue:i,isVisitable:pn});function b(m,g){if(!x.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+g.join("."));d.push(m),x.forEach(m,function(T,k){(!(x.isUndefined(T)||T===null)&&a.call(n,T,x.isString(k)?k.trim():k,g,p))===!0&&b(T,g?g.concat(k):[k])}),d.pop()}}if(!x.isObject(t))throw new TypeError("data must be an object");return b(t),n}function rs(t){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return n[r]})}function vn(t,n){this._pairs=[],t&&Jt(t,this,n)}const zs=vn.prototype;zs.append=function(n,s){this._pairs.push([n,s])};zs.toString=function(n){const s=n?function(r){return n.call(this,r,rs)}:rs;return this._pairs.map(function(a){return s(a[0])+"="+s(a[1])},"").join("&")};function za(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ys(t,n,s){if(!n)return t;const r=s&&s.encode||za;x.isFunction(s)&&(s={serialize:s});const a=s&&s.serialize;let u;if(a?u=a(n,s):u=x.isURLSearchParams(n)?n.toString():new vn(n,s).toString(r),u){const l=t.indexOf("#");l!==-1&&(t=t.slice(0,l)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}class as{constructor(){this.handlers=[]}use(n,s,r){return this.handlers.push({fulfilled:n,rejected:s,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){x.forEach(this.handlers,function(r){r!==null&&n(r)})}}const Hs={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ya=typeof URLSearchParams!="undefined"?URLSearchParams:vn,Ha=typeof FormData!="undefined"?FormData:null,qa=typeof Blob!="undefined"?Blob:null,Va={isBrowser:!0,classes:{URLSearchParams:Ya,FormData:Ha,Blob:qa},protocols:["http","https","file","blob","url","data"]},wn=typeof window!="undefined"&&typeof document!="undefined",xn=typeof navigator=="object"&&navigator||void 0,Ja=wn&&(!xn||["ReactNative","NativeScript","NS"].indexOf(xn.product)<0),Qa=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ka=wn&&window.location.href||"http://localhost",Ga=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:wn,hasStandardBrowserEnv:Ja,hasStandardBrowserWebWorkerEnv:Qa,navigator:xn,origin:Ka},Symbol.toStringTag,{value:"Module"})),ye=K(K({},Ga),Va);function Xa(t,n){return Jt(t,new ye.classes.URLSearchParams,K({visitor:function(s,r,a,u){return ye.isNode&&x.isBuffer(s)?(this.append(r,s.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},n))}function Za(t){return x.matchAll(/\w+|\[(\w*)]/g,t).map(n=>n[0]==="[]"?"":n[1]||n[0])}function ei(t){const n={},s=Object.keys(t);let r;const a=s.length;let u;for(r=0;r<a;r++)u=s[r],n[u]=t[u];return n}function qs(t){function n(s,r,a,u){let l=s[u++];if(l==="__proto__")return!0;const f=Number.isFinite(+l),c=u>=s.length;return l=!l&&x.isArray(a)?a.length:l,c?(x.hasOwnProp(a,l)?a[l]=[a[l],r]:a[l]=r,!f):((!a[l]||!x.isObject(a[l]))&&(a[l]=[]),n(s,r,a[l],u)&&x.isArray(a[l])&&(a[l]=ei(a[l])),!f)}if(x.isFormData(t)&&x.isFunction(t.entries)){const s={};return x.forEachEntry(t,(r,a)=>{n(Za(r),a,s,0)}),s}return null}function ti(t,n,s){if(x.isString(t))try{return(n||JSON.parse)(t),x.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(s||JSON.stringify)(t)}const pt={transitional:Hs,adapter:["xhr","http","fetch"],transformRequest:[function(n,s){const r=s.getContentType()||"",a=r.indexOf("application/json")>-1,u=x.isObject(n);if(u&&x.isHTMLForm(n)&&(n=new FormData(n)),x.isFormData(n))return a?JSON.stringify(qs(n)):n;if(x.isArrayBuffer(n)||x.isBuffer(n)||x.isStream(n)||x.isFile(n)||x.isBlob(n)||x.isReadableStream(n))return n;if(x.isArrayBufferView(n))return n.buffer;if(x.isURLSearchParams(n))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let f;if(u){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Xa(n,this.formSerializer).toString();if((f=x.isFileList(n))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Jt(f?{"files[]":n}:n,c&&new c,this.formSerializer)}}return u||a?(s.setContentType("application/json",!1),ti(n)):n}],transformResponse:[function(n){const s=this.transitional||pt.transitional,r=s&&s.forcedJSONParsing,a=this.responseType==="json";if(x.isResponse(n)||x.isReadableStream(n))return n;if(n&&x.isString(n)&&(r&&!this.responseType||a)){const l=!(s&&s.silentJSONParsing)&&a;try{return JSON.parse(n,this.parseReviver)}catch(f){if(l)throw f.name==="SyntaxError"?G.from(f,G.ERR_BAD_RESPONSE,this,null,this.response):f}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ye.classes.FormData,Blob:ye.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};x.forEach(["delete","get","head","post","put","patch"],t=>{pt.headers[t]={}});const ni=x.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),si=t=>{const n={};let s,r,a;return t&&t.split(`
`).forEach(function(l){a=l.indexOf(":"),s=l.substring(0,a).trim().toLowerCase(),r=l.substring(a+1).trim(),!(!s||n[s]&&ni[s])&&(s==="set-cookie"?n[s]?n[s].push(r):n[s]=[r]:n[s]=n[s]?n[s]+", "+r:r)}),n},is=Symbol("internals");function ct(t){return t&&String(t).trim().toLowerCase()}function It(t){return t===!1||t==null?t:x.isArray(t)?t.map(It):String(t)}function ri(t){const n=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=s.exec(t);)n[r[1]]=r[2];return n}const ai=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function on(t,n,s,r,a){if(x.isFunction(r))return r.call(this,n,s);if(a&&(n=s),!!x.isString(n)){if(x.isString(r))return n.indexOf(r)!==-1;if(x.isRegExp(r))return r.test(n)}}function ii(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,s,r)=>s.toUpperCase()+r)}function oi(t,n){const s=x.toCamelCase(" "+n);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+s,{value:function(a,u,l){return this[r].call(this,n,a,u,l)},configurable:!0})})}let be=class{constructor(n){n&&this.set(n)}set(n,s,r){const a=this;function u(f,c,i){const o=ct(c);if(!o)throw new Error("header name must be a non-empty string");const d=x.findKey(a,o);(!d||a[d]===void 0||i===!0||i===void 0&&a[d]!==!1)&&(a[d||c]=It(f))}const l=(f,c)=>x.forEach(f,(i,o)=>u(i,o,c));if(x.isPlainObject(n)||n instanceof this.constructor)l(n,s);else if(x.isString(n)&&(n=n.trim())&&!ai(n))l(si(n),s);else if(x.isObject(n)&&x.isIterable(n)){let f={},c,i;for(const o of n){if(!x.isArray(o))throw TypeError("Object iterator must return a key-value pair");f[i=o[0]]=(c=f[i])?x.isArray(c)?[...c,o[1]]:[c,o[1]]:o[1]}l(f,s)}else n!=null&&u(s,n,r);return this}get(n,s){if(n=ct(n),n){const r=x.findKey(this,n);if(r){const a=this[r];if(!s)return a;if(s===!0)return ri(a);if(x.isFunction(s))return s.call(this,a,r);if(x.isRegExp(s))return s.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,s){if(n=ct(n),n){const r=x.findKey(this,n);return!!(r&&this[r]!==void 0&&(!s||on(this,this[r],r,s)))}return!1}delete(n,s){const r=this;let a=!1;function u(l){if(l=ct(l),l){const f=x.findKey(r,l);f&&(!s||on(r,r[f],f,s))&&(delete r[f],a=!0)}}return x.isArray(n)?n.forEach(u):u(n),a}clear(n){const s=Object.keys(this);let r=s.length,a=!1;for(;r--;){const u=s[r];(!n||on(this,this[u],u,n,!0))&&(delete this[u],a=!0)}return a}normalize(n){const s=this,r={};return x.forEach(this,(a,u)=>{const l=x.findKey(r,u);if(l){s[l]=It(a),delete s[u];return}const f=n?ii(u):String(u).trim();f!==u&&delete s[u],s[f]=It(a),r[f]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const s=Object.create(null);return x.forEach(this,(r,a)=>{r!=null&&r!==!1&&(s[a]=n&&x.isArray(r)?r.join(", "):r)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,s])=>n+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...s){const r=new this(n);return s.forEach(a=>r.set(a)),r}static accessor(n){const r=(this[is]=this[is]={accessors:{}}).accessors,a=this.prototype;function u(l){const f=ct(l);r[f]||(oi(a,l),r[f]=!0)}return x.isArray(n)?n.forEach(u):u(n),this}};be.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);x.reduceDescriptors(be.prototype,({value:t},n)=>{let s=n[0].toUpperCase()+n.slice(1);return{get:()=>t,set(r){this[s]=r}}});x.freezeMethods(be);function ln(t,n){const s=this||pt,r=n||s,a=be.from(r.headers);let u=r.data;return x.forEach(t,function(f){u=f.call(s,u,a.normalize(),n?n.status:void 0)}),a.normalize(),u}function Vs(t){return!!(t&&t.__CANCEL__)}function rt(t,n,s){G.call(this,t==null?"canceled":t,G.ERR_CANCELED,n,s),this.name="CanceledError"}x.inherits(rt,G,{__CANCEL__:!0});function Js(t,n,s){const r=s.config.validateStatus;!s.status||!r||r(s.status)?t(s):n(new G("Request failed with status code "+s.status,[G.ERR_BAD_REQUEST,G.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function li(t){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return n&&n[1]||""}function ci(t,n){t=t||10;const s=new Array(t),r=new Array(t);let a=0,u=0,l;return n=n!==void 0?n:1e3,function(c){const i=Date.now(),o=r[u];l||(l=i),s[a]=c,r[a]=i;let d=u,p=0;for(;d!==a;)p+=s[d++],d=d%t;if(a=(a+1)%t,a===u&&(u=(u+1)%t),i-l<n)return;const b=o&&i-o;return b?Math.round(p*1e3/b):void 0}}function di(t,n){let s=0,r=1e3/n,a,u;const l=(i,o=Date.now())=>{s=o,a=null,u&&(clearTimeout(u),u=null),t(...i)};return[(...i)=>{const o=Date.now(),d=o-s;d>=r?l(i,o):(a=i,u||(u=setTimeout(()=>{u=null,l(a)},r-d)))},()=>a&&l(a)]}const Wt=(t,n,s=3)=>{let r=0;const a=ci(50,250);return di(u=>{const l=u.loaded,f=u.lengthComputable?u.total:void 0,c=l-r,i=a(c),o=l<=f;r=l;const d={loaded:l,total:f,progress:f?l/f:void 0,bytes:c,rate:i||void 0,estimated:i&&f&&o?(f-l)/i:void 0,event:u,lengthComputable:f!=null,[n?"download":"upload"]:!0};t(d)},s)},os=(t,n)=>{const s=t!=null;return[r=>n[0]({lengthComputable:s,total:t,loaded:r}),n[1]]},ls=t=>(...n)=>x.asap(()=>t(...n)),ui=ye.hasStandardBrowserEnv?((t,n)=>s=>(s=new URL(s,ye.origin),t.protocol===s.protocol&&t.host===s.host&&(n||t.port===s.port)))(new URL(ye.origin),ye.navigator&&/(msie|trident)/i.test(ye.navigator.userAgent)):()=>!0,hi=ye.hasStandardBrowserEnv?{write(t,n,s,r,a,u,l){if(typeof document=="undefined")return;const f=[`${t}=${encodeURIComponent(n)}`];x.isNumber(s)&&f.push(`expires=${new Date(s).toUTCString()}`),x.isString(r)&&f.push(`path=${r}`),x.isString(a)&&f.push(`domain=${a}`),u===!0&&f.push("secure"),x.isString(l)&&f.push(`SameSite=${l}`),document.cookie=f.join("; ")},read(t){if(typeof document=="undefined")return null;const n=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return n?decodeURIComponent(n[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function fi(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function mi(t,n){return n?t.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):t}function Qs(t,n,s){let r=!fi(n);return t&&(r||s==!1)?mi(t,n):n}const cs=t=>t instanceof be?K({},t):t;function Qe(t,n){n=n||{};const s={};function r(i,o,d,p){return x.isPlainObject(i)&&x.isPlainObject(o)?x.merge.call({caseless:p},i,o):x.isPlainObject(o)?x.merge({},o):x.isArray(o)?o.slice():o}function a(i,o,d,p){if(x.isUndefined(o)){if(!x.isUndefined(i))return r(void 0,i,d,p)}else return r(i,o,d,p)}function u(i,o){if(!x.isUndefined(o))return r(void 0,o)}function l(i,o){if(x.isUndefined(o)){if(!x.isUndefined(i))return r(void 0,i)}else return r(void 0,o)}function f(i,o,d){if(d in n)return r(i,o);if(d in t)return r(void 0,i)}const c={url:u,method:u,data:u,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:f,headers:(i,o,d)=>a(cs(i),cs(o),d,!0)};return x.forEach(Object.keys(K(K({},t),n)),function(o){const d=c[o]||a,p=d(t[o],n[o],o);x.isUndefined(p)&&d!==f||(s[o]=p)}),s}const Ks=t=>{const n=Qe({},t);let{data:s,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:u,headers:l,auth:f}=n;if(n.headers=l=be.from(l),n.url=Ys(Qs(n.baseURL,n.url,n.allowAbsoluteUrls),t.params,t.paramsSerializer),f&&l.set("Authorization","Basic "+btoa((f.username||"")+":"+(f.password?unescape(encodeURIComponent(f.password)):""))),x.isFormData(s)){if(ye.hasStandardBrowserEnv||ye.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(x.isFunction(s.getHeaders)){const c=s.getHeaders(),i=["content-type","content-length"];Object.entries(c).forEach(([o,d])=>{i.includes(o.toLowerCase())&&l.set(o,d)})}}if(ye.hasStandardBrowserEnv&&(r&&x.isFunction(r)&&(r=r(n)),r||r!==!1&&ui(n.url))){const c=a&&u&&hi.read(u);c&&l.set(a,c)}return n},pi=typeof XMLHttpRequest!="undefined",xi=pi&&function(t){return new Promise(function(s,r){const a=Ks(t);let u=a.data;const l=be.from(a.headers).normalize();let{responseType:f,onUploadProgress:c,onDownloadProgress:i}=a,o,d,p,b,m;function g(){b&&b(),m&&m(),a.cancelToken&&a.cancelToken.unsubscribe(o),a.signal&&a.signal.removeEventListener("abort",o)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function T(){if(!y)return;const A=be.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),Q={data:!f||f==="text"||f==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:A,config:t,request:y};Js(function(se){s(se),g()},function(se){r(se),g()},Q),y=null}"onloadend"in y?y.onloadend=T:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(T)},y.onabort=function(){y&&(r(new G("Request aborted",G.ECONNABORTED,t,y)),y=null)},y.onerror=function(F){const Q=F&&F.message?F.message:"Network Error",Z=new G(Q,G.ERR_NETWORK,t,y);Z.event=F||null,r(Z),y=null},y.ontimeout=function(){let F=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const Q=a.transitional||Hs;a.timeoutErrorMessage&&(F=a.timeoutErrorMessage),r(new G(F,Q.clarifyTimeoutError?G.ETIMEDOUT:G.ECONNABORTED,t,y)),y=null},u===void 0&&l.setContentType(null),"setRequestHeader"in y&&x.forEach(l.toJSON(),function(F,Q){y.setRequestHeader(Q,F)}),x.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),f&&f!=="json"&&(y.responseType=a.responseType),i&&([p,m]=Wt(i,!0),y.addEventListener("progress",p)),c&&y.upload&&([d,b]=Wt(c),y.upload.addEventListener("progress",d),y.upload.addEventListener("loadend",b)),(a.cancelToken||a.signal)&&(o=A=>{y&&(r(!A||A.type?new rt(null,t,y):A),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(o),a.signal&&(a.signal.aborted?o():a.signal.addEventListener("abort",o)));const k=li(a.url);if(k&&ye.protocols.indexOf(k)===-1){r(new G("Unsupported protocol "+k+":",G.ERR_BAD_REQUEST,t));return}y.send(u||null)})},gi=(t,n)=>{const{length:s}=t=t?t.filter(Boolean):[];if(n||s){let r=new AbortController,a;const u=function(i){if(!a){a=!0,f();const o=i instanceof Error?i:this.reason;r.abort(o instanceof G?o:new rt(o instanceof Error?o.message:o))}};let l=n&&setTimeout(()=>{l=null,u(new G(`timeout ${n} of ms exceeded`,G.ETIMEDOUT))},n);const f=()=>{t&&(l&&clearTimeout(l),l=null,t.forEach(i=>{i.unsubscribe?i.unsubscribe(u):i.removeEventListener("abort",u)}),t=null)};t.forEach(i=>i.addEventListener("abort",u));const{signal:c}=r;return c.unsubscribe=()=>x.asap(f),c}},yi=function*(t,n){let s=t.byteLength;if(s<n){yield t;return}let r=0,a;for(;r<s;)a=r+n,yield t.slice(r,a),r=a},ji=function(t,n){return rn(this,null,function*(){try{for(var s=Kn(bi(t)),r,a,u;r=!(a=yield new We(s.next())).done;r=!1){const l=a.value;yield*an(yi(l,n))}}catch(a){u=[a]}finally{try{r&&(a=s.return)&&(yield new We(a.call(s)))}finally{if(u)throw u[0]}}})},bi=function(t){return rn(this,null,function*(){if(t[Symbol.asyncIterator]){yield*an(t);return}const n=t.getReader();try{for(;;){const{done:s,value:r}=yield new We(n.read());if(s)break;yield r}}finally{yield new We(n.cancel())}})},ds=(t,n,s,r)=>{const a=ji(t,n);let u=0,l,f=i=>{l||(l=!0,r&&r(i))};return new ReadableStream({pull(i){return V(this,null,function*(){try{const{done:o,value:d}=yield a.next();if(o){f(),i.close();return}let p=d.byteLength;if(s){let b=u+=p;s(b)}i.enqueue(new Uint8Array(d))}catch(o){throw f(o),o}})},cancel(i){return f(i),a.return()}},{highWaterMark:2})},us=64*1024,{isFunction:Dt}=x,vi=(({Request:t,Response:n})=>({Request:t,Response:n}))(x.global),{ReadableStream:hs,TextEncoder:fs}=x.global,ms=(t,...n)=>{try{return!!t(...n)}catch(s){return!1}},wi=t=>{t=x.merge.call({skipUndefined:!0},vi,t);const{fetch:n,Request:s,Response:r}=t,a=n?Dt(n):typeof fetch=="function",u=Dt(s),l=Dt(r);if(!a)return!1;const f=a&&Dt(hs),c=a&&(typeof fs=="function"?(m=>g=>m.encode(g))(new fs):m=>V(void 0,null,function*(){return new Uint8Array(yield new s(m).arrayBuffer())})),i=u&&f&&ms(()=>{let m=!1;const g=new s(ye.origin,{body:new hs,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!g}),o=l&&f&&ms(()=>x.isReadableStream(new r("").body)),d={stream:o&&(m=>m.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!d[m]&&(d[m]=(g,y)=>{let T=g&&g[m];if(T)return T.call(g);throw new G(`Response type '${m}' is not supported`,G.ERR_NOT_SUPPORT,y)})});const p=m=>V(void 0,null,function*(){if(m==null)return 0;if(x.isBlob(m))return m.size;if(x.isSpecCompliantForm(m))return(yield new s(ye.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(x.isArrayBufferView(m)||x.isArrayBuffer(m))return m.byteLength;if(x.isURLSearchParams(m)&&(m=m+""),x.isString(m))return(yield c(m)).byteLength}),b=(m,g)=>V(void 0,null,function*(){const y=x.toFiniteNumber(m.getContentLength());return y==null?p(g):y});return m=>V(void 0,null,function*(){let{url:g,method:y,data:T,signal:k,cancelToken:A,timeout:F,onDownloadProgress:Q,onUploadProgress:Z,responseType:se,headers:ue,withCredentials:oe="same-origin",fetchOptions:te}=Ks(m),C=n||fetch;se=se?(se+"").toLowerCase():"text";let H=gi([k,A&&A.toAbortSignal()],F),B=null;const D=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let _;try{if(Z&&i&&y!=="get"&&y!=="head"&&(_=yield b(ue,T))!==0){let R=new s(g,{method:"POST",body:T,duplex:"half"}),P;if(x.isFormData(T)&&(P=R.headers.get("content-type"))&&ue.setContentType(P),R.body){const[U,ne]=os(_,Wt(ls(Z)));T=ds(R.body,us,U,ne)}}x.isString(oe)||(oe=oe?"include":"omit");const E=u&&"credentials"in s.prototype,I=ee(K({},te),{signal:H,method:y.toUpperCase(),headers:ue.normalize().toJSON(),body:T,duplex:"half",credentials:E?oe:void 0});B=u&&new s(g,I);let j=yield u?C(B,te):C(g,I);const M=o&&(se==="stream"||se==="response");if(o&&(Q||M&&D)){const R={};["status","statusText","headers"].forEach(he=>{R[he]=j[he]});const P=x.toFiniteNumber(j.headers.get("content-length")),[U,ne]=Q&&os(P,Wt(ls(Q),!0))||[];j=new r(ds(j.body,us,U,()=>{ne&&ne(),D&&D()}),R)}se=se||"text";let O=yield d[x.findKey(d,se)||"text"](j,m);return!M&&D&&D(),yield new Promise((R,P)=>{Js(R,P,{data:O,headers:be.from(j.headers),status:j.status,statusText:j.statusText,config:m,request:B})})}catch(E){throw D&&D(),E&&E.name==="TypeError"&&/Load failed|fetch/i.test(E.message)?Object.assign(new G("Network Error",G.ERR_NETWORK,m,B),{cause:E.cause||E}):G.from(E,E&&E.code,m,B)}})},Ci=new Map,Gs=t=>{let n=t&&t.env||{};const{fetch:s,Request:r,Response:a}=n,u=[r,a,s];let l=u.length,f=l,c,i,o=Ci;for(;f--;)c=u[f],i=o.get(c),i===void 0&&o.set(c,i=f?new Map:wi(n)),o=i;return i};Gs();const Cn={http:Ba,xhr:xi,fetch:{get:Gs}};x.forEach(Cn,(t,n)=>{if(t){try{Object.defineProperty(t,"name",{value:n})}catch(s){}Object.defineProperty(t,"adapterName",{value:n})}});const ps=t=>`- ${t}`,Si=t=>x.isFunction(t)||t===null||t===!1;function _i(t,n){t=x.isArray(t)?t:[t];const{length:s}=t;let r,a;const u={};for(let l=0;l<s;l++){r=t[l];let f;if(a=r,!Si(r)&&(a=Cn[(f=String(r)).toLowerCase()],a===void 0))throw new G(`Unknown adapter '${f}'`);if(a&&(x.isFunction(a)||(a=a.get(n))))break;u[f||"#"+l]=a}if(!a){const l=Object.entries(u).map(([c,i])=>`adapter ${c} `+(i===!1?"is not supported by the environment":"is not available in the build"));let f=s?l.length>1?`since :
`+l.map(ps).join(`
`):" "+ps(l[0]):"as no adapter specified";throw new G("There is no suitable adapter to dispatch the request "+f,"ERR_NOT_SUPPORT")}return a}const Xs={getAdapter:_i,adapters:Cn};function cn(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new rt(null,t)}function xs(t){return cn(t),t.headers=be.from(t.headers),t.data=ln.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Xs.getAdapter(t.adapter||pt.adapter,t)(t).then(function(r){return cn(t),r.data=ln.call(t,t.transformResponse,r),r.headers=be.from(r.headers),r},function(r){return Vs(r)||(cn(t),r&&r.response&&(r.response.data=ln.call(t,t.transformResponse,r.response),r.response.headers=be.from(r.response.headers))),Promise.reject(r)})}const Zs="1.13.2",Qt={};["object","boolean","number","function","string","symbol"].forEach((t,n)=>{Qt[t]=function(r){return typeof r===t||"a"+(n<1?"n ":" ")+t}});const gs={};Qt.transitional=function(n,s,r){function a(u,l){return"[Axios v"+Zs+"] Transitional option '"+u+"'"+l+(r?". "+r:"")}return(u,l,f)=>{if(n===!1)throw new G(a(l," has been removed"+(s?" in "+s:"")),G.ERR_DEPRECATED);return s&&!gs[l]&&(gs[l]=!0,console.warn(a(l," has been deprecated since v"+s+" and will be removed in the near future"))),n?n(u,l,f):!0}};Qt.spelling=function(n){return(s,r)=>(console.warn(`${r} is likely a misspelling of ${n}`),!0)};function Ei(t,n,s){if(typeof t!="object")throw new G("options must be an object",G.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let a=r.length;for(;a-- >0;){const u=r[a],l=n[u];if(l){const f=t[u],c=f===void 0||l(f,u,t);if(c!==!0)throw new G("option "+u+" must be "+c,G.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new G("Unknown option "+u,G.ERR_BAD_OPTION)}}const Nt={assertOptions:Ei,validators:Qt},Oe=Nt.validators;let Je=class{constructor(n){this.defaults=n||{},this.interceptors={request:new as,response:new as}}request(n,s){return V(this,null,function*(){try{return yield this._request(n,s)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const u=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?u&&!String(r.stack).endsWith(u.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+u):r.stack=u}catch(l){}}throw r}})}_request(n,s){typeof n=="string"?(s=s||{},s.url=n):s=n||{},s=Qe(this.defaults,s);const{transitional:r,paramsSerializer:a,headers:u}=s;r!==void 0&&Nt.assertOptions(r,{silentJSONParsing:Oe.transitional(Oe.boolean),forcedJSONParsing:Oe.transitional(Oe.boolean),clarifyTimeoutError:Oe.transitional(Oe.boolean)},!1),a!=null&&(x.isFunction(a)?s.paramsSerializer={serialize:a}:Nt.assertOptions(a,{encode:Oe.function,serialize:Oe.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),Nt.assertOptions(s,{baseUrl:Oe.spelling("baseURL"),withXsrfToken:Oe.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let l=u&&x.merge(u.common,u[s.method]);u&&x.forEach(["delete","get","head","post","put","patch","common"],m=>{delete u[m]}),s.headers=be.concat(l,u);const f=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(s)===!1||(c=c&&g.synchronous,f.unshift(g.fulfilled,g.rejected))});const i=[];this.interceptors.response.forEach(function(g){i.push(g.fulfilled,g.rejected)});let o,d=0,p;if(!c){const m=[xs.bind(this),void 0];for(m.unshift(...f),m.push(...i),p=m.length,o=Promise.resolve(s);d<p;)o=o.then(m[d++],m[d++]);return o}p=f.length;let b=s;for(;d<p;){const m=f[d++],g=f[d++];try{b=m(b)}catch(y){g.call(this,y);break}}try{o=xs.call(this,b)}catch(m){return Promise.reject(m)}for(d=0,p=i.length;d<p;)o=o.then(i[d++],i[d++]);return o}getUri(n){n=Qe(this.defaults,n);const s=Qs(n.baseURL,n.url,n.allowAbsoluteUrls);return Ys(s,n.params,n.paramsSerializer)}};x.forEach(["delete","get","head","options"],function(n){Je.prototype[n]=function(s,r){return this.request(Qe(r||{},{method:n,url:s,data:(r||{}).data}))}});x.forEach(["post","put","patch"],function(n){function s(r){return function(u,l,f){return this.request(Qe(f||{},{method:n,headers:r?{"Content-Type":"multipart/form-data"}:{},url:u,data:l}))}}Je.prototype[n]=s(),Je.prototype[n+"Form"]=s(!0)});let Ri=class er{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(u){s=u});const r=this;this.promise.then(a=>{if(!r._listeners)return;let u=r._listeners.length;for(;u-- >0;)r._listeners[u](a);r._listeners=null}),this.promise.then=a=>{let u;const l=new Promise(f=>{r.subscribe(f),u=f}).then(a);return l.cancel=function(){r.unsubscribe(u)},l},n(function(u,l,f){r.reason||(r.reason=new rt(u,l,f),s(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const s=this._listeners.indexOf(n);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const n=new AbortController,s=r=>{n.abort(r)};return this.subscribe(s),n.signal.unsubscribe=()=>this.unsubscribe(s),n.signal}static source(){let n;return{token:new er(function(a){n=a}),cancel:n}}};function Ai(t){return function(s){return t.apply(null,s)}}function Oi(t){return x.isObject(t)&&t.isAxiosError===!0}const gn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(gn).forEach(([t,n])=>{gn[n]=t});function tr(t){const n=new Je(t),s=ks(Je.prototype.request,n);return x.extend(s,Je.prototype,n,{allOwnKeys:!0}),x.extend(s,n,null,{allOwnKeys:!0}),s.create=function(a){return tr(Qe(t,a))},s}const de=tr(pt);de.Axios=Je;de.CanceledError=rt;de.CancelToken=Ri;de.isCancel=Vs;de.VERSION=Zs;de.toFormData=Jt;de.AxiosError=G;de.Cancel=de.CanceledError;de.all=function(n){return Promise.all(n)};de.spread=Ai;de.isAxiosError=Oi;de.mergeConfig=Qe;de.AxiosHeaders=be;de.formToJSON=t=>qs(x.isHTMLForm(t)?new FormData(t):t);de.getAdapter=Xs.getAdapter;de.HttpStatusCode=gn;de.default=de;const{Axios:ho,AxiosError:fo,CanceledError:mo,isCancel:po,CancelToken:xo,VERSION:go,all:yo,Cancel:jo,isAxiosError:bo,spread:vo,toFormData:wo,AxiosHeaders:Co,HttpStatusCode:So,formToJSON:_o,getAdapter:Eo,mergeConfig:Ro}=de,Di="/api",Mi=Di,L=de.create({baseURL:Mi});L.interceptors.request.use(t=>{const n=localStorage.getItem("token");return n&&(t.headers=ee(K({},t.headers),{Authorization:`Bearer ${n}`})),t});L.interceptors.response.use(t=>t,t=>{var s;return((s=t==null?void 0:t.response)==null?void 0:s.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("name"),localStorage.removeItem("userId"),typeof window!="undefined"&&window.location.pathname!=="/"&&window.location.assign("/")),Promise.reject(t)});const nr=v.createContext(void 0),ki=({children:t})=>{const[n,s]=v.useState({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!1});v.useEffect(()=>{V(void 0,null,function*(){const f=localStorage.getItem("token"),c=localStorage.getItem("role"),i=localStorage.getItem("name"),o=localStorage.getItem("userId");if(f)try{const d=yield L.get("/auth/me",{headers:{Authorization:`Bearer ${f}`}}),p=d.data.role;localStorage.setItem("role",p),localStorage.setItem("name",d.data.full_name),localStorage.setItem("userId",d.data.id),s({token:f,role:p,name:d.data.full_name,userId:d.data.id,mustChangePassword:!!d.data.must_change_password,ready:!0});return}catch(d){localStorage.clear(),s({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!0});return}(c||i||o)&&localStorage.clear(),s({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!0})})},[]);const r=()=>V(void 0,null,function*(){const l=localStorage.getItem("token");if(!l)return;const f=yield L.get("/auth/me",{headers:{Authorization:`Bearer ${l}`}}),c=f.data.role;localStorage.setItem("role",c),localStorage.setItem("name",f.data.full_name),localStorage.setItem("userId",f.data.id),s({token:l,role:c,name:f.data.full_name,userId:f.data.id,mustChangePassword:!!f.data.must_change_password,ready:!0})}),a=(l,f,c,i)=>V(void 0,null,function*(){const o=yield L.post("/auth/token",{email:l,password:f,mfa_code:c,recovery_code:i}),d=o.data.access_token;localStorage.setItem("token",d);const p=yield L.get("/auth/me",{headers:{Authorization:`Bearer ${d}`}}),b=p.data.role;return localStorage.setItem("role",b),localStorage.setItem("name",p.data.full_name),localStorage.setItem("userId",p.data.id),s({token:d,role:b,name:p.data.full_name,userId:p.data.id,mustChangePassword:!!p.data.must_change_password,ready:!0}),o.data}),u=()=>{localStorage.clear(),s({token:null,role:null,name:null,userId:null,mustChangePassword:!1,ready:!0})};return e.jsx(nr.Provider,{value:ee(K({},n),{login:a,logout:u,refreshMe:r}),children:t})},at=()=>{const t=v.useContext(nr);if(!t)throw new Error("useAuth must be used within AuthProvider");return t},Pi={new:"default",acknowledged:"primary",in_investigation:"warning",response_drafted:"secondary",final_response_issued:"success",closed:"success",reopened:"default"},Ti=t=>t.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),zt=({status:t})=>{const n=typeof t=="string"?t.toLowerCase():t;return e.jsx(me,{size:"small",label:Ti(n),color:Pi[n]||"default"})};function Fi(){const t=ut(),n=jn(),{userId:s,token:r}=at(),[a,u]=v.useState(null),[l,f]=v.useState([]),[c,i]=v.useState("mine"),[o,d]=v.useState(!1),[p,b]=v.useState(!1);v.useEffect(()=>{r&&L.get("/complaints/metrics",{params:{_:Date.now()}}).then(g=>u(g.data)).catch(g=>{var y;((y=g==null?void 0:g.response)==null?void 0:y.status)!==401&&console.error("Failed to load dashboard metrics",g)})},[r,n.pathname]),v.useEffect(()=>{if(!s||!r)return;V(this,null,function*(){var y;b(!0);try{if(c==="mine"){const k=((yield L.get("/complaints",{params:{handler_id:s,page:1,page_size:50,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed");f(dn(k));return}if(c==="unassigned"){const k=((yield L.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed").filter(A=>!A.assigned_handler_id);f(dn(k));return}if(c==="breached"){const k=((yield L.get("/complaints",{params:{overdue:!0,page:1,page_size:100,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed");f(dn(k));return}if(c==="oldest"){const k=((yield L.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(A=>A.status!=="closed");k.sort((A,F)=>ie(A.received_at).valueOf()-ie(F.received_at).valueOf()),f(k.slice(0,20));return}}catch(T){if(((y=T==null?void 0:T.response)==null?void 0:y.status)===401)return;console.error("Failed to load dashboard queue",T)}finally{b(!1)}})},[c,s,r,n.pathname]);const m=v.useMemo(()=>a!=null&&a.as_of?ie(a.as_of).format("DD MMM YYYY HH:mm"):null,[a==null?void 0:a.as_of]);return e.jsxs(ae,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:1},children:[e.jsx(w,{variant:"h5",children:"Dashboard"}),m&&e.jsxs(w,{variant:"caption",color:"text.secondary",children:["As of ",m]})]}),e.jsxs(S,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(Mt,{title:"Open now",value:a==null?void 0:a.kpis.open,subtitle:"All open complaints",onClick:()=>i("oldest")})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(Mt,{title:"My open",value:a==null?void 0:a.kpis.my_open,subtitle:"Assigned to you",onClick:()=>i("mine")})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(Mt,{title:"SLA breached (open)",value:a==null?void 0:a.kpis.open_sla_breaches,subtitle:"Ack or Final breached",onClick:()=>i("breached")})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(Mt,{title:"Stale (21d+)",value:a==null?void 0:a.kpis.open_stale_21d,subtitle:"No activity 21+ days",onClick:()=>i("oldest")})})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx(kt,{title:"SLA & Aging",children:e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(le,{sx:{height:"100%"},children:e.jsxs(ce,{children:[e.jsx(w,{variant:"subtitle2",children:"SLA performance (30d)"}),e.jsxs(z,{spacing:1.5,sx:{mt:1},children:[e.jsx(ys,{label:"Ack",item:a.sla_30d.ack}),e.jsx(ys,{label:"Final",item:a.sla_30d.final})]})]})})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(le,{sx:{height:"100%"},children:e.jsxs(ce,{children:[e.jsx(w,{variant:"subtitle2",children:"Aging (open)"}),e.jsxs(z,{spacing:1.2,sx:{mt:1},children:[e.jsx(Pt,{label:"07 days",value:a.aging_open["0-7"],total:a.kpis.open}),e.jsx(Pt,{label:"821 days",value:a.aging_open["8-21"],total:a.kpis.open}),e.jsx(Pt,{label:"2256 days",value:a.aging_open["22-56"],total:a.kpis.open}),e.jsx(Pt,{label:"56+ days",value:a.aging_open["56+"],total:a.kpis.open})]})]})})})]})}),e.jsx(kt,{title:"Workload",children:e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(le,{sx:{height:"100%"},children:e.jsxs(ce,{children:[e.jsx(w,{variant:"subtitle2",children:"Open by handler"}),e.jsx(z,{spacing:.75,sx:{mt:1},children:a.workload_open_by_handler.slice(0,6).map(g=>e.jsxs(z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(w,{variant:"body2",children:g.name}),e.jsx(w,{variant:"body2",fontWeight:700,children:g.count})]},g.id))})]})})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(le,{sx:{height:"100%"},children:e.jsxs(ce,{children:[e.jsx(w,{variant:"subtitle2",children:"Flow (last 7d)"}),e.jsxs(z,{direction:"row",spacing:2,sx:{mt:1},children:[e.jsx(js,{label:"New",value:a.flow_7d.new}),e.jsx(js,{label:"Closed",value:a.flow_7d.closed})]}),e.jsx(w,{variant:"subtitle2",sx:{mt:2},children:"Open status"}),e.jsx(z,{spacing:.6,sx:{mt:1},children:Object.entries(a.status_open).sort((g,y)=>y[1]-g[1]).slice(0,6).map(([g,y])=>e.jsxs(z,{direction:"row",justifyContent:"space-between",children:[e.jsx(w,{variant:"body2",children:g.replace(/_/g," ")}),e.jsx(w,{variant:"body2",fontWeight:700,children:y})]},g))})]})})})]})}),e.jsx(kt,{title:"Risk & Compliance",children:e.jsx(le,{children:e.jsxs(ce,{children:[e.jsxs(S,{container:!0,spacing:2,children:[e.jsxs(S,{item:!0,xs:12,md:3,children:[e.jsx(w,{variant:"subtitle2",children:"Vulnerable (open)"}),e.jsx(w,{variant:"h5",children:a.risk.open_vulnerable.count}),e.jsx(w,{variant:"caption",color:"text.secondary",children:$t(a.risk.open_vulnerable.pct_of_open)})]}),e.jsxs(S,{item:!0,xs:12,md:3,children:[e.jsx(w,{variant:"subtitle2",children:"Escalated (open)"}),e.jsx(w,{variant:"h5",children:a.risk.escalated_open}),e.jsx(w,{variant:"caption",color:"text.secondary",children:"Current open escalations"})]}),e.jsxs(S,{item:!0,xs:12,md:3,children:[e.jsx(w,{variant:"subtitle2",children:"Reopened (all time)"}),e.jsx(w,{variant:"h5",children:a.risk.reopened.count}),e.jsx(w,{variant:"caption",color:"text.secondary",children:$t(a.risk.reopened.pct_all_time)})]}),e.jsxs(S,{item:!0,xs:12,md:3,children:[e.jsx(w,{variant:"subtitle2",children:"Final attachments (open)"}),e.jsx(w,{variant:"h5",children:$t(a.risk.final_attachment_open_pct)}),e.jsx(w,{variant:"caption",color:"text.secondary",children:"Coverage on open cases"})]})]}),e.jsxs(Fr,{in:o,unmountOnExit:!0,children:[e.jsx(As,{sx:{my:2}}),e.jsx(w,{variant:"subtitle2",children:"Notes"}),e.jsx(w,{variant:"body2",color:"text.secondary",children:"Stale means no communications in 21+ days (or received date if no comms)."})]}),e.jsx($,{size:"small",onClick:()=>d(g=>!g),sx:{mt:1},children:o?"Hide details":"View details"})]})})}),e.jsx(kt,{title:"My Queue",children:e.jsxs(le,{children:[e.jsx(ce,{sx:{pb:1},children:e.jsxs(Os,{value:c,onChange:(g,y)=>i(y),variant:"scrollable",scrollButtons:"auto",children:[e.jsx(Ie,{value:"mine",label:"Assigned to me"}),e.jsx(Ie,{value:"unassigned",label:"Unassigned"}),e.jsx(Ie,{value:"breached",label:"SLA breached"}),e.jsx(Ie,{value:"oldest",label:"Oldest open"})]})}),p&&e.jsx(yn,{}),e.jsxs(Tt,{dense:!0,children:[!p&&l.length===0&&e.jsx(Ye,{children:e.jsx(He,{primary:"No items"})}),l.map(g=>{var y,T;return e.jsxs(Ye,{button:!0,onClick:()=>t(`/complaints/${g.id}`),children:[e.jsx(He,{primary:`${g.reference} - ${(T=(y=g.complainant)==null?void 0:y.full_name)!=null?T:"Unknown"}`,secondary:Ii(g)}),e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",children:[g.ack_breached||g.final_breached?e.jsx(me,{size:"small",label:"Breach"}):null,e.jsx(zt,{status:g.status})]})]},g.id)})]})]})})]})]})}function Mt({title:t,value:n,subtitle:s,onClick:r}){const a=e.jsxs(ce,{children:[e.jsx(w,{variant:"subtitle2",children:t}),e.jsx(w,{variant:"h4",children:n!=null?n:""}),s&&e.jsx(w,{variant:"caption",color:"text.secondary",children:s})]});return e.jsx(le,{sx:{height:"100%"},children:r?e.jsx(Ir,{onClick:r,sx:{height:"100%"},children:a}):a})}function kt({title:t,children:n}){return e.jsxs(ae,{sx:{mb:3},children:[e.jsxs(z,{direction:"row",alignItems:"center",spacing:1,sx:{mb:1},children:[e.jsx(w,{variant:"subtitle1",children:t}),e.jsx(As,{sx:{flexGrow:1}})]}),n]})}function ys({label:t,item:n}){const s=n.on_time_pct;return e.jsxs(ae,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",children:[e.jsx(w,{variant:"body2",fontWeight:700,children:t}),e.jsx(w,{variant:"body2",color:"text.secondary",children:n.total>0?`${n.on_time}/${n.total}`:""})]}),e.jsx(z,{direction:"row",justifyContent:"space-between",sx:{mt:.3},children:e.jsx(w,{variant:"body1",children:$t(s)})}),e.jsx(yn,{variant:"determinate",value:s!=null?s:0,sx:{mt:.6}})]})}function Pt({label:t,value:n,total:s}){const r=s>0?n/s*100:0;return e.jsxs(ae,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",children:[e.jsx(w,{variant:"body2",children:t}),e.jsx(w,{variant:"body2",fontWeight:700,children:n})]}),e.jsx(yn,{variant:"determinate",value:r,sx:{mt:.5}})]})}function js({label:t,value:n}){return e.jsxs(ae,{children:[e.jsx(w,{variant:"subtitle2",children:t}),e.jsx(w,{variant:"h5",children:n})]})}function $t(t){return t!=null?`${t.toFixed(0)}%`:""}function Ii(t){const n=t.received_at?ie(t.received_at).format("DD MMM YYYY"):"";return[t.product?t.product:"",`Received ${n}`].filter(Boolean).join("  ")}function dn(t){return[...t].sort((n,s)=>{const r=n.ack_breached||n.final_breached?1:0,a=s.ack_breached||s.final_breached?1:0;return r!==a?a-r:ie(n.received_at).valueOf()-ie(s.received_at).valueOf()})}const Ni=["New","Acknowledged","In Investigation","Response Drafted","Final Response Issued","Closed","Reopened"];function $i(){const[t,n]=v.useState([]),[s,r]=v.useState([]),[a,u]=v.useState(""),[l,f]=v.useState(""),c=ut(),i=()=>{L.get("/complaints",{params:{status_filter:a||void 0,search:l||void 0}}).then(o=>n(o.data))};return v.useEffect(()=>{i(),L.get("/users").then(o=>r(o.data))},[]),e.jsxs(ae,{children:[e.jsx(w,{variant:"h5",gutterBottom:!0,children:"Complaints"}),e.jsx(le,{sx:{mb:2},children:e.jsx(ce,{children:e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(N,{select:!0,label:"Status",fullWidth:!0,size:"small",value:a,onChange:o=>u(o.target.value),children:[e.jsx(X,{value:"",children:"All"}),Ni.map(o=>e.jsx(X,{value:o,children:o},o))]})}),e.jsx(S,{item:!0,xs:12,md:5,children:e.jsx(N,{label:"Search ref / policy / name",fullWidth:!0,size:"small",value:l,onChange:o=>f(o.target.value)})}),e.jsxs(S,{item:!0,xs:12,md:4,display:"flex",alignItems:"center",gap:1,children:[e.jsx($,{variant:"contained",onClick:i,children:"Apply"}),e.jsx($,{component:Fe,to:"/complaints/new",children:"New complaint"})]})]})})}),e.jsx(le,{children:e.jsxs(Lt,{size:"small",children:[e.jsx(Bt,{children:e.jsxs(we,{children:[e.jsx(J,{children:"Reference"}),e.jsx(J,{children:"Complainant"}),e.jsx(J,{children:"Product"}),e.jsx(J,{children:"Handler"}),e.jsx(J,{children:"Received"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Due (Final)"})]})}),e.jsx(Ut,{children:t.map(o=>{var d;return e.jsxs(we,{hover:!0,sx:{cursor:"pointer"},onClick:()=>c(`/complaints/${o.id}`),children:[e.jsx(J,{children:o.reference}),e.jsx(J,{children:(d=o.complainant)==null?void 0:d.full_name}),e.jsx(J,{children:o.product}),e.jsx(J,{children:o.assigned_handler_name||"Unassigned"}),e.jsx(J,{children:ie(o.received_at).format("DD MMM YYYY")}),e.jsx(J,{children:e.jsx(zt,{status:o.status})}),e.jsx(J,{children:ie(o.final_due_at).format("DD MMM YYYY")})]},o.id)})})]})})]})}const bs=[{value:"financial_loss",label:"Financial Loss (Direct Loss)"},{value:"interest_on_financial_loss",label:"Interest on Financial Loss"},{value:"distress_and_inconvenience",label:"Distress and Inconvenience"},{value:"consequential_loss",label:"Consequential Loss"},{value:"premium_refund_adjustment",label:"Premium Refund / Adjustment"},{value:"goodwill_payment",label:"Goodwill Payment"},{value:"third_party_payment",label:"Third-Party Payment"},{value:"apology_or_explanation",label:"Apology / Explanation (Non-monetary)"},{value:"remedial_action",label:"Remedial Action (Non-monetary)"}],vs=["financial_loss","interest_on_financial_loss","distress_and_inconvenience","consequential_loss","premium_refund_adjustment","goodwill_payment","third_party_payment"],ws="";function Li(){var Hn,qn;const{id:t}=Gr(),n=ut(),[s,r]=v.useState(null),[a,u]=v.useState(0),{role:l,name:f,userId:c}=at(),[i,o]=v.useState("email"),[d,p]=v.useState("outbound"),[b,m]=v.useState(""),[g,y]=v.useState(ie().format("YYYY-MM-DDTHH:mm")),[T,k]=v.useState(null),[A,F]=v.useState(!1),[Q,Z]=v.useState(!1),[se,ue]=v.useState("upheld"),[oe,te]=v.useState(""),[C,H]=v.useState(!1),[B,D]=v.useState(""),[_,E]=v.useState("goodwill_payment"),[I,j]=v.useState("pending"),[M,O]=v.useState(""),[R,P]=v.useState(""),[U,ne]=v.useState(""),[he,De]=v.useState("not_started"),[Ee,Te]=v.useState(!1),[Re,fe]=v.useState(!1),[Ce,Me]=v.useState(null),[Ge,Sn]=v.useState(!1),[_n,En]=v.useState(""),[Kt,Rn]=v.useState(ie().format("YYYY-MM-DD")),[An,On]=v.useState(!1),[Xe,ir]=v.useState([]),[xt,Gt]=v.useState(""),[it,gt]=v.useState(!1),[or,yt]=v.useState(!1),[jt,Dn]=v.useState(""),[bt,Mn]=v.useState(!1),[lr,vt]=v.useState(!1),[Xt,kn]=v.useState(!1),[Pn,Tn]=v.useState(!1),[cr,ot]=v.useState(!1),[wt,dr]=v.useState("standard"),[lt,ur]=v.useState(ie().format("YYYY-MM-DD")),[Zt,en]=v.useState(""),[Fn,Ct]=v.useState(null),[hr,St]=v.useState(!1),[_t,In]=v.useState(""),[tn,Nn]=v.useState(ie().format("YYYY-MM-DD")),[Et,$n]=v.useState(!1),ke=vs.includes(_),fr=h=>{var Y;return((Y=bs.find(q=>q.value===h))==null?void 0:Y.label)||h},[Ln,mr]=v.useState([]),[Ue,Rt]=v.useState(!1),[nn,Bn]=v.useState(!1),[W,pe]=v.useState({source:"",received_at:"",description:"",category:"",reason:"",fca_complaint:!1,vulnerability_flag:!1,vulnerability_notes:"",complainant:{full_name:"",email:"",phone:""},policy:{policy_number:"",product:"",insurer:"",broker:"",scheme:""}}),[sn,pr]=v.useState({products:[],insurers:[],brokers:[]}),xr=["Policy Administration","Sales and Advice","Pricing and Premiums","Claims Handling","Customer Service","Cancellations and Refunds","Disclosure and Documentation","Vulnerability and Customer Treatment","Data Protection and Privacy","Third-Party / Supplier Issues","Fraud or Financial Crime","Other / Unclassified"],Un=(h,Y)=>V(this,null,function*(){s&&(yield L.patch(`/complaints/${s.id}/redress/${h}`,Y),xe())});v.useEffect(()=>{var h,Y,q,re,ge,Se,ve,Ae;Ue&&s&&pe({source:s.source||"",received_at:ie(s.received_at).format("YYYY-MM-DD"),description:s.description||"",category:s.category||"",reason:s.reason||"",fca_complaint:s.fca_complaint||!1,vulnerability_flag:s.vulnerability_flag||!1,vulnerability_notes:s.vulnerability_notes||"",complainant:{full_name:((h=s.complainant)==null?void 0:h.full_name)||"",email:((Y=s.complainant)==null?void 0:Y.email)||"",phone:((q=s.complainant)==null?void 0:q.phone)||""},policy:{policy_number:s.policy_number||((re=s.policy)==null?void 0:re.policy_number)||"",product:s.product||((ge=s.policy)==null?void 0:ge.product)||"",insurer:s.insurer||((Se=s.policy)==null?void 0:Se.insurer)||"",broker:s.broker||((ve=s.policy)==null?void 0:ve.broker)||"",scheme:s.scheme||((Ae=s.policy)==null?void 0:Ae.scheme)||""}})},[Ue,s]),v.useEffect(()=>{Ue&&V(this,null,function*(){try{const[Y,q,re]=yield Promise.all([L.get("/reference/products"),L.get("/reference/insurers"),L.get("/reference/brokers")]);pr({products:Y.data,insurers:q.data,brokers:re.data})}catch(Y){}})},[Ue]);const gr=()=>V(this,null,function*(){var h,Y;if(s){Bn(!0);try{const q={source:W.source,received_at:ie(W.received_at).toISOString(),description:W.description,category:W.category,reason:W.reason||null,fca_complaint:W.fca_complaint,vulnerability_flag:W.vulnerability_flag,vulnerability_notes:W.vulnerability_notes||null,complainant:W.complainant,policy:W.policy};yield L.patch(`/complaints/${s.id}`,q),Rt(!1),xe()}catch(q){console.error("Failed to update complaint",q);let re="Failed to update complaint";if((Y=(h=q==null?void 0:q.response)==null?void 0:h.data)!=null&&Y.detail){const ge=q.response.data.detail;Array.isArray(ge)?re=ge.map(ve=>{var At;const Ae=((At=ve.loc)==null?void 0:At.join("."))||"field",Ze=ve.msg||"validation error";return`${Ae}: ${Ze}`}).join(`
`):typeof ge=="string"&&(re=ge)}alert(`Error: ${re}`)}finally{Bn(!1)}}}),Wn=(Hn=s==null?void 0:s.communications)!=null&&Hn.length?s.communications.map(h=>h.occurred_at).sort().slice(-1)[0]:null,xe=()=>{L.get(`/complaints/${t}`,{params:{_:Date.now()}}).then(h=>r(h.data)),L.get(`/complaints/${t}/events`).then(h=>mr(h.data))};v.useEffect(()=>{xe()},[t]),v.useEffect(()=>{l&&l!=="read_only"&&L.get("/users").then(h=>ir(h.data))},[l]);const zn=h=>V(this,null,function*(){yield L.post(`/complaints/${t}/${h}`),xe()}),yr=()=>V(this,null,function*(){if(s){H(!0);try{yield L.post(`/complaints/${s.id}/outcome`,{outcome:se,notes:oe||null}),xe()}finally{H(!1)}}}),jr=()=>V(this,null,function*(){var Y,q;if(!s)return;const h=ke;if(!(h&&B==="")&&!(h&&!R.trim())&&!(!h&&!U.trim())){fe(!0);try{yield L.post(`/complaints/${s.id}/redress`,{amount:h?Number(B):null,payment_type:_,status:h?I:"pending",notes:M||null,outcome_id:(q=(Y=s.outcome)==null?void 0:Y.id)!=null?q:null,rationale:R||null,action_description:U||null,action_status:he,approved:h?Ee:!1}),D(""),O(""),E("goodwill_payment"),j("pending"),P(""),ne(""),De("not_started"),Te(!1),xe()}finally{fe(!1)}}}),br=()=>V(this,null,function*(){var Y,q;if(!s||!b||Q&&!s.outcome)return;F(!0);const h=new FormData;h.append("channel",i),h.append("direction",d),h.append("summary",b),h.append("occurred_at",new Date(g).toISOString()),h.append("is_final_response",String(Q)),T&&Array.from(T).forEach(re=>h.append("files",re));try{yield L.post(`/complaints/${s.id}/communications`,h),m(""),k(null),y(ie().format("YYYY-MM-DDTHH:mm")),Z(!1),xe()}catch(re){console.error("Failed to add communication",re);let ge="Failed to add communication";if((q=(Y=re==null?void 0:re.response)==null?void 0:Y.data)!=null&&q.detail){const Se=re.response.data.detail;Array.isArray(Se)?ge=Se.map(Ae=>{var Vn;const Ze=((Vn=Ae.loc)==null?void 0:Vn.join("."))||"field",At=Ae.msg||"validation error";return`${Ze}: ${At}`}).join(`
`):typeof Se=="string"?ge=Se:ge=JSON.stringify(Se)}else re!=null&&re.message&&(ge=re.message);alert(`Error: ${ge}`)}finally{F(!1)}}),vr=()=>V(this,null,function*(){if(s){On(!0);try{yield L.post(`/complaints/${s.id}/reopen`,{reason:_n||null,reopened_at:Kt?new Date(Kt).toISOString():null}),Sn(!1),En(""),Rn(ie().format("YYYY-MM-DD")),xe()}finally{On(!1)}}}),wr=()=>{var q;const h=Xe.filter(re=>re.role==="complaints_manager"),Y=(s!=null&&s.assigned_handler_id&&h.some(re=>re.id===s.assigned_handler_id)?s.assigned_handler_id:(q=h[0])==null?void 0:q.id)||"";Dn(Y),yt(!0)},Cr=()=>V(this,null,function*(){if(!(!s||!jt)){gt(!0);try{yield L.post(`/complaints/${s.id}/escalate`,{manager_id:jt}),yt(!1),xe()}finally{gt(!1)}}}),Sr=()=>V(this,null,function*(){if(s){gt(!0);try{yield L.patch(`/complaints/${s.id}`,{is_escalated:!1}),xe()}finally{gt(!1)}}}),_r=()=>V(this,null,function*(){xt&&(yield L.post(`/complaints/${t}/assign`,null,{params:{handler_id:xt}}),Gt(""),xe())}),Er=()=>V(this,null,function*(){var h,Y;Mn(!0),Ct(null);try{yield L.post(`/complaints/${t}/close-non-reportable`,{closed_at:lt?new Date(lt).toISOString():null,comment:Zt||null}),ot(!1),en(""),xe()}catch(q){const re=(Y=(h=q==null?void 0:q.response)==null?void 0:h.data)==null?void 0:Y.detail;Ct(re||"Could not close as non-reportable")}finally{Mn(!1)}}),Rr=()=>V(this,null,function*(){var h,Y;Tn(!0),Ct(null);try{yield L.post(`/complaints/${t}/close`,{closed_at:lt?new Date(lt).toISOString():null,comment:Zt||null}),ot(!1),en(""),xe()}catch(q){const re=(Y=(h=q==null?void 0:q.response)==null?void 0:h.data)==null?void 0:Y.detail;Ct(re||"Could not close complaint")}finally{Tn(!1)}}),Yn=h=>{dr(h),ot(!0)},Ar=()=>V(this,null,function*(){var h,Y;if(t){kn(!0);try{yield L.delete(`/complaints/${t}`),n("/complaints")}catch(q){console.error("Failed to delete complaint",q),alert(((Y=(h=q==null?void 0:q.response)==null?void 0:h.data)==null?void 0:Y.detail)||"Failed to delete complaint")}finally{kn(!1),vt(!1)}}});return s?e.jsxs(ae,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs("div",{children:[e.jsx(w,{variant:"h5",children:s.reference}),e.jsx(w,{variant:"subtitle1",children:s.complainant.full_name})]}),e.jsxs(z,{direction:"row",spacing:2,alignItems:"center",children:[l!=="read_only"&&e.jsx($,{variant:"contained",size:"small",onClick:()=>{Ue?Rt(!1):(u(0),Rt(!0))},children:Ue?"Cancel edit":"Edit Complaint"}),e.jsx(zt,{status:s.status})]})]}),e.jsxs(S,{container:!0,spacing:2,mb:2,children:[e.jsx(S,{item:!0,children:e.jsx(me,{label:`Product: ${s.product||"n/a"}`})}),e.jsx(S,{item:!0,children:e.jsx(me,{label:`Policy: ${s.policy_number||"n/a"}`})}),s.vulnerability_flag&&e.jsx(S,{item:!0,children:e.jsx(me,{color:"warning",label:"Vulnerable"})}),s.fos_complaint&&e.jsx(S,{item:!0,children:e.jsx(me,{color:"info",label:`FOS: ${s.fos_reference||"Referred"}`})})]}),e.jsxs(z,{direction:"row",spacing:1,mb:2,children:[e.jsx($,{variant:"contained",size:"small",disabled:l==="read_only",onClick:()=>zn("acknowledge"),children:"Acknowledge"}),e.jsx($,{variant:"outlined",size:"small",color:"info",disabled:l==="read_only"||s.fos_complaint||Et,onClick:()=>St(!0),children:"Refer to Ombudsman"}),e.jsx($,{variant:"outlined",size:"small",disabled:l==="read_only",onClick:()=>zn("investigate"),children:"Move to investigation"}),e.jsx($,{variant:"outlined",size:"small",disabled:l==="read_only",onClick:()=>Yn("standard"),children:"Close"}),e.jsx($,{variant:"outlined",size:"small",color:"warning",disabled:l==="read_only"||bt,onClick:()=>Yn("non_reportable"),children:bt?"Closing...":"Close as non-reportable"}),(s==null?void 0:s.status)==="Closed"&&e.jsx($,{variant:"outlined",size:"small",disabled:l==="read_only",onClick:()=>Sn(h=>!h),children:"Reopen"}),e.jsx($,{variant:"outlined",size:"small",color:"secondary",disabled:l==="read_only"||it||Xe.filter(h=>h.role==="complaints_manager").length===0,onClick:wr,children:s.is_escalated?"Change escalation":"Escalate"}),s.is_escalated&&e.jsx($,{variant:"text",size:"small",color:"inherit",onClick:Sr,disabled:l==="read_only"||it,children:"Remove escalation"}),l==="admin"&&e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",sx:{ml:{xs:0,md:2}},children:[e.jsxs(N,{select:!0,size:"small",label:"Assign handler",value:xt||s.assigned_handler_id||"",onChange:h=>Gt(h.target.value),sx:{minWidth:200},children:[e.jsx(X,{value:"",children:"(Unassigned)"}),Xe.map(h=>e.jsx(X,{value:h.id,children:h.full_name},h.id))]}),e.jsx($,{variant:"contained",size:"small",onClick:_r,disabled:!xt,children:"Assign"}),e.jsx($,{variant:"outlined",size:"small",onClick:()=>{const h=Xe.find(Y=>Y.full_name===f);h&&(Gt(h.id),L.post(`/complaints/${t}/assign`,null,{params:{handler_id:h.id}}).then(xe))},disabled:!Xe.length,children:"Assign to me"}),e.jsx($,{variant:"outlined",size:"small",color:"error",onClick:()=>vt(!0),children:"Delete"})]}),l==="complaints_handler"&&!s.assigned_handler_id&&c&&e.jsx($,{variant:"outlined",size:"small",onClick:()=>L.post(`/complaints/${t}/assign`,null,{params:{handler_id:c}}).then(xe),children:"Assign to me"})]}),Ge&&(s==null?void 0:s.status)==="Closed"&&e.jsx(le,{sx:{mb:2},children:e.jsxs(ce,{children:[e.jsx(w,{variant:"subtitle2",children:"Reopen complaint"}),e.jsx(w,{variant:"caption",color:"text.secondary",children:"Leave the date blank to use today's date."}),e.jsxs(S,{container:!0,spacing:2,mt:1,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{fullWidth:!0,label:"Reason for reopen",multiline:!0,minRows:3,value:_n,onChange:h=>En(h.target.value)})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(N,{fullWidth:!0,label:"Reopen date",type:"date",value:Kt,onChange:h=>Rn(h.target.value),helperText:"Blank = today"})}),e.jsx(S,{item:!0,xs:12,md:3,display:"flex",alignItems:"center",children:e.jsx($,{variant:"contained",onClick:vr,disabled:An,children:An?"Reopening...":"Confirm reopen"})})]})]})}),e.jsxs(Os,{value:a,onChange:(h,Y)=>u(Y),sx:{mb:2},children:[e.jsx(Ie,{label:"Overview"}),e.jsx(Ie,{label:"Communications"}),e.jsx(Ie,{label:"Outcome / Redress"}),e.jsx(Ie,{label:"History"})]}),a===0&&e.jsx(le,{children:e.jsx(ce,{sx:{p:3},children:e.jsxs(z,{spacing:3,children:[e.jsxs(z,{direction:"row",alignItems:"flex-start",justifyContent:"space-between",flexWrap:"wrap",rowGap:1,children:[e.jsxs(ae,{sx:{flex:1,minWidth:0},children:[e.jsx(w,{variant:"overline",color:"text.secondary",sx:{letterSpacing:.6},children:"Overview"}),e.jsxs(w,{variant:"h6",sx:{fontWeight:700,mt:.5},children:[s.reference,"  ",s.complainant.full_name]}),e.jsxs(w,{variant:"body2",color:"text.secondary",children:["Received ",ie(s.received_at).format("DD MMM YYYY"),"  Source ",s.source||"n/a"]})]}),e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",flexWrap:"wrap",children:[e.jsx(zt,{status:s.status}),s.vulnerability_flag&&e.jsx(me,{size:"small",color:"warning",label:"Vulnerable"}),s.is_escalated&&e.jsx(me,{size:"small",color:"error",label:"Escalated"}),s.fos_complaint&&e.jsx(me,{size:"small",color:"info",label:`FOS: ${s.fos_reference||"Referred"}`}),s.ack_breached&&e.jsx(me,{size:"small",color:"error",label:"Ack SLA breached"}),s.final_breached&&e.jsx(me,{size:"small",color:"error",label:"Final SLA breached"})]})]}),Ue?e.jsxs(z,{spacing:3,children:[e.jsx(w,{variant:"subtitle1",fontWeight:600,children:"Edit Complaint Details"}),e.jsxs(ae,{children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Complainant"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Full name",fullWidth:!0,value:W.complainant.full_name,onChange:h=>pe(ee(K({},W),{complainant:ee(K({},W.complainant),{full_name:h.target.value})}))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Email",fullWidth:!0,value:W.complainant.email,onChange:h=>pe(ee(K({},W),{complainant:ee(K({},W.complainant),{email:h.target.value})}))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Phone",fullWidth:!0,value:W.complainant.phone,onChange:h=>pe(ee(K({},W),{complainant:ee(K({},W.complainant),{phone:h.target.value})}))})})]})]}),e.jsxs(ae,{children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Complaint Details"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,children:e.jsx(N,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:W.description,onChange:h=>pe(ee(K({},W),{description:h.target.value}))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{select:!0,label:"Category (FCA-aligned)",fullWidth:!0,value:W.category,onChange:h=>{const Y=h.target.value;pe(ee(K({},W),{category:Y,vulnerability_flag:Y==="Vulnerability and Customer Treatment"?!0:W.vulnerability_flag}))},children:xr.map(h=>e.jsx(X,{value:h,children:h},h))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Reason / sub-category",fullWidth:!0,multiline:!0,minRows:2,value:W.reason,onChange:h=>pe(ee(K({},W),{reason:h.target.value}))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{select:!0,label:"Channel",fullWidth:!0,value:W.source,onChange:h=>pe(ee(K({},W),{source:h.target.value})),children:["Phone","Email","Letter","Web","In Person","Other"].map(h=>e.jsx(X,{value:h,children:h},h))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Date complaint received",type:"date",fullWidth:!0,value:W.received_at,onChange:h=>pe(ee(K({},W),{received_at:h.target.value})),InputLabelProps:{shrink:!0}})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(qe,{control:e.jsx(Ot,{checked:W.fca_complaint,onChange:h=>pe(ee(K({},W),{fca_complaint:h.target.checked}))}),label:"FCA Complaint"})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(qe,{control:e.jsx(Ot,{checked:W.vulnerability_flag,onChange:h=>pe(ee(K({},W),{vulnerability_flag:h.target.checked}))}),label:"Vulnerable customer"})}),W.vulnerability_flag&&e.jsx(S,{item:!0,xs:12,children:e.jsx(N,{label:"Vulnerability notes",fullWidth:!0,multiline:!0,minRows:2,value:W.vulnerability_notes,onChange:h=>pe(ee(K({},W),{vulnerability_notes:h.target.value}))})})]})]}),e.jsxs(ae,{children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Policy Information"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Policy number or Claim Reference",fullWidth:!0,value:W.policy.policy_number,onChange:h=>pe(ee(K({},W),{policy:ee(K({},W.policy),{policy_number:h.target.value})}))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsxs(N,{select:!0,label:"Product",fullWidth:!0,value:W.policy.product,onChange:h=>pe(ee(K({},W),{policy:ee(K({},W.policy),{product:h.target.value})})),children:[e.jsx(X,{value:"",children:"(None)"}),sn.products.map(h=>e.jsx(X,{value:h.name,children:h.name},h.id))]})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsxs(N,{select:!0,label:"Insurer",fullWidth:!0,value:W.policy.insurer,onChange:h=>pe(ee(K({},W),{policy:ee(K({},W.policy),{insurer:h.target.value})})),children:[e.jsx(X,{value:"",children:"(None)"}),sn.insurers.map(h=>e.jsx(X,{value:h.name,children:h.name},h.id))]})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsxs(N,{select:!0,label:"Broker",fullWidth:!0,value:W.policy.broker,onChange:h=>pe(ee(K({},W),{policy:ee(K({},W.policy),{broker:h.target.value})})),children:[e.jsx(X,{value:"",children:"(None)"}),sn.brokers.map(h=>e.jsx(X,{value:h.name,children:h.name},h.id))]})})]})]}),e.jsxs(z,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx($,{variant:"outlined",onClick:()=>Rt(!1),disabled:nn,children:"Cancel"}),e.jsx($,{variant:"contained",onClick:gr,disabled:nn||!W.description||!W.category||!W.complainant.full_name,children:nn?"Saving...":"Save Changes"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:8,children:e.jsx(ae,{sx:{p:2,borderRadius:2,background:"#f8fafc",border:"1px solid #e5e7eb",minHeight:140},children:e.jsx(w,{variant:"body1",sx:{lineHeight:1.6},children:s.description})})}),e.jsx(S,{item:!0,xs:12,md:4,children:e.jsx(ae,{sx:{p:2,borderRadius:2,background:"#0f4c81",color:"#f8fafc",height:"100%"},children:e.jsxs(z,{spacing:1,children:[e.jsxs(w,{variant:"body1",children:["Ack due: ",ie(s.ack_due_at).format("DD MMM YYYY")]}),e.jsxs(w,{variant:"body1",children:["Final due: ",ie(s.final_due_at).format("DD MMM YYYY")]}),e.jsxs(w,{variant:"body2",sx:{mt:1,color:"rgba(255,255,255,0.8)"},children:["Last updated: ",Wn?ie(Wn).format("DD MMM YYYY HH:mm"):"No communications"]})]})})})]}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(ae,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(w,{variant:"caption",color:"text.secondary",children:"Product"}),e.jsx(w,{variant:"body1",children:s.product||"n/a"})]})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(ae,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(w,{variant:"caption",color:"text.secondary",children:"Policy"}),e.jsx(w,{variant:"body1",children:s.policy_number||"n/a"})]})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(ae,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(w,{variant:"caption",color:"text.secondary",children:"Broker / Insurer"}),e.jsx(w,{variant:"body1",children:s.broker||"n/a"}),e.jsx(w,{variant:"body2",color:"text.secondary",children:s.insurer||""})]})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(ae,{sx:{p:2,border:"1px solid #e5e7eb",borderRadius:2},children:[e.jsx(w,{variant:"caption",color:"text.secondary",children:"Category / Reason"}),e.jsxs(w,{variant:"body1",children:[s.category||"n/a",s.reason?`  ${s.reason}`:""]})]})})]})]})]})})}),a===1&&e.jsxs(z,{spacing:2.5,children:[e.jsx(le,{children:e.jsxs(ce,{sx:{p:3},children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Add communication"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(N,{select:!0,fullWidth:!0,label:"Channel",value:i,onChange:h=>o(h.target.value),children:[{value:"phone",label:"Phone call"},{value:"email",label:"Email"},{value:"letter",label:"Letter"},{value:"web",label:"Web"},{value:"third_party",label:"Third party"},{value:"other",label:"Other"}].map(h=>e.jsx(X,{value:h.value,children:h.label},h.value))})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(N,{select:!0,fullWidth:!0,label:"Direction",value:d,onChange:h=>p(h.target.value),children:[e.jsx(X,{value:"outbound",children:"Outbound"}),e.jsx(X,{value:"inbound",children:"Inbound"})]})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{fullWidth:!0,label:"When",type:"datetime-local",value:g,onChange:h=>y(h.target.value)})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,multiline:!0,minRows:3,label:"Summary",value:b,onChange:h=>m(h.target.value)})}),e.jsxs(S,{item:!0,xs:12,md:6,display:"flex",alignItems:"center",children:[e.jsx(qe,{control:e.jsx(Ot,{checked:Q,onChange:h=>Z(h.target.checked),disabled:!s.outcome}),label:"This is the final response"}),!s.outcome&&e.jsx(w,{variant:"caption",color:"text.secondary",sx:{ml:1},children:"Record an outcome first."})]}),e.jsxs(S,{item:!0,xs:12,md:6,display:"flex",alignItems:"center",justifyContent:"flex-end",children:[e.jsxs($,{variant:"outlined",component:"label",size:"small",children:["Attach files",e.jsx("input",{hidden:!0,multiple:!0,type:"file",onChange:h=>k(h.target.files)})]}),T&&T.length>0&&e.jsxs(w,{variant:"caption",sx:{ml:1},children:[T.length," file(s) selected"]})]}),e.jsx(S,{item:!0,xs:12,children:e.jsx($,{variant:"contained",onClick:br,disabled:A||!b||Q&&!s.outcome,children:A?"Saving...":"Add communication"})})]})]})}),e.jsx(le,{children:e.jsx(ce,{sx:{p:0},children:e.jsxs(Tt,{dense:!0,children:[(qn=s.communications)==null?void 0:qn.map(h=>e.jsxs(Ye,{alignItems:"flex-start",sx:{borderBottom:"1px solid #e5e7eb",py:1.5,px:2},children:[e.jsx(He,{primaryTypographyProps:{sx:{fontWeight:600}},primary:`${h.direction} ${h.channel}`,secondary:e.jsxs(z,{spacing:.5,sx:{mt:.5},children:[e.jsx(w,{variant:"body2",color:"text.primary",children:h.summary}),e.jsx(w,{variant:"caption",color:"text.secondary",children:ie(h.occurred_at).format("DD MMM YYYY HH:mm")})]})}),e.jsxs(z,{direction:"row",spacing:1,alignItems:"center",children:[h.is_final_response&&e.jsx(me,{size:"small",color:"success",label:"Final response"}),h.attachments&&h.attachments.length>0&&e.jsx(z,{direction:"row",spacing:1,children:h.attachments.map(Y=>e.jsx($,{size:"small",component:"a",href:`${ws}${Y.url}`,target:"_blank",rel:"noreferrer",children:Y.file_name},Y.id))})]})]},h.id)),(!s.communications||s.communications.length===0)&&e.jsx(Ye,{sx:{py:2,px:2},children:e.jsx(He,{primary:"No communications recorded"})})]})})})]}),a===2&&e.jsxs(z,{spacing:2.5,children:[e.jsx(le,{children:e.jsxs(ce,{sx:{p:3},children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Outcome"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:4,children:e.jsx(N,{select:!0,fullWidth:!0,label:"Outcome",value:se,onChange:h=>ue(h.target.value),children:[["upheld","Upheld"],["partially_upheld","Partially upheld"],["not_upheld","Not upheld"],["withdrawn","Withdrawn"],["out_of_scope","Out of scope"]].map(([h,Y])=>e.jsx(X,{value:h,children:Y},h))})}),e.jsx(S,{item:!0,xs:12,md:8,children:e.jsx(N,{fullWidth:!0,label:"Outcome notes",multiline:!0,minRows:3,value:oe,onChange:h=>te(h.target.value)})}),e.jsxs(S,{item:!0,xs:12,children:[e.jsx($,{variant:"contained",size:"small",onClick:yr,disabled:C,children:C?"Saving...":"Save outcome"}),s.outcome&&e.jsxs(w,{variant:"body2",sx:{ml:2},component:"span",children:["Current: ",s.outcome.outcome]})]})]})]})}),e.jsx(le,{children:e.jsxs(ce,{sx:{p:3},children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Redress"}),e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(N,{select:!0,fullWidth:!0,label:"Redress type",value:_,onChange:h=>E(h.target.value),children:bs.map(h=>e.jsx(X,{value:h.value,children:h.label},h.value))})}),ke&&e.jsx(S,{item:!0,xs:12,md:3,children:e.jsx(N,{type:"number",fullWidth:!0,label:"Amount (monetary)",value:B,onChange:h=>D(h.target.value===""?"":Number(h.target.value))})}),ke&&e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{fullWidth:!0,label:"Rationale (monetary)",multiline:!0,minRows:2,value:R,onChange:h=>P(h.target.value),helperText:"Required for monetary redress"})}),!ke&&e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{fullWidth:!0,label:"Action description (non-monetary)",multiline:!0,minRows:2,value:U,onChange:h=>ne(h.target.value),helperText:"Required for non-monetary redress"})}),ke&&e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(N,{select:!0,fullWidth:!0,label:"Status",value:I,onChange:h=>j(h.target.value),children:[e.jsx(X,{value:"pending",children:"Pending"}),e.jsx(X,{value:"authorised",children:"Authorised"}),e.jsx(X,{value:"paid",children:"Paid"})]})}),e.jsx(S,{item:!0,xs:12,md:3,children:e.jsxs(N,{select:!0,fullWidth:!0,label:"Action status",value:he,onChange:h=>De(h.target.value),children:[e.jsx(X,{value:"not_started",children:"Not Started"}),e.jsx(X,{value:"in_progress",children:"In Progress"}),e.jsx(X,{value:"completed",children:"Completed"})]})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{fullWidth:!0,label:"Notes",multiline:!0,minRows:3,value:M,onChange:h=>O(h.target.value)})}),ke&&e.jsx(S,{item:!0,xs:12,md:3,display:"flex",alignItems:"center",children:e.jsx(qe,{control:e.jsx(Ot,{checked:Ee,onChange:h=>Te(h.target.checked)}),label:"Approved"})}),e.jsx(S,{item:!0,xs:12,children:e.jsx($,{variant:"contained",size:"small",onClick:jr,disabled:Re||ke&&B===""||ke&&!R.trim()||!ke&&!U.trim(),children:Re?"Saving...":"Add redress"})})]}),s.redress_payments&&s.redress_payments.length>0?e.jsx(Tt,{dense:!0,sx:{mt:2},children:s.redress_payments.map(h=>e.jsxs(Ye,{alignItems:"flex-start",onClick:()=>Me(h.id),sx:{borderBottom:"1px solid #e5e7eb",py:1.5,px:0,cursor:"pointer"},children:[Ce===h.id&&e.jsx(w,{variant:"caption",color:"text.secondary",sx:{position:"absolute",top:8,right:0},children:"Tap to select status"}),e.jsx(He,{primaryTypographyProps:{sx:{fontWeight:600}},secondaryTypographyProps:{component:"div"},primary:`${fr(h.payment_type)}${h.amount?`  ${h.amount}`:""}`,secondary:e.jsxs(z,{component:"div",spacing:.5,sx:{mt:.5},children:[vs.includes(h.payment_type)?Ce===h.id?e.jsxs(Gn,{size:"small",sx:{minWidth:160},children:[e.jsx(Xn,{children:"Status"}),e.jsxs(Zn,{label:"Status",value:h.status,onChange:Y=>V(this,null,function*(){yield Un(h.id,{status:Y.target.value,approved:h.approved}),Me(null)}),children:[e.jsx(X,{value:"pending",children:"Pending"}),e.jsx(X,{value:"authorised",children:"Authorised"}),e.jsx(X,{value:"paid",children:"Paid"})]})]}):e.jsxs(w,{component:"span",variant:"caption",children:["Status: ",h.status," (click to update)"]}):Ce===h.id?e.jsxs(Gn,{size:"small",sx:{minWidth:180},children:[e.jsx(Xn,{children:"Action status"}),e.jsxs(Zn,{label:"Action status",value:h.action_status||"not_started",onChange:Y=>V(this,null,function*(){yield Un(h.id,{action_status:Y.target.value}),Me(null)}),children:[e.jsx(X,{value:"not_started",children:"Not Started"}),e.jsx(X,{value:"in_progress",children:"In Progress"}),e.jsx(X,{value:"completed",children:"Completed"})]})]}):e.jsxs(w,{component:"span",variant:"caption",children:["Action: ",h.action_description||"n/a"," (",h.action_status||"not_started",")  click to update"]}),h.approved&&e.jsx(me,{size:"small",label:"Approved",color:"success",sx:{maxWidth:"fit-content"}}),h.rationale&&e.jsxs(w,{component:"span",variant:"caption",display:"block",children:["Rationale: ",h.rationale]}),h.action_description&&e.jsxs(w,{component:"span",variant:"caption",display:"block",children:["Action: ",h.action_description," (",h.action_status,")"]}),h.notes&&e.jsxs(w,{component:"span",variant:"caption",display:"block",children:["Notes: ",h.notes]})]})})]},h.id))}):e.jsx(w,{color:"text.secondary",mt:2,children:"No redress recorded"})]})})]}),a===3&&e.jsx(le,{children:e.jsxs(ce,{sx:{p:3},children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"History / Audit trail"}),e.jsxs(Tt,{dense:!0,children:[Ln.length===0&&e.jsx(Ye,{children:e.jsx(He,{primary:"No events recorded yet"})}),Ln.map(h=>{var ge,Se;const q=h.event_type==="communication_added"?(ge=s==null?void 0:s.communications)==null?void 0:ge.find(ve=>{var Ae,Ze;return ve.summary===h.description||((Ze=ve.summary)==null?void 0:Ze.includes(((Ae=h.description)==null?void 0:Ae.substring(0,50))||""))}):null,re=(q==null?void 0:q.attachments)&&q.attachments.length>0;return e.jsx(Ye,{sx:{borderBottom:"1px solid #e5e7eb"},children:e.jsx(He,{primaryTypographyProps:{sx:{fontWeight:600}},secondaryTypographyProps:{component:"div"},primary:h.event_type.replace(/_/g," "),secondary:e.jsxs(z,{spacing:.5,children:[h.description&&e.jsx(w,{variant:"body2",children:h.description}),re&&e.jsxs(z,{direction:"row",spacing:1,sx:{mt:.5,flexWrap:"wrap"},children:[e.jsx(w,{variant:"caption",color:"text.secondary",sx:{fontWeight:600},children:"Attachments:"}),(Se=q.attachments)==null?void 0:Se.map(ve=>e.jsx($,{size:"small",component:"a",href:`${ws}${ve.url}`,target:"_blank",rel:"noreferrer",sx:{minWidth:"auto",p:.5,textTransform:"none",fontSize:"0.75rem"},children:ve.file_name},ve.id))]}),(h.created_by_name||h.created_by_id)&&e.jsx(w,{variant:"caption",color:"text.secondary",children:`By ${h.created_by_name||h.created_by_id}`}),e.jsx(w,{variant:"caption",color:"text.secondary",children:ie(h.created_at).format("DD MMM YYYY HH:mm")})]})})},h.id)})]})]})}),e.jsxs(Ne,{open:or,onClose:()=>yt(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx($e,{children:"Escalate to manager"}),e.jsx(Le,{dividers:!0,children:e.jsxs(z,{spacing:2,sx:{mt:1},children:[e.jsx(N,{select:!0,fullWidth:!0,label:"Manager",value:jt,onChange:h=>Dn(h.target.value),children:Xe.filter(h=>h.role==="complaints_manager").map(h=>e.jsx(X,{value:h.id,children:h.full_name},h.id))}),e.jsx(w,{variant:"body2",color:"text.secondary",children:"Selecting a manager will assign the complaint to them and mark it as escalated."})]})}),e.jsxs(Be,{children:[e.jsx($,{onClick:()=>yt(!1),disabled:it,children:"Cancel"}),e.jsx($,{variant:"contained",onClick:Cr,disabled:it||!jt,children:it?"Escalating...":"Confirm escalation"})]})]}),e.jsxs(Ne,{open:cr,onClose:()=>ot(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx($e,{children:wt==="non_reportable"?"Close as non-reportable":"Close complaint"}),e.jsx(Le,{dividers:!0,children:e.jsxs(z,{spacing:2,sx:{mt:1},children:[Fn&&e.jsx(Pe,{severity:"error",children:Fn}),e.jsx(N,{fullWidth:!0,label:"Closed date",type:"date",value:lt,onChange:h=>ur(h.target.value),helperText:"Choose the effective closed date"}),e.jsx(N,{fullWidth:!0,label:"Comments (optional)",multiline:!0,minRows:2,value:Zt,onChange:h=>en(h.target.value)})]})}),e.jsxs(Be,{children:[e.jsx($,{onClick:()=>ot(!1),children:"Cancel"}),e.jsx($,{variant:"contained",onClick:wt==="non_reportable"?Er:Rr,disabled:wt==="non_reportable"?bt:Pn,children:wt==="non_reportable"?bt?"Closing...":"Confirm close (non-reportable)":Pn?"Closing...":"Confirm close"})]})]}),e.jsxs(Ne,{open:lr,onClose:()=>vt(!1),children:[e.jsx($e,{children:"Delete Complaint"}),e.jsxs(Le,{children:[e.jsx(Pe,{severity:"warning",sx:{mb:2},children:"Are you sure you want to delete this complaint? This action cannot be undone. All related data (communications, events, outcomes, redress payments, etc.) will also be deleted."}),e.jsxs(w,{variant:"body2",color:"text.secondary",children:["Complaint: ",s==null?void 0:s.reference]})]}),e.jsxs(Be,{children:[e.jsx($,{onClick:()=>vt(!1),disabled:Xt,children:"Cancel"}),e.jsx($,{onClick:Ar,color:"error",variant:"contained",disabled:Xt,children:Xt?"Deleting...":"Delete"})]})]}),e.jsxs(Ne,{open:hr,onClose:()=>St(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx($e,{children:"Refer to Financial Ombudsman Service"}),e.jsx(Le,{dividers:!0,children:e.jsxs(z,{spacing:2,sx:{mt:1},children:[e.jsx(N,{fullWidth:!0,label:"FOS Reference",value:_t,onChange:h=>In(h.target.value),required:!0,helperText:"Enter the FOS reference number"}),e.jsx(N,{fullWidth:!0,label:"Date referred",type:"date",value:tn,onChange:h=>Nn(h.target.value),InputLabelProps:{shrink:!0},helperText:"Date the complaint was referred to FOS"})]})}),e.jsxs(Be,{children:[e.jsx($,{onClick:()=>St(!1),disabled:Et,children:"Cancel"}),e.jsx($,{variant:"contained",onClick:()=>V(this,null,function*(){var h,Y;if(_t.trim()){$n(!0);try{yield L.post(`/complaints/${s.id}/refer-to-fos`,{fos_reference:_t.trim(),fos_referred_at:tn?new Date(tn).toISOString():null}),St(!1),In(""),Nn(ie().format("YYYY-MM-DD")),xe()}catch(q){console.error("Failed to refer to FOS",q),alert(((Y=(h=q==null?void 0:q.response)==null?void 0:h.data)==null?void 0:Y.detail)||"Failed to refer complaint to FOS")}finally{$n(!1)}}}),disabled:Et||!_t.trim(),children:Et?"Referring...":"Confirm Referral"})]})]})]}):e.jsx(w,{children:"Loading..."})}const Cs=["Complainant","Complaint","Policy"],Ss=["Policy Administration","Sales and Advice","Pricing and Premiums","Claims Handling","Customer Service","Cancellations and Refunds","Disclosure and Documentation","Vulnerability and Customer Treatment","Data Protection and Privacy","Third-Party / Supplier Issues","Fraud or Financial Crime","Other / Unclassified"];function Bi(){const[t,n]=v.useState(0),[s,r]=v.useState({source:"Web",received_at:ie().toISOString(),description:"",category:Ss[0],reason:"",fca_complaint:!0,vulnerability_flag:!1,complainant:{full_name:""},policy:{}}),[a,u]=v.useState(null),[l,f]=v.useState({products:[],insurers:[],brokers:[]}),c=ut();v.useEffect(()=>{V(this,null,function*(){try{const[p,b,m]=yield Promise.all([L.get("/reference/products"),L.get("/reference/insurers"),L.get("/reference/brokers")]);f({products:p.data,insurers:b.data,brokers:m.data})}catch(p){}})},[]);const i=(d,p)=>{const b=d.split(".");r(m=>{const g=K({},m);let y=g;return b.forEach((T,k)=>{k===b.length-1?y[T]=p:(y[T]=K({},y[T]),y=y[T])}),g})},o=()=>V(this,null,function*(){var b,m;if(s.category==="Other / Unclassified"&&!(s.reason&&s.reason.trim())){alert('Please provide a justification when selecting "Other / Unclassified".');return}const p=(yield L.post("/complaints",s)).data.id;if(a){const g=new FormData,T={Email:"email",Letter:"letter",Phone:"phone",Web:"web","In Person":"other",Other:"other"}[s.source]||"other";g.append("channel",T),g.append("direction","inbound"),g.append("summary",`Initial complaint via ${s.source}${a.name?` (with attachment: ${a.name})`:""}`),g.append("occurred_at",s.received_at),g.append("is_final_response","false"),g.append("files",a);try{yield L.post(`/complaints/${p}/communications`,g)}catch(k){console.error("Failed to upload attachment during complaint creation",k);let A="Unknown error";if((m=(b=k==null?void 0:k.response)==null?void 0:b.data)!=null&&m.detail){const F=k.response.data.detail;Array.isArray(F)?A=F.map(Z=>{var oe;const se=((oe=Z.loc)==null?void 0:oe.join("."))||"field",ue=Z.msg||"validation error";return`${se}: ${ue}`}).join(`
`):typeof F=="string"?A=F:A=JSON.stringify(F)}else k!=null&&k.message&&(A=k.message);alert(`Complaint created successfully, but attachment upload failed: ${A}. You can add it manually in the Communications tab.`)}}c(`/complaints/${p}`,{state:{refreshDashboard:!0}})});return e.jsxs(ae,{children:[e.jsx(w,{variant:"h5",gutterBottom:!0,children:"Create complaint"}),e.jsx(Nr,{activeStep:t,sx:{mb:2},children:Cs.map(d=>e.jsx($r,{children:e.jsx(Lr,{children:d})},d))}),e.jsx(le,{children:e.jsxs(ce,{children:[t===0&&e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Full name",fullWidth:!0,value:s.complainant.full_name,onChange:d=>i("complainant.full_name",d.target.value)})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Email",fullWidth:!0,value:s.complainant.email||"",onChange:d=>i("complainant.email",d.target.value)})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Phone",fullWidth:!0,value:s.complainant.phone||"",onChange:d=>i("complainant.phone",d.target.value)})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(qe,{control:e.jsx(un,{checked:s.vulnerability_flag,onChange:d=>i("vulnerability_flag",d.target.checked)}),label:"Vulnerable customer"})})]}),t===1&&e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,children:e.jsx(N,{label:"Description",fullWidth:!0,multiline:!0,rows:3,helperText:"Brief summary of the complaint",value:s.description,onChange:d=>i("description",d.target.value)})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{select:!0,label:"Category (FCA-aligned)",fullWidth:!0,value:s.category,onChange:d=>{const p=d.target.value;i("category",p),p==="Vulnerability and Customer Treatment"&&i("vulnerability_flag",!0)},helperText:"Choose one primary category",children:Ss.map(d=>e.jsx(X,{value:d,children:d},d))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Reason / sub-category",fullWidth:!0,multiline:!0,minRows:2,value:s.reason||"",onChange:d=>i("reason",d.target.value),helperText:"Add specific reason(s); multiple allowed"})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{select:!0,label:"Channel",fullWidth:!0,value:s.source,onChange:d=>i("source",d.target.value),helperText:"How the complaint was received",children:["Phone","Email","Letter","Web","In Person","Other"].map(d=>e.jsx(X,{value:d,children:d},d))})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Date complaint received",type:"date",fullWidth:!0,value:ie(s.received_at).format("YYYY-MM-DD"),onChange:d=>i("received_at",ie(d.target.value).toISOString()),InputLabelProps:{shrink:!0}})}),e.jsxs(S,{item:!0,xs:12,children:[e.jsxs($,{variant:"outlined",component:"label",children:["Attach file (PDF preferred)",e.jsx("input",{hidden:!0,type:"file",accept:".pdf,.png,.jpg,.jpeg,.txt,.doc,.docx",onChange:d=>{var p;return u(((p=d.target.files)==null?void 0:p[0])||null)}})]}),e.jsx(w,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:s.source==="Email"||s.source==="Letter"?`For emails/letters, please upload a PDF print (avoid .eml/.msg). Selected: ${(a==null?void 0:a.name)||"none"}`:`Upload supporting documents. Selected: ${(a==null?void 0:a.name)||"none"}`})]})]}),t===2&&e.jsxs(S,{container:!0,spacing:2,children:[e.jsx(S,{item:!0,xs:12,md:6,children:e.jsx(N,{label:"Policy number or Claim Reference",fullWidth:!0,value:s.policy.policy_number||"",onChange:d=>{i("policy.policy_number",d.target.value),i("policy_number",d.target.value)}})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsxs(N,{select:!0,label:"Product",fullWidth:!0,value:s.policy.product||"",onChange:d=>{i("policy.product",d.target.value),i("product",d.target.value)},helperText:"Select from reference data",children:[e.jsx(X,{value:"",children:"(None)"}),l.products.map(d=>e.jsx(X,{value:d.name,children:d.name},d.id))]})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsxs(N,{select:!0,label:"Insurer",fullWidth:!0,value:s.policy.insurer||"",onChange:d=>{i("policy.insurer",d.target.value),i("insurer",d.target.value)},helperText:"Select from reference data",children:[e.jsx(X,{value:"",children:"(None)"}),l.insurers.map(d=>e.jsx(X,{value:d.name,children:d.name},d.id))]})}),e.jsx(S,{item:!0,xs:12,md:6,children:e.jsxs(N,{select:!0,label:"Broker",fullWidth:!0,value:s.policy.broker||"",onChange:d=>{i("policy.broker",d.target.value),i("broker",d.target.value)},helperText:"Select from reference data",children:[e.jsx(X,{value:"",children:"(None)"}),l.brokers.map(d=>e.jsx(X,{value:d.name,children:d.name},d.id))]})})]})]})}),e.jsxs(ae,{mt:2,display:"flex",justifyContent:"space-between",children:[e.jsx($,{disabled:t===0,onClick:()=>n(d=>d-1),children:"Back"}),t<Cs.length-1?e.jsx($,{variant:"contained",onClick:()=>n(d=>d+1),children:"Next"}):e.jsx($,{variant:"contained",onClick:o,children:"Submit"})]})]})}const _s=[{value:"admin",label:"Admin"},{value:"complaints_handler",label:"Complaints Handler"},{value:"complaints_manager",label:"Complaints Manager"},{value:"reviewer",label:"Reviewer"},{value:"read_only",label:"Read only"}];function Ui(){const{role:t}=at(),[n,s]=v.useState([]),[r,a]=v.useState(!1),[u,l]=v.useState(!1),[f,c]=v.useState(!1),[i,o]=v.useState(null),[d,p]=v.useState(null),[b,m]=v.useState({}),[g,y]=v.useState(null),[T,k]=v.useState(!1),[A,F]=v.useState({email:"",full_name:"",password:"",role:"complaints_handler",is_active:!0}),Q=()=>V(this,null,function*(){var C,H;a(!0),o(null);try{const B=yield L.get("/users");s(B.data)}catch(B){o(((H=(C=B==null?void 0:B.response)==null?void 0:C.data)==null?void 0:H.detail)||"Failed to load users")}finally{a(!1)}});v.useEffect(()=>{Q()},[]);const Z=()=>V(this,null,function*(){var C,H;l(!0),o(null);try{yield L.post("/users",A),F({email:"",full_name:"",password:"",role:"complaints_handler",is_active:!0}),k(!1),yield Q()}catch(B){o(((H=(C=B==null?void 0:B.response)==null?void 0:C.data)==null?void 0:H.detail)||"Failed to create user")}finally{l(!1)}}),se=(C,H)=>V(this,null,function*(){var B,D;l(!0),o(null);try{yield L.patch(`/users/${C}`,H),yield Q()}catch(_){o(((D=(B=_==null?void 0:_.response)==null?void 0:B.data)==null?void 0:D.detail)||"Failed to update user")}finally{l(!1)}}),ue=C=>V(this,null,function*(){var H,B;l(!0),o(null);try{yield L.post(`/auth/mfa/reset/${C}`),yield Q()}catch(D){o(((B=(H=D==null?void 0:D.response)==null?void 0:H.data)==null?void 0:B.detail)||"Failed to reset MFA")}finally{l(!1)}}),oe=(C,H)=>V(this,null,function*(){var B,D;l(!0),o(null);try{const _=yield L.post(`/users/${C}/reset-password`);y({open:!0,email:H,tempPassword:_.data.temporary_password}),yield Q()}catch(_){o(((D=(B=_==null?void 0:_.response)==null?void 0:B.data)==null?void 0:D.detail)||"Failed to reset password")}finally{l(!1)}}),te=C=>V(this,null,function*(){var H,B;c(!0),o(null);try{const D=yield L.post(`/auth/mfa/recovery/${C}/regenerate`);m(_=>ee(K({},_),{[C]:D.data.recovery_codes})),p(C)}catch(D){o(((B=(H=D==null?void 0:D.response)==null?void 0:H.data)==null?void 0:B.detail)||"Failed to get recovery codes")}finally{c(!1)}});return t!=="admin"?e.jsxs(ae,{children:[e.jsx(w,{variant:"h6",gutterBottom:!0,children:"Admin only"}),e.jsx(w,{color:"text.secondary",children:"You need admin rights to manage users."})]}):e.jsxs(ae,{children:[e.jsx(w,{variant:"h5",gutterBottom:!0,children:"User management"}),(g==null?void 0:g.open)&&e.jsxs(Ne,{open:!0,onClose:()=>y(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx($e,{children:"Password reset"}),e.jsx(Le,{children:e.jsxs(z,{spacing:2,sx:{mt:1},children:[e.jsx(Pe,{severity:"warning",children:"This user will be forced to change their password on next login. Copy the temporary password and email it to them."}),e.jsxs(w,{variant:"body2",children:["User: ",e.jsx("strong",{children:g.email})]}),e.jsx(N,{label:"Temporary password",value:g.tempPassword,fullWidth:!0,InputProps:{readOnly:!0}}),e.jsx($,{variant:"outlined",onClick:()=>V(this,null,function*(){try{yield navigator.clipboard.writeText(g.tempPassword)}catch(C){}}),children:"Copy to clipboard"})]})}),e.jsx(Be,{children:e.jsx($,{onClick:()=>y(null),children:"Done"})})]}),e.jsx(le,{children:e.jsxs(ce,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(w,{variant:"h6",children:"Users"}),e.jsxs(z,{direction:"row",spacing:1,children:[e.jsx($,{variant:"contained",onClick:()=>k(!0),disabled:u,children:"Create user"}),e.jsx($,{onClick:Q,disabled:r||u,children:"Refresh"})]})]}),i&&e.jsx(w,{color:"error",variant:"body2",sx:{mb:2},children:i}),e.jsx(ae,{sx:{overflowX:"auto"},children:e.jsxs(Lt,{size:"small",sx:{minWidth:1e3},children:[e.jsx(Bt,{children:e.jsxs(we,{children:[e.jsx(J,{sx:{minWidth:200},children:"Email"}),e.jsx(J,{sx:{minWidth:150},children:"Name"}),e.jsx(J,{sx:{minWidth:180},children:"Role"}),e.jsx(J,{sx:{minWidth:100},children:"MFA"}),e.jsx(J,{sx:{minWidth:100},children:"Status"}),e.jsx(J,{align:"right",sx:{minWidth:400},children:"Actions"})]})}),e.jsxs(Ut,{children:[n.map(C=>{const H=d===C.id;return e.jsxs(tt.Fragment,{children:[e.jsxs(we,{hover:!0,sx:{cursor:"pointer"},onClick:()=>H?p(null):te(C.id),children:[e.jsx(J,{sx:{py:.5},children:C.email}),e.jsx(J,{sx:{py:.5},children:C.full_name}),e.jsx(J,{onClick:B=>B.stopPropagation(),sx:{py:.5},children:e.jsx(N,{select:!0,size:"small",value:C.role,onChange:B=>se(C.id,{role:B.target.value}),sx:{minWidth:160},children:_s.map(B=>e.jsx(X,{value:B.value,children:B.label},B.value))})}),e.jsx(J,{sx:{py:.5},children:e.jsx(me,{label:C.mfa_enabled?"Enabled":"Disabled",color:C.mfa_enabled?"success":"default",size:"small"})}),e.jsx(J,{sx:{py:.5},children:e.jsx(me,{label:C.is_active?"Active":"Disabled",color:C.is_active?"success":"default",size:"small"})}),e.jsx(J,{align:"right",onClick:B=>B.stopPropagation(),sx:{py:.5},children:e.jsxs(z,{direction:"row",spacing:1,justifyContent:"flex-end",alignItems:"center",flexWrap:"wrap",children:[e.jsx(qe,{control:e.jsx(un,{checked:C.is_active,onChange:B=>se(C.id,{is_active:B.target.checked}),size:"small"}),label:C.is_active?"Active":"Inactive",labelPlacement:"start",sx:{margin:0,mr:1}}),e.jsx($,{variant:"outlined",size:"small",onClick:()=>oe(C.id,C.email),disabled:u,children:"Reset password"}),e.jsx($,{variant:"outlined",size:"small",onClick:()=>ue(C.id),disabled:u,children:"Reset MFA"})]})})]}),H&&e.jsx(we,{children:e.jsx(J,{colSpan:6,children:e.jsxs(z,{spacing:1,children:[e.jsx(w,{variant:"subtitle2",children:"Recovery codes"}),f?e.jsx(w,{variant:"body2",color:"text.secondary",children:"Loading..."}):e.jsxs(z,{direction:"row",gap:1,flexWrap:"wrap",children:[(b[C.id]||[]).map(B=>e.jsx(ae,{sx:{border:"1px solid #ddd",px:1.5,py:.5,borderRadius:1,fontFamily:"monospace"},children:B},B)),(!b[C.id]||b[C.id].length===0)&&e.jsx(w,{variant:"body2",color:"text.secondary",children:"No codes available."})]})]})})})]},C.id)}),n.length===0&&e.jsx(we,{children:e.jsx(J,{colSpan:6,children:r?"Loading...":"No users"})})]})]})})]})}),e.jsxs(Ne,{open:T,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx($e,{children:"Create user"}),e.jsx(Le,{children:e.jsxs(z,{spacing:2.5,sx:{mt:1},children:[i&&e.jsx(Pe,{severity:"error",onClose:()=>o(null),children:i}),e.jsx(N,{label:"Email",value:A.email,onChange:C=>F(H=>ee(K({},H),{email:C.target.value})),fullWidth:!0,size:"small",autoComplete:"email"}),e.jsx(N,{label:"Full name",value:A.full_name,onChange:C=>F(H=>ee(K({},H),{full_name:C.target.value})),fullWidth:!0,size:"small"}),e.jsx(N,{label:"Password",type:"password",value:A.password,onChange:C=>F(H=>ee(K({},H),{password:C.target.value})),fullWidth:!0,size:"small",autoComplete:"new-password"}),e.jsx(N,{label:"Role",select:!0,value:A.role,onChange:C=>F(H=>ee(K({},H),{role:C.target.value})),fullWidth:!0,size:"small",children:_s.map(C=>e.jsx(X,{value:C.value,children:C.label},C.value))}),e.jsx(qe,{control:e.jsx(un,{checked:A.is_active,onChange:C=>F(H=>ee(K({},H),{is_active:C.target.checked})),size:"small"}),label:"Active"})]})}),e.jsxs(Be,{children:[e.jsx($,{onClick:()=>k(!1),disabled:u,children:"Cancel"}),e.jsx($,{variant:"contained",onClick:Z,disabled:u||r,children:u?"Creating...":"Create user"})]})]})]})}const Es={products:"Products",brokers:"Brokers",insurers:"Insurers"};function Wi(){const{role:t}=at(),[n,s]=v.useState({products:[],brokers:[],insurers:[]}),[r,a]=v.useState(!1),[u,l]=v.useState(!1),[f,c]=v.useState(null),[i,o]=v.useState({products:"",brokers:"",insurers:""}),[d,p]=v.useState({products:null,brokers:null,insurers:null}),b=()=>V(this,null,function*(){var j,M;a(!0),c(null);try{const[O,R,P]=yield Promise.all([L.get("/reference/products"),L.get("/reference/brokers"),L.get("/reference/insurers")]);s({products:O.data,brokers:R.data,insurers:P.data})}catch(O){c(((M=(j=O==null?void 0:O.response)==null?void 0:j.data)==null?void 0:M.detail)||"Failed to load reference data")}finally{a(!1)}});v.useEffect(()=>{b()},[]);const m=j=>V(this,null,function*(){var O,R;const M=i[j].trim();if(M){l(!0),c(null);try{yield L.post(`/reference/${j}`,{name:M}),o(P=>ee(K({},P),{[j]:""})),yield b()}catch(P){c(((R=(O=P==null?void 0:P.response)==null?void 0:O.data)==null?void 0:R.detail)||"Failed to create item")}finally{l(!1)}}}),g=j=>V(this,null,function*(){var O,R;const M=d[j];if(M){l(!0),c(null);try{const P=new FormData;P.append("file",M),yield L.post(`/reference/${j}/import`,P),p(U=>ee(K({},U),{[j]:null})),yield b()}catch(P){c(((R=(O=P==null?void 0:P.response)==null?void 0:O.data)==null?void 0:R.detail)||"Failed to import CSV")}finally{l(!1)}}}),y=j=>{const M=`name
Sample Name
`,O=new Blob([M],{type:"text/csv"}),R=URL.createObjectURL(O),P=document.createElement("a");P.href=R,P.download=`${j}_template.csv`,P.click(),URL.revokeObjectURL(R)},T=({kind:j})=>{var M;return e.jsx(le,{sx:{flex:1},children:e.jsxs(ce,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(w,{variant:"h6",children:Es[j]}),e.jsx($,{onClick:()=>y(j),children:"Download CSV template"})]}),e.jsxs(z,{direction:{xs:"column",md:"row"},spacing:2,mb:2,children:[e.jsx(N,{label:`Add ${Es[j].slice(0,-1)}`,size:"small",value:i[j],onChange:O=>o(R=>ee(K({},R),{[j]:O.target.value})),fullWidth:!0}),e.jsx($,{variant:"contained",onClick:()=>m(j),disabled:u,children:"Add"})]}),e.jsxs(z,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",mb:2,children:[e.jsxs($,{variant:"outlined",component:"label",disabled:u,children:["Choose CSV",e.jsx("input",{hidden:!0,type:"file",accept:".csv,text/csv",onChange:O=>p(R=>{var P;return ee(K({},R),{[j]:((P=O.target.files)==null?void 0:P[0])||null})})})]}),e.jsx(w,{variant:"body2",color:"text.secondary",children:((M=d[j])==null?void 0:M.name)||"No file selected"}),e.jsx($,{variant:"contained",onClick:()=>g(j),disabled:u||!d[j],children:"Import CSV"})]}),f&&e.jsx(w,{variant:"body2",color:"error",sx:{mb:1},children:f}),e.jsxs(Lt,{size:"small",children:[e.jsx(Bt,{children:e.jsxs(we,{children:[e.jsx(J,{children:"Name"}),e.jsx(J,{children:"Created"})]})}),e.jsxs(Ut,{children:[n[j].map(O=>e.jsxs(we,{children:[e.jsx(J,{children:O.name}),e.jsx(J,{children:new Date(O.created_at).toLocaleString()})]},O.id)),n[j].length===0&&e.jsx(we,{children:e.jsx(J,{colSpan:2,children:r?"Loading...":"No records"})})]})]})]})})},[k,A]=v.useState([]),[F,Q]=v.useState(!1),[Z,se]=v.useState(null),[ue,oe]=v.useState(!1),[te,C]=v.useState(null),[H,B]=v.useState(null),D=()=>V(this,null,function*(){var j,M;Q(!0),B(null);try{const O=yield L.get("/complaints/attachments/list",{params:{limit:200}});A(O.data.attachments||[])}catch(O){const R=((M=(j=O==null?void 0:O.response)==null?void 0:j.data)==null?void 0:M.detail)||"Failed to load attachments";B(R),console.error("Failed to load attachments:",O),A([])}finally{Q(!1)}});v.useEffect(()=>{b(),D()},[]);const _=j=>{C({id:j.id,file_name:j.file_name}),oe(!0)},E=()=>V(this,null,function*(){var j,M;if(te){se(te.id),c(null);try{yield L.delete(`/complaints/attachments/${te.id}`),yield D(),oe(!1),C(null)}catch(O){c(((M=(j=O==null?void 0:O.response)==null?void 0:j.data)==null?void 0:M.detail)||"Failed to delete attachment")}finally{se(null)}}}),I=j=>{if(j===0)return"0 B";const M=1024,O=["B","KB","MB","GB"],R=Math.floor(Math.log(j)/Math.log(M));return`${(j/Math.pow(M,R)).toFixed(2)} ${O[R]}`};return e.jsxs(ae,{children:[e.jsx(w,{variant:"h5",gutterBottom:!0,children:"Reference data"}),e.jsx(w,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage products, brokers, and insurers. Add individually or import via CSV (column: name)."}),e.jsxs(z,{spacing:3,children:[e.jsx(T,{kind:"products"}),e.jsx(T,{kind:"brokers"}),e.jsx(T,{kind:"insurers"}),t==="admin"&&e.jsx(le,{children:e.jsxs(ce,{children:[e.jsxs(z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(w,{variant:"h6",children:"Attachments"}),e.jsx($,{onClick:D,disabled:F,children:"Refresh"})]}),H&&e.jsxs(Pe,{severity:"warning",sx:{mb:2},onClose:()=>B(null),children:[H,H.includes("403")||H.includes("Forbidden")?e.jsx(w,{variant:"caption",display:"block",sx:{mt:.5},children:"Admin access required to view attachments."}):null]}),e.jsxs(Lt,{size:"small",children:[e.jsx(Bt,{children:e.jsxs(we,{children:[e.jsx(J,{children:"File Name"}),e.jsx(J,{children:"Content Type"}),e.jsx(J,{children:"Size"}),e.jsx(J,{children:"Uploaded"}),e.jsx(J,{children:"Status"}),e.jsx(J,{align:"right",children:"Actions"})]})}),e.jsx(Ut,{children:F?e.jsx(we,{children:e.jsx(J,{colSpan:6,children:"Loading..."})}):k.length===0?e.jsx(we,{children:e.jsx(J,{colSpan:6,children:"No attachments found"})}):k.map(j=>e.jsxs(we,{children:[e.jsx(J,{children:j.file_name}),e.jsx(J,{children:e.jsx(me,{label:j.content_type,size:"small"})}),e.jsx(J,{children:I(j.file_size_bytes)}),e.jsx(J,{children:j.uploaded_at?new Date(j.uploaded_at).toLocaleString():"N/A"}),e.jsx(J,{children:e.jsx(me,{label:j.file_exists?"Exists":"Missing",color:j.file_exists?"success":"error",size:"small"})}),e.jsx(J,{align:"right",children:e.jsxs(z,{direction:"row",spacing:1,justifyContent:"flex-end",children:[e.jsx(hn,{size:"small",component:"a",href:j.url,target:"_blank",rel:"noreferrer",title:"View/Download",children:e.jsx(Ds,{fontSize:"small"})}),e.jsx(hn,{size:"small",onClick:()=>_(j),disabled:Z===j.id,color:"error",title:"Delete",children:e.jsx(Br,{fontSize:"small"})})]})})]},j.id))})]})]})})]}),e.jsxs(Ne,{open:ue,onClose:()=>oe(!1),children:[e.jsx($e,{children:"Delete Attachment"}),e.jsxs(Le,{children:[e.jsxs(w,{children:["Are you sure you want to delete ",e.jsx("strong",{children:te==null?void 0:te.file_name}),"?"]}),e.jsx(w,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"This will permanently delete the file from disk and remove the database record. This action cannot be undone."})]}),e.jsxs(Be,{children:[e.jsx($,{onClick:()=>oe(!1),children:"Cancel"}),e.jsx($,{onClick:E,color:"error",variant:"contained",disabled:Z!==null,children:Z?"Deleting...":"Delete"})]})]})]})}function zi(){var A;const{name:t,mustChangePassword:n,refreshMe:s}=at(),a=!!((A=jn().state)!=null&&A.forced)||n,[u,l]=v.useState(""),[f,c]=v.useState(""),[i,o]=v.useState(""),[d,p]=v.useState(!1),[b,m]=v.useState(null),[g,y]=v.useState(null),T=v.useMemo(()=>!(!f||f.length<8||f!==i||!u),[f,i,u]),k=()=>V(this,null,function*(){var F,Q;p(!0),m(null),y(null);try{yield L.post("/auth/password/change",{current_password:u,new_password:f}),l(""),c(""),o(""),yield s(),y("Password updated.")}catch(Z){m(((Q=(F=Z==null?void 0:Z.response)==null?void 0:F.data)==null?void 0:Q.detail)||"Failed to update password")}finally{p(!1)}});return e.jsxs(ae,{children:[e.jsx(w,{variant:"h5",gutterBottom:!0,children:"Profile"}),e.jsxs(w,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Signed in as ",t||""]}),e.jsx(le,{sx:{maxWidth:520,mt:2},children:e.jsx(ce,{children:e.jsxs(z,{spacing:2,children:[a&&e.jsx(Pe,{severity:"warning",children:"Your password has been reset by an admin. You must set a new password before continuing."}),b&&e.jsx(Pe,{severity:"error",children:b}),g&&e.jsx(Pe,{severity:"success",children:g}),e.jsx(w,{variant:"subtitle1",children:"Change password"}),e.jsx(N,{label:"Current password",type:"password",value:u,onChange:F=>l(F.target.value),fullWidth:!0}),e.jsx(N,{label:"New password (min 8 chars)",type:"password",value:f,onChange:F=>c(F.target.value),fullWidth:!0}),e.jsx(N,{label:"Confirm new password",type:"password",value:i,onChange:F=>o(F.target.value),fullWidth:!0}),e.jsx($,{variant:"contained",onClick:k,disabled:!T||d,children:"Update password"})]})})})]})}var Yi=Object.defineProperty,Yt=Object.getOwnPropertySymbols,sr=Object.prototype.hasOwnProperty,rr=Object.prototype.propertyIsEnumerable,Rs=(t,n,s)=>n in t?Yi(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,Hi=(t,n)=>{for(var s in n||(n={}))sr.call(n,s)&&Rs(t,s,n[s]);if(Yt)for(var s of Yt(n))rr.call(n,s)&&Rs(t,s,n[s]);return t},qi=(t,n)=>{var s={};for(var r in t)sr.call(t,r)&&n.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&Yt)for(var r of Yt(t))n.indexOf(r)<0&&rr.call(t,r)&&(s[r]=t[r]);return s};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Ke;(t=>{const n=class{constructor(c,i,o,d){if(this.version=c,this.errorCorrectionLevel=i,this.modules=[],this.isFunction=[],c<n.MIN_VERSION||c>n.MAX_VERSION)throw new RangeError("Version value out of range");if(d<-1||d>7)throw new RangeError("Mask value out of range");this.size=c*4+17;let p=[];for(let m=0;m<this.size;m++)p.push(!1);for(let m=0;m<this.size;m++)this.modules.push(p.slice()),this.isFunction.push(p.slice());this.drawFunctionPatterns();const b=this.addEccAndInterleave(o);if(this.drawCodewords(b),d==-1){let m=1e9;for(let g=0;g<8;g++){this.applyMask(g),this.drawFormatBits(g);const y=this.getPenaltyScore();y<m&&(d=g,m=y),this.applyMask(g)}}u(0<=d&&d<=7),this.mask=d,this.applyMask(d),this.drawFormatBits(d),this.isFunction=[]}static encodeText(c,i){const o=t.QrSegment.makeSegments(c);return n.encodeSegments(o,i)}static encodeBinary(c,i){const o=t.QrSegment.makeBytes(c);return n.encodeSegments([o],i)}static encodeSegments(c,i,o=1,d=40,p=-1,b=!0){if(!(n.MIN_VERSION<=o&&o<=d&&d<=n.MAX_VERSION)||p<-1||p>7)throw new RangeError("Invalid value");let m,g;for(m=o;;m++){const A=n.getNumDataCodewords(m,i)*8,F=f.getTotalBits(c,m);if(F<=A){g=F;break}if(m>=d)throw new RangeError("Data too long")}for(const A of[n.Ecc.MEDIUM,n.Ecc.QUARTILE,n.Ecc.HIGH])b&&g<=n.getNumDataCodewords(m,A)*8&&(i=A);let y=[];for(const A of c){r(A.mode.modeBits,4,y),r(A.numChars,A.mode.numCharCountBits(m),y);for(const F of A.getData())y.push(F)}u(y.length==g);const T=n.getNumDataCodewords(m,i)*8;u(y.length<=T),r(0,Math.min(4,T-y.length),y),r(0,(8-y.length%8)%8,y),u(y.length%8==0);for(let A=236;y.length<T;A^=253)r(A,8,y);let k=[];for(;k.length*8<y.length;)k.push(0);return y.forEach((A,F)=>k[F>>>3]|=A<<7-(F&7)),new n(m,i,k,p)}getModule(c,i){return 0<=c&&c<this.size&&0<=i&&i<this.size&&this.modules[i][c]}getModules(){return this.modules}drawFunctionPatterns(){for(let o=0;o<this.size;o++)this.setFunctionModule(6,o,o%2==0),this.setFunctionModule(o,6,o%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const c=this.getAlignmentPatternPositions(),i=c.length;for(let o=0;o<i;o++)for(let d=0;d<i;d++)o==0&&d==0||o==0&&d==i-1||o==i-1&&d==0||this.drawAlignmentPattern(c[o],c[d]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(c){const i=this.errorCorrectionLevel.formatBits<<3|c;let o=i;for(let p=0;p<10;p++)o=o<<1^(o>>>9)*1335;const d=(i<<10|o)^21522;u(d>>>15==0);for(let p=0;p<=5;p++)this.setFunctionModule(8,p,a(d,p));this.setFunctionModule(8,7,a(d,6)),this.setFunctionModule(8,8,a(d,7)),this.setFunctionModule(7,8,a(d,8));for(let p=9;p<15;p++)this.setFunctionModule(14-p,8,a(d,p));for(let p=0;p<8;p++)this.setFunctionModule(this.size-1-p,8,a(d,p));for(let p=8;p<15;p++)this.setFunctionModule(8,this.size-15+p,a(d,p));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let c=this.version;for(let o=0;o<12;o++)c=c<<1^(c>>>11)*7973;const i=this.version<<12|c;u(i>>>18==0);for(let o=0;o<18;o++){const d=a(i,o),p=this.size-11+o%3,b=Math.floor(o/3);this.setFunctionModule(p,b,d),this.setFunctionModule(b,p,d)}}drawFinderPattern(c,i){for(let o=-4;o<=4;o++)for(let d=-4;d<=4;d++){const p=Math.max(Math.abs(d),Math.abs(o)),b=c+d,m=i+o;0<=b&&b<this.size&&0<=m&&m<this.size&&this.setFunctionModule(b,m,p!=2&&p!=4)}}drawAlignmentPattern(c,i){for(let o=-2;o<=2;o++)for(let d=-2;d<=2;d++)this.setFunctionModule(c+d,i+o,Math.max(Math.abs(d),Math.abs(o))!=1)}setFunctionModule(c,i,o){this.modules[i][c]=o,this.isFunction[i][c]=!0}addEccAndInterleave(c){const i=this.version,o=this.errorCorrectionLevel;if(c.length!=n.getNumDataCodewords(i,o))throw new RangeError("Invalid argument");const d=n.NUM_ERROR_CORRECTION_BLOCKS[o.ordinal][i],p=n.ECC_CODEWORDS_PER_BLOCK[o.ordinal][i],b=Math.floor(n.getNumRawDataModules(i)/8),m=d-b%d,g=Math.floor(b/d);let y=[];const T=n.reedSolomonComputeDivisor(p);for(let A=0,F=0;A<d;A++){let Q=c.slice(F,F+g-p+(A<m?0:1));F+=Q.length;const Z=n.reedSolomonComputeRemainder(Q,T);A<m&&Q.push(0),y.push(Q.concat(Z))}let k=[];for(let A=0;A<y[0].length;A++)y.forEach((F,Q)=>{(A!=g-p||Q>=m)&&k.push(F[A])});return u(k.length==b),k}drawCodewords(c){if(c.length!=Math.floor(n.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let i=0;for(let o=this.size-1;o>=1;o-=2){o==6&&(o=5);for(let d=0;d<this.size;d++)for(let p=0;p<2;p++){const b=o-p,g=(o+1&2)==0?this.size-1-d:d;!this.isFunction[g][b]&&i<c.length*8&&(this.modules[g][b]=a(c[i>>>3],7-(i&7)),i++)}}u(i==c.length*8)}applyMask(c){if(c<0||c>7)throw new RangeError("Mask value out of range");for(let i=0;i<this.size;i++)for(let o=0;o<this.size;o++){let d;switch(c){case 0:d=(o+i)%2==0;break;case 1:d=i%2==0;break;case 2:d=o%3==0;break;case 3:d=(o+i)%3==0;break;case 4:d=(Math.floor(o/3)+Math.floor(i/2))%2==0;break;case 5:d=o*i%2+o*i%3==0;break;case 6:d=(o*i%2+o*i%3)%2==0;break;case 7:d=((o+i)%2+o*i%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[i][o]&&d&&(this.modules[i][o]=!this.modules[i][o])}}getPenaltyScore(){let c=0;for(let p=0;p<this.size;p++){let b=!1,m=0,g=[0,0,0,0,0,0,0];for(let y=0;y<this.size;y++)this.modules[p][y]==b?(m++,m==5?c+=n.PENALTY_N1:m>5&&c++):(this.finderPenaltyAddHistory(m,g),b||(c+=this.finderPenaltyCountPatterns(g)*n.PENALTY_N3),b=this.modules[p][y],m=1);c+=this.finderPenaltyTerminateAndCount(b,m,g)*n.PENALTY_N3}for(let p=0;p<this.size;p++){let b=!1,m=0,g=[0,0,0,0,0,0,0];for(let y=0;y<this.size;y++)this.modules[y][p]==b?(m++,m==5?c+=n.PENALTY_N1:m>5&&c++):(this.finderPenaltyAddHistory(m,g),b||(c+=this.finderPenaltyCountPatterns(g)*n.PENALTY_N3),b=this.modules[y][p],m=1);c+=this.finderPenaltyTerminateAndCount(b,m,g)*n.PENALTY_N3}for(let p=0;p<this.size-1;p++)for(let b=0;b<this.size-1;b++){const m=this.modules[p][b];m==this.modules[p][b+1]&&m==this.modules[p+1][b]&&m==this.modules[p+1][b+1]&&(c+=n.PENALTY_N2)}let i=0;for(const p of this.modules)i=p.reduce((b,m)=>b+(m?1:0),i);const o=this.size*this.size,d=Math.ceil(Math.abs(i*20-o*10)/o)-1;return u(0<=d&&d<=9),c+=d*n.PENALTY_N4,u(0<=c&&c<=2568888),c}getAlignmentPatternPositions(){if(this.version==1)return[];{const c=Math.floor(this.version/7)+2,i=this.version==32?26:Math.ceil((this.version*4+4)/(c*2-2))*2;let o=[6];for(let d=this.size-7;o.length<c;d-=i)o.splice(1,0,d);return o}}static getNumRawDataModules(c){if(c<n.MIN_VERSION||c>n.MAX_VERSION)throw new RangeError("Version number out of range");let i=(16*c+128)*c+64;if(c>=2){const o=Math.floor(c/7)+2;i-=(25*o-10)*o-55,c>=7&&(i-=36)}return u(208<=i&&i<=29648),i}static getNumDataCodewords(c,i){return Math.floor(n.getNumRawDataModules(c)/8)-n.ECC_CODEWORDS_PER_BLOCK[i.ordinal][c]*n.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][c]}static reedSolomonComputeDivisor(c){if(c<1||c>255)throw new RangeError("Degree out of range");let i=[];for(let d=0;d<c-1;d++)i.push(0);i.push(1);let o=1;for(let d=0;d<c;d++){for(let p=0;p<i.length;p++)i[p]=n.reedSolomonMultiply(i[p],o),p+1<i.length&&(i[p]^=i[p+1]);o=n.reedSolomonMultiply(o,2)}return i}static reedSolomonComputeRemainder(c,i){let o=i.map(d=>0);for(const d of c){const p=d^o.shift();o.push(0),i.forEach((b,m)=>o[m]^=n.reedSolomonMultiply(b,p))}return o}static reedSolomonMultiply(c,i){if(c>>>8||i>>>8)throw new RangeError("Byte out of range");let o=0;for(let d=7;d>=0;d--)o=o<<1^(o>>>7)*285,o^=(i>>>d&1)*c;return u(o>>>8==0),o}finderPenaltyCountPatterns(c){const i=c[1];u(i<=this.size*3);const o=i>0&&c[2]==i&&c[3]==i*3&&c[4]==i&&c[5]==i;return(o&&c[0]>=i*4&&c[6]>=i?1:0)+(o&&c[6]>=i*4&&c[0]>=i?1:0)}finderPenaltyTerminateAndCount(c,i,o){return c&&(this.finderPenaltyAddHistory(i,o),i=0),i+=this.size,this.finderPenaltyAddHistory(i,o),this.finderPenaltyCountPatterns(o)}finderPenaltyAddHistory(c,i){i[0]==0&&(c+=this.size),i.pop(),i.unshift(c)}};let s=n;s.MIN_VERSION=1,s.MAX_VERSION=40,s.PENALTY_N1=3,s.PENALTY_N2=3,s.PENALTY_N3=40,s.PENALTY_N4=10,s.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],s.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=s;function r(c,i,o){if(i<0||i>31||c>>>i)throw new RangeError("Value out of range");for(let d=i-1;d>=0;d--)o.push(c>>>d&1)}function a(c,i){return(c>>>i&1)!=0}function u(c){if(!c)throw new Error("Assertion error")}const l=class{constructor(c,i,o){if(this.mode=c,this.numChars=i,this.bitData=o,i<0)throw new RangeError("Invalid argument");this.bitData=o.slice()}static makeBytes(c){let i=[];for(const o of c)r(o,8,i);return new l(l.Mode.BYTE,c.length,i)}static makeNumeric(c){if(!l.isNumeric(c))throw new RangeError("String contains non-numeric characters");let i=[];for(let o=0;o<c.length;){const d=Math.min(c.length-o,3);r(parseInt(c.substr(o,d),10),d*3+1,i),o+=d}return new l(l.Mode.NUMERIC,c.length,i)}static makeAlphanumeric(c){if(!l.isAlphanumeric(c))throw new RangeError("String contains unencodable characters in alphanumeric mode");let i=[],o;for(o=0;o+2<=c.length;o+=2){let d=l.ALPHANUMERIC_CHARSET.indexOf(c.charAt(o))*45;d+=l.ALPHANUMERIC_CHARSET.indexOf(c.charAt(o+1)),r(d,11,i)}return o<c.length&&r(l.ALPHANUMERIC_CHARSET.indexOf(c.charAt(o)),6,i),new l(l.Mode.ALPHANUMERIC,c.length,i)}static makeSegments(c){return c==""?[]:l.isNumeric(c)?[l.makeNumeric(c)]:l.isAlphanumeric(c)?[l.makeAlphanumeric(c)]:[l.makeBytes(l.toUtf8ByteArray(c))]}static makeEci(c){let i=[];if(c<0)throw new RangeError("ECI assignment value out of range");if(c<128)r(c,8,i);else if(c<16384)r(2,2,i),r(c,14,i);else if(c<1e6)r(6,3,i),r(c,21,i);else throw new RangeError("ECI assignment value out of range");return new l(l.Mode.ECI,0,i)}static isNumeric(c){return l.NUMERIC_REGEX.test(c)}static isAlphanumeric(c){return l.ALPHANUMERIC_REGEX.test(c)}getData(){return this.bitData.slice()}static getTotalBits(c,i){let o=0;for(const d of c){const p=d.mode.numCharCountBits(i);if(d.numChars>=1<<p)return 1/0;o+=4+p+d.bitData.length}return o}static toUtf8ByteArray(c){c=encodeURI(c);let i=[];for(let o=0;o<c.length;o++)c.charAt(o)!="%"?i.push(c.charCodeAt(o)):(i.push(parseInt(c.substr(o+1,2),16)),o+=2);return i}};let f=l;f.NUMERIC_REGEX=/^[0-9]*$/,f.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,f.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",t.QrSegment=f})(Ke||(Ke={}));(t=>{(n=>{const s=class{constructor(a,u){this.ordinal=a,this.formatBits=u}};let r=s;r.LOW=new s(0,1),r.MEDIUM=new s(1,0),r.QUARTILE=new s(2,3),r.HIGH=new s(3,2),n.Ecc=r})(t.QrCode||(t.QrCode={}))})(Ke||(Ke={}));(t=>{(n=>{const s=class{constructor(a,u){this.modeBits=a,this.numBitsCharCount=u}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};let r=s;r.NUMERIC=new s(1,[10,12,14]),r.ALPHANUMERIC=new s(2,[9,11,13]),r.BYTE=new s(4,[8,16,16]),r.KANJI=new s(8,[8,10,12]),r.ECI=new s(7,[0,0,0]),n.Mode=r})(t.QrSegment||(t.QrSegment={}))})(Ke||(Ke={}));var dt=Ke;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Vi={L:dt.QrCode.Ecc.LOW,M:dt.QrCode.Ecc.MEDIUM,Q:dt.QrCode.Ecc.QUARTILE,H:dt.QrCode.Ecc.HIGH},Ji=128,Qi="L",Ki="#FFFFFF",Gi="#000000",Xi=!1,ar=4,Zi=.1;function eo(t,n=0){const s=[];return t.forEach(function(r,a){let u=null;r.forEach(function(l,f){if(!l&&u!==null){s.push(`M${u+n} ${a+n}h${f-u}v1H${u+n}z`),u=null;return}if(f===r.length-1){if(!l)return;u===null?s.push(`M${f+n},${a+n} h1v1H${f+n}z`):s.push(`M${u+n},${a+n} h${f+1-u}v1H${u+n}z`);return}l&&u===null&&(u=f)})}),s.join("")}function to(t,n){return t.slice().map((s,r)=>r<n.y||r>=n.y+n.h?s:s.map((a,u)=>u<n.x||u>=n.x+n.w?a:!1))}function no(t,n,s,r){if(r==null)return null;const a=s?ar:0,u=t.length+a*2,l=Math.floor(n*Zi),f=u/n,c=(r.width||l)*f,i=(r.height||l)*f,o=r.x==null?t.length/2-c/2:r.x*f,d=r.y==null?t.length/2-i/2:r.y*f;let p=null;if(r.excavate){let b=Math.floor(o),m=Math.floor(d),g=Math.ceil(c+o-b),y=Math.ceil(i+d-m);p={x:b,y:m,w:g,h:y}}return{x:o,y:d,h:i,w:c,excavation:p}}(function(){try{new Path2D().addPath(new Path2D)}catch(t){return!1}return!0})();function so(t){const n=t,{value:s,size:r=Ji,level:a=Qi,bgColor:u=Ki,fgColor:l=Gi,includeMargin:f=Xi,imageSettings:c}=n,i=qi(n,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let o=dt.QrCode.encodeText(s,Vi[a]).getModules();const d=f?ar:0,p=o.length+d*2,b=no(o,r,f,c);let m=null;c!=null&&b!=null&&(b.excavation!=null&&(o=to(o,b.excavation)),m=tt.createElement("image",{xlinkHref:c.src,height:b.h,width:b.w,x:b.x+d,y:b.y+d,preserveAspectRatio:"none"}));const g=eo(o,d);return tt.createElement("svg",Hi({height:r,width:r,viewBox:`0 0 ${p} ${p}`},i),tt.createElement("path",{fill:u,d:`M0,0 h${p}v${p}H0z`,shapeRendering:"crispEdges"}),tt.createElement("path",{fill:l,d:g,shapeRendering:"crispEdges"}),m)}new URL("/assets/compass-logo-D3WIe7Ai.png",import.meta.url).href;function ro(){const{token:t,role:n,name:s,login:r,logout:a,mustChangePassword:u,ready:l}=at(),[f,c]=v.useState(""),[i,o]=v.useState(""),[d,p]=v.useState(!1),[b,m]=v.useState(""),[g,y]=v.useState(""),[T,k]=v.useState(null),[A,F]=v.useState(!1),[Q,Z]=v.useState(!1),[se,ue]=v.useState(null),[oe,te]=v.useState(null),[C,H]=v.useState(0),[B,D]=v.useState(!1),_=ut(),E=jn();v.useEffect(()=>{D(!t)},[t]),v.useEffect(()=>{l&&(t||E.pathname!=="/"&&_("/",{replace:!0}))},[l,t,E.pathname,_]),v.useEffect(()=>{t&&u&&E.pathname!=="/profile"&&_("/profile",{replace:!0,state:{forced:!0}})},[t,u,E.pathname,_]);const I=()=>V(this,null,function*(){var R,P;k(null);try{const U=yield r(f,i,A?b:void 0,A?g:void 0);F(!1),m(""),y(""),U!=null&&U.mfa_enrollment_required?(H(U.mfa_remaining_skips||0),yield j()):_("/")}catch(U){const ne=(P=(R=U==null?void 0:U.response)==null?void 0:R.data)==null?void 0:P.detail;ne==="MFA code required"||(ne==null?void 0:ne.code)==="mfa_required"?(F(!0),k("Enter your 6-digit MFA code or a recovery code.")):k(ne==="Invalid recovery code"||ne==="Invalid MFA code"||ne==="Invalid code"?"Invalid code. Please try again.":"Login failed. Check your credentials.")}}),j=()=>V(this,null,function*(){var R,P;try{const U=yield L.post("/auth/mfa/enroll");ue(U.data),te(null),Z(!0)}catch(U){k(((P=(R=U==null?void 0:U.response)==null?void 0:R.data)==null?void 0:P.detail)||"Could not start MFA enrollment")}}),M=()=>V(this,null,function*(){var R,P;try{const U=yield L.post("/auth/mfa/verify",{code:b});te(U.data.recovery_codes),Z(!1),m(""),H(0),_("/")}catch(U){k(((P=(R=U==null?void 0:U.response)==null?void 0:R.data)==null?void 0:P.detail)||"Invalid code")}}),O=()=>V(this,null,function*(){var R,P;try{const U=yield L.post("/auth/mfa/skip");H(U.data.remaining_skips),Z(!1),ue(null)}catch(U){k(((P=(R=U==null?void 0:U.response)==null?void 0:R.data)==null?void 0:P.detail)||"Cannot skip MFA")}});return e.jsxs(e.Fragment,{children:[e.jsx(Ur,{position:"static",color:"transparent",elevation:0,sx:{borderBottom:"1px solid rgba(255,255,255,0.08)",background:"linear-gradient(135deg, #0f172a 0%, #0f4c81 100%)",color:"#e5e7eb"},children:e.jsx(es,{maxWidth:"lg",children:e.jsxs(Wr,{disableGutters:!0,sx:{py:1.5,minHeight:72},children:[e.jsx(z,{direction:"row",alignItems:"center",spacing:1.6,sx:{flexGrow:1},children:e.jsx(w,{variant:"h5",sx:{fontWeight:800,letterSpacing:.4,color:"#f8fafc"},children:e.jsx(Fe,{to:"/",style:{color:"inherit",textDecoration:"none"},children:"Compass"})})}),t&&e.jsxs(z,{direction:"row",gap:1.5,alignItems:"center",children:[e.jsx(w,{variant:"body2",sx:{color:"rgba(255,255,255,0.85)"},children:s}),e.jsx($,{color:"inherit",component:Fe,to:"/",sx:{fontWeight:700,color:"#f8fafc"},children:"Dashboard"}),e.jsx($,{color:"inherit",component:Fe,to:"/complaints",sx:{fontWeight:700,color:"#f8fafc"},children:"Complaints"}),e.jsx($,{color:"inherit",component:Fe,to:"/profile",sx:{fontWeight:700,color:"#f8fafc"},children:"Profile"}),e.jsx($,{color:"inherit",component:Fe,to:"/complaints/new",disabled:n==="read_only",sx:{fontWeight:700,color:"#f8fafc"},children:"New"}),n==="admin"&&e.jsx($,{color:"inherit",component:Fe,to:"/admin",sx:{fontWeight:700,color:"#f8fafc"},children:"Admin"}),n==="admin"&&e.jsx($,{color:"inherit",component:Fe,to:"/reference",sx:{fontWeight:700,color:"#f8fafc"},children:"Reference"}),e.jsx($,{color:"inherit",onClick:a,sx:{fontWeight:700,color:"#f8fafc"},children:"Logout"})]})]})})}),e.jsx(es,{maxWidth:"lg",sx:{mt:4,mb:4},children:t?e.jsxs(Xr,{children:[e.jsx(ze,{path:"/",element:e.jsx(Fi,{})}),e.jsx(ze,{path:"/complaints",element:e.jsx($i,{})}),e.jsx(ze,{path:"/complaints/new",element:e.jsx(Bi,{})}),e.jsx(ze,{path:"/complaints/:id",element:e.jsx(Li,{})}),e.jsx(ze,{path:"/profile",element:e.jsx(zi,{})}),e.jsx(ze,{path:"/admin",element:e.jsx(Ui,{})}),e.jsx(ze,{path:"/reference",element:e.jsx(Wi,{})})]}):e.jsx(ae,{maxWidth:420,mx:"auto",mt:6,children:e.jsx(le,{children:e.jsxs(ce,{sx:{p:4},children:[B&&e.jsx(Pe,{severity:"info",sx:{mb:2},children:"Please log in to continue."}),e.jsxs(w,{variant:"h5",gutterBottom:!0,children:["Sign in ",!1]}),e.jsx(w,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Use your credentials to access the complaints workspace."}),T&&e.jsx(w,{variant:"body2",color:"error",sx:{mb:1},children:T}),e.jsxs(ae,{component:"form",onSubmit:R=>{R.preventDefault(),I()},children:[e.jsx(N,{label:"Email",value:f,onChange:R=>c(R.target.value),fullWidth:!0,sx:{mb:2.5,mt:1},autoComplete:"email"}),e.jsx(N,{label:"Password",type:d?"text":"password",value:i,onChange:R=>o(R.target.value),fullWidth:!0,sx:{mb:3},autoComplete:"current-password",InputProps:{endAdornment:e.jsx(zr,{position:"end",children:e.jsx(hn,{"aria-label":d?"Hide password":"Show password",onClick:()=>p(R=>!R),edge:"end",children:d?e.jsx(Yr,{}):e.jsx(Ds,{})})})}}),A&&e.jsxs(e.Fragment,{children:[e.jsx(N,{label:"MFA code (6 digits)",value:b,onChange:R=>m(R.target.value),fullWidth:!0,sx:{mb:2}}),e.jsx(N,{label:"Recovery code (optional)",value:g,onChange:R=>y(R.target.value),fullWidth:!0,sx:{mb:3}})]}),e.jsx($,{variant:"contained",fullWidth:!0,size:"large",type:"submit",children:"Login"})]})]})})})}),e.jsxs(Ne,{open:Q,onClose:C>0?()=>Z(!1):void 0,disableEscapeKeyDown:C<=0,children:[e.jsx($e,{children:"Set up MFA"}),e.jsx(Le,{children:e.jsxs(z,{spacing:2,sx:{mt:1},children:[C<=0?e.jsx(w,{color:"error",children:"You must enable MFA to continue."}):e.jsxs(w,{children:["We recommend enabling MFA. You can skip up to ",C," more time(s)."]}),se?e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"subtitle2",children:"Scan in your authenticator app"}),e.jsx(ae,{display:"flex",justifyContent:"center",children:e.jsx(so,{value:se.otpauth_url,size:180})}),e.jsxs(w,{variant:"body2",children:["Secret (manual entry): ",se.secret]}),e.jsx(N,{label:"6-digit code",value:b,onChange:R=>m(R.target.value),size:"small",sx:{maxWidth:240}}),oe&&e.jsxs(ae,{children:[e.jsx(w,{variant:"subtitle2",gutterBottom:!0,children:"Recovery codes (store securely)"}),e.jsx(z,{direction:"row",gap:1,flexWrap:"wrap",children:oe.map(R=>e.jsx(ae,{sx:{border:"1px solid #ddd",px:1.5,py:.5,borderRadius:1,fontFamily:"monospace"},children:R},R))})]})]}):e.jsx(w,{color:"text.secondary",children:"Preparing enrollment..."})]})}),e.jsxs(Be,{sx:{px:3,pb:2},children:[e.jsx($,{onClick:O,disabled:C<=0,children:"Skip for now"}),e.jsx($,{variant:"contained",onClick:M,disabled:!b||b.length<6,children:"Verify & enable"})]})]})]})}const ao=Hr({palette:{mode:"light",primary:{main:"#0f4c81"},secondary:{main:"#0b6e4f"},background:{default:"#f5f7fb",paper:"#ffffff"},text:{primary:"#1b2430",secondary:"#4b5563"}},shape:{borderRadius:10},typography:{fontFamily:"'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif",h5:{fontWeight:600},h6:{fontWeight:600},subtitle2:{fontWeight:600,letterSpacing:.1}},components:{MuiCssBaseline:{styleOverrides:{body:{backgroundColor:"#f5f7fb"}}},MuiCard:{defaultProps:{elevation:0},styleOverrides:{root:{border:"1px solid #e5e7eb",boxShadow:"0 6px 18px rgba(15,76,129,0.06)"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:10,fontWeight:600}}},MuiTextField:{defaultProps:{size:"small"}},MuiPaper:{styleOverrides:{root:{borderRadius:12}}}}});fn.createRoot(document.getElementById("root")).render(e.jsx(tt.StrictMode,{children:e.jsxs(qr,{theme:ao,children:[e.jsx(Vr,{}),e.jsx(Zr,{children:e.jsx(ki,{children:e.jsx(ro,{})})})]})}));
