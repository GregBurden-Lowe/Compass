var Kr=Object.defineProperty,Qr=Object.defineProperties;var Xr=Object.getOwnPropertyDescriptors;var bt=Object.getOwnPropertySymbols;var ws=Object.prototype.hasOwnProperty,Cs=Object.prototype.propertyIsEnumerable;var Ve=(t,s)=>(s=Symbol[t])?s:Symbol.for("Symbol."+t),Gr=t=>{throw TypeError(t)};var Ns=(t,s,n)=>s in t?Kr(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,ee=(t,s)=>{for(var n in s||(s={}))ws.call(s,n)&&Ns(t,n,s[n]);if(bt)for(var n of bt(s))Cs.call(s,n)&&Ns(t,n,s[n]);return t},oe=(t,s)=>Qr(t,Xr(s));var It=(t,s)=>{var n={};for(var r in t)ws.call(t,r)&&s.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&bt)for(var r of bt(t))s.indexOf(r)<0&&Cs.call(t,r)&&(n[r]=t[r]);return n};var Zr=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports);var Q=(t,s,n)=>new Promise((r,a)=>{var o=l=>{try{u(n.next(l))}catch(i){a(i)}},d=l=>{try{u(n.throw(l))}catch(i){a(i)}},u=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,d);u((n=n.apply(t,s)).next())}),De=function(t,s){this[0]=t,this[1]=s},Bt=(t,s,n)=>{var r=(d,u,l,i)=>{try{var c=n[d](u),m=(u=c.value)instanceof De,h=c.done;Promise.resolve(m?u[0]:u).then(v=>m?r(d==="return"?d:"next",u[1]?{done:v.done,value:v.value}:v,l,i):l({value:v,done:h})).catch(v=>r("throw",v,l,i))}catch(v){i(v)}},a=d=>o[d]=u=>new Promise((l,i)=>r(d,u,l,i)),o={};return n=n.apply(t,s),o[Ve("asyncIterator")]=()=>o,a("next"),a("throw"),a("return"),o},Ut=t=>{var s=t[Ve("asyncIterator")],n=!1,r,a={};return s==null?(s=t[Ve("iterator")](),r=o=>a[o]=d=>s[o](d)):(s=s.call(t),r=o=>a[o]=d=>{if(n){if(n=!1,o==="throw")throw d;return d}return n=!0,{done:!1,value:new De(new Promise(u=>{var l=s[o](d);l instanceof Object||Gr("Object expected"),u(l)}),1)}}),a[Ve("iterator")]=()=>a,r("next"),"throw"in s?r("throw"):a.throw=o=>{throw o},"return"in s&&r("return"),a},_s=(t,s,n)=>(s=t[Ve("asyncIterator")])?s.call(t):(t=t[Ve("iterator")](),s={},n=(r,a)=>(a=t[r])&&(s[r]=o=>new Promise((d,u,l)=>(o=a.call(t,o),l=o.done,Promise.resolve(o.value).then(i=>d({value:i,done:l}),u)))),n("next"),n("return"),s);import{j as e}from"./mui-pHrinNmD.js";import{a as en,c as qs,g as Vs,r as f,u as Xt,L as tn,b as Ke,d as sn,e as rn,R as nt,f as nn,h as Fe,B as an}from"./vendor-0kNZJvhf.js";var xi=Zr(Le=>{(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var qt={},ks=en;qt.createRoot=ks.createRoot,qt.hydrateRoot=ks.hydrateRoot;var Js={exports:{}};(function(t,s){(function(n,r){t.exports=r()})(qs,function(){var n=1e3,r=6e4,a=36e5,o="millisecond",d="second",u="minute",l="hour",i="day",c="week",m="month",h="quarter",v="year",x="date",y="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,j=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,R={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(P){var L=["th","st","nd","rd"],w=P%100;return"["+P+(L[(w-20)%10]||L[w]||L[0])+"]"}},N=function(P,L,w){var _=String(P);return!_||_.length>=L?P:""+Array(L+1-_.length).join(w)+P},C={s:N,z:function(P){var L=-P.utcOffset(),w=Math.abs(L),_=Math.floor(w/60),E=w%60;return(L<=0?"+":"-")+N(_,2,"0")+":"+N(E,2,"0")},m:function P(L,w){if(L.date()<w.date())return-P(w,L);var _=12*(w.year()-L.year())+(w.month()-L.month()),E=L.clone().add(_,m),A=w-E<0,U=L.clone().add(_+(A?-1:1),m);return+(-(_+(w-E)/(A?E-U:U-E))||0)},a:function(P){return P<0?Math.ceil(P)||0:Math.floor(P)},p:function(P){return{M:m,y:v,w:c,d:i,D:x,h:l,m:u,s:d,ms:o,Q:h}[P]||String(P||"").toLowerCase().replace(/s$/,"")},u:function(P){return P===void 0}},D="en",k={};k[D]=R;var Y="$isDayjsObject",se=function(P){return P instanceof T||!(!P||!P[Y])},F=function P(L,w,_){var E;if(!L)return D;if(typeof L=="string"){var A=L.toLowerCase();k[A]&&(E=A),w&&(k[A]=w,E=A);var U=L.split("-");if(!E&&U.length>1)return P(U[0])}else{var S=L.name;k[S]=L,E=S}return!_&&E&&(D=E),E||!_&&D},B=function(P,L){if(se(P))return P.clone();var w=typeof L=="object"?L:{};return w.date=P,w.args=arguments,new T(w)},I=C;I.l=F,I.i=se,I.w=function(P,L){return B(P,{locale:L.$L,utc:L.$u,x:L.$x,$offset:L.$offset})};var T=function(){function P(w){this.$L=F(w.locale,null,!0),this.parse(w),this.$x=this.$x||w.x||{},this[Y]=!0}var L=P.prototype;return L.parse=function(w){this.$d=function(_){var E=_.date,A=_.utc;if(E===null)return new Date(NaN);if(I.u(E))return new Date;if(E instanceof Date)return new Date(E);if(typeof E=="string"&&!/Z$/i.test(E)){var U=E.match(p);if(U){var S=U[2]-1||0,q=(U[7]||"0").substring(0,3);return A?new Date(Date.UTC(U[1],S,U[3]||1,U[4]||0,U[5]||0,U[6]||0,q)):new Date(U[1],S,U[3]||1,U[4]||0,U[5]||0,U[6]||0,q)}}return new Date(E)}(w),this.init()},L.init=function(){var w=this.$d;this.$y=w.getFullYear(),this.$M=w.getMonth(),this.$D=w.getDate(),this.$W=w.getDay(),this.$H=w.getHours(),this.$m=w.getMinutes(),this.$s=w.getSeconds(),this.$ms=w.getMilliseconds()},L.$utils=function(){return I},L.isValid=function(){return this.$d.toString()!==y},L.isSame=function(w,_){var E=B(w);return this.startOf(_)<=E&&E<=this.endOf(_)},L.isAfter=function(w,_){return B(w)<this.startOf(_)},L.isBefore=function(w,_){return this.endOf(_)<B(w)},L.$g=function(w,_,E){return I.u(w)?this[_]:this.set(E,w)},L.unix=function(){return Math.floor(this.valueOf()/1e3)},L.valueOf=function(){return this.$d.getTime()},L.startOf=function(w,_){var E=this,A=!!I.u(_)||_,U=I.p(w),S=function(he,H){var X=I.w(E.$u?Date.UTC(E.$y,H,he):new Date(E.$y,H,he),E);return A?X:X.endOf(i)},q=function(he,H){return I.w(E.toDate()[he].apply(E.toDate("s"),(A?[0,0,0,0]:[23,59,59,999]).slice(H)),E)},V=this.$W,$=this.$M,G=this.$D,M="set"+(this.$u?"UTC":"");switch(U){case v:return A?S(1,0):S(31,11);case m:return A?S(1,$):S(0,$+1);case c:var te=this.$locale().weekStart||0,le=(V<te?V+7:V)-te;return S(A?G-le:G+(6-le),$);case i:case x:return q(M+"Hours",0);case l:return q(M+"Minutes",1);case u:return q(M+"Seconds",2);case d:return q(M+"Milliseconds",3);default:return this.clone()}},L.endOf=function(w){return this.startOf(w,!1)},L.$set=function(w,_){var E,A=I.p(w),U="set"+(this.$u?"UTC":""),S=(E={},E[i]=U+"Date",E[x]=U+"Date",E[m]=U+"Month",E[v]=U+"FullYear",E[l]=U+"Hours",E[u]=U+"Minutes",E[d]=U+"Seconds",E[o]=U+"Milliseconds",E)[A],q=A===i?this.$D+(_-this.$W):_;if(A===m||A===v){var V=this.clone().set(x,1);V.$d[S](q),V.init(),this.$d=V.set(x,Math.min(this.$D,V.daysInMonth())).$d}else S&&this.$d[S](q);return this.init(),this},L.set=function(w,_){return this.clone().$set(w,_)},L.get=function(w){return this[I.p(w)]()},L.add=function(w,_){var E,A=this;w=Number(w);var U=I.p(_),S=function($){var G=B(A);return I.w(G.date(G.date()+Math.round($*w)),A)};if(U===m)return this.set(m,this.$M+w);if(U===v)return this.set(v,this.$y+w);if(U===i)return S(1);if(U===c)return S(7);var q=(E={},E[u]=r,E[l]=a,E[d]=n,E)[U]||1,V=this.$d.getTime()+w*q;return I.w(V,this)},L.subtract=function(w,_){return this.add(-1*w,_)},L.format=function(w){var _=this,E=this.$locale();if(!this.isValid())return E.invalidDate||y;var A=w||"YYYY-MM-DDTHH:mm:ssZ",U=I.z(this),S=this.$H,q=this.$m,V=this.$M,$=E.weekdays,G=E.months,M=E.meridiem,te=function(H,X,re,Me){return H&&(H[X]||H(_,A))||re[X].slice(0,Me)},le=function(H){return I.s(S%12||12,H,"0")},he=M||function(H,X,re){var Me=H<12?"AM":"PM";return re?Me.toLowerCase():Me};return A.replace(j,function(H,X){return X||function(re){switch(re){case"YY":return String(_.$y).slice(-2);case"YYYY":return I.s(_.$y,4,"0");case"M":return V+1;case"MM":return I.s(V+1,2,"0");case"MMM":return te(E.monthsShort,V,G,3);case"MMMM":return te(G,V);case"D":return _.$D;case"DD":return I.s(_.$D,2,"0");case"d":return String(_.$W);case"dd":return te(E.weekdaysMin,_.$W,$,2);case"ddd":return te(E.weekdaysShort,_.$W,$,3);case"dddd":return $[_.$W];case"H":return String(S);case"HH":return I.s(S,2,"0");case"h":return le(1);case"hh":return le(2);case"a":return he(S,q,!0);case"A":return he(S,q,!1);case"m":return String(q);case"mm":return I.s(q,2,"0");case"s":return String(_.$s);case"ss":return I.s(_.$s,2,"0");case"SSS":return I.s(_.$ms,3,"0");case"Z":return U}return null}(H)||U.replace(":","")})},L.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},L.diff=function(w,_,E){var A,U=this,S=I.p(_),q=B(w),V=(q.utcOffset()-this.utcOffset())*r,$=this-q,G=function(){return I.m(U,q)};switch(S){case v:A=G()/12;break;case m:A=G();break;case h:A=G()/3;break;case c:A=($-V)/6048e5;break;case i:A=($-V)/864e5;break;case l:A=$/a;break;case u:A=$/r;break;case d:A=$/n;break;default:A=$}return E?A:I.a(A)},L.daysInMonth=function(){return this.endOf(m).$D},L.$locale=function(){return k[this.$L]},L.locale=function(w,_){if(!w)return this.$L;var E=this.clone(),A=F(w,_,!0);return A&&(E.$L=A),E},L.clone=function(){return I.w(this.$d,this)},L.toDate=function(){return new Date(this.valueOf())},L.toJSON=function(){return this.isValid()?this.toISOString():null},L.toISOString=function(){return this.$d.toISOString()},L.toString=function(){return this.$d.toUTCString()},P}(),W=T.prototype;return B.prototype=W,[["$ms",o],["$s",d],["$m",u],["$H",l],["$W",i],["$M",m],["$y",v],["$D",x]].forEach(function(P){W[P[1]]=function(L){return this.$g(L,P[0],P[1])}}),B.extend=function(P,L){return P.$i||(P(L,T,B),P.$i=!0),B},B.locale=F,B.isDayjs=se,B.unix=function(P){return B(1e3*P)},B.en=k[D],B.Ls=k,B.p={},B})})(Js);var on=Js.exports;const z=Vs(on);function Ks(t,s){return function(){return t.apply(s,arguments)}}const{toString:ln}=Object.prototype,{getPrototypeOf:Gt}=Object,{iterator:_t,toStringTag:Qs}=Symbol,kt=(t=>s=>{const n=ln.call(s);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Re=t=>(t=t.toLowerCase(),s=>kt(s)===t),St=t=>s=>typeof s===t,{isArray:Qe}=Array,Je=St("undefined");function it(t){return t!==null&&!Je(t)&&t.constructor!==null&&!Je(t.constructor)&&Ce(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Xs=Re("ArrayBuffer");function cn(t){let s;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?s=ArrayBuffer.isView(t):s=t&&t.buffer&&Xs(t.buffer),s}const dn=St("string"),Ce=St("function"),Gs=St("number"),ot=t=>t!==null&&typeof t=="object",mn=t=>t===!0||t===!1,jt=t=>{if(kt(t)!=="object")return!1;const s=Gt(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Qs in t)&&!(_t in t)},un=t=>{if(!ot(t)||it(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch(s){return!1}},xn=Re("Date"),hn=Re("File"),fn=Re("Blob"),pn=Re("FileList"),bn=t=>ot(t)&&Ce(t.pipe),gn=t=>{let s;return t&&(typeof FormData=="function"&&t instanceof FormData||Ce(t.append)&&((s=kt(t))==="formdata"||s==="object"&&Ce(t.toString)&&t.toString()==="[object FormData]"))},jn=Re("URLSearchParams"),[yn,vn,Nn,wn]=["ReadableStream","Request","Response","Headers"].map(Re),Cn=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function lt(t,s,{allOwnKeys:n=!1}={}){if(t===null||typeof t=="undefined")return;let r,a;if(typeof t!="object"&&(t=[t]),Qe(t))for(r=0,a=t.length;r<a;r++)s.call(null,t[r],r,t);else{if(it(t))return;const o=n?Object.getOwnPropertyNames(t):Object.keys(t),d=o.length;let u;for(r=0;r<d;r++)u=o[r],s.call(null,t[u],u,t)}}function Zs(t,s){if(it(t))return null;s=s.toLowerCase();const n=Object.keys(t);let r=n.length,a;for(;r-- >0;)if(a=n[r],s===a.toLowerCase())return a;return null}const Ie=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:global,er=t=>!Je(t)&&t!==Ie;function Vt(){const{caseless:t,skipUndefined:s}=er(this)&&this||{},n={},r=(a,o)=>{const d=t&&Zs(n,o)||o;jt(n[d])&&jt(a)?n[d]=Vt(n[d],a):jt(a)?n[d]=Vt({},a):Qe(a)?n[d]=a.slice():(!s||!Je(a))&&(n[d]=a)};for(let a=0,o=arguments.length;a<o;a++)arguments[a]&&lt(arguments[a],r);return n}const _n=(t,s,n,{allOwnKeys:r}={})=>(lt(s,(a,o)=>{n&&Ce(a)?t[o]=Ks(a,n):t[o]=a},{allOwnKeys:r}),t),kn=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Sn=(t,s,n,r)=>{t.prototype=Object.create(s.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:s.prototype}),n&&Object.assign(t.prototype,n)},Mn=(t,s,n,r)=>{let a,o,d;const u={};if(s=s||{},t==null)return s;do{for(a=Object.getOwnPropertyNames(t),o=a.length;o-- >0;)d=a[o],(!r||r(d,t,s))&&!u[d]&&(s[d]=t[d],u[d]=!0);t=n!==!1&&Gt(t)}while(t&&(!n||n(t,s))&&t!==Object.prototype);return s},En=(t,s,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=s.length;const r=t.indexOf(s,n);return r!==-1&&r===n},Rn=t=>{if(!t)return null;if(Qe(t))return t;let s=t.length;if(!Gs(s))return null;const n=new Array(s);for(;s-- >0;)n[s]=t[s];return n},An=(t=>s=>t&&s instanceof t)(typeof Uint8Array!="undefined"&&Gt(Uint8Array)),Fn=(t,s)=>{const r=(t&&t[_t]).call(t);let a;for(;(a=r.next())&&!a.done;){const o=a.value;s.call(t,o[0],o[1])}},Ln=(t,s)=>{let n;const r=[];for(;(n=t.exec(s))!==null;)r.push(n);return r},On=Re("HTMLFormElement"),Dn=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,a){return r.toUpperCase()+a}),Ss=(({hasOwnProperty:t})=>(s,n)=>t.call(s,n))(Object.prototype),Pn=Re("RegExp"),tr=(t,s)=>{const n=Object.getOwnPropertyDescriptors(t),r={};lt(n,(a,o)=>{let d;(d=s(a,o,t))!==!1&&(r[o]=d||a)}),Object.defineProperties(t,r)},Tn=t=>{tr(t,(s,n)=>{if(Ce(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(Ce(r)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},$n=(t,s)=>{const n={},r=a=>{a.forEach(o=>{n[o]=!0})};return Qe(t)?r(t):r(String(t).split(s)),n},In=()=>{},Bn=(t,s)=>t!=null&&Number.isFinite(t=+t)?t:s;function Un(t){return!!(t&&Ce(t.append)&&t[Qs]==="FormData"&&t[_t])}const zn=t=>{const s=new Array(10),n=(r,a)=>{if(ot(r)){if(s.indexOf(r)>=0)return;if(it(r))return r;if(!("toJSON"in r)){s[a]=r;const o=Qe(r)?[]:{};return lt(r,(d,u)=>{const l=n(d,a+1);!Je(l)&&(o[u]=l)}),s[a]=void 0,o}}return r};return n(t,0)},Hn=Re("AsyncFunction"),Yn=t=>t&&(ot(t)||Ce(t))&&Ce(t.then)&&Ce(t.catch),sr=((t,s)=>t?setImmediate:s?((n,r)=>(Ie.addEventListener("message",({source:a,data:o})=>{a===Ie&&o===n&&r.length&&r.shift()()},!1),a=>{r.push(a),Ie.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Ce(Ie.postMessage)),Wn=typeof queueMicrotask!="undefined"?queueMicrotask.bind(Ie):typeof process!="undefined"&&process.nextTick||sr,qn=t=>t!=null&&Ce(t[_t]),g={isArray:Qe,isArrayBuffer:Xs,isBuffer:it,isFormData:gn,isArrayBufferView:cn,isString:dn,isNumber:Gs,isBoolean:mn,isObject:ot,isPlainObject:jt,isEmptyObject:un,isReadableStream:yn,isRequest:vn,isResponse:Nn,isHeaders:wn,isUndefined:Je,isDate:xn,isFile:hn,isBlob:fn,isRegExp:Pn,isFunction:Ce,isStream:bn,isURLSearchParams:jn,isTypedArray:An,isFileList:pn,forEach:lt,merge:Vt,extend:_n,trim:Cn,stripBOM:kn,inherits:Sn,toFlatObject:Mn,kindOf:kt,kindOfTest:Re,endsWith:En,toArray:Rn,forEachEntry:Fn,matchAll:Ln,isHTMLForm:On,hasOwnProperty:Ss,hasOwnProp:Ss,reduceDescriptors:tr,freezeMethods:Tn,toObjectSet:$n,toCamelCase:Dn,noop:In,toFiniteNumber:Bn,findKey:Zs,global:Ie,isContextDefined:er,isSpecCompliantForm:Un,toJSONObject:zn,isAsyncFn:Hn,isThenable:Yn,setImmediate:sr,asap:Wn,isIterable:qn};function Z(t,s,n,r,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",s&&(this.code=s),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a,this.status=a.status?a.status:null)}g.inherits(Z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:g.toJSONObject(this.config),code:this.code,status:this.status}}});const rr=Z.prototype,nr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{nr[t]={value:t}});Object.defineProperties(Z,nr);Object.defineProperty(rr,"isAxiosError",{value:!0});Z.from=(t,s,n,r,a,o)=>{const d=Object.create(rr);g.toFlatObject(t,d,function(c){return c!==Error.prototype},i=>i!=="isAxiosError");const u=t&&t.message?t.message:"Error",l=s==null&&t?t.code:s;return Z.call(d,u,l,n,r,a),t&&d.cause==null&&Object.defineProperty(d,"cause",{value:t,configurable:!0}),d.name=t&&t.name||"Error",o&&Object.assign(d,o),d};const Vn=null;function Jt(t){return g.isPlainObject(t)||g.isArray(t)}function ar(t){return g.endsWith(t,"[]")?t.slice(0,-2):t}function Ms(t,s,n){return t?t.concat(s).map(function(a,o){return a=ar(a),!n&&o?"["+a+"]":a}).join(n?".":""):s}function Jn(t){return g.isArray(t)&&!t.some(Jt)}const Kn=g.toFlatObject(g,{},null,function(s){return/^is[A-Z]/.test(s)});function Mt(t,s,n){if(!g.isObject(t))throw new TypeError("target must be an object");s=s||new FormData,n=g.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,p){return!g.isUndefined(p[y])});const r=n.metaTokens,a=n.visitor||c,o=n.dots,d=n.indexes,l=(n.Blob||typeof Blob!="undefined"&&Blob)&&g.isSpecCompliantForm(s);if(!g.isFunction(a))throw new TypeError("visitor must be a function");function i(x){if(x===null)return"";if(g.isDate(x))return x.toISOString();if(g.isBoolean(x))return x.toString();if(!l&&g.isBlob(x))throw new Z("Blob is not supported. Use a Buffer instead.");return g.isArrayBuffer(x)||g.isTypedArray(x)?l&&typeof Blob=="function"?new Blob([x]):Buffer.from(x):x}function c(x,y,p){let j=x;if(x&&!p&&typeof x=="object"){if(g.endsWith(y,"{}"))y=r?y:y.slice(0,-2),x=JSON.stringify(x);else if(g.isArray(x)&&Jn(x)||(g.isFileList(x)||g.endsWith(y,"[]"))&&(j=g.toArray(x)))return y=ar(y),j.forEach(function(N,C){!(g.isUndefined(N)||N===null)&&s.append(d===!0?Ms([y],C,o):d===null?y:y+"[]",i(N))}),!1}return Jt(x)?!0:(s.append(Ms(p,y,o),i(x)),!1)}const m=[],h=Object.assign(Kn,{defaultVisitor:c,convertValue:i,isVisitable:Jt});function v(x,y){if(!g.isUndefined(x)){if(m.indexOf(x)!==-1)throw Error("Circular reference detected in "+y.join("."));m.push(x),g.forEach(x,function(j,R){(!(g.isUndefined(j)||j===null)&&a.call(s,j,g.isString(R)?R.trim():R,y,h))===!0&&v(j,y?y.concat(R):[R])}),m.pop()}}if(!g.isObject(t))throw new TypeError("data must be an object");return v(t),s}function Es(t){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return s[r]})}function Zt(t,s){this._pairs=[],t&&Mt(t,this,s)}const ir=Zt.prototype;ir.append=function(s,n){this._pairs.push([s,n])};ir.toString=function(s){const n=s?function(r){return s.call(this,r,Es)}:Es;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Qn(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function or(t,s,n){if(!s)return t;const r=n&&n.encode||Qn;g.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let o;if(a?o=a(s,n):o=g.isURLSearchParams(s)?s.toString():new Zt(s,n).toString(r),o){const d=t.indexOf("#");d!==-1&&(t=t.slice(0,d)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class Rs{constructor(){this.handlers=[]}use(s,n,r){return this.handlers.push({fulfilled:s,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){g.forEach(this.handlers,function(r){r!==null&&s(r)})}}const lr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Xn=typeof URLSearchParams!="undefined"?URLSearchParams:Zt,Gn=typeof FormData!="undefined"?FormData:null,Zn=typeof Blob!="undefined"?Blob:null,ea={isBrowser:!0,classes:{URLSearchParams:Xn,FormData:Gn,Blob:Zn},protocols:["http","https","file","blob","url","data"]},es=typeof window!="undefined"&&typeof document!="undefined",Kt=typeof navigator=="object"&&navigator||void 0,ta=es&&(!Kt||["ReactNative","NativeScript","NS"].indexOf(Kt.product)<0),sa=typeof WorkerGlobalScope!="undefined"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ra=es&&window.location.href||"http://localhost",na=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:es,hasStandardBrowserEnv:ta,hasStandardBrowserWebWorkerEnv:sa,navigator:Kt,origin:ra},Symbol.toStringTag,{value:"Module"})),we=ee(ee({},na),ea);function aa(t,s){return Mt(t,new we.classes.URLSearchParams,ee({visitor:function(n,r,a,o){return we.isNode&&g.isBuffer(n)?(this.append(r,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},s))}function ia(t){return g.matchAll(/\w+|\[(\w*)]/g,t).map(s=>s[0]==="[]"?"":s[1]||s[0])}function oa(t){const s={},n=Object.keys(t);let r;const a=n.length;let o;for(r=0;r<a;r++)o=n[r],s[o]=t[o];return s}function cr(t){function s(n,r,a,o){let d=n[o++];if(d==="__proto__")return!0;const u=Number.isFinite(+d),l=o>=n.length;return d=!d&&g.isArray(a)?a.length:d,l?(g.hasOwnProp(a,d)?a[d]=[a[d],r]:a[d]=r,!u):((!a[d]||!g.isObject(a[d]))&&(a[d]=[]),s(n,r,a[d],o)&&g.isArray(a[d])&&(a[d]=oa(a[d])),!u)}if(g.isFormData(t)&&g.isFunction(t.entries)){const n={};return g.forEachEntry(t,(r,a)=>{s(ia(r),a,n,0)}),n}return null}function la(t,s,n){if(g.isString(t))try{return(s||JSON.parse)(t),g.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const ct={transitional:lr,adapter:["xhr","http","fetch"],transformRequest:[function(s,n){const r=n.getContentType()||"",a=r.indexOf("application/json")>-1,o=g.isObject(s);if(o&&g.isHTMLForm(s)&&(s=new FormData(s)),g.isFormData(s))return a?JSON.stringify(cr(s)):s;if(g.isArrayBuffer(s)||g.isBuffer(s)||g.isStream(s)||g.isFile(s)||g.isBlob(s)||g.isReadableStream(s))return s;if(g.isArrayBufferView(s))return s.buffer;if(g.isURLSearchParams(s))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let u;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return aa(s,this.formSerializer).toString();if((u=g.isFileList(s))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Mt(u?{"files[]":s}:s,l&&new l,this.formSerializer)}}return o||a?(n.setContentType("application/json",!1),la(s)):s}],transformResponse:[function(s){const n=this.transitional||ct.transitional,r=n&&n.forcedJSONParsing,a=this.responseType==="json";if(g.isResponse(s)||g.isReadableStream(s))return s;if(s&&g.isString(s)&&(r&&!this.responseType||a)){const d=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(s,this.parseReviver)}catch(u){if(d)throw u.name==="SyntaxError"?Z.from(u,Z.ERR_BAD_RESPONSE,this,null,this.response):u}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:we.classes.FormData,Blob:we.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};g.forEach(["delete","get","head","post","put","patch"],t=>{ct.headers[t]={}});const ca=g.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),da=t=>{const s={};let n,r,a;return t&&t.split(`
`).forEach(function(d){a=d.indexOf(":"),n=d.substring(0,a).trim().toLowerCase(),r=d.substring(a+1).trim(),!(!n||s[n]&&ca[n])&&(n==="set-cookie"?s[n]?s[n].push(r):s[n]=[r]:s[n]=s[n]?s[n]+", "+r:r)}),s},As=Symbol("internals");function rt(t){return t&&String(t).trim().toLowerCase()}function yt(t){return t===!1||t==null?t:g.isArray(t)?t.map(yt):String(t)}function ma(t){const s=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)s[r[1]]=r[2];return s}const ua=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function zt(t,s,n,r,a){if(g.isFunction(r))return r.call(this,s,n);if(a&&(s=n),!!g.isString(s)){if(g.isString(r))return s.indexOf(r)!==-1;if(g.isRegExp(r))return r.test(s)}}function xa(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,n,r)=>n.toUpperCase()+r)}function ha(t,s){const n=g.toCamelCase(" "+s);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(a,o,d){return this[r].call(this,s,a,o,d)},configurable:!0})})}let _e=class{constructor(s){s&&this.set(s)}set(s,n,r){const a=this;function o(u,l,i){const c=rt(l);if(!c)throw new Error("header name must be a non-empty string");const m=g.findKey(a,c);(!m||a[m]===void 0||i===!0||i===void 0&&a[m]!==!1)&&(a[m||l]=yt(u))}const d=(u,l)=>g.forEach(u,(i,c)=>o(i,c,l));if(g.isPlainObject(s)||s instanceof this.constructor)d(s,n);else if(g.isString(s)&&(s=s.trim())&&!ua(s))d(da(s),n);else if(g.isObject(s)&&g.isIterable(s)){let u={},l,i;for(const c of s){if(!g.isArray(c))throw TypeError("Object iterator must return a key-value pair");u[i=c[0]]=(l=u[i])?g.isArray(l)?[...l,c[1]]:[l,c[1]]:c[1]}d(u,n)}else s!=null&&o(n,s,r);return this}get(s,n){if(s=rt(s),s){const r=g.findKey(this,s);if(r){const a=this[r];if(!n)return a;if(n===!0)return ma(a);if(g.isFunction(n))return n.call(this,a,r);if(g.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,n){if(s=rt(s),s){const r=g.findKey(this,s);return!!(r&&this[r]!==void 0&&(!n||zt(this,this[r],r,n)))}return!1}delete(s,n){const r=this;let a=!1;function o(d){if(d=rt(d),d){const u=g.findKey(r,d);u&&(!n||zt(r,r[u],u,n))&&(delete r[u],a=!0)}}return g.isArray(s)?s.forEach(o):o(s),a}clear(s){const n=Object.keys(this);let r=n.length,a=!1;for(;r--;){const o=n[r];(!s||zt(this,this[o],o,s,!0))&&(delete this[o],a=!0)}return a}normalize(s){const n=this,r={};return g.forEach(this,(a,o)=>{const d=g.findKey(r,o);if(d){n[d]=yt(a),delete n[o];return}const u=s?xa(o):String(o).trim();u!==o&&delete n[o],n[u]=yt(a),r[u]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const n=Object.create(null);return g.forEach(this,(r,a)=>{r!=null&&r!==!1&&(n[a]=s&&g.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,n])=>s+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...n){const r=new this(s);return n.forEach(a=>r.set(a)),r}static accessor(s){const r=(this[As]=this[As]={accessors:{}}).accessors,a=this.prototype;function o(d){const u=rt(d);r[u]||(ha(a,d),r[u]=!0)}return g.isArray(s)?s.forEach(o):o(s),this}};_e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);g.reduceDescriptors(_e.prototype,({value:t},s)=>{let n=s[0].toUpperCase()+s.slice(1);return{get:()=>t,set(r){this[n]=r}}});g.freezeMethods(_e);function Ht(t,s){const n=this||ct,r=s||n,a=_e.from(r.headers);let o=r.data;return g.forEach(t,function(u){o=u.call(n,o,a.normalize(),s?s.status:void 0)}),a.normalize(),o}function dr(t){return!!(t&&t.__CANCEL__)}function Xe(t,s,n){Z.call(this,t==null?"canceled":t,Z.ERR_CANCELED,s,n),this.name="CanceledError"}g.inherits(Xe,Z,{__CANCEL__:!0});function mr(t,s,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):s(new Z("Request failed with status code "+n.status,[Z.ERR_BAD_REQUEST,Z.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function fa(t){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return s&&s[1]||""}function pa(t,s){t=t||10;const n=new Array(t),r=new Array(t);let a=0,o=0,d;return s=s!==void 0?s:1e3,function(l){const i=Date.now(),c=r[o];d||(d=i),n[a]=l,r[a]=i;let m=o,h=0;for(;m!==a;)h+=n[m++],m=m%t;if(a=(a+1)%t,a===o&&(o=(o+1)%t),i-d<s)return;const v=c&&i-c;return v?Math.round(h*1e3/v):void 0}}function ba(t,s){let n=0,r=1e3/s,a,o;const d=(i,c=Date.now())=>{n=c,a=null,o&&(clearTimeout(o),o=null),t(...i)};return[(...i)=>{const c=Date.now(),m=c-n;m>=r?d(i,c):(a=i,o||(o=setTimeout(()=>{o=null,d(a)},r-m)))},()=>a&&d(a)]}const Nt=(t,s,n=3)=>{let r=0;const a=pa(50,250);return ba(o=>{const d=o.loaded,u=o.lengthComputable?o.total:void 0,l=d-r,i=a(l),c=d<=u;r=d;const m={loaded:d,total:u,progress:u?d/u:void 0,bytes:l,rate:i||void 0,estimated:i&&u&&c?(u-d)/i:void 0,event:o,lengthComputable:u!=null,[s?"download":"upload"]:!0};t(m)},n)},Fs=(t,s)=>{const n=t!=null;return[r=>s[0]({lengthComputable:n,total:t,loaded:r}),s[1]]},Ls=t=>(...s)=>g.asap(()=>t(...s)),ga=we.hasStandardBrowserEnv?((t,s)=>n=>(n=new URL(n,we.origin),t.protocol===n.protocol&&t.host===n.host&&(s||t.port===n.port)))(new URL(we.origin),we.navigator&&/(msie|trident)/i.test(we.navigator.userAgent)):()=>!0,ja=we.hasStandardBrowserEnv?{write(t,s,n,r,a,o,d){if(typeof document=="undefined")return;const u=[`${t}=${encodeURIComponent(s)}`];g.isNumber(n)&&u.push(`expires=${new Date(n).toUTCString()}`),g.isString(r)&&u.push(`path=${r}`),g.isString(a)&&u.push(`domain=${a}`),o===!0&&u.push("secure"),g.isString(d)&&u.push(`SameSite=${d}`),document.cookie=u.join("; ")},read(t){if(typeof document=="undefined")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function ya(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function va(t,s){return s?t.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):t}function ur(t,s,n){let r=!ya(s);return t&&(r||n==!1)?va(t,s):s}const Os=t=>t instanceof _e?ee({},t):t;function Ue(t,s){s=s||{};const n={};function r(i,c,m,h){return g.isPlainObject(i)&&g.isPlainObject(c)?g.merge.call({caseless:h},i,c):g.isPlainObject(c)?g.merge({},c):g.isArray(c)?c.slice():c}function a(i,c,m,h){if(g.isUndefined(c)){if(!g.isUndefined(i))return r(void 0,i,m,h)}else return r(i,c,m,h)}function o(i,c){if(!g.isUndefined(c))return r(void 0,c)}function d(i,c){if(g.isUndefined(c)){if(!g.isUndefined(i))return r(void 0,i)}else return r(void 0,c)}function u(i,c,m){if(m in s)return r(i,c);if(m in t)return r(void 0,i)}const l={url:o,method:o,data:o,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:u,headers:(i,c,m)=>a(Os(i),Os(c),m,!0)};return g.forEach(Object.keys(ee(ee({},t),s)),function(c){const m=l[c]||a,h=m(t[c],s[c],c);g.isUndefined(h)&&m!==u||(n[c]=h)}),n}const xr=t=>{const s=Ue({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:a,xsrfCookieName:o,headers:d,auth:u}=s;if(s.headers=d=_e.from(d),s.url=or(ur(s.baseURL,s.url,s.allowAbsoluteUrls),t.params,t.paramsSerializer),u&&d.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),g.isFormData(n)){if(we.hasStandardBrowserEnv||we.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if(g.isFunction(n.getHeaders)){const l=n.getHeaders(),i=["content-type","content-length"];Object.entries(l).forEach(([c,m])=>{i.includes(c.toLowerCase())&&d.set(c,m)})}}if(we.hasStandardBrowserEnv&&(r&&g.isFunction(r)&&(r=r(s)),r||r!==!1&&ga(s.url))){const l=a&&o&&ja.read(o);l&&d.set(a,l)}return s},Na=typeof XMLHttpRequest!="undefined",wa=Na&&function(t){return new Promise(function(n,r){const a=xr(t);let o=a.data;const d=_e.from(a.headers).normalize();let{responseType:u,onUploadProgress:l,onDownloadProgress:i}=a,c,m,h,v,x;function y(){v&&v(),x&&x(),a.cancelToken&&a.cancelToken.unsubscribe(c),a.signal&&a.signal.removeEventListener("abort",c)}let p=new XMLHttpRequest;p.open(a.method.toUpperCase(),a.url,!0),p.timeout=a.timeout;function j(){if(!p)return;const N=_e.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),D={data:!u||u==="text"||u==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:N,config:t,request:p};mr(function(Y){n(Y),y()},function(Y){r(Y),y()},D),p=null}"onloadend"in p?p.onloadend=j:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(j)},p.onabort=function(){p&&(r(new Z("Request aborted",Z.ECONNABORTED,t,p)),p=null)},p.onerror=function(C){const D=C&&C.message?C.message:"Network Error",k=new Z(D,Z.ERR_NETWORK,t,p);k.event=C||null,r(k),p=null},p.ontimeout=function(){let C=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const D=a.transitional||lr;a.timeoutErrorMessage&&(C=a.timeoutErrorMessage),r(new Z(C,D.clarifyTimeoutError?Z.ETIMEDOUT:Z.ECONNABORTED,t,p)),p=null},o===void 0&&d.setContentType(null),"setRequestHeader"in p&&g.forEach(d.toJSON(),function(C,D){p.setRequestHeader(D,C)}),g.isUndefined(a.withCredentials)||(p.withCredentials=!!a.withCredentials),u&&u!=="json"&&(p.responseType=a.responseType),i&&([h,x]=Nt(i,!0),p.addEventListener("progress",h)),l&&p.upload&&([m,v]=Nt(l),p.upload.addEventListener("progress",m),p.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(c=N=>{p&&(r(!N||N.type?new Xe(null,t,p):N),p.abort(),p=null)},a.cancelToken&&a.cancelToken.subscribe(c),a.signal&&(a.signal.aborted?c():a.signal.addEventListener("abort",c)));const R=fa(a.url);if(R&&we.protocols.indexOf(R)===-1){r(new Z("Unsupported protocol "+R+":",Z.ERR_BAD_REQUEST,t));return}p.send(o||null)})},Ca=(t,s)=>{const{length:n}=t=t?t.filter(Boolean):[];if(s||n){let r=new AbortController,a;const o=function(i){if(!a){a=!0,u();const c=i instanceof Error?i:this.reason;r.abort(c instanceof Z?c:new Xe(c instanceof Error?c.message:c))}};let d=s&&setTimeout(()=>{d=null,o(new Z(`timeout ${s} of ms exceeded`,Z.ETIMEDOUT))},s);const u=()=>{t&&(d&&clearTimeout(d),d=null,t.forEach(i=>{i.unsubscribe?i.unsubscribe(o):i.removeEventListener("abort",o)}),t=null)};t.forEach(i=>i.addEventListener("abort",o));const{signal:l}=r;return l.unsubscribe=()=>g.asap(u),l}},_a=function*(t,s){let n=t.byteLength;if(n<s){yield t;return}let r=0,a;for(;r<n;)a=r+s,yield t.slice(r,a),r=a},ka=function(t,s){return Bt(this,null,function*(){try{for(var n=_s(Sa(t)),r,a,o;r=!(a=yield new De(n.next())).done;r=!1){const d=a.value;yield*Ut(_a(d,s))}}catch(a){o=[a]}finally{try{r&&(a=n.return)&&(yield new De(a.call(n)))}finally{if(o)throw o[0]}}})},Sa=function(t){return Bt(this,null,function*(){if(t[Symbol.asyncIterator]){yield*Ut(t);return}const s=t.getReader();try{for(;;){const{done:n,value:r}=yield new De(s.read());if(n)break;yield r}}finally{yield new De(s.cancel())}})},Ds=(t,s,n,r)=>{const a=ka(t,s);let o=0,d,u=i=>{d||(d=!0,r&&r(i))};return new ReadableStream({pull(i){return Q(this,null,function*(){try{const{done:c,value:m}=yield a.next();if(c){u(),i.close();return}let h=m.byteLength;if(n){let v=o+=h;n(v)}i.enqueue(new Uint8Array(m))}catch(c){throw u(c),c}})},cancel(i){return u(i),a.return()}},{highWaterMark:2})},Ps=64*1024,{isFunction:gt}=g,Ma=(({Request:t,Response:s})=>({Request:t,Response:s}))(g.global),{ReadableStream:Ts,TextEncoder:$s}=g.global,Is=(t,...s)=>{try{return!!t(...s)}catch(n){return!1}},Ea=t=>{t=g.merge.call({skipUndefined:!0},Ma,t);const{fetch:s,Request:n,Response:r}=t,a=s?gt(s):typeof fetch=="function",o=gt(n),d=gt(r);if(!a)return!1;const u=a&&gt(Ts),l=a&&(typeof $s=="function"?(x=>y=>x.encode(y))(new $s):x=>Q(Le,null,function*(){return new Uint8Array(yield new n(x).arrayBuffer())})),i=o&&u&&Is(()=>{let x=!1;const y=new n(we.origin,{body:new Ts,method:"POST",get duplex(){return x=!0,"half"}}).headers.has("Content-Type");return x&&!y}),c=d&&u&&Is(()=>g.isReadableStream(new r("").body)),m={stream:c&&(x=>x.body)};a&&["text","arrayBuffer","blob","formData","stream"].forEach(x=>{!m[x]&&(m[x]=(y,p)=>{let j=y&&y[x];if(j)return j.call(y);throw new Z(`Response type '${x}' is not supported`,Z.ERR_NOT_SUPPORT,p)})});const h=x=>Q(Le,null,function*(){if(x==null)return 0;if(g.isBlob(x))return x.size;if(g.isSpecCompliantForm(x))return(yield new n(we.origin,{method:"POST",body:x}).arrayBuffer()).byteLength;if(g.isArrayBufferView(x)||g.isArrayBuffer(x))return x.byteLength;if(g.isURLSearchParams(x)&&(x=x+""),g.isString(x))return(yield l(x)).byteLength}),v=(x,y)=>Q(Le,null,function*(){const p=g.toFiniteNumber(x.getContentLength());return p==null?h(y):p});return x=>Q(Le,null,function*(){let{url:y,method:p,data:j,signal:R,cancelToken:N,timeout:C,onDownloadProgress:D,onUploadProgress:k,responseType:Y,headers:se,withCredentials:F="same-origin",fetchOptions:B}=xr(x),I=s||fetch;Y=Y?(Y+"").toLowerCase():"text";let T=Ca([R,N&&N.toAbortSignal()],C),W=null;const P=T&&T.unsubscribe&&(()=>{T.unsubscribe()});let L;try{if(k&&i&&p!=="get"&&p!=="head"&&(L=yield v(se,j))!==0){let S=new n(y,{method:"POST",body:j,duplex:"half"}),q;if(g.isFormData(j)&&(q=S.headers.get("content-type"))&&se.setContentType(q),S.body){const[V,$]=Fs(L,Nt(Ls(k)));j=Ds(S.body,Ps,V,$)}}g.isString(F)||(F=F?"include":"omit");const w=o&&"credentials"in n.prototype,_=oe(ee({},B),{signal:T,method:p.toUpperCase(),headers:se.normalize().toJSON(),body:j,duplex:"half",credentials:w?F:void 0});W=o&&new n(y,_);let E=yield o?I(W,B):I(y,_);const A=c&&(Y==="stream"||Y==="response");if(c&&(D||A&&P)){const S={};["status","statusText","headers"].forEach(G=>{S[G]=E[G]});const q=g.toFiniteNumber(E.headers.get("content-length")),[V,$]=D&&Fs(q,Nt(Ls(D),!0))||[];E=new r(Ds(E.body,Ps,V,()=>{$&&$(),P&&P()}),S)}Y=Y||"text";let U=yield m[g.findKey(m,Y)||"text"](E,x);return!A&&P&&P(),yield new Promise((S,q)=>{mr(S,q,{data:U,headers:_e.from(E.headers),status:E.status,statusText:E.statusText,config:x,request:W})})}catch(w){throw P&&P(),w&&w.name==="TypeError"&&/Load failed|fetch/i.test(w.message)?Object.assign(new Z("Network Error",Z.ERR_NETWORK,x,W),{cause:w.cause||w}):Z.from(w,w&&w.code,x,W)}})},Ra=new Map,hr=t=>{let s=t&&t.env||{};const{fetch:n,Request:r,Response:a}=s,o=[r,a,n];let d=o.length,u=d,l,i,c=Ra;for(;u--;)l=o[u],i=c.get(l),i===void 0&&c.set(l,i=u?new Map:Ea(s)),c=i;return i};hr();const ts={http:Vn,xhr:wa,fetch:{get:hr}};g.forEach(ts,(t,s)=>{if(t){try{Object.defineProperty(t,"name",{value:s})}catch(n){}Object.defineProperty(t,"adapterName",{value:s})}});const Bs=t=>`- ${t}`,Aa=t=>g.isFunction(t)||t===null||t===!1;function Fa(t,s){t=g.isArray(t)?t:[t];const{length:n}=t;let r,a;const o={};for(let d=0;d<n;d++){r=t[d];let u;if(a=r,!Aa(r)&&(a=ts[(u=String(r)).toLowerCase()],a===void 0))throw new Z(`Unknown adapter '${u}'`);if(a&&(g.isFunction(a)||(a=a.get(s))))break;o[u||"#"+d]=a}if(!a){const d=Object.entries(o).map(([l,i])=>`adapter ${l} `+(i===!1?"is not supported by the environment":"is not available in the build"));let u=n?d.length>1?`since :
`+d.map(Bs).join(`
`):" "+Bs(d[0]):"as no adapter specified";throw new Z("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return a}const fr={getAdapter:Fa,adapters:ts};function Yt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Xe(null,t)}function Us(t){return Yt(t),t.headers=_e.from(t.headers),t.data=Ht.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),fr.getAdapter(t.adapter||ct.adapter,t)(t).then(function(r){return Yt(t),r.data=Ht.call(t,t.transformResponse,r),r.headers=_e.from(r.headers),r},function(r){return dr(r)||(Yt(t),r&&r.response&&(r.response.data=Ht.call(t,t.transformResponse,r.response),r.response.headers=_e.from(r.response.headers))),Promise.reject(r)})}const pr="1.13.2",Et={};["object","boolean","number","function","string","symbol"].forEach((t,s)=>{Et[t]=function(r){return typeof r===t||"a"+(s<1?"n ":" ")+t}});const zs={};Et.transitional=function(s,n,r){function a(o,d){return"[Axios v"+pr+"] Transitional option '"+o+"'"+d+(r?". "+r:"")}return(o,d,u)=>{if(s===!1)throw new Z(a(d," has been removed"+(n?" in "+n:"")),Z.ERR_DEPRECATED);return n&&!zs[d]&&(zs[d]=!0,console.warn(a(d," has been deprecated since v"+n+" and will be removed in the near future"))),s?s(o,d,u):!0}};Et.spelling=function(s){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${s}`),!0)};function La(t,s,n){if(typeof t!="object")throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let a=r.length;for(;a-- >0;){const o=r[a],d=s[o];if(d){const u=t[o],l=u===void 0||d(u,o,t);if(l!==!0)throw new Z("option "+o+" must be "+l,Z.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Z("Unknown option "+o,Z.ERR_BAD_OPTION)}}const vt={assertOptions:La,validators:Et},Ae=vt.validators;let Be=class{constructor(s){this.defaults=s||{},this.interceptors={request:new Rs,response:new Rs}}request(s,n){return Q(this,null,function*(){try{return yield this._request(s,n)}catch(r){if(r instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const o=a.stack?a.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch(d){}}throw r}})}_request(s,n){typeof s=="string"?(n=n||{},n.url=s):n=s||{},n=Ue(this.defaults,n);const{transitional:r,paramsSerializer:a,headers:o}=n;r!==void 0&&vt.assertOptions(r,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1),a!=null&&(g.isFunction(a)?n.paramsSerializer={serialize:a}:vt.assertOptions(a,{encode:Ae.function,serialize:Ae.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),vt.assertOptions(n,{baseUrl:Ae.spelling("baseURL"),withXsrfToken:Ae.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let d=o&&g.merge(o.common,o[n.method]);o&&g.forEach(["delete","get","head","post","put","patch","common"],x=>{delete o[x]}),n.headers=_e.concat(d,o);const u=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(n)===!1||(l=l&&y.synchronous,u.unshift(y.fulfilled,y.rejected))});const i=[];this.interceptors.response.forEach(function(y){i.push(y.fulfilled,y.rejected)});let c,m=0,h;if(!l){const x=[Us.bind(this),void 0];for(x.unshift(...u),x.push(...i),h=x.length,c=Promise.resolve(n);m<h;)c=c.then(x[m++],x[m++]);return c}h=u.length;let v=n;for(;m<h;){const x=u[m++],y=u[m++];try{v=x(v)}catch(p){y.call(this,p);break}}try{c=Us.call(this,v)}catch(x){return Promise.reject(x)}for(m=0,h=i.length;m<h;)c=c.then(i[m++],i[m++]);return c}getUri(s){s=Ue(this.defaults,s);const n=ur(s.baseURL,s.url,s.allowAbsoluteUrls);return or(n,s.params,s.paramsSerializer)}};g.forEach(["delete","get","head","options"],function(s){Be.prototype[s]=function(n,r){return this.request(Ue(r||{},{method:s,url:n,data:(r||{}).data}))}});g.forEach(["post","put","patch"],function(s){function n(r){return function(o,d,u){return this.request(Ue(u||{},{method:s,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:d}))}}Be.prototype[s]=n(),Be.prototype[s+"Form"]=n(!0)});let Oa=class br{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const r=this;this.promise.then(a=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](a);r._listeners=null}),this.promise.then=a=>{let o;const d=new Promise(u=>{r.subscribe(u),o=u}).then(a);return d.cancel=function(){r.unsubscribe(o)},d},s(function(o,d,u){r.reason||(r.reason=new Xe(o,d,u),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const n=this._listeners.indexOf(s);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const s=new AbortController,n=r=>{s.abort(r)};return this.subscribe(n),s.signal.unsubscribe=()=>this.unsubscribe(n),s.signal}static source(){let s;return{token:new br(function(a){s=a}),cancel:s}}};function Da(t){return function(n){return t.apply(null,n)}}function Pa(t){return g.isObject(t)&&t.isAxiosError===!0}const Qt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Qt).forEach(([t,s])=>{Qt[s]=t});function gr(t){const s=new Be(t),n=Ks(Be.prototype.request,s);return g.extend(n,Be.prototype,s,{allOwnKeys:!0}),g.extend(n,s,null,{allOwnKeys:!0}),n.create=function(a){return gr(Ue(t,a))},n}const je=gr(ct);je.Axios=Be;je.CanceledError=Xe;je.CancelToken=Oa;je.isCancel=dr;je.VERSION=pr;je.toFormData=Mt;je.AxiosError=Z;je.Cancel=je.CanceledError;je.all=function(s){return Promise.all(s)};je.spread=Da;je.isAxiosError=Pa;je.mergeConfig=Ue;je.AxiosHeaders=_e;je.formToJSON=t=>cr(g.isHTMLForm(t)?new FormData(t):t);je.getAdapter=fr.getAdapter;je.HttpStatusCode=Qt;je.default=je;const{Axios:ji,AxiosError:yi,CanceledError:vi,isCancel:Ni,CancelToken:wi,VERSION:Ci,all:_i,Cancel:ki,isAxiosError:Si,spread:Mi,toFormData:Ei,AxiosHeaders:Ri,HttpStatusCode:Ai,formToJSON:Fi,getAdapter:Li,mergeConfig:Oi}=je,Ta="/api",$a=Ta,J=je.create({baseURL:$a});J.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&(t.headers=oe(ee({},t.headers),{Authorization:`Bearer ${s}`})),t});J.interceptors.response.use(t=>t,t=>{var n;return((n=t==null?void 0:t.response)==null?void 0:n.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("name"),localStorage.removeItem("userId"),typeof window!="undefined"&&window.location.pathname!=="/"&&window.location.assign("/")),Promise.reject(t)});const jr=f.createContext(void 0),Ia=({children:t})=>{const[s,n]=f.useState({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!1});f.useEffect(()=>{Q(Le,null,function*(){const u=localStorage.getItem("token"),l=localStorage.getItem("role"),i=localStorage.getItem("name"),c=localStorage.getItem("userId");if(u)try{const m=yield J.get("/auth/me",{headers:{Authorization:`Bearer ${u}`}}),h=m.data.role;localStorage.setItem("role",h),localStorage.setItem("name",m.data.full_name),localStorage.setItem("userId",m.data.id),n({token:u,role:h,name:m.data.full_name,userId:m.data.id,user:m.data,mustChangePassword:!!m.data.must_change_password,ready:!0});return}catch(m){localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0});return}(l||i||c)&&localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0})})},[]);const r=()=>Q(Le,null,function*(){const d=localStorage.getItem("token");if(!d)return;const u=yield J.get("/auth/me",{headers:{Authorization:`Bearer ${d}`}}),l=u.data.role;localStorage.setItem("role",l),localStorage.setItem("name",u.data.full_name),localStorage.setItem("userId",u.data.id),n({token:d,role:l,name:u.data.full_name,userId:u.data.id,mustChangePassword:!!u.data.must_change_password,ready:!0})}),a=(d,u,l,i)=>Q(Le,null,function*(){const c=yield J.post("/auth/token",{email:d,password:u,mfa_code:l,recovery_code:i}),m=c.data.access_token;localStorage.setItem("token",m);const h=yield J.get("/auth/me",{headers:{Authorization:`Bearer ${m}`}}),v=h.data.role;return localStorage.setItem("role",v),localStorage.setItem("name",h.data.full_name),localStorage.setItem("userId",h.data.id),n({token:m,role:v,name:h.data.full_name,userId:h.data.id,user:h.data,mustChangePassword:!!h.data.must_change_password,ready:!0}),c.data}),o=()=>{localStorage.clear(),n({token:null,role:null,name:null,userId:null,user:null,mustChangePassword:!1,ready:!0})};return e.jsx(jr.Provider,{value:oe(ee({},s),{login:a,logout:o,refreshMe:r}),children:t})},He=()=>{const t=f.useContext(jr);if(!t)throw new Error("useAuth must be used within AuthProvider");return t};function Pe({to:t,icon:s,label:n,badge:r}){const o=Xt().pathname===t;return e.jsxs(tn,{to:t,className:`flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium transition ${o?"bg-app text-text-primary":"text-text-secondary hover:bg-app hover:text-text-primary"}`,children:[e.jsx("span",{className:"h-5 w-5",children:s}),e.jsx("span",{className:"flex-1",children:n}),r!==void 0&&r>0&&e.jsx("span",{className:"ml-auto inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-app px-1 text-[11px] font-semibold text-text-secondary border border-border",children:r})]})}function Ba(){var n,r,a;const{user:t,logout:s}=He();return e.jsxs("div",{className:"fixed inset-y-0 left-0 w-64 bg-surface border-r border-border px-6 py-6 flex flex-col gap-6 overflow-y-auto scrollbar-thin",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-brand flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"C"})}),e.jsx("span",{className:"text-lg font-semibold text-text-primary",children:"Compass"})]}),e.jsxs("nav",{className:"flex flex-col gap-1",children:[e.jsx(Pe,{to:"/",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),label:"Dashboard"}),e.jsx(Pe,{to:"/tasks",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),label:"My Tasks"}),e.jsx(Pe,{to:"/complaints",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),label:"Complaints"}),e.jsx(Pe,{to:"/create",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),label:"New Complaint"}),(t==null?void 0:t.role)!=="read_only"&&e.jsx(Pe,{to:"/reference",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),label:"Reference Data"}),((t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="complaints_manager")&&e.jsx(Pe,{to:"/users",icon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),label:"Users"}),e.jsx(Pe,{to:"/settings",icon:e.jsxs("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),label:"Settings"})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3 px-2",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-brand flex items-center justify-center text-white font-bold text-sm flex-shrink-0",children:((r=(n=t==null?void 0:t.full_name)==null?void 0:n.charAt(0))==null?void 0:r.toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:(t==null?void 0:t.full_name)||"User"}),e.jsx("div",{className:"text-xs text-text-secondary truncate capitalize",children:((a=t==null?void 0:t.role)==null?void 0:a.replace(/_/g," "))||"User"})]})]}),e.jsxs("button",{onClick:s,className:"flex w-full items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-text-secondary hover:bg-app hover:text-text-primary transition",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Sign out"})]})]})]})}function Ua({children:t}){return e.jsxs("div",{className:"min-h-screen bg-app text-text-primary",children:[e.jsx(Ba,{}),e.jsx("div",{className:"ml-64 min-h-screen flex flex-col",children:t})]})}function O(o){var d=o,{variant:t="primary",size:s="md",className:n="",children:r}=d,a=It(d,["variant","size","className","children"]);const u="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand focus-visible:ring-offset-2 focus-visible:ring-offset-app disabled:opacity-40 disabled:pointer-events-none",l={sm:"h-8 px-3 text-xs",md:"h-10 px-4 text-sm"},i={primary:"bg-brand text-white hover:opacity-90 active:translate-y-px",secondary:"bg-surface text-text-primary border border-border hover:bg-app active:translate-y-px",ghost:"bg-transparent text-text-primary hover:bg-app active:translate-y-px",icon:"h-10 w-10 p-0 rounded-full hover:bg-app active:translate-y-px"};return e.jsx("button",oe(ee({className:`${u} ${l[s]} ${i[t]} ${n}`},a),{children:r}))}function ne(a){var o=a,{error:t,leadingIcon:s,className:n=""}=o,r=It(o,["error","leadingIcon","className"]);const d="w-full h-10 rounded-lg border bg-surface px-3 text-sm text-text-primary placeholder:text-text-muted outline-none transition",u=t?"border-semantic-error focus:border-semantic-error focus:ring-2 focus:ring-semantic-error/15":"border-border focus:border-brand focus:ring-2 focus:ring-brand/15",l=s?"pl-10":"px-3";return e.jsxs("div",{className:"relative",children:[s&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-text-muted",children:s}),e.jsx("input",ee({className:`${d} ${u} ${l} ${n}`},r))]})}function ie({children:t,className:s="",onClick:n,selected:r,inverse:a}){const o="rounded-card border shadow-card p-4",d=a?"bg-brand text-white border-transparent":"bg-surface text-text-primary border-border",u=r?"ring-2 ring-brand/15":"",l=n?"cursor-pointer hover:shadow-sm active:translate-y-px transition":"";return e.jsx("div",{className:`${o} ${d} ${u} ${l} ${s}`,onClick:n,children:t})}function de({children:t,className:s=""}){return e.jsx("div",{className:`flex items-start justify-between gap-3 ${s}`,children:t})}function me({children:t,className:s="",inverse:n}){const r=n?"text-white":"text-text-primary";return e.jsx("h3",{className:`text-sm font-semibold ${r} ${s}`,children:t})}function ce({children:t,className:s="",inverse:n}){const r=n?"text-white/80":"text-text-secondary";return e.jsx("div",{className:`mt-2 text-xs leading-relaxed ${r} ${s}`,children:t})}function fe({open:t,onClose:s,children:n}){return f.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/40 z-40",onClick:s}),e.jsx("div",{className:"fixed left-1/2 top-1/2 w-[min(560px,calc(100%-2rem))] -translate-x-1/2 -translate-y-1/2 rounded-modal border border-border bg-surface p-6 shadow-xl z-50",children:n})]}):null}function pe({children:t,onClose:s}){return e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:t}),s&&e.jsx("button",{onClick:s,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-text-muted hover:bg-app hover:text-text-primary transition",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}function be({children:t}){return e.jsx("div",{className:"text-sm text-text-secondary",children:t})}function ge({children:t}){return e.jsx("div",{className:"mt-6 flex justify-end gap-3",children:t})}function yr({children:t,className:s=""}){return e.jsx("div",{className:`overflow-hidden rounded-card border border-border bg-surface ${s}`,children:e.jsx("table",{className:"w-full table-auto",children:t})})}function za({children:t}){return e.jsx("thead",{className:"bg-app",children:t})}function Ha({children:t}){return e.jsx("tbody",{children:t})}function Hs({children:t,onClick:s,className:n=""}){const r=s?"cursor-pointer hover:bg-app/60":"hover:bg-app/60";return e.jsx("tr",{className:`border-t border-border ${r} ${n}`,onClick:s,children:t})}function Te({children:t,className:s=""}){return e.jsx("th",{className:`h-10 px-4 text-left text-xs font-semibold text-text-secondary ${s}`,children:t})}function $e({children:t,className:s=""}){return e.jsx("td",{className:`h-12 px-4 text-sm text-text-primary ${s}`,children:t})}function Wt({value:t,onChange:s,options:n,placeholder:r,className:a=""}){const[o,d]=f.useState(!1),[u,l]=f.useState(t),[i,c]=f.useState(0),m=f.useRef(null),h=f.useRef(null);f.useEffect(()=>{l(t)},[t]);const v=n.filter(R=>R.toLowerCase().includes(u.toLowerCase()));f.useEffect(()=>{const R=N=>{h.current&&!h.current.contains(N.target)&&m.current&&!m.current.contains(N.target)&&(d(!1),s(u))};return document.addEventListener("mousedown",R),()=>document.removeEventListener("mousedown",R)},[u,s]);const x=R=>{const N=R.target.value;l(N),d(!0),c(0)},y=R=>{var N;l(R),s(R),d(!1),(N=m.current)==null||N.blur()},p=R=>{var N;if(!o&&(R.key==="ArrowDown"||R.key==="ArrowUp")){d(!0);return}if(o)switch(R.key){case"ArrowDown":R.preventDefault(),c(C=>C<v.length-1?C+1:C);break;case"ArrowUp":R.preventDefault(),c(C=>C>0?C-1:0);break;case"Enter":R.preventDefault(),v[i]&&y(v[i]);break;case"Escape":R.preventDefault(),d(!1),(N=m.current)==null||N.blur();break}},j=()=>{setTimeout(()=>{var R;(R=h.current)!=null&&R.contains(document.activeElement)||(d(!1),s(u))},200)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:m,type:"text",value:u,onChange:x,onFocus:()=>d(!0),onBlur:j,onKeyDown:p,placeholder:r,className:`w-full h-10 rounded-lg border border-border bg-surface pl-3 pr-10 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${a}`}),e.jsx("button",{type:"button",onClick:()=>{var R;d(!o),(R=m.current)==null||R.focus()},className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:e.jsx("svg",{className:`h-4 w-4 transition-transform ${o?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]}),o&&v.length>0&&e.jsx("div",{ref:h,className:"absolute z-50 mt-1 w-full rounded-lg border border-border bg-surface shadow-lg max-h-60 overflow-auto scrollbar-thin",children:v.map((R,N)=>e.jsx("button",{type:"button",onClick:()=>y(R),onMouseEnter:()=>c(N),className:`w-full text-left px-3 py-2 text-sm transition ${N===i?"bg-app text-text-primary":"text-text-secondary hover:bg-app hover:text-text-primary"}`,children:R},R))}),o&&u&&v.length===0&&e.jsx("div",{ref:h,className:"absolute z-50 mt-1 w-full rounded-lg border border-border bg-surface shadow-lg p-3",children:e.jsxs("p",{className:"text-sm text-text-secondary",children:['No matches found. Type to create "',u,'"']})})]})}function Se({title:t,actions:s}){return e.jsxs("div",{className:"h-16 px-10 flex items-center justify-between gap-6 bg-app border-b border-border",children:[t?e.jsx("h1",{className:"text-2xl font-semibold text-text-primary",children:t}):e.jsx("div",{className:"w-full max-w-md",children:e.jsx(ne,{type:"search",placeholder:"Search complaints...",leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),e.jsx("div",{className:"flex items-center gap-3",children:s})]})}function Ya(){const t=Ke(),{userId:s,token:n}=He(),[r,a]=f.useState(null),[o,d]=f.useState([]),[u,l]=f.useState("mine"),[i,c]=f.useState(!1),[m,h]=f.useState(!0),[v,x]=f.useState(null),y=()=>Q(this,null,function*(){var j;if(n){h(!0),x(null);try{const R=yield J.get("/complaints/metrics",{params:{_:Date.now()}});a(R.data)}catch(R){if(((j=R==null?void 0:R.response)==null?void 0:j.status)===401)return;console.error("Failed to load dashboard metrics",R),x("Failed to load metrics. Please try again.")}finally{h(!1)}}});f.useEffect(()=>{y()},[n]),f.useEffect(()=>{if(!s||!n)return;Q(this,null,function*(){var R;c(!0);try{let N=[];u==="mine"?N=((yield J.get("/complaints",{params:{handler_id:s,page:1,page_size:50,_:Date.now()}})).data||[]).filter(D=>D.status!=="Closed"):u==="unassigned"?N=((yield J.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(D=>D.status!=="Closed").filter(D=>!D.assigned_handler_id):u==="breached"?N=((yield J.get("/complaints",{params:{overdue:!0,page:1,page_size:100,_:Date.now()}})).data||[]).filter(D=>D.status!=="Closed"):u==="oldest"&&(N=((yield J.get("/complaints",{params:{page:1,page_size:100,_:Date.now()}})).data||[]).filter(D=>D.status!=="Closed"),N.sort((D,k)=>z(D.received_at).valueOf()-z(k.received_at).valueOf()),N=N.slice(0,20)),d(N)}catch(N){if(((R=N==null?void 0:N.response)==null?void 0:R.status)===401)return;console.error("Failed to load queue",N)}finally{c(!1)}})},[s,n,u]);const p=j=>j===null?"N/A":`${Math.round(j)}%`;return e.jsxs(e.Fragment,{children:[e.jsx(Se,{actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"secondary",onClick:y,disabled:m,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),m?"Refreshing...":"Refresh"]}),e.jsxs(O,{variant:"primary",onClick:()=>t("/create"),children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"New Complaint"]})]})}),e.jsxs("div",{className:"px-10 py-6",children:[v&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:v}),e.jsx(O,{variant:"secondary",onClick:y,children:"Retry"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>t("/complaints"),className:"rounded-card border border-border bg-app p-6 text-left hover:bg-surface transition",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Open Cases"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-text-primary",children:m?"":(r==null?void 0:r.kpis.open)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"Total open complaints"})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"My Open"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-text-primary",children:m?"":(r==null?void 0:r.kpis.my_open)||0}),e.jsxs("div",{className:"mt-2 text-xs text-text-secondary",children:["Assigned to me",!m&&r&&e.jsx("button",{onClick:()=>t("/tasks"),className:"ml-2 text-brand hover:text-brand-dark font-medium",children:"View "})]})]}),e.jsxs("button",{type:"button",onClick:()=>t("/complaints?overdue=true"),className:"rounded-card border border-border bg-app p-6 text-left hover:bg-surface transition",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"SLA Breaches"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-semantic-error",children:m?"":(r==null?void 0:r.kpis.open_sla_breaches)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"Open breaches"})]}),e.jsxs("div",{className:"rounded-card border border-border bg-app p-6",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary",children:"Stale (21d+)"}),e.jsx("div",{className:"mt-3 text-3xl font-semibold text-semantic-warning",children:m?"":(r==null?void 0:r.kpis.open_stale_21d)||0}),e.jsx("div",{className:"mt-2 text-xs text-text-secondary",children:"No activity"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"7-Day Flow"})}),e.jsx(ce,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-semantic-success"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"New complaints"})]}),e.jsx("span",{className:"text-xl font-semibold text-text-primary",children:(r==null?void 0:r.flow_7d.new)||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"Closed"})]}),e.jsx("span",{className:"text-xl font-semibold text-text-primary",children:(r==null?void 0:r.flow_7d.closed)||0})]}),e.jsx("div",{className:"pt-2 border-t border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:"Net change"}),e.jsxs("span",{className:`text-lg font-semibold ${((r==null?void 0:r.flow_7d.new)||0)-((r==null?void 0:r.flow_7d.closed)||0)>0?"text-semantic-warning":"text-semantic-success"}`,children:[((r==null?void 0:r.flow_7d.new)||0)-((r==null?void 0:r.flow_7d.closed)||0)>0?"+":"",((r==null?void 0:r.flow_7d.new)||0)-((r==null?void 0:r.flow_7d.closed)||0)]})]})})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Age of Open Cases"})}),e.jsx(ce,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsx("div",{className:"space-y-3",children:[{label:"0-7 days",key:"0-7",color:"bg-semantic-success"},{label:"8-21 days",key:"8-21",color:"bg-semantic-info"},{label:"22-56 days",key:"22-56",color:"bg-semantic-warning"},{label:"56+ days",key:"56+",color:"bg-semantic-error"}].map(({label:j,key:R,color:N})=>{const C=r==null?void 0:r.aging_open;if(!C)return null;const D=C[R]||0,k=Object.values(C).reduce((se,F)=>se+F,0),Y=k>0?D/k*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:j}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:D})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${N} transition-all duration-300`,style:{width:`${Math.min(100,Math.max(0,Y))}%`}})})]},R)})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsx(ie,{children:e.jsxs(ce,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Vulnerable Customers"}),e.jsx("div",{className:"text-2xl font-semibold text-text-primary",children:m?"":(r==null?void 0:r.risk.open_vulnerable.count)||0}),!m&&r&&r.risk.open_vulnerable.pct_of_open!==null&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:[p(r.risk.open_vulnerable.pct_of_open)," of open"]}),!m&&e.jsx("button",{type:"button",onClick:()=>t("/complaints?vulnerability=true"),className:"mt-2 text-xs font-medium text-brand hover:text-brand-dark",children:"View cases "})]})}),e.jsx(ie,{children:e.jsxs(ce,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Reopened Cases"}),e.jsx("div",{className:"text-2xl font-semibold text-semantic-warning",children:m?"":(r==null?void 0:r.risk.reopened.count)||0}),!m&&r&&r.risk.reopened.pct_all_time!==null&&e.jsxs("div",{className:"mt-1 text-xs text-text-muted",children:[p(r.risk.reopened.pct_all_time)," of all time"]})]})}),e.jsx(ie,{children:e.jsxs(ce,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Escalated (Open)"}),e.jsx("div",{className:"text-2xl font-semibold text-semantic-error",children:m?"":(r==null?void 0:r.risk.escalated_open)||0}),e.jsx("div",{className:"mt-1 text-xs text-text-muted",children:"Requires attention"})]})}),e.jsx(ie,{children:e.jsxs(ce,{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary mb-2",children:"Final Response Rate"}),e.jsx("div",{className:"text-2xl font-semibold text-text-primary",children:m?"":p((r==null?void 0:r.risk.final_attachment_open_pct)||null)}),e.jsx("div",{className:"mt-1 text-xs text-text-muted",children:"Open with attachments"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Acknowledgement SLA (30d)"})}),e.jsx(ce,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"On-time rate"}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:p((r==null?void 0:r.sla_30d.ack.on_time_pct)||null)})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-semantic-success transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(r==null?void 0:r.sla_30d.ack.on_time_pct)||0))}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:[(r==null?void 0:r.sla_30d.ack.on_time)||0," / ",(r==null?void 0:r.sla_30d.ack.total)||0," on time"]})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Final Response SLA (30d)"})}),e.jsx(ce,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"On-time rate"}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:p((r==null?void 0:r.sla_30d.final.on_time_pct)||null)})]}),e.jsx("div",{className:"w-full h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-semantic-success transition-all duration-300",style:{width:`${Math.min(100,Math.max(0,(r==null?void 0:r.sla_30d.final.on_time_pct)||0))}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:[(r==null?void 0:r.sla_30d.final.on_time)||0," / ",(r==null?void 0:r.sla_30d.final.total)||0," on time"]})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Team Workload"})}),e.jsx(ce,{children:m?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):e.jsxs("div",{className:"mt-4 space-y-2",children:[((r==null?void 0:r.workload_open_by_handler)||[]).slice(0,5).map(j=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary truncate pr-2",children:j.name}),e.jsx("span",{className:"text-sm font-semibold text-text-primary",children:j.count})]},j.id)),(!(r!=null&&r.workload_open_by_handler)||r.workload_open_by_handler.length===0)&&e.jsx("div",{className:"text-xs text-text-muted text-center py-4",children:"No workload data"})]})})]})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"My Queue"})}),e.jsx("div",{className:"mt-4 border-b border-border",children:e.jsx("div",{className:"flex gap-1 px-4",children:["mine","unassigned","breached","oldest"].map(j=>e.jsx("button",{onClick:()=>l(j),className:`px-4 py-2 text-sm font-medium capitalize transition border-b-2 ${u===j?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:j},j))})}),e.jsx("div",{className:"p-4",children:i?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"Loading..."}):o.length===0?e.jsx("div",{className:"text-center py-8 text-text-muted",children:"No complaints in this queue"}):e.jsx("div",{className:"space-y-2",children:o.map(j=>e.jsxs("div",{onClick:()=>t(`/complaints/${j.id}`),className:"flex items-center justify-between p-3 rounded-lg border border-border hover:bg-app cursor-pointer transition",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-text-primary truncate",children:j.reference}),e.jsx("div",{className:"text-xs text-text-secondary truncate mt-1",children:j.description||"No description"})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[e.jsx("span",{className:"text-xs text-text-muted whitespace-nowrap",children:z(j.received_at).format("MMM D")}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${j.status==="New"?"bg-semantic-info/10 text-semantic-info":j.status==="Acknowledged"?"bg-semantic-success/10 text-semantic-success":"bg-app text-text-secondary"}`,children:j.status})]})]},j.id))})})]})]})]})}function wt({status:t,className:s=""}){const n=r=>{switch(r){case"New":return"bg-semantic-info/10 text-semantic-info border-semantic-info/20";case"Acknowledged":return"bg-semantic-success/10 text-semantic-success border-semantic-success/20";case"In Investigation":return"bg-blue-50 text-blue-700 border-blue-200";case"Response Drafted":return"bg-purple-50 text-purple-700 border-purple-200";case"Awaiting Customer":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"Escalated":return"bg-semantic-warning/10 text-semantic-warning border-semantic-warning/20";case"Closed":return"bg-gray-100 text-gray-700 border-gray-200";default:return"bg-app text-text-secondary border-border"}};return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium border ${n(t)} ${s}`,children:t})}function Wa(){const t=Ke(),[s]=sn(),[n,r]=f.useState([]),[a,o]=f.useState(!0),[d,u]=f.useState(null),[l,i]=f.useState(""),[c,m]=f.useState("all"),[h,v]=f.useState("all"),[x,y]=f.useState(!1),[p,j]=f.useState(!1),[R,N]=f.useState("received_at"),[C,D]=f.useState("desc"),[k,Y]=f.useState(1),[se]=f.useState(50),[F,B]=f.useState(1),[I,T]=f.useState([]);f.useEffect(()=>{const S=s.get("overdue"),q=s.get("vulnerability"),V=s.get("status"),$=s.get("handler"),G=s.get("search");S!==null&&y(S==="true"),q!==null&&j(q==="true"),V&&m(V),$&&v($),G&&i(G),Y(1)},[]);const W=()=>Q(this,null,function*(){o(!0),u(null);try{const S={page:k,page_size:se,_:Date.now()};c!=="all"&&(S.status_filter=c),h!=="all"&&h!=="unassigned"&&(S.handler_id=h),x&&(S.overdue=!0),p&&(S.vulnerability=!0),l.trim()&&(S.search=l.trim());const q=yield J.get("/complaints",{params:S}),V=q.data||[];r(h==="unassigned"?V.filter($=>!$.assigned_handler_id):V),q.data&&q.data.length===se?B(k+1):B(k)}catch(S){console.error("Failed to load complaints",S),u("Failed to load complaints. Please try again.")}finally{o(!1)}}),P=()=>Q(this,null,function*(){try{const S=yield J.get("/users");T(S.data||[])}catch(S){console.error("Failed to load handlers",S)}});f.useEffect(()=>{P()},[]),f.useEffect(()=>{W()},[k,h,x,c,p]);const L=S=>{R===S?D(C==="asc"?"desc":"asc"):(N(S),D("asc"))},w=S=>R!==S?e.jsx("svg",{className:"h-4 w-4 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):C==="asc"?e.jsx("svg",{className:"h-4 w-4 text-brand",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"h-4 w-4 text-brand",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),_=n.sort((S,q)=>{var G,M;let V,$;switch(R){case"reference":V=S.reference,$=q.reference;break;case"status":V=S.status,$=q.status;break;case"received_at":V=new Date(S.received_at).getTime(),$=new Date(q.received_at).getTime();break;case"handler":V=S.assigned_handler_name||"zzz",$=q.assigned_handler_name||"zzz";break;case"complainant":V=((G=S.complainant)==null?void 0:G.full_name)||"zzz",$=((M=q.complainant)==null?void 0:M.full_name)||"zzz";break;default:return 0}return V<$?C==="asc"?-1:1:V>$?C==="asc"?1:-1:0}),E=S=>{if(S.status==="Closed")return!1;const q=z();return!S.acknowledged_at&&S.ack_due_at?z(S.ack_due_at).isBefore(q):!S.final_response_at&&S.final_due_at?z(S.final_due_at).isBefore(q):!1},A=()=>{i(""),m("all"),v("all"),y(!1),j(!1),Y(1)},U=[l!=="",c!=="all",h!=="all",x,p].filter(Boolean).length;return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"Complaints",actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"secondary",onClick:W,disabled:a,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),a?"Refreshing...":"Refresh"]}),e.jsxs(O,{variant:"primary",onClick:()=>t("/create"),children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"New Complaint"]})]})}),e.jsxs("div",{className:"px-10 py-6",children:[e.jsx(ie,{className:"mb-6",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Filters & Search"}),U>0&&e.jsxs(O,{variant:"secondary",onClick:A,children:["Clear all (",U,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(ne,{type:"search",placeholder:"Search by reference, description, or complainant...",value:l,onChange:S=>i(S.target.value),onKeyDown:S=>{S.key==="Enter"&&(S.preventDefault(),Y(1),W())},leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("p",{className:"mt-1 text-xs text-text-muted",children:"Tip: Press Enter or click Refresh to run a new search (server-side)."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status-filter",className:"block text-xs font-medium text-text-primary mb-1",children:"Status"}),e.jsxs("select",{id:"status-filter",value:c,onChange:S=>m(S.target.value),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-surface text-text-primary focus:outline-none focus:ring-2 focus:ring-brand",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"New",children:"New"}),e.jsx("option",{value:"Acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"In Investigation",children:"In Investigation"}),e.jsx("option",{value:"Response Drafted",children:"Response Drafted"}),e.jsx("option",{value:"Final Response Issued",children:"Final Response Issued"}),e.jsx("option",{value:"Closed",children:"Closed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"handler-filter",className:"block text-xs font-medium text-text-primary mb-1",children:"Handler"}),e.jsxs("select",{id:"handler-filter",value:h,onChange:S=>v(S.target.value),className:"w-full px-3 py-2 text-sm border border-border rounded-lg bg-surface text-text-primary focus:outline-none focus:ring-2 focus:ring-brand",children:[e.jsx("option",{value:"all",children:"All Handlers"}),e.jsx("option",{value:"unassigned",children:"Unassigned"}),I.map(S=>e.jsx("option",{value:S.id,children:S.full_name},S.id))]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:S=>y(S.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Overdue only"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:S=>j(S.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Vulnerable only"})]})]})]})]})}),d&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:d}),e.jsx(O,{variant:"secondary",onClick:W,children:"Retry"})]}),a?e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading complaints..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-text-secondary",children:["Showing ",_.length," complaint",_.length!==1?"s":""]}),F>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{variant:"secondary",onClick:()=>Y(k-1),disabled:k===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["Page ",k," of ",F]}),e.jsx(O,{variant:"secondary",onClick:()=>Y(k+1),disabled:k===F,children:"Next"})]})]}),e.jsxs(yr,{children:[e.jsx(za,{children:e.jsxs(Hs,{children:[e.jsx(Te,{children:e.jsxs("button",{onClick:()=>L("reference"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Reference ",w("reference")]})}),e.jsx(Te,{children:e.jsxs("button",{onClick:()=>L("status"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Status ",w("status")]})}),e.jsx(Te,{children:e.jsxs("button",{onClick:()=>L("complainant"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Complainant ",w("complainant")]})}),e.jsx(Te,{children:"Description"}),e.jsx(Te,{children:e.jsxs("button",{onClick:()=>L("received_at"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Received ",w("received_at")]})}),e.jsx(Te,{children:e.jsxs("button",{onClick:()=>L("handler"),className:"flex items-center gap-1 hover:text-text-primary transition",children:["Handler ",w("handler")]})}),e.jsx(Te,{children:"Flags"})]})}),e.jsx(Ha,{children:_.map(S=>{var V;const q=E(S);return e.jsxs(Hs,{onClick:()=>t(`/complaints/${S.id}`),children:[e.jsx($e,{children:e.jsx("span",{className:"font-semibold",children:S.reference})}),e.jsx($e,{children:e.jsx(wt,{status:S.status})}),e.jsx($e,{children:e.jsx("span",{className:"text-text-primary",children:((V=S.complainant)==null?void 0:V.full_name)||"Unknown"})}),e.jsx($e,{children:e.jsx("span",{className:"truncate max-w-xs block text-text-secondary",children:S.description||"No description"})}),e.jsx($e,{children:e.jsx("span",{className:"text-text-muted",children:z(S.received_at).format("MMM D, YYYY")})}),e.jsx($e,{children:e.jsx("span",{className:"text-text-muted",children:S.assigned_handler_name||"Unassigned"})}),e.jsx($e,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[q&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-semantic-error/10 text-semantic-error",title:"SLA breach",children:" Overdue"}),S.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-semantic-warning/10 text-semantic-warning",title:"Vulnerable customer",children:" Vulnerable"}),S.fos_complaint&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-purple-100 text-purple-700",title:"Referred to FOS",children:"FOS"})]})})]},S.id)})})]}),F>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx(O,{variant:"secondary",onClick:()=>Y(k-1),disabled:k===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-text-secondary",children:["Page ",k," of ",F]}),e.jsx(O,{variant:"secondary",onClick:()=>Y(k+1),disabled:k===F,children:"Next"})]})]}),!a&&_.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"No complaints found"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:U>0?"Try adjusting your filters or search criteria":"No complaints have been created yet"}),U>0&&e.jsx(O,{variant:"secondary",onClick:A,className:"mt-4",children:"Clear all filters"})]})]})]})}function qa(){const{id:t}=rn(),s=Ke(),{user:n}=He(),[r,a]=f.useState(null),[o,d]=f.useState([]),[u,l]=f.useState(!0),[i,c]=f.useState("overview"),[m,h]=f.useState([]),[v,x]=f.useState(null),[y,p]=f.useState("all"),[j,R]=f.useState(!1),[N,C]=f.useState(!1),[D,k]=f.useState(""),[Y,se]=f.useState(!1),[F,B]=f.useState(!1),[I,T]=f.useState(""),[W,P]=f.useState(!1),[L,w]=f.useState(null),[_,E]=f.useState(!1),[A,U]=f.useState({channel:"email",direction:"inbound",summary:"",occurred_at:z().format("YYYY-MM-DDTHH:mm"),is_final_response:!1,is_internal:!1}),[S,q]=f.useState(!1),[V,$]=f.useState(null),[G,M]=f.useState(!1),[te,le]=f.useState(null),[he,H]=f.useState(!1),[X,re]=f.useState({outcome:"upheld",rationale:"",notes:""}),[Me,Rt]=f.useState(!1),[ss,dt]=f.useState(null),[kr,Ge]=f.useState(!1),[Ne,Oe]=f.useState({payment_type:"financial_loss",amount:"",rationale:"",action_description:"",action_status:"not_started",notes:""}),[rs,Ye]=f.useState(!1),[ns,We]=f.useState(null),[Sr,Ze]=f.useState(!1),[At,as]=f.useState(null),[mt,is]=f.useState(z().format("YYYY-MM-DD")),[Ft,os]=f.useState(!1),[ls,Lt]=f.useState(null),[Mr,et]=f.useState(!1),[cs,Er]=f.useState(null),[ut,ds]=f.useState(z().format("YYYY-MM-DDTHH:mm")),[ms,us]=f.useState(!1),[Rr,tt]=f.useState(!1),[xt,xs]=f.useState(""),[ht,hs]=f.useState(z().format("YYYY-MM-DDTHH:mm")),[Ot,fs]=f.useState(!1),[Ar,st]=f.useState(!1),[ft,ps]=f.useState(""),[Dt,bs]=f.useState(z().format("YYYY-MM-DDTHH:mm")),[Pt,gs]=f.useState(!1),[js,pt]=f.useState(null);f.useEffect(()=>{t&&(Ee(),Lr())},[t]);const Fr=()=>{t&&J.get(`/complaints/${t}/events`).then(b=>d(b.data)).catch(b=>console.error("Failed to load events",b))},Ee=()=>{t&&(l(!0),J.get(`/complaints/${t}`).then(b=>{a(b.data),Fr(),l(!1)}).catch(b=>{console.error("Failed to load complaint",b),l(!1)}))},Lr=()=>{J.get("/users").then(b=>{const K=b.data.filter(ae=>ae.is_active&&["admin","complaints_handler","complaints_manager","reviewer"].includes(ae.role));h(K)}).catch(b=>{console.error("Failed to load users",b)})},Or=()=>Q(this,null,function*(){var b,K;if(!(!t||!n)){P(!0),w(null);try{yield J.post(`/complaints/${t}/assign`,null,{params:{handler_id:n.id}}),Ee()}catch(ae){w(((K=(b=ae==null?void 0:ae.response)==null?void 0:b.data)==null?void 0:K.detail)||"Failed to assign complaint")}finally{P(!1)}}}),Dr=()=>Q(this,null,function*(){var b,K;if(!(!t||!I)){P(!0),w(null);try{yield J.post(`/complaints/${t}/assign`,null,{params:{handler_id:I}}),B(!1),T(""),Ee()}catch(ae){w(((K=(b=ae==null?void 0:ae.response)==null?void 0:b.data)==null?void 0:K.detail)||"Failed to assign complaint")}finally{P(!1)}}}),ys=b=>Q(this,null,function*(){var ae,ke;if(!t||!A.summary)return;const K=A.is_internal?!1:A.is_final_response;if(K&&(!V||V.length===0)&&!(b!=null&&b.allowFinalWithoutAttachment)){q(!0);return}M(!0),le(null);try{const xe=new FormData;xe.append("channel",A.channel),xe.append("direction",A.direction),xe.append("summary",A.summary),xe.append("occurred_at",z(A.occurred_at).toISOString()),xe.append("is_final_response",K.toString()),xe.append("is_internal",A.is_internal.toString()),V&&Array.from(V).forEach(ye=>{xe.append("files",ye)}),yield J.post(`/complaints/${t}/communications`,xe,{headers:{"Content-Type":"multipart/form-data"}}),E(!1),U({channel:"email",direction:"inbound",summary:"",occurred_at:z().format("YYYY-MM-DDTHH:mm"),is_final_response:!1,is_internal:!1}),$(null),Ee()}catch(xe){const ye=(ke=(ae=xe==null?void 0:xe.response)==null?void 0:ae.data)==null?void 0:ke.detail;let ue="Failed to add communication";typeof ye=="string"?ue=ye:Array.isArray(ye)?ue=ye.map(qe=>qe.msg||JSON.stringify(qe)).join(", "):ye&&typeof ye=="object"&&(ue=JSON.stringify(ye)),le(ue)}finally{M(!1)}}),Pr=()=>Q(this,null,function*(){q(!1),yield ys({allowFinalWithoutAttachment:!0})});if(u)return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"Loading..."}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading complaint details..."})})]});if(!r)return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"Not Found"}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"Complaint not found"}),e.jsx(O,{variant:"secondary",onClick:()=>s("/complaints"),className:"mt-4",children:"Back to Complaints"})]})})]});const Tt=(b,K)=>Q(this,null,function*(){var ae,ke;if(t)try{yield J.post(`/complaints/${t}/${b}`),x({type:"success",text:K}),Ee()}catch(xe){x({type:"error",text:((ke=(ae=xe==null?void 0:xe.response)==null?void 0:ae.data)==null?void 0:ke.detail)||`Failed to ${K.toLowerCase()}`})}}),Tr=()=>Q(this,null,function*(){var ke,xe;if(!t)return;Rt(!0),dt(null);const b=(X.rationale||"").trim(),K=(X.notes||"").trim();if(new Set(["upheld","partially_upheld","not_upheld","out_of_scope"]).has(X.outcome)&&b.length<10){Rt(!1),dt("Please add a short rationale (at least 10 characters) for this outcome.");return}try{yield J.post(`/complaints/${t}/outcome`,{outcome:X.outcome,rationale:b||null,notes:K||null}),H(!1),Ee()}catch(ye){dt(((xe=(ke=ye==null?void 0:ye.response)==null?void 0:ke.data)==null?void 0:xe.detail)||"Failed to save outcome")}finally{Rt(!1)}}),$r=()=>Q(this,null,function*(){var ke,xe,ye;if(!t)return;Ye(!0),We(null);const b=(Ne.amount||"").trim(),K=b?Number(b):null,ae=(Ne.rationale||"").trim();if(b&&(Number.isNaN(K)||K===null)){Ye(!1),We("Please enter a valid amount.");return}if(K!==null&&K<0){Ye(!1),We("Amount cannot be negative.");return}if(K!==null&&!/^\d+(\.\d{1,2})?$/.test(b)){Ye(!1),We("Amount must have at most 2 decimal places.");return}if(K!==null&&K>0&&ae.length<10){Ye(!1),We("Please add a short rationale (at least 10 characters) for monetary redress.");return}try{yield J.post(`/complaints/${t}/redress`,{payment_type:Ne.payment_type,amount:K!==null?K:null,status:"pending",rationale:ae||null,action_description:Ne.action_description||null,action_status:Ne.action_status,notes:Ne.notes||null,approved:!0,outcome_id:((ke=r==null?void 0:r.outcome)==null?void 0:ke.id)||null}),Ge(!1),Oe({payment_type:"financial_loss",amount:"",rationale:"",action_description:"",action_status:"not_started",notes:""}),Ee()}catch(ue){We(((ye=(xe=ue==null?void 0:ue.response)==null?void 0:xe.data)==null?void 0:ye.detail)||"Failed to add redress")}finally{Ye(!1)}}),Ir=b=>{Lt(null),as(b),is(z().format("YYYY-MM-DD")),Ze(!0)},Br=()=>Q(this,null,function*(){var b,K;if(!(!t||!At)){os(!0),Lt(null);try{yield J.patch(`/complaints/${t}/redress/${At}`,{paid_at:mt?z(mt).startOf("day").toISOString():null}),Ze(!1),as(null),Ee()}catch(ae){Lt(((K=(b=ae==null?void 0:ae.response)==null?void 0:b.data)==null?void 0:K.detail)||"Failed to record payment date")}finally{os(!1)}}}),Ur=()=>{r!=null&&r.outcome?re({outcome:r.outcome.outcome,rationale:r.outcome.rationale||"",notes:r.outcome.notes||""}):re({outcome:"upheld",rationale:"",notes:""}),dt(null),H(!0)},$t=b=>{Er(b),ds(z().format("YYYY-MM-DDTHH:mm")),et(!0)},zr=()=>Q(this,null,function*(){if(!(!t||!cs)){us(!0);try{yield J.post(`/complaints/${t}/${cs}`,{closed_at:ut?z(ut).toISOString():null}),et(!1),Ee()}catch(b){console.error("Failed to close complaint",b)}finally{us(!1)}}}),Hr=()=>{xs(""),hs(z().format("YYYY-MM-DDTHH:mm")),tt(!0)},Yr=()=>Q(this,null,function*(){if(t){fs(!0);try{yield J.post(`/complaints/${t}/reopen`,{reason:(xt==null?void 0:xt.trim())||null,reopened_at:ht?z(ht).toISOString():null}),tt(!1),Ee()}catch(b){console.error("Failed to reopen complaint",b)}finally{fs(!1)}}}),Wr=()=>{pt(null),ps(""),bs(z().format("YYYY-MM-DDTHH:mm")),st(!0)},qr=()=>Q(this,null,function*(){var b,K;if(t){if(!ft.trim()){pt("FOS reference is required");return}gs(!0),pt(null);try{yield J.post(`/complaints/${t}/refer-to-fos`,{fos_reference:ft.trim(),fos_referred_at:Dt?z(Dt).toISOString():null}),st(!1),Ee()}catch(ae){pt(((K=(b=ae==null?void 0:ae.response)==null?void 0:b.data)==null?void 0:K.detail)||"Failed to refer to FOS")}finally{gs(!1)}}}),Vr=()=>Q(this,null,function*(){var b,K;if(t&&(n==null?void 0:n.role)==="admin"){se(!0);try{yield J.delete(`/complaints/${t}`),s("/complaints")}catch(ae){x({type:"error",text:((K=(b=ae==null?void 0:ae.response)==null?void 0:b.data)==null?void 0:K.detail)||"Failed to delete complaint"})}finally{se(!1),C(!1),k("")}}});return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:r.reference,actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(wt,{status:r.status}),(n==null?void 0:n.role)==="admin"&&e.jsx(O,{variant:"secondary",onClick:()=>C(!0),className:"border-semantic-error/40 text-semantic-error hover:bg-semantic-error/5",children:"Delete"}),e.jsx(O,{variant:"secondary",onClick:()=>s("/complaints"),children:"Back"})]})}),e.jsxs("div",{className:"px-10 py-6",children:[v&&e.jsxs("div",{className:`mb-6 rounded-lg border p-4 flex items-start justify-between gap-4 ${v.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:[e.jsx("div",{className:"text-sm",children:v.text}),e.jsx("button",{onClick:()=>x(null),className:"text-sm font-medium underline underline-offset-2",children:"Dismiss"})]}),e.jsx("div",{className:"border-b border-border mb-6",children:e.jsx("div",{className:"flex gap-1",children:["overview","communications","outcome","history"].map(b=>e.jsx("button",{onClick:()=>c(b),className:`px-4 py-3 text-sm font-medium capitalize transition border-b-2 ${i===b?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:b},b))})}),i==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[(n==null?void 0:n.role)!=="read_only"&&e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Actions"})}),e.jsx(ce,{children:e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[!r.acknowledged_at&&(r.status==="New"||r.status==="Reopened")&&e.jsx(O,{variant:"primary",size:"sm",onClick:()=>Tt("acknowledge","Complaint acknowledged"),children:" Acknowledge"}),(r.status==="Acknowledged"||r.status==="New"||r.status==="Reopened")&&e.jsx(O,{variant:"primary",size:"sm",onClick:()=>Tt("investigate","Investigation started"),children:" Start Investigation"}),r.status==="In Investigation"&&e.jsx(O,{variant:"secondary",size:"sm",onClick:()=>s(`/complaints/${t}`),children:" Draft Response"}),r.outcome&&!r.final_response_at&&e.jsx(O,{variant:"primary",size:"sm",onClick:()=>Tt("final-response","Final response issued"),children:" Issue Final Response"}),!r.closed_at&&e.jsx(O,{variant:"secondary",size:"sm",onClick:()=>$t("close-non-reportable"),children:" Close as Non-Reportable"}),r.closed_at&&e.jsx(O,{variant:"primary",size:"sm",onClick:Hr,children:" Reopen Complaint"}),r.fos_complaint?e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-semantic-info/10 text-semantic-info border border-semantic-info/20",children:[e.jsx("span",{className:"text-sm font-medium",children:" Referred to FOS"}),r.fos_reference&&e.jsxs("span",{className:"text-xs",children:["(",r.fos_reference,")"]})]}):e.jsx(O,{variant:"secondary",size:"sm",onClick:Wr,children:" Refer to Ombudsman"})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Complaint Details"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Description"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.description||"No description"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Category"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.category||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Reason"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.reason||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Product"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.product||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Scheme"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.scheme||"N/A"})]})]})]})})]}),r.complainant&&e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Complainant"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("p",{className:"text-sm text-text-primary font-medium",children:r.complainant.full_name}),r.complainant.email&&e.jsx("p",{className:"text-sm text-text-secondary",children:r.complainant.email}),r.complainant.phone&&e.jsx("p",{className:"text-sm text-text-secondary",children:r.complainant.phone})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Status"})}),e.jsx(ce,{children:e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Case State"}),e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:r.closed_at?"Closed":"Open"})]}),e.jsx(wt,{status:r.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Workflow Status"}),e.jsx("p",{className:"text-sm text-text-primary",children:r.status})]}),e.jsxs("div",{className:"pt-2 border-t border-border space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Ack due"}),e.jsx("span",{className:`text-xs font-medium ${r.ack_breached?"text-semantic-error":"text-text-primary"}`,children:r.ack_due_at?z(r.ack_due_at).format("MMM D, YYYY"):""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Final due"}),e.jsx("span",{className:`text-xs font-medium ${r.final_breached?"text-semantic-error":"text-text-primary"}`,children:r.final_due_at?z(r.final_due_at).format("MMM D, YYYY"):""})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t border-border",children:[r.ack_breached&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-error/10 text-semantic-error border border-semantic-error/20",children:" Ack breached"}),r.final_breached&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-error/10 text-semantic-error border border-semantic-error/20",children:" Final breached"}),r.is_escalated&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-warning/10 text-semantic-warning border border-semantic-warning/20",children:" Escalated"}),r.fos_complaint&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-info/10 text-semantic-info border border-semantic-info/20",children:" FOS referred"}),r.non_reportable&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-muted border border-border",children:" Non-reportable"}),r.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-warning/10 text-semantic-warning border border-semantic-warning/20",children:" Vulnerable"})]})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Timeline"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Received"}),e.jsx("p",{className:"text-sm text-text-primary",children:z(r.received_at).format("MMM D, YYYY h:mm A")})]}),r.acknowledged_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Acknowledged"}),e.jsx("p",{className:"text-sm text-text-primary",children:z(r.acknowledged_at).format("MMM D, YYYY h:mm A")})]}),r.closed_at&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Closed"}),e.jsx("p",{className:"text-sm text-text-primary",children:z(r.closed_at).format("MMM D, YYYY h:mm A")})]})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Assignment"})}),e.jsx(ce,{children:e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Current Handler"}),e.jsx("p",{className:"text-sm text-text-primary font-semibold",children:r.assigned_handler_name||"Unassigned"})]}),(n==null?void 0:n.role)!=="read_only"&&e.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[(!r.assigned_handler_id||r.assigned_handler_id!==(n==null?void 0:n.id))&&e.jsxs(O,{variant:"secondary",size:"sm",onClick:Or,disabled:W,className:"w-full",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Assign to Me"]}),((n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="complaints_manager"||(n==null?void 0:n.role)==="reviewer")&&e.jsxs(O,{variant:"secondary",size:"sm",onClick:()=>B(!0),disabled:W,className:"w-full",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),"Assign to User"]})]})]})})]})]})]}),i==="communications"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:"Communications"}),e.jsxs(O,{variant:"primary",onClick:()=>E(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Communication"]})]}),r.communications&&r.communications.length>0?e.jsx("div",{className:"space-y-4",children:r.communications.sort((b,K)=>z(K.occurred_at).valueOf()-z(b.occurred_at).valueOf()).map(b=>e.jsx(ie,{children:e.jsxs(ce,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:b.is_internal?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-info/10 text-semantic-info border border-semantic-info/20",children:"Note / Decision"}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-primary border border-border",children:b.channel}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium ${String(b.direction).toLowerCase()==="inbound"?"bg-semantic-info/10 text-semantic-info":"bg-semantic-success/10 text-semantic-success"}`,children:String(b.direction).replace(/_/g," ").replace(/^\w/,K=>K.toUpperCase())}),b.is_final_response&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-warning/10 text-semantic-warning border border-semantic-warning/20",children:"Final Response"})]})}),e.jsx("span",{className:"text-xs text-text-muted",children:z(b.occurred_at).format("MMM D, YYYY h:mm A")})]}),e.jsx("p",{className:"text-sm text-text-primary mt-2",children:b.summary}),b.attachments&&b.attachments.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:b.attachments.map(K=>e.jsxs("a",{href:K.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1 rounded-lg bg-app text-text-primary hover:bg-border text-xs transition",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),K.file_name]},K.id))})]})},b.id))}):e.jsxs("div",{className:"text-center py-12 rounded-lg border border-border bg-surface",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No communications yet"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:'Click "Add Communication" to log your first interaction'})]})]}),i==="outcome"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(me,{children:"Outcome"}),(n==null?void 0:n.role)!=="read_only"&&e.jsx(O,{variant:"primary",size:"sm",onClick:Ur,children:r.outcome?"Update Outcome":"Record Outcome"})]})}),e.jsx(ce,{children:r.outcome?e.jsxs("div",{className:"space-y-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Outcome Type"}),e.jsx("p",{className:"text-sm text-text-primary capitalize",children:r.outcome.outcome.replace(/_/g," ")})]}),r.outcome.rationale&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Rationale"}),e.jsx("p",{className:"text-sm text-text-secondary",children:r.outcome.rationale})]}),r.outcome.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:r.outcome.notes})]})]}):e.jsx("p",{className:"text-sm text-text-secondary mt-4",children:"No outcome recorded yet"})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(me,{children:"Redress Payments"}),(n==null?void 0:n.role)!=="read_only"&&e.jsxs(O,{variant:"primary",size:"sm",onClick:()=>Ge(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add Redress"]})]})}),e.jsx(ce,{children:r.redress_payments&&r.redress_payments.length>0?e.jsx("div",{className:"space-y-4 mt-4",children:r.redress_payments.map(b=>e.jsxs("div",{className:"p-4 rounded-lg border border-border bg-surface",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary capitalize",children:b.payment_type.replace(/_/g," ")}),b.amount&&e.jsxs("p",{className:"text-lg font-bold text-text-primary mt-1",children:["",b.amount.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b.paid_at?e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-success/10 text-semantic-success border border-semantic-success/20",children:[" Paid ",z(b.paid_at).format("MMM D, YYYY")]}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-secondary border border-border",children:"Recorded"}),(n==null?void 0:n.role)!=="read_only"&&b.amount&&!b.paid_at&&e.jsx(O,{variant:"secondary",size:"sm",onClick:()=>Ir(b.id),children:"Record payment date"})]})]}),b.rationale&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Rationale"}),e.jsx("p",{className:"text-sm text-text-secondary",children:b.rationale})]}),b.action_description&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Action"}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("p",{className:"text-sm text-text-secondary flex-1",children:b.action_description}),b.action_status&&e.jsx("span",{className:`ml-3 inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium capitalize ${b.action_status==="completed"?"bg-semantic-success/10 text-semantic-success":b.action_status==="in_progress"?"bg-semantic-info/10 text-semantic-info":"bg-app text-text-muted border border-border"}`,children:b.action_status.replace(/_/g," ")})]})]}),b.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Notes"}),e.jsx("p",{className:"text-sm text-text-secondary",children:b.notes})]})]},b.id))}):e.jsxs("div",{className:"text-center py-12 mt-4",children:[e.jsx("div",{className:"mx-auto h-12 w-12 rounded-full border-2 border-text-muted flex items-center justify-center",children:e.jsx("span",{className:"text-2xl font-bold text-text-muted",children:""})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No redress payments"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"No redress payments have been recorded for this complaint"})]})})]}),(n==null?void 0:n.role)!=="read_only"&&r.status!=="Closed"&&e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Close Complaint"})}),e.jsxs(ce,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[r.final_response_at&&e.jsx(O,{variant:"primary",onClick:()=>$t("close"),children:" Close Complaint"}),e.jsx(O,{variant:"secondary",onClick:()=>$t("close-non-reportable"),children:" Close as Non-Reportable"})]}),!r.final_response_at&&e.jsx("p",{className:"text-xs text-text-muted mt-3",children:"Note: Final response must be issued before closing the complaint normally."})]})]})]}),i==="history"&&e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx("div",{className:"flex items-start justify-between gap-4 w-full",children:e.jsxs("div",{children:[e.jsx(me,{children:"Activity History"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"Filter noise to review key compliance events quickly."})]})})}),e.jsx(ce,{children:o&&o.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 mb-4 rounded-lg border border-border bg-surface p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 justify-between",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:[{key:"all",label:"All"},{key:"status",label:"Status changes"},{key:"communications",label:"Communications"},{key:"decisions",label:"Outcome / Redress / FOS"},{key:"assignment",label:"Assignment"}].map(b=>e.jsx("button",{onClick:()=>p(b.key),className:`px-3 py-1.5 rounded-lg text-sm font-medium border transition ${y===b.key?"bg-app border-border text-text-primary":"bg-surface border-border text-text-secondary hover:text-text-primary hover:bg-app"}`,children:b.label},b.key))}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:b=>R(b.target.checked),className:"h-4 w-4 rounded border-border text-brand focus:ring-brand"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Show Viewed"})]}),e.jsx("button",{onClick:()=>{p("all"),R(!1)},className:"text-sm font-medium text-brand hover:text-brand-dark",children:"Reset"})]})]})}),e.jsx("div",{className:"space-y-0",children:(()=>{const b=[...o].sort((ue,qe)=>z(qe.created_at).valueOf()-z(ue.created_at).valueOf()),K=new Set(["created","updated","acknowledged","investigation_started","response_drafted","final_response_issued","closed","closed_non_reportable","reopened","escalated"]),ae=new Set(["communication_added"]),ke=new Set(["outcome_recorded","redress_added","redress_updated","referred_to_fos"]),xe=new Set(["assigned"]),ye=b.filter(ue=>!j&&ue.event_type==="accessed"?!1:y==="status"?K.has(ue.event_type):y==="communications"?ae.has(ue.event_type):y==="decisions"?ke.has(ue.event_type):y==="assignment"?xe.has(ue.event_type):!0);return ye.length===0?e.jsxs("div",{className:"text-center py-10 rounded-lg border border-border bg-surface",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:"No events match your filters"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"Try resetting filters or enabling Viewed."})]}):ye.map(ue=>{const qe=ve=>ve==="created"?"":ve==="accessed"?"":ve==="updated"?"":ve==="acknowledged"?"":ve==="investigation_started"?"":ve==="response_drafted"?"":ve==="outcome_recorded"?"":ve==="final_response_issued"?"":ve==="closed"?"":ve==="closed_non_reportable"?"":ve==="reopened"?"":ve==="escalated"?"":ve==="assigned"?"":ve==="referred_to_fos"?"":ve==="communication_added"?"":ve==="redress_added"||ve==="redress_updated"?"":"",Jr=ve=>ve.split("_").map(vs=>vs.charAt(0).toUpperCase()+vs.slice(1)).join(" ");return e.jsxs("div",{className:"flex gap-4 py-3 border-b border-border last:border-0 hover:bg-surface/50 transition px-3 -mx-3 rounded-lg",children:[e.jsx("div",{className:"flex-shrink-0 text-lg pt-0.5",children:qe(ue.event_type)}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-text-primary",children:Jr(ue.event_type)}),ue.description&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:ue.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1.5 flex-wrap",children:[ue.created_by_name&&e.jsxs("span",{className:"text-xs text-text-muted",children:["by ",ue.created_by_name]}),e.jsx("span",{className:"text-xs text-text-muted",children:z(ue.created_at).format("MMM D, YYYY [at] h:mm A")})]})]})})})]},ue.id)})})()})]}):e.jsxs("div",{className:"text-center py-12 mt-4",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:"No history events recorded"})]})})]})]}),e.jsxs(fe,{open:F,onClose:()=>B(!1),children:[e.jsx(pe,{onClose:()=>B(!1),children:"Assign Complaint"}),e.jsxs(be,{children:[L&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:L}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"assign-handler",className:"block text-xs font-medium text-text-primary",children:"Select Handler *"}),e.jsxs("select",{id:"assign-handler",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:I,onChange:b=>T(b.target.value),children:[e.jsx("option",{value:"",children:"-- Select a user --"}),m.map(b=>e.jsxs("option",{value:b.id,children:[b.full_name," (",b.role.replace(/_/g," "),")"]},b.id))]})]})})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>B(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:Dr,disabled:!I||W,children:W?"Assigning...":"Assign"})]})]}),e.jsxs(fe,{open:Mr,onClose:()=>et(!1),children:[e.jsx(pe,{onClose:()=>et(!1),children:"Confirm Closure"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Please confirm the closure date for this complaint."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"close-date",className:"block text-xs font-medium text-text-primary",children:"Closure Date & Time *"}),e.jsx(ne,{id:"close-date",type:"datetime-local",value:ut,onChange:b=>ds(b.target.value)})]})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>et(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:zr,disabled:ms||!ut,children:ms?"Closing...":"Confirm Closure"})]})]}),e.jsxs(fe,{open:Rr,onClose:()=>tt(!1),children:[e.jsx(pe,{onClose:()=>tt(!1),children:"Reopen Complaint"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Reopening will remove the closure date and set the status back to an active state."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"reopen-date",className:"block text-xs font-medium text-text-primary",children:"Reopen Date & Time *"}),e.jsx(ne,{id:"reopen-date",type:"datetime-local",value:ht,onChange:b=>hs(b.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Reason (optional)"}),e.jsx("textarea",{className:"w-full min-h-[90px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:xt,onChange:b=>xs(b.target.value),placeholder:"Why is the complaint being reopened?"})]})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>tt(!1),disabled:Ot,children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:Yr,disabled:Ot||!ht,children:Ot?"Reopening...":"Reopen"})]})]}),e.jsxs(fe,{open:Ar,onClose:()=>st(!1),children:[e.jsx(pe,{onClose:()=>st(!1),children:"Refer to Ombudsman (FOS)"}),e.jsxs(be,{children:[js&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:js}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Record the referral details. This can only be done once per complaint."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"fos-reference",className:"block text-xs font-medium text-text-primary",children:"FOS Reference *"}),e.jsx(ne,{id:"fos-reference",value:ft,onChange:b=>ps(b.target.value),placeholder:"e.g. FOS-12345678",autoFocus:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"fos-date",className:"block text-xs font-medium text-text-primary",children:"Date Referred *"}),e.jsx(ne,{id:"fos-date",type:"datetime-local",value:Dt,onChange:b=>bs(b.target.value)})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>st(!1),disabled:Pt,children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:qr,disabled:Pt||!ft.trim(),children:Pt?"Referring...":"Confirm Referral"})]})]}),e.jsxs(fe,{open:he,onClose:()=>H(!1),children:[e.jsx(pe,{onClose:()=>H(!1),children:r!=null&&r.outcome?"Update Outcome":"Record Outcome"}),e.jsxs(be,{children:[ss&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:ss}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"outcome-type",className:"block text-xs font-medium text-text-primary",children:"Outcome *"}),e.jsxs("select",{id:"outcome-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:X.outcome,onChange:b=>re(oe(ee({},X),{outcome:b.target.value})),children:[e.jsx("option",{value:"upheld",children:"Upheld"}),e.jsx("option",{value:"partially_upheld",children:"Partially Upheld"}),e.jsx("option",{value:"not_upheld",children:"Not Upheld"}),e.jsx("option",{value:"withdrawn",children:"Withdrawn"}),e.jsx("option",{value:"out_of_scope",children:"Out of Scope"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Rationale"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:X.rationale,onChange:b=>re(oe(ee({},X),{rationale:b.target.value})),placeholder:"Why was this outcome selected?"}),e.jsx("p",{className:"text-xs text-text-muted",children:"This should capture the decision rationale for auditability."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Notes (optional)"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:X.notes,onChange:b=>re(oe(ee({},X),{notes:b.target.value})),placeholder:"Any additional notes..."})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>H(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:Tr,disabled:Me,children:Me?"Saving...":"Save Outcome"})]})]}),e.jsxs(fe,{open:kr,onClose:()=>Ge(!1),children:[e.jsx(pe,{onClose:()=>Ge(!1),children:"Add Redress Payment"}),e.jsxs(be,{children:[ns&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:ns}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"redress-type",className:"block text-xs font-medium text-text-primary",children:"Redress Type *"}),e.jsxs("select",{id:"redress-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ne.payment_type,onChange:b=>Oe(oe(ee({},Ne),{payment_type:b.target.value})),children:[e.jsx("option",{value:"financial_loss",children:"Financial Loss"}),e.jsx("option",{value:"interest_on_financial_loss",children:"Interest on Financial Loss"}),e.jsx("option",{value:"distress_and_inconvenience",children:"Distress and Inconvenience"}),e.jsx("option",{value:"consequential_loss",children:"Consequential Loss"}),e.jsx("option",{value:"premium_refund_adjustment",children:"Premium Refund/Adjustment"}),e.jsx("option",{value:"goodwill_payment",children:"Goodwill Payment"}),e.jsx("option",{value:"third_party_payment",children:"Third Party Payment"}),e.jsx("option",{value:"apology_or_explanation",children:"Apology or Explanation"}),e.jsx("option",{value:"remedial_action",children:"Remedial Action"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Amount ()"}),e.jsx(ne,{type:"number",step:"0.01",value:Ne.amount,onChange:b=>Oe(oe(ee({},Ne),{amount:b.target.value})),placeholder:"0.00"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Leave blank for non-monetary redress"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Rationale"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ne.rationale,onChange:b=>Oe(oe(ee({},Ne),{rationale:b.target.value})),placeholder:"Why is this redress being offered?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Action Description"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ne.action_description,onChange:b=>Oe(oe(ee({},Ne),{action_description:b.target.value})),placeholder:"What action needs to be taken?"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"action-status",className:"block text-xs font-medium text-text-primary",children:"Action Status *"}),e.jsxs("select",{id:"action-status",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ne.action_status,onChange:b=>Oe(oe(ee({},Ne),{action_status:b.target.value})),children:[e.jsx("option",{value:"not_started",children:"Not Started"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Notes"}),e.jsx("textarea",{className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:Ne.notes,onChange:b=>Oe(oe(ee({},Ne),{notes:b.target.value})),placeholder:"Additional notes..."})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>Ge(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:$r,disabled:rs,children:rs?"Adding...":"Add Redress"})]})]}),e.jsxs(fe,{open:Sr,onClose:()=>Ze(!1),children:[e.jsx(pe,{onClose:()=>Ze(!1),children:"Record Payment Date"}),e.jsxs(be,{children:[ls&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:ls}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Record the date the redress payment was made."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"paid-at-date",className:"block text-xs font-medium text-text-primary",children:"Payment Date *"}),e.jsx(ne,{id:"paid-at-date",type:"date",value:mt,onChange:b=>is(b.target.value)})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>Ze(!1),disabled:Ft,children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:Br,disabled:Ft||!mt||!At,children:Ft?"Saving...":"Save payment date"})]})]}),e.jsxs(fe,{open:_,onClose:()=>E(!1),children:[e.jsx(pe,{onClose:()=>E(!1),children:"Add Communication"}),e.jsxs(be,{children:[te&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:te}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-type",className:"block text-xs font-medium text-text-primary",children:"Type *"}),e.jsxs("select",{id:"comm-type",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:A.is_internal?"note":"communication",onChange:b=>{const K=b.target.value==="note";U(oe(ee({},A),{is_internal:K,channel:K?"other":A.channel,direction:K?"outbound":A.direction,is_final_response:K?!1:A.is_final_response}))},children:[e.jsx("option",{value:"communication",children:"Customer Communication"}),e.jsx("option",{value:"note",children:"Note / Decision (internal)"})]}),A.is_internal&&e.jsx("div",{className:"rounded-lg border border-semantic-info/30 bg-semantic-info/5 p-3 text-sm text-semantic-info",children:"This is an internal diary entry. It will not issue a final response and can be used for observations/decisions."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-channel",className:"block text-xs font-medium text-text-primary",children:"Channel *"}),e.jsxs("select",{id:"comm-channel",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:A.channel,onChange:b=>U(oe(ee({},A),{channel:b.target.value})),disabled:A.is_internal,children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"phone",children:"Phone"}),e.jsx("option",{value:"letter",children:"Letter"}),e.jsx("option",{value:"web",children:"Web Form"}),e.jsx("option",{value:"third_party",children:"Third Party"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-direction",className:"block text-xs font-medium text-text-primary",children:"Direction *"}),e.jsxs("select",{id:"comm-direction",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:A.direction,onChange:b=>U(oe(ee({},A),{direction:b.target.value})),disabled:A.is_internal,children:[e.jsx("option",{value:"inbound",children:"Inbound"}),e.jsx("option",{value:"outbound",children:"Outbound"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Date & Time *"}),e.jsx(ne,{type:"datetime-local",value:A.occurred_at,onChange:b=>U(oe(ee({},A),{occurred_at:b.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Summary *"}),e.jsx("textarea",{className:"w-full min-h-[100px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:A.summary,onChange:b=>U(oe(ee({},A),{summary:b.target.value})),placeholder:"Describe the communication..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"comm-attachments",className:"block text-xs font-medium text-text-primary",children:"Attachments"}),e.jsx("input",{id:"comm-attachments",type:"file",multiple:!0,onChange:b=>$(b.target.files),className:"w-full text-sm text-text-primary file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-brand file:text-white hover:file:opacity-90 cursor-pointer"})]}),!A.is_internal&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:A.is_final_response,onChange:()=>U(oe(ee({},A),{is_final_response:!A.is_final_response})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Mark as Final Response"})]}),A.is_final_response&&e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"Final responses should normally have evidence attached (e.g., final response letter/email)."})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>E(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:()=>ys(),disabled:!A.summary||G,children:G?"Adding...":"Add Communication"})]})]}),e.jsxs(fe,{open:S,onClose:()=>q(!1),children:[e.jsx(pe,{onClose:()=>q(!1),children:"Final Response without attachment?"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["You marked this communication as a ",e.jsx("strong",{className:"text-text-primary",children:"Final Response"}),", but no attachment was added."]}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"For auditability, attach the final response letter/email where possible."}),e.jsx("p",{className:"text-sm text-text-secondary",children:"You can continue without an attachment if the evidence is stored elsewhere, but this may increase operational risk."})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>q(!1),disabled:G,children:"Go back"}),e.jsx(O,{variant:"primary",onClick:Pr,disabled:G,children:"Continue anyway"})]})]}),e.jsxs(fe,{open:N,onClose:()=>C(!1),children:[e.jsx(pe,{onClose:()=>C(!1),children:"Delete Complaint"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:"This will permanently delete the complaint and all related records (including communications and attachments)."}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["To confirm, type the complaint reference:"," ",e.jsx("span",{className:"font-semibold text-text-primary",children:r.reference})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"delete-confirm",className:"block text-xs font-medium text-text-primary",children:"Type reference to confirm"}),e.jsx(ne,{id:"delete-confirm",value:D,onChange:b=>k(b.target.value),placeholder:r.reference,autoFocus:!0})]})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>C(!1),disabled:Y,children:"Cancel"}),e.jsx(O,{variant:"secondary",onClick:Vr,disabled:Y||D.trim()!==r.reference,className:"border-semantic-error/40 text-semantic-error hover:bg-semantic-error/5",children:Y?"Deleting...":"Delete permanently"})]})]})]})}function Va(){const t=Ke(),[s,n]=f.useState(!1),[r,a]=f.useState(null),[o,d]=f.useState(!1),[u,l]=f.useState({}),[i,c]=f.useState(!1),[m,h]=f.useState([]),[v,x]=f.useState([]),[y,p]=f.useState([]);f.useEffect(()=>{Promise.all([J.get("/reference/products"),J.get("/reference/insurers"),J.get("/reference/brokers")]).then(([F,B,I])=>{h(F.data.map(T=>T.name)),x(B.data.map(T=>T.name)),p(I.data.map(T=>T.name))}).catch(F=>{console.error("Failed to load reference data",F)})},[]);const[j,R]=f.useState({source:"Email",received_at:z().format("YYYY-MM-DDTHH:mm"),description:"",category:"",reason:"",vulnerability_flag:!1,vulnerability_notes:"",policy_number:"",insurer:"",broker:"",product:"",scheme:"",complainant_name:"",complainant_email:"",complainant_phone:"",complainant_address:"",complainant_dob:""});f.useEffect(()=>{const F=!!(j.complainant_name||j.description||j.category);d(F)},[j]),f.useEffect(()=>{const F=B=>{o&&(B.preventDefault(),B.returnValue="")};return window.addEventListener("beforeunload",F),()=>window.removeEventListener("beforeunload",F)},[o]),f.useEffect(()=>{const F=B=>{var I;(B.metaKey||B.ctrlKey)&&B.key==="s"&&(B.preventDefault(),(I=document.getElementById("submit-btn"))==null||I.click())};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[]);const N=F=>F?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(F):!0,C=(F,B)=>{if(R(oe(ee({},j),{[F]:B})),u[F]){const I=ee({},u);delete I[F],l(I)}},D=()=>{if(o){c(!0);return}t("/complaints")},k=()=>{R(oe(ee({},j),{received_at:z().format("YYYY-MM-DDTHH:mm")}))},Y=F=>Q(this,null,function*(){var I,T;F.preventDefault(),a(null),l({});const B={};if(j.complainant_name.trim()||(B.complainant_name="Full name is required"),j.complainant_email&&!N(j.complainant_email)&&(B.complainant_email="Invalid email format"),j.description.trim()||(B.description="Description is required"),j.category||(B.category="Category is required"),Object.keys(B).length>0){l(B),a("Please fix the validation errors before submitting");return}n(!0);try{const W=yield J.post("/complaints",{source:j.source,received_at:z(j.received_at).toISOString(),description:j.description,category:j.category,reason:j.reason||null,fca_complaint:!0,fca_rationale:null,vulnerability_flag:j.vulnerability_flag,vulnerability_notes:j.vulnerability_notes||null,policy_number:j.policy_number||null,insurer:j.insurer||null,broker:j.broker||null,product:j.product||null,scheme:j.scheme||null,complainant:{full_name:j.complainant_name,email:j.complainant_email||null,phone:j.complainant_phone||null,address:j.complainant_address||null,date_of_birth:j.complainant_dob||null},policy:{policy_number:j.policy_number||null,insurer:j.insurer||null,broker:j.broker||null,product:j.product||null,scheme:j.scheme||null}});d(!1),t(`/complaints/${W.data.id}`,{state:{message:"Complaint created successfully!"}})}catch(W){a(((T=(I=W==null?void 0:W.response)==null?void 0:I.data)==null?void 0:T.detail)||"Failed to create complaint"),n(!1)}}),se=(F,B)=>{const I=B-F.length,T=I<=50,W=I<0;return e.jsxs("span",{className:`text-xs ${W?"text-semantic-error":T?"text-semantic-warning":"text-text-muted"}`,children:[F.length," / ",B]})};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"Create New Complaint",actions:e.jsxs("div",{className:"flex items-center gap-4",children:[o&&e.jsx("span",{className:"text-xs text-text-muted",children:"Unsaved changes"}),e.jsx(O,{variant:"secondary",onClick:D,type:"button",children:"Cancel"})]})}),e.jsxs("div",{className:"px-10 py-6 max-w-4xl",children:[r&&e.jsx("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:r}),e.jsxs("div",{className:"mb-6 bg-surface rounded-lg border border-border p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-text-secondary mb-2",children:[e.jsx("span",{children:"Complaint Creation Form"}),e.jsx("span",{className:"text-text-muted",children:"Tip: Press Cmd/Ctrl + S to submit"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Receipt Information"}),e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Complainant Details"}),e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Complaint Details"}),e.jsx("div",{className:"flex-1 h-1 bg-brand rounded-full",title:"Policy Information"})]}),e.jsxs("div",{className:"flex justify-between text-xs text-text-muted mt-2",children:[e.jsx("span",{children:"Receipt"}),e.jsx("span",{children:"Complainant"}),e.jsx("span",{children:"Complaint"}),e.jsx("span",{children:"Policy"})]})]}),e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Receipt Information"})}),e.jsx(ce,{children:e.jsx("div",{className:"space-y-4 mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"source",className:"block text-xs font-medium text-text-primary",children:"Source *"}),e.jsxs("select",{id:"source",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:j.source,onChange:F=>C("source",F.target.value),required:!0,children:[e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"Phone",children:"Phone"}),e.jsx("option",{value:"Letter",children:"Letter"}),e.jsx("option",{value:"Web Form",children:"Web Form"}),e.jsx("option",{value:"In Person",children:"In Person"}),e.jsx("option",{value:"Social Media",children:"Social Media"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"received_at",className:"block text-xs font-medium text-text-primary",children:"Date Received *"}),e.jsx("button",{type:"button",onClick:k,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Set to Now"})]}),e.jsx(ne,{id:"received_at",type:"datetime-local",value:j.received_at,onChange:F=>C("received_at",F.target.value),required:!0})]})]})})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Complainant Details"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_name",className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(ne,{id:"complainant_name",value:j.complainant_name,onChange:F=>C("complainant_name",F.target.value),placeholder:"John Doe",required:!0,className:u.complainant_name?"border-semantic-error":""}),u.complainant_name&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.complainant_name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_email",className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(ne,{id:"complainant_email",type:"email",value:j.complainant_email,onChange:F=>C("complainant_email",F.target.value),placeholder:"john@example.com",className:u.complainant_email?"border-semantic-error":""}),u.complainant_email&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.complainant_email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_phone",className:"block text-xs font-medium text-text-primary",children:"Phone"}),e.jsx(ne,{id:"complainant_phone",value:j.complainant_phone,onChange:F=>C("complainant_phone",F.target.value),placeholder:"+44 20 1234 5678"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"complainant_dob",className:"block text-xs font-medium text-text-primary",children:["Date of Birth",e.jsx("span",{className:"text-text-muted font-normal ml-1",children:"(for verification)"})]}),e.jsx(ne,{id:"complainant_dob",type:"date",value:j.complainant_dob,onChange:F=>C("complainant_dob",F.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"complainant_address",className:"block text-xs font-medium text-text-primary",children:"Address"}),e.jsx(ne,{id:"complainant_address",value:j.complainant_address,onChange:F=>C("complainant_address",F.target.value),placeholder:"Full address..."})]})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{id:"vulnerability_flag",type:"checkbox",checked:j.vulnerability_flag,onChange:()=>C("vulnerability_flag",!j.vulnerability_flag),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Vulnerable Customer"})]}),j.vulnerability_flag&&e.jsxs("div",{className:"pl-7 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"vulnerability_notes",className:"block text-xs font-medium text-text-primary",children:"Vulnerability Notes"}),se(j.vulnerability_notes,500)]}),e.jsx("textarea",{id:"vulnerability_notes",className:"w-full min-h-[80px] rounded-lg border border-border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:j.vulnerability_notes,onChange:F=>C("vulnerability_notes",F.target.value),placeholder:"Details about vulnerability...",maxLength:500})]})]})})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Complaint Details"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{htmlFor:"description",className:"block text-xs font-medium text-text-primary",children:"Description *"}),se(j.description,2e3)]}),e.jsx("textarea",{id:"description",className:`w-full min-h-[120px] rounded-lg border bg-surface px-3 py-2 text-sm text-text-primary placeholder:text-text-muted outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${u.description?"border-semantic-error":"border-border"}`,value:j.description,onChange:F=>C("description",F.target.value),placeholder:"Detailed description of the complaint...",maxLength:2e3,required:!0}),u.description&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"category",className:"block text-xs font-medium text-text-primary",children:"Category *"}),e.jsxs("select",{id:"category",className:`w-full h-10 rounded-lg border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15 ${u.category?"border-semantic-error":"border-border"}`,value:j.category,onChange:F=>C("category",F.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select category..."}),e.jsx("option",{value:"Claims",children:"Claims"}),e.jsx("option",{value:"Policy",children:"Policy"}),e.jsx("option",{value:"Service",children:"Service"}),e.jsx("option",{value:"Premium",children:"Premium"}),e.jsx("option",{value:"Communication",children:"Communication"}),e.jsx("option",{value:"Sales",children:"Sales"}),e.jsx("option",{value:"Other",children:"Other"})]}),u.category&&e.jsx("p",{className:"text-xs text-semantic-error",children:u.category})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"reason",className:"block text-xs font-medium text-text-primary",children:["Reason",e.jsx("span",{className:"text-text-muted font-normal ml-1",children:"(optional)"})]}),e.jsx(ne,{id:"reason",value:j.reason,onChange:F=>C("reason",F.target.value),placeholder:"Specific reason..."})]})]})]})})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Policy Information"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"policy_number",className:"block text-xs font-medium text-text-primary",children:["Policy Number",e.jsx("span",{className:"text-text-muted font-normal ml-1",children:"(if known)"})]}),e.jsx(ne,{id:"policy_number",value:j.policy_number,onChange:F=>C("policy_number",F.target.value),placeholder:"POL-12345"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"product",className:"block text-xs font-medium text-text-primary",children:"Product"}),e.jsx(Wt,{value:j.product,onChange:F=>C("product",F),options:m,placeholder:"Select or type product..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"insurer",className:"block text-xs font-medium text-text-primary",children:"Insurer"}),e.jsx(Wt,{value:j.insurer,onChange:F=>C("insurer",F),options:v,placeholder:"Select or type insurer..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"broker",className:"block text-xs font-medium text-text-primary",children:"Broker"}),e.jsx(Wt,{value:j.broker,onChange:F=>C("broker",F),options:y,placeholder:"Select or type broker..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"scheme",className:"block text-xs font-medium text-text-primary",children:"Scheme"}),e.jsx(ne,{id:"scheme",value:j.scheme,onChange:F=>C("scheme",F.target.value),placeholder:"Scheme name..."})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 sticky bottom-6 bg-app/95 backdrop-blur-sm p-4 rounded-lg border border-border shadow-lg",children:[e.jsx(O,{variant:"secondary",onClick:D,type:"button",children:"Cancel"}),e.jsx(O,{id:"submit-btn",variant:"primary",type:"submit",disabled:s,children:s?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Complaint"})]})]})]}),e.jsxs(fe,{open:i,onClose:()=>c(!1),children:[e.jsx(pe,{onClose:()=>c(!1),children:"Discard changes?"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"You have unsaved changes. If you leave now, they will be lost."}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"This complaint has not been created yet."})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>c(!1),children:"Stay here"}),e.jsx(O,{variant:"primary",onClick:()=>{c(!1),t("/complaints")},children:"Discard & Exit"})]})]})]})}var vr={exports:{}};(function(t,s){(function(n,r){t.exports=r()})(qs,function(){return function(n,r,a){n=n||{};var o=r.prototype,d={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function u(i,c,m,h){return o.fromToBase(i,c,m,h)}a.en.relativeTime=d,o.fromToBase=function(i,c,m,h,v){for(var x,y,p,j=m.$locale().relativeTime||d,R=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],N=R.length,C=0;C<N;C+=1){var D=R[C];D.d&&(x=h?a(i).diff(m,D.d,!0):m.diff(i,D.d,!0));var k=(n.rounding||Math.round)(Math.abs(x));if(p=x>0,k<=D.r||!D.r){k<=1&&C>0&&(D=R[C-1]);var Y=j[D.l];v&&(k=v(""+k)),y=typeof Y=="string"?Y.replace("%d",k):Y(k,c,D.l,p);break}}if(c)return y;var se=p?j.future:j.past;return typeof se=="function"?se(y):se.replace("%s",y)},o.to=function(i,c){return u(i,c,this,!0)},o.from=function(i,c){return u(i,c,this)};var l=function(i){return i.$u?a.utc():a()};o.toNow=function(i){return this.to(l(this),i)},o.fromNow=function(i){return this.from(l(this),i)}}})})(vr);var Ja=vr.exports;const Ka=Vs(Ja);z.extend(Ka);function Qa(){var v;const t=Ke(),{user:s}=He(),[n,r]=f.useState(!0),[a,o]=f.useState(null),[d,u]=f.useState([]);f.useEffect(()=>{l()},[]);const l=()=>Q(this,null,function*(){if(s!=null&&s.id){r(!0),o(null);try{const y=(yield J.get("/complaints",{params:{handler_id:s.id,page:1,page_size:100,_:Date.now()}})).data.filter(k=>k.status!=="Closed"),p=y.filter(k=>(k.status==="New"||k.status==="Reopened")&&!k.acknowledged_at&&k.ack_due_at&&z(k.ack_due_at).isAfter(z())),j=y.filter(k=>(k.status==="New"||k.status==="Reopened")&&!k.acknowledged_at&&k.ack_due_at&&z(k.ack_due_at).isBefore(z())),R=y.filter(k=>k.status==="In Investigation"||k.status==="Acknowledged"),N=y.filter(k=>k.status==="Response Drafted"&&!k.final_response_at&&k.final_due_at&&z(k.final_due_at).isAfter(z())),C=y.filter(k=>(k.status==="Response Drafted"||k.status==="In Investigation"||k.status==="Acknowledged")&&!k.final_response_at&&k.final_due_at&&z(k.final_due_at).isBefore(z())),D=[];j.length>0&&D.push({title:"Acknowledgements Overdue",description:"These complaints need acknowledgement urgently",icon:"",colorClass:"semantic-error",bgColorClass:"bg-semantic-error/10",textColorClass:"text-semantic-error",complaints:j.sort((k,Y)=>z(k.ack_due_at).valueOf()-z(Y.ack_due_at).valueOf())}),p.length>0&&D.push({title:"Acknowledgements Due",description:"These complaints need acknowledgement soon",icon:"",colorClass:"semantic-warning",bgColorClass:"bg-semantic-warning/10",textColorClass:"text-semantic-warning",complaints:p.sort((k,Y)=>z(k.ack_due_at).valueOf()-z(Y.ack_due_at).valueOf())}),C.length>0&&D.push({title:"Final Responses Overdue",description:"These complaints need final response urgently",icon:"",colorClass:"semantic-error",bgColorClass:"bg-semantic-error/10",textColorClass:"text-semantic-error",complaints:C.sort((k,Y)=>z(k.final_due_at).valueOf()-z(Y.final_due_at).valueOf())}),N.length>0&&D.push({title:"Final Responses Due",description:"These complaints are ready for final response",icon:"",colorClass:"semantic-info",bgColorClass:"bg-semantic-info/10",textColorClass:"text-semantic-info",complaints:N.sort((k,Y)=>z(k.final_due_at).valueOf()-z(Y.final_due_at).valueOf())}),R.length>0&&D.push({title:"In Investigation",description:"These complaints are actively being worked on",icon:"",colorClass:"brand",bgColorClass:"bg-brand/10",textColorClass:"text-brand",complaints:R.sort((k,Y)=>z(k.received_at).valueOf()-z(Y.received_at).valueOf())}),u(D)}catch(x){console.error("Failed to load tasks",x),o("Failed to load your tasks. Please try again.")}finally{r(!1)}}}),i=x=>{if(!x)return"";const y=z(),p=z(x);return p.isBefore(y)?`${z().to(p)} overdue`:`due ${z().to(p)}`},c=(x,y)=>Q(this,null,function*(){y.stopPropagation();try{o(null),yield J.post(`/complaints/${x}/acknowledge`),l()}catch(p){console.error("Failed to acknowledge",p),o("Failed to acknowledge complaint. Please try again.")}}),m=()=>d.reduce((x,y)=>x+y.complaints.length,0),h=()=>d.filter(x=>x.title.includes("Overdue")).reduce((x,y)=>x+y.complaints.length,0);return n?e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"My Tasks",actions:e.jsxs(O,{variant:"secondary",onClick:l,disabled:n,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading your tasks..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"My Tasks",actions:e.jsxs(O,{variant:"secondary",onClick:l,disabled:n,children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),n?"Refreshing...":"Refresh"]})}),e.jsxs("div",{className:"px-10 py-6",children:[a&&e.jsxs("div",{className:"mb-6 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-semantic-error",children:a}),e.jsx(O,{variant:"secondary",onClick:l,children:"Retry"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Your Work List"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:m()===0?"You're all caught up!":`You have ${m()} ${m()===1?"task":"tasks"} requiring attention`})]})}),m()>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"rounded-lg border border-border bg-app p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary",children:"Total Tasks"}),e.jsx("div",{className:"text-2xl font-bold text-text-primary mt-1",children:m()})]}),e.jsx("div",{className:"text-3xl",children:""})]})}),e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-semantic-error",children:"Urgent (Overdue)"}),e.jsx("div",{className:"text-2xl font-bold text-semantic-error mt-1",children:h()})]}),e.jsx("div",{className:"text-3xl",children:""})]})}),e.jsx("div",{className:"rounded-lg border border-border bg-app p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-text-secondary",children:"In Progress"}),e.jsx("div",{className:"text-2xl font-bold text-text-primary mt-1",children:((v=d.find(x=>x.title==="In Investigation"))==null?void 0:v.complaints.length)||0})]}),e.jsx("div",{className:"text-3xl",children:""})]})})]})]}),d.length===0?e.jsx(ie,{children:e.jsx(ce,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-16 w-16 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"mt-4 text-lg font-semibold text-text-primary",children:"All caught up!"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:"You don't have any tasks requiring immediate attention."})]})})}):e.jsx("div",{className:"space-y-6",children:d.map((x,y)=>e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:x.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx(me,{children:x.title}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:x.description})]}),e.jsx("span",{className:`inline-flex items-center justify-center h-8 min-w-8 rounded-full ${x.bgColorClass} ${x.textColorClass} px-2 text-sm font-bold`,children:x.complaints.length})]})}),e.jsx(ce,{children:e.jsx("div",{className:"space-y-3 mt-4",children:x.complaints.map(p=>{var D;const j=x.title.includes("Acknowledgement"),R=x.title.includes("Final Response"),N=j?p.ack_due_at:R?p.final_due_at:null,C=N?z(N).isBefore(z()):!1;return e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4 rounded-lg border border-border hover:bg-surface transition cursor-pointer",onClick:()=>t(`/complaints/${p.id}`),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-text-primary",children:p.reference}),e.jsx(wt,{status:p.status}),p.vulnerability_flag&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-semantic-warning/10 text-semantic-warning",children:" Vulnerable"})]}),e.jsx("p",{className:"text-sm text-text-secondary truncate mb-2",children:p.description||"No description"}),e.jsxs("div",{className:"flex items-center gap-4 text-xs flex-wrap",children:[((D=p.complainant)==null?void 0:D.full_name)&&e.jsxs("span",{className:"text-text-muted",children:[" ",p.complainant.full_name]}),e.jsxs("span",{className:"text-text-muted",children:[" Received ",z(p.received_at).format("MMM D, YYYY")]}),N&&e.jsxs("span",{className:`font-semibold ${C?"text-semantic-error":"text-semantic-warning"}`,children:[" ",j?"Ack":"Final"," ",i(N)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&!p.acknowledged_at&&e.jsx(O,{variant:"secondary",size:"sm",onClick:k=>c(p.id,k),children:"Acknowledge"}),e.jsx(O,{variant:"primary",size:"sm",onClick:k=>{k.stopPropagation(),t(`/complaints/${p.id}`)},children:"View"})]})]},p.id)})})})]},y))})]})]})}function Xa(){const[t,s]=f.useState([]),[n,r]=f.useState(!0),[a,o]=f.useState(!1),[d,u]=f.useState(!1),[l,i]=f.useState(!1),[c,m]=f.useState(!1),[h,v]=f.useState(null),[x,y]=f.useState(null),[p,j]=f.useState(null),[R,N]=f.useState(null),[C,D]=f.useState(!1),[k,Y]=f.useState(!1),[se,F]=f.useState(!1),[B,I]=f.useState(null),[T,W]=f.useState({email:"",full_name:"",role:"complaints_handler",password:"",is_active:!0});f.useEffect(()=>{P()},[]);const P=()=>Q(this,null,function*(){r(!0);try{const M=yield J.get("/users");s(M.data)}catch(M){console.error("Failed to load users",M)}finally{r(!1)}}),L=()=>Q(this,null,function*(){var M,te;if(!T.email||!T.full_name||!T.password){N("Please fill in all required fields");return}D(!0),N(null);try{yield J.post("/users",T),o(!1),$(),P()}catch(le){N(((te=(M=le==null?void 0:le.response)==null?void 0:M.data)==null?void 0:te.detail)||"Failed to create user")}finally{D(!1)}}),w=()=>Q(this,null,function*(){var M,te;if(!h||!T.email||!T.full_name){N("Please fill in all required fields");return}D(!0),N(null);try{yield J.patch(`/users/${h.id}`,ee({email:T.email,full_name:T.full_name,role:T.role,is_active:T.is_active},T.password?{password:T.password}:{})),u(!1),v(null),$(),P()}catch(le){N(((te=(M=le==null?void 0:le.response)==null?void 0:M.data)==null?void 0:te.detail)||"Failed to update user")}finally{D(!1)}}),_=()=>Q(this,null,function*(){var M,te;if(h){D(!0),N(null);try{const le=yield J.post(`/users/${h.id}/reset-password`);y(le.data.temporary_password),P()}catch(le){N(((te=(M=le==null?void 0:le.response)==null?void 0:M.data)==null?void 0:te.detail)||"Failed to reset password")}finally{D(!1)}}}),E=()=>{$(),o(!0)},A=M=>{v(M),W({email:M.email,full_name:M.full_name,role:M.role,password:"",is_active:M.is_active}),N(null),u(!0)},U=M=>{v(M),y(null),N(null),i(!0)},S=M=>Q(this,null,function*(){var te,le;Y(!0),N(null);try{yield J.post(`/auth/mfa/reset/${M.id}`),P()}catch(he){N(((le=(te=he==null?void 0:he.response)==null?void 0:te.data)==null?void 0:le.detail)||"Failed to reset MFA")}finally{Y(!1)}}),q=M=>{I(M),F(!0)},V=M=>Q(this,null,function*(){var te,le;Y(!0),N(null),v(M);try{const he=yield J.post(`/auth/mfa/recovery/${M.id}/regenerate`);j(he.data.recovery_codes||[]),m(!0)}catch(he){N(((le=(te=he==null?void 0:he.response)==null?void 0:te.data)==null?void 0:le.detail)||"Failed to regenerate recovery codes")}finally{Y(!1)}}),$=()=>{W({email:"",full_name:"",role:"complaints_handler",password:"",is_active:!0}),N(null)},G=M=>M==="admin"?"bg-semantic-error/10 text-semantic-error":M==="complaints_manager"?"bg-semantic-warning/10 text-semantic-warning":M==="reviewer"?"bg-semantic-info/10 text-semantic-info":M==="complaints_handler"?"bg-semantic-success/10 text-semantic-success":"bg-app text-text-muted border border-border";return n?e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"User Management"}),e.jsx("div",{className:"px-10 py-6",children:e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading users..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"User Management",actions:e.jsxs(O,{variant:"primary",onClick:E,children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Create User"]})}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs(me,{children:["Users (",t.length,")"]})}),e.jsx(ce,{children:e.jsxs("div",{className:"mt-4",children:[e.jsxs(yr,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"MFA"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(M=>e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold",children:M.full_name}),e.jsx("td",{className:"text-text-secondary",children:M.email}),e.jsx("td",{children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium capitalize ${G(M.role)}`,children:M.role.replace(/_/g," ")})}),e.jsx("td",{children:M.is_active?e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-semantic-success/10 text-semantic-success",children:"Active"}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-app text-text-muted border border-border",children:"Inactive"})}),e.jsx("td",{children:M.mfa_enabled?e.jsx("span",{className:"text-semantic-success",children:" Enabled"}):e.jsx("span",{className:"text-text-muted",children:"Disabled"})}),e.jsx("td",{className:"text-text-secondary text-sm",children:z(M.created_at).format("MMM D, YYYY")}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(M),className:"text-brand hover:text-brand-dark text-sm font-medium",children:"Edit"}),e.jsx("button",{onClick:()=>U(M),className:"text-semantic-warning hover:opacity-80 text-sm font-medium",children:"Reset Password"}),e.jsx("button",{onClick:()=>q(M),className:"text-semantic-error hover:opacity-80 text-sm font-medium disabled:opacity-50",disabled:k,children:"Reset MFA"}),e.jsx("button",{onClick:()=>V(M),className:"text-text-secondary hover:text-text-primary text-sm font-medium disabled:opacity-50",disabled:k,children:"Recovery Codes"})]})})]},M.id))})]}),t.length===0&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-sm text-text-secondary",children:"No users found"})})]})})]})}),e.jsxs(fe,{open:a,onClose:()=>o(!1),children:[e.jsx(pe,{onClose:()=>o(!1),children:"Create New User"}),e.jsxs(be,{children:[R&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:R}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(ne,{type:"text",value:T.full_name,onChange:M=>W(oe(ee({},T),{full_name:M.target.value})),placeholder:"John Doe"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email *"}),e.jsx(ne,{type:"email",value:T.email,onChange:M=>W(oe(ee({},T),{email:M.target.value})),placeholder:"john.doe@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"create-role",className:"block text-xs font-medium text-text-primary",children:"Role *"}),e.jsxs("select",{id:"create-role",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:T.role,onChange:M=>W(oe(ee({},T),{role:M.target.value})),children:[e.jsx("option",{value:"complaints_handler",children:"Complaints Handler"}),e.jsx("option",{value:"complaints_manager",children:"Complaints Manager"}),e.jsx("option",{value:"reviewer",children:"Reviewer"}),e.jsx("option",{value:"read_only",children:"Read Only"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"create-password",className:"block text-xs font-medium text-text-primary",children:"Initial Password *"}),e.jsx(ne,{id:"create-password",type:"password",value:T.password,onChange:M=>W(oe(ee({},T),{password:M.target.value})),placeholder:""}),e.jsx("p",{className:"text-xs text-text-muted",children:"User will be required to change this on first login"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.is_active,onChange:()=>W(oe(ee({},T),{is_active:!T.is_active})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Active"})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>o(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:L,disabled:C,children:C?"Creating...":"Create User"})]})]}),e.jsxs(fe,{open:d,onClose:()=>u(!1),children:[e.jsx(pe,{onClose:()=>u(!1),children:"Edit User"}),e.jsxs(be,{children:[R&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:R}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Full Name *"}),e.jsx(ne,{type:"text",value:T.full_name,onChange:M=>W(oe(ee({},T),{full_name:M.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email *"}),e.jsx(ne,{type:"email",value:T.email,onChange:M=>W(oe(ee({},T),{email:M.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-role",className:"block text-xs font-medium text-text-primary",children:"Role *"}),e.jsxs("select",{id:"edit-role",className:"w-full h-10 rounded-lg border border-border bg-surface px-3 text-sm text-text-primary outline-none transition focus:border-brand focus:ring-2 focus:ring-brand/15",value:T.role,onChange:M=>W(oe(ee({},T),{role:M.target.value})),children:[e.jsx("option",{value:"complaints_handler",children:"Complaints Handler"}),e.jsx("option",{value:"complaints_manager",children:"Complaints Manager"}),e.jsx("option",{value:"reviewer",children:"Reviewer"}),e.jsx("option",{value:"read_only",children:"Read Only"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-password",className:"block text-xs font-medium text-text-primary",children:"New Password"}),e.jsx(ne,{id:"edit-password",type:"password",value:T.password,onChange:M=>W(oe(ee({},T),{password:M.target.value})),placeholder:"Leave blank to keep current password"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T.is_active,onChange:()=>W(oe(ee({},T),{is_active:!T.is_active})),className:"h-4 w-4 rounded border-border text-brand focus:ring-2 focus:ring-brand/15"}),e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Active"})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:w,disabled:C,children:C?"Saving...":"Save Changes"})]})]}),e.jsxs(fe,{open:c,onClose:()=>m(!1),children:[e.jsx(pe,{onClose:()=>m(!1),children:"Recovery Codes"}),e.jsxs(be,{children:[R&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:R}),p&&p.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["Provide these codes to ",e.jsx("strong",{className:"text-text-primary",children:h==null?void 0:h.full_name}),". Each code can be used once."]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.map(M=>e.jsx("code",{className:"text-sm font-mono bg-app border border-border rounded px-2 py-2 text-text-primary text-center",children:M},M))}),e.jsx("p",{className:"text-xs text-text-muted",children:"Users should store these codes securely. They can be used if the authenticator device is unavailable."})]}):e.jsx("p",{className:"text-sm text-text-secondary",children:"No recovery codes generated."})]}),e.jsx(ge,{children:e.jsx(O,{variant:"primary",onClick:()=>m(!1),children:"Close"})})]}),e.jsxs(fe,{open:se,onClose:()=>F(!1),children:[e.jsx(pe,{onClose:()=>F(!1),children:"Reset MFA"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Resetting MFA will disable MFA for this user and require re-enrollment."}),e.jsxs("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:["User: ",e.jsx("strong",{className:"text-text-primary",children:B==null?void 0:B.full_name})]})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>F(!1),disabled:k,children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:()=>Q(this,null,function*(){B&&(F(!1),yield S(B))}),disabled:!B||k,children:k?"Resetting...":"Confirm Reset"})]})]}),e.jsxs(fe,{open:l,onClose:()=>i(!1),children:[e.jsx(pe,{onClose:()=>i(!1),children:"Reset Password"}),e.jsxs(be,{children:[R&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:R}),x?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-semantic-success mb-2",children:"Password reset successful!"}),e.jsxs("p",{className:"text-sm text-text-secondary mb-3",children:["Please provide this temporary password to ",e.jsx("strong",{children:h==null?void 0:h.full_name}),":"]}),e.jsx("div",{className:"rounded-lg bg-app border border-border p-3",children:e.jsx("code",{className:"text-lg font-mono font-bold text-text-primary",children:x})}),e.jsx("p",{className:"text-xs text-text-muted mt-3",children:"The user will be required to change this password on their next login."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-text-secondary",children:["Are you sure you want to reset the password for ",e.jsx("strong",{className:"text-text-primary",children:h==null?void 0:h.full_name}),"?"]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"A temporary password will be generated that you can provide to the user. They will be required to change it on their next login."})]})]}),e.jsx(ge,{children:x?e.jsx(O,{variant:"primary",onClick:()=>i(!1),children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"secondary",onClick:()=>i(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:_,disabled:C,children:C?"Resetting...":"Reset Password"})]})})]})]})}function Ga(){const{user:t}=He(),s=(t==null?void 0:t.role)==="admin",[n,r]=f.useState("products"),[a,o]=f.useState([]),[d,u]=f.useState(!0),[l,i]=f.useState(""),[c,m]=f.useState(!1),[h,v]=f.useState(""),[x,y]=f.useState(!1),[p,j]=f.useState(null),[R,N]=f.useState(!1),[C,D]=f.useState(null),[k,Y]=f.useState(!1),[se,F]=f.useState(null),[B,I]=f.useState(null);f.useEffect(()=>{T()},[n]);const T=()=>Q(this,null,function*(){u(!0);try{const _=yield J.get(`/reference/${n}`);o(_.data||[])}catch(_){console.error("Failed to load reference items",_)}finally{u(!1)}}),W=()=>Q(this,null,function*(){var _,E;if(h.trim()){y(!0),j(null);try{yield J.post(`/reference/${n}`,{name:h.trim()}),v(""),m(!1),T()}catch(A){j(((E=(_=A==null?void 0:A.response)==null?void 0:_.data)==null?void 0:E.detail)||"Failed to create item")}finally{y(!1)}}}),P=()=>Q(this,null,function*(){var _,E;if(C){Y(!0),F(null),I(null);try{const A=new FormData;A.append("file",C);const U=yield J.post(`/reference/${n}/import`,A,{headers:{"Content-Type":"multipart/form-data"}});I(`Successfully imported ${U.data.added} items`),D(null),T(),setTimeout(()=>N(!1),2e3)}catch(A){F(((E=(_=A==null?void 0:A.response)==null?void 0:_.data)==null?void 0:E.detail)||"Failed to import file")}finally{Y(!1)}}}),L=a.filter(_=>_.name.toLowerCase().includes(l.toLowerCase())),w=_=>{switch(_){case"products":return"Products";case"brokers":return"Brokers";case"insurers":return"Insurers"}};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"Reference Data Management"}),e.jsx("div",{className:"px-10 py-6",children:e.jsxs(ie,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(me,{children:"Reference Lists"}),s&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"secondary",size:"sm",onClick:()=>N(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Import CSV"]}),e.jsxs(O,{variant:"primary",size:"sm",onClick:()=>m(!0),children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add New"]})]})]})}),e.jsx("div",{className:"border-b border-border",children:e.jsx("div",{className:"flex gap-1 px-4",children:["products","brokers","insurers"].map(_=>e.jsxs("button",{onClick:()=>r(_),className:`px-4 py-3 text-sm font-medium capitalize transition border-b-2 ${n===_?"border-brand text-text-primary":"border-transparent text-text-secondary hover:text-text-primary"}`,children:[w(_),e.jsx("span",{className:"ml-2 inline-flex items-center justify-center h-5 min-w-5 px-1 rounded-full bg-app text-[11px] font-semibold text-text-secondary border border-border",children:_===n?L.length:a.length})]},_))})}),e.jsxs(ce,{children:[e.jsx("div",{className:"mt-4 mb-6",children:e.jsx(ne,{type:"search",placeholder:`Search ${w(n).toLowerCase()}...`,value:l,onChange:_=>i(_.target.value),leadingIcon:e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),d?e.jsx("div",{className:"text-center py-12 text-text-muted",children:"Loading..."}):L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"mt-4 text-sm font-semibold text-text-primary",children:l?"No items match your search":`No ${w(n).toLowerCase()} yet`}),!l&&s&&e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:'Click "Add New" to create your first entry'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:L.map(_=>e.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg border border-border bg-surface hover:bg-app transition",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-text-primary truncate",children:_.name}),e.jsxs("div",{className:"text-xs text-text-muted",children:["ID: ",_.id.substring(0,8),"..."]})]})},_.id))})]})]})}),e.jsxs(fe,{open:c,onClose:()=>m(!1),children:[e.jsxs(pe,{onClose:()=>m(!1),children:["Add New ",w(n).slice(0,-1)]}),e.jsxs(be,{children:[p&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:p}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Name *"}),e.jsx(ne,{value:h,onChange:_=>v(_.target.value),placeholder:`Enter ${w(n).slice(0,-1).toLowerCase()} name...`,autoFocus:!0,onKeyDown:_=>{_.key==="Enter"&&h.trim()&&W()}})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>m(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:W,disabled:!h.trim()||x,children:x?"Creating...":"Create"})]})]}),e.jsxs(fe,{open:R,onClose:()=>N(!1),children:[e.jsxs(pe,{onClose:()=>N(!1),children:["Import ",w(n)," from CSV"]}),e.jsxs(be,{children:[se&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:se}),B&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-3 text-sm text-semantic-success",children:B}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:'Upload a CSV file with a "name" column. Duplicate names will be skipped.'}),e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-border p-6 text-center",children:[e.jsx("input",{type:"file",accept:".csv",onChange:_=>{var E;return D(((E=_.target.files)==null?void 0:E[0])||null)},className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-text-muted",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("p",{className:"mt-2 text-sm font-medium text-text-primary",children:"Click to select CSV file"}),e.jsx("p",{className:"mt-1 text-xs text-text-muted",children:"or drag and drop"})]})]}),C&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-sm text-text-primary",children:[e.jsx("svg",{className:"h-5 w-5 text-semantic-success",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),C.name]})]}),e.jsxs("div",{className:"rounded-lg bg-app p-3 text-xs text-text-secondary",children:[e.jsx("p",{className:"font-semibold text-text-primary mb-1",children:"CSV Format Example:"}),e.jsxs("code",{className:"block bg-surface p-2 rounded border border-border font-mono",children:["name",e.jsx("br",{}),"Product A",e.jsx("br",{}),"Product B",e.jsx("br",{}),"Product C"]})]})]})]}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:P,disabled:!C||k,children:k?"Importing...":"Import"})]})]})]})}var Za=Object.defineProperty,Ct=Object.getOwnPropertySymbols,Nr=Object.prototype.hasOwnProperty,wr=Object.prototype.propertyIsEnumerable,Ys=(t,s,n)=>s in t?Za(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,ei=(t,s)=>{for(var n in s||(s={}))Nr.call(s,n)&&Ys(t,n,s[n]);if(Ct)for(var n of Ct(s))wr.call(s,n)&&Ys(t,n,s[n]);return t},ti=(t,s)=>{var n={};for(var r in t)Nr.call(t,r)&&s.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Ct)for(var r of Ct(t))s.indexOf(r)<0&&wr.call(t,r)&&(n[r]=t[r]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var ze;(t=>{const s=class{constructor(l,i,c,m){if(this.version=l,this.errorCorrectionLevel=i,this.modules=[],this.isFunction=[],l<s.MIN_VERSION||l>s.MAX_VERSION)throw new RangeError("Version value out of range");if(m<-1||m>7)throw new RangeError("Mask value out of range");this.size=l*4+17;let h=[];for(let x=0;x<this.size;x++)h.push(!1);for(let x=0;x<this.size;x++)this.modules.push(h.slice()),this.isFunction.push(h.slice());this.drawFunctionPatterns();const v=this.addEccAndInterleave(c);if(this.drawCodewords(v),m==-1){let x=1e9;for(let y=0;y<8;y++){this.applyMask(y),this.drawFormatBits(y);const p=this.getPenaltyScore();p<x&&(m=y,x=p),this.applyMask(y)}}o(0<=m&&m<=7),this.mask=m,this.applyMask(m),this.drawFormatBits(m),this.isFunction=[]}static encodeText(l,i){const c=t.QrSegment.makeSegments(l);return s.encodeSegments(c,i)}static encodeBinary(l,i){const c=t.QrSegment.makeBytes(l);return s.encodeSegments([c],i)}static encodeSegments(l,i,c=1,m=40,h=-1,v=!0){if(!(s.MIN_VERSION<=c&&c<=m&&m<=s.MAX_VERSION)||h<-1||h>7)throw new RangeError("Invalid value");let x,y;for(x=c;;x++){const N=s.getNumDataCodewords(x,i)*8,C=u.getTotalBits(l,x);if(C<=N){y=C;break}if(x>=m)throw new RangeError("Data too long")}for(const N of[s.Ecc.MEDIUM,s.Ecc.QUARTILE,s.Ecc.HIGH])v&&y<=s.getNumDataCodewords(x,N)*8&&(i=N);let p=[];for(const N of l){r(N.mode.modeBits,4,p),r(N.numChars,N.mode.numCharCountBits(x),p);for(const C of N.getData())p.push(C)}o(p.length==y);const j=s.getNumDataCodewords(x,i)*8;o(p.length<=j),r(0,Math.min(4,j-p.length),p),r(0,(8-p.length%8)%8,p),o(p.length%8==0);for(let N=236;p.length<j;N^=253)r(N,8,p);let R=[];for(;R.length*8<p.length;)R.push(0);return p.forEach((N,C)=>R[C>>>3]|=N<<7-(C&7)),new s(x,i,R,h)}getModule(l,i){return 0<=l&&l<this.size&&0<=i&&i<this.size&&this.modules[i][l]}getModules(){return this.modules}drawFunctionPatterns(){for(let c=0;c<this.size;c++)this.setFunctionModule(6,c,c%2==0),this.setFunctionModule(c,6,c%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const l=this.getAlignmentPatternPositions(),i=l.length;for(let c=0;c<i;c++)for(let m=0;m<i;m++)c==0&&m==0||c==0&&m==i-1||c==i-1&&m==0||this.drawAlignmentPattern(l[c],l[m]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(l){const i=this.errorCorrectionLevel.formatBits<<3|l;let c=i;for(let h=0;h<10;h++)c=c<<1^(c>>>9)*1335;const m=(i<<10|c)^21522;o(m>>>15==0);for(let h=0;h<=5;h++)this.setFunctionModule(8,h,a(m,h));this.setFunctionModule(8,7,a(m,6)),this.setFunctionModule(8,8,a(m,7)),this.setFunctionModule(7,8,a(m,8));for(let h=9;h<15;h++)this.setFunctionModule(14-h,8,a(m,h));for(let h=0;h<8;h++)this.setFunctionModule(this.size-1-h,8,a(m,h));for(let h=8;h<15;h++)this.setFunctionModule(8,this.size-15+h,a(m,h));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let l=this.version;for(let c=0;c<12;c++)l=l<<1^(l>>>11)*7973;const i=this.version<<12|l;o(i>>>18==0);for(let c=0;c<18;c++){const m=a(i,c),h=this.size-11+c%3,v=Math.floor(c/3);this.setFunctionModule(h,v,m),this.setFunctionModule(v,h,m)}}drawFinderPattern(l,i){for(let c=-4;c<=4;c++)for(let m=-4;m<=4;m++){const h=Math.max(Math.abs(m),Math.abs(c)),v=l+m,x=i+c;0<=v&&v<this.size&&0<=x&&x<this.size&&this.setFunctionModule(v,x,h!=2&&h!=4)}}drawAlignmentPattern(l,i){for(let c=-2;c<=2;c++)for(let m=-2;m<=2;m++)this.setFunctionModule(l+m,i+c,Math.max(Math.abs(m),Math.abs(c))!=1)}setFunctionModule(l,i,c){this.modules[i][l]=c,this.isFunction[i][l]=!0}addEccAndInterleave(l){const i=this.version,c=this.errorCorrectionLevel;if(l.length!=s.getNumDataCodewords(i,c))throw new RangeError("Invalid argument");const m=s.NUM_ERROR_CORRECTION_BLOCKS[c.ordinal][i],h=s.ECC_CODEWORDS_PER_BLOCK[c.ordinal][i],v=Math.floor(s.getNumRawDataModules(i)/8),x=m-v%m,y=Math.floor(v/m);let p=[];const j=s.reedSolomonComputeDivisor(h);for(let N=0,C=0;N<m;N++){let D=l.slice(C,C+y-h+(N<x?0:1));C+=D.length;const k=s.reedSolomonComputeRemainder(D,j);N<x&&D.push(0),p.push(D.concat(k))}let R=[];for(let N=0;N<p[0].length;N++)p.forEach((C,D)=>{(N!=y-h||D>=x)&&R.push(C[N])});return o(R.length==v),R}drawCodewords(l){if(l.length!=Math.floor(s.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let i=0;for(let c=this.size-1;c>=1;c-=2){c==6&&(c=5);for(let m=0;m<this.size;m++)for(let h=0;h<2;h++){const v=c-h,y=(c+1&2)==0?this.size-1-m:m;!this.isFunction[y][v]&&i<l.length*8&&(this.modules[y][v]=a(l[i>>>3],7-(i&7)),i++)}}o(i==l.length*8)}applyMask(l){if(l<0||l>7)throw new RangeError("Mask value out of range");for(let i=0;i<this.size;i++)for(let c=0;c<this.size;c++){let m;switch(l){case 0:m=(c+i)%2==0;break;case 1:m=i%2==0;break;case 2:m=c%3==0;break;case 3:m=(c+i)%3==0;break;case 4:m=(Math.floor(c/3)+Math.floor(i/2))%2==0;break;case 5:m=c*i%2+c*i%3==0;break;case 6:m=(c*i%2+c*i%3)%2==0;break;case 7:m=((c+i)%2+c*i%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[i][c]&&m&&(this.modules[i][c]=!this.modules[i][c])}}getPenaltyScore(){let l=0;for(let h=0;h<this.size;h++){let v=!1,x=0,y=[0,0,0,0,0,0,0];for(let p=0;p<this.size;p++)this.modules[h][p]==v?(x++,x==5?l+=s.PENALTY_N1:x>5&&l++):(this.finderPenaltyAddHistory(x,y),v||(l+=this.finderPenaltyCountPatterns(y)*s.PENALTY_N3),v=this.modules[h][p],x=1);l+=this.finderPenaltyTerminateAndCount(v,x,y)*s.PENALTY_N3}for(let h=0;h<this.size;h++){let v=!1,x=0,y=[0,0,0,0,0,0,0];for(let p=0;p<this.size;p++)this.modules[p][h]==v?(x++,x==5?l+=s.PENALTY_N1:x>5&&l++):(this.finderPenaltyAddHistory(x,y),v||(l+=this.finderPenaltyCountPatterns(y)*s.PENALTY_N3),v=this.modules[p][h],x=1);l+=this.finderPenaltyTerminateAndCount(v,x,y)*s.PENALTY_N3}for(let h=0;h<this.size-1;h++)for(let v=0;v<this.size-1;v++){const x=this.modules[h][v];x==this.modules[h][v+1]&&x==this.modules[h+1][v]&&x==this.modules[h+1][v+1]&&(l+=s.PENALTY_N2)}let i=0;for(const h of this.modules)i=h.reduce((v,x)=>v+(x?1:0),i);const c=this.size*this.size,m=Math.ceil(Math.abs(i*20-c*10)/c)-1;return o(0<=m&&m<=9),l+=m*s.PENALTY_N4,o(0<=l&&l<=2568888),l}getAlignmentPatternPositions(){if(this.version==1)return[];{const l=Math.floor(this.version/7)+2,i=this.version==32?26:Math.ceil((this.version*4+4)/(l*2-2))*2;let c=[6];for(let m=this.size-7;c.length<l;m-=i)c.splice(1,0,m);return c}}static getNumRawDataModules(l){if(l<s.MIN_VERSION||l>s.MAX_VERSION)throw new RangeError("Version number out of range");let i=(16*l+128)*l+64;if(l>=2){const c=Math.floor(l/7)+2;i-=(25*c-10)*c-55,l>=7&&(i-=36)}return o(208<=i&&i<=29648),i}static getNumDataCodewords(l,i){return Math.floor(s.getNumRawDataModules(l)/8)-s.ECC_CODEWORDS_PER_BLOCK[i.ordinal][l]*s.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][l]}static reedSolomonComputeDivisor(l){if(l<1||l>255)throw new RangeError("Degree out of range");let i=[];for(let m=0;m<l-1;m++)i.push(0);i.push(1);let c=1;for(let m=0;m<l;m++){for(let h=0;h<i.length;h++)i[h]=s.reedSolomonMultiply(i[h],c),h+1<i.length&&(i[h]^=i[h+1]);c=s.reedSolomonMultiply(c,2)}return i}static reedSolomonComputeRemainder(l,i){let c=i.map(m=>0);for(const m of l){const h=m^c.shift();c.push(0),i.forEach((v,x)=>c[x]^=s.reedSolomonMultiply(v,h))}return c}static reedSolomonMultiply(l,i){if(l>>>8||i>>>8)throw new RangeError("Byte out of range");let c=0;for(let m=7;m>=0;m--)c=c<<1^(c>>>7)*285,c^=(i>>>m&1)*l;return o(c>>>8==0),c}finderPenaltyCountPatterns(l){const i=l[1];o(i<=this.size*3);const c=i>0&&l[2]==i&&l[3]==i*3&&l[4]==i&&l[5]==i;return(c&&l[0]>=i*4&&l[6]>=i?1:0)+(c&&l[6]>=i*4&&l[0]>=i?1:0)}finderPenaltyTerminateAndCount(l,i,c){return l&&(this.finderPenaltyAddHistory(i,c),i=0),i+=this.size,this.finderPenaltyAddHistory(i,c),this.finderPenaltyCountPatterns(c)}finderPenaltyAddHistory(l,i){i[0]==0&&(l+=this.size),i.pop(),i.unshift(l)}};let n=s;n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=n;function r(l,i,c){if(i<0||i>31||l>>>i)throw new RangeError("Value out of range");for(let m=i-1;m>=0;m--)c.push(l>>>m&1)}function a(l,i){return(l>>>i&1)!=0}function o(l){if(!l)throw new Error("Assertion error")}const d=class{constructor(l,i,c){if(this.mode=l,this.numChars=i,this.bitData=c,i<0)throw new RangeError("Invalid argument");this.bitData=c.slice()}static makeBytes(l){let i=[];for(const c of l)r(c,8,i);return new d(d.Mode.BYTE,l.length,i)}static makeNumeric(l){if(!d.isNumeric(l))throw new RangeError("String contains non-numeric characters");let i=[];for(let c=0;c<l.length;){const m=Math.min(l.length-c,3);r(parseInt(l.substr(c,m),10),m*3+1,i),c+=m}return new d(d.Mode.NUMERIC,l.length,i)}static makeAlphanumeric(l){if(!d.isAlphanumeric(l))throw new RangeError("String contains unencodable characters in alphanumeric mode");let i=[],c;for(c=0;c+2<=l.length;c+=2){let m=d.ALPHANUMERIC_CHARSET.indexOf(l.charAt(c))*45;m+=d.ALPHANUMERIC_CHARSET.indexOf(l.charAt(c+1)),r(m,11,i)}return c<l.length&&r(d.ALPHANUMERIC_CHARSET.indexOf(l.charAt(c)),6,i),new d(d.Mode.ALPHANUMERIC,l.length,i)}static makeSegments(l){return l==""?[]:d.isNumeric(l)?[d.makeNumeric(l)]:d.isAlphanumeric(l)?[d.makeAlphanumeric(l)]:[d.makeBytes(d.toUtf8ByteArray(l))]}static makeEci(l){let i=[];if(l<0)throw new RangeError("ECI assignment value out of range");if(l<128)r(l,8,i);else if(l<16384)r(2,2,i),r(l,14,i);else if(l<1e6)r(6,3,i),r(l,21,i);else throw new RangeError("ECI assignment value out of range");return new d(d.Mode.ECI,0,i)}static isNumeric(l){return d.NUMERIC_REGEX.test(l)}static isAlphanumeric(l){return d.ALPHANUMERIC_REGEX.test(l)}getData(){return this.bitData.slice()}static getTotalBits(l,i){let c=0;for(const m of l){const h=m.mode.numCharCountBits(i);if(m.numChars>=1<<h)return 1/0;c+=4+h+m.bitData.length}return c}static toUtf8ByteArray(l){l=encodeURI(l);let i=[];for(let c=0;c<l.length;c++)l.charAt(c)!="%"?i.push(l.charCodeAt(c)):(i.push(parseInt(l.substr(c+1,2),16)),c+=2);return i}};let u=d;u.NUMERIC_REGEX=/^[0-9]*$/,u.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,u.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",t.QrSegment=u})(ze||(ze={}));(t=>{(s=>{const n=class{constructor(a,o){this.ordinal=a,this.formatBits=o}};let r=n;r.LOW=new n(0,1),r.MEDIUM=new n(1,0),r.QUARTILE=new n(2,3),r.HIGH=new n(3,2),s.Ecc=r})(t.QrCode||(t.QrCode={}))})(ze||(ze={}));(t=>{(s=>{const n=class{constructor(a,o){this.modeBits=a,this.numBitsCharCount=o}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};let r=n;r.NUMERIC=new n(1,[10,12,14]),r.ALPHANUMERIC=new n(2,[9,11,13]),r.BYTE=new n(4,[8,16,16]),r.KANJI=new n(8,[8,10,12]),r.ECI=new n(7,[0,0,0]),s.Mode=r})(t.QrSegment||(t.QrSegment={}))})(ze||(ze={}));var at=ze;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var si={L:at.QrCode.Ecc.LOW,M:at.QrCode.Ecc.MEDIUM,Q:at.QrCode.Ecc.QUARTILE,H:at.QrCode.Ecc.HIGH},ri=128,ni="L",ai="#FFFFFF",ii="#000000",oi=!1,Cr=4,li=.1;function ci(t,s=0){const n=[];return t.forEach(function(r,a){let o=null;r.forEach(function(d,u){if(!d&&o!==null){n.push(`M${o+s} ${a+s}h${u-o}v1H${o+s}z`),o=null;return}if(u===r.length-1){if(!d)return;o===null?n.push(`M${u+s},${a+s} h1v1H${u+s}z`):n.push(`M${o+s},${a+s} h${u+1-o}v1H${o+s}z`);return}d&&o===null&&(o=u)})}),n.join("")}function di(t,s){return t.slice().map((n,r)=>r<s.y||r>=s.y+s.h?n:n.map((a,o)=>o<s.x||o>=s.x+s.w?a:!1))}function mi(t,s,n,r){if(r==null)return null;const a=n?Cr:0,o=t.length+a*2,d=Math.floor(s*li),u=o/s,l=(r.width||d)*u,i=(r.height||d)*u,c=r.x==null?t.length/2-l/2:r.x*u,m=r.y==null?t.length/2-i/2:r.y*u;let h=null;if(r.excavate){let v=Math.floor(c),x=Math.floor(m),y=Math.ceil(l+c-v),p=Math.ceil(i+m-x);h={x:v,y:x,w:y,h:p}}return{x:c,y:m,h:i,w:l,excavation:h}}(function(){try{new Path2D().addPath(new Path2D)}catch(t){return!1}return!0})();function _r(t){const s=t,{value:n,size:r=ri,level:a=ni,bgColor:o=ai,fgColor:d=ii,includeMargin:u=oi,imageSettings:l}=s,i=ti(s,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let c=at.QrCode.encodeText(n,si[a]).getModules();const m=u?Cr:0,h=c.length+m*2,v=mi(c,r,u,l);let x=null;l!=null&&v!=null&&(v.excavation!=null&&(c=di(c,v.excavation)),x=nt.createElement("image",{xlinkHref:l.src,height:v.h,width:v.w,x:v.x+m,y:v.y+m,preserveAspectRatio:"none"}));const y=ci(c,m);return nt.createElement("svg",ei({height:r,width:r,viewBox:`0 0 ${h} ${h}`},i),nt.createElement("path",{fill:o,d:`M0,0 h${h}v${h}H0z`,shapeRendering:"crispEdges"}),nt.createElement("path",{fill:d,d:y,shapeRendering:"crispEdges"}),x)}function Ws(){var le,he;const{user:t}=He(),n=(le=Xt().state)==null?void 0:le.forced,[r,a]=f.useState(""),[o,d]=f.useState(""),[u,l]=f.useState(""),[i,c]=f.useState(!1),[m,h]=f.useState(!1),[v,x]=f.useState(!1),[y,p]=f.useState(null),[j,R]=f.useState(!1),[N,C]=f.useState(!1),[D,k]=f.useState(!1),[Y,se]=f.useState(null),[F,B]=f.useState(""),[I,T]=f.useState(null),[W,P]=f.useState(!1),[L,w]=f.useState(null),[_,E]=f.useState(null);f.useEffect(()=>{t&&C(t.mfa_enabled||!1)},[t]);const U=(H=>{if(!H)return{score:0,label:"",color:""};let X=0;return H.length>=8&&X++,H.length>=12&&X++,/[a-z]/.test(H)&&/[A-Z]/.test(H)&&X++,/\d/.test(H)&&X++,/[^a-zA-Z0-9]/.test(H)&&X++,X<=2?{score:X,label:"Weak",color:"bg-semantic-error"}:X===3?{score:X,label:"Fair",color:"bg-semantic-warning"}:X===4?{score:X,label:"Good",color:"bg-semantic-info"}:{score:X,label:"Strong",color:"bg-semantic-success"}})(o),S=H=>Q(this,null,function*(){var X,re;if(H.preventDefault(),p(null),o!==u){p({type:"error",text:"New passwords do not match"});return}if(o.length<8){p({type:"error",text:"Password must be at least 8 characters"});return}R(!0);try{yield J.post("/auth/change-password",{current_password:r,new_password:o}),p({type:"success",text:"Password changed successfully"}),a(""),d(""),l("")}catch(Me){p({type:"error",text:((re=(X=Me==null?void 0:Me.response)==null?void 0:X.data)==null?void 0:re.detail)||"Failed to change password"})}finally{R(!1)}}),q=()=>Q(this,null,function*(){var H,X;P(!0),w(null);try{const re=yield J.post("/auth/mfa/enroll");se(re.data),T(null),B(""),k(!0)}catch(re){w({type:"error",text:((X=(H=re==null?void 0:re.response)==null?void 0:H.data)==null?void 0:X.detail)||"Failed to start MFA enrollment"})}finally{P(!1)}}),V=()=>Q(this,null,function*(){var H,X;P(!0),w(null);try{const re=yield J.post("/auth/mfa/verify",{code:F});T(re.data.recovery_codes),C(!0),w({type:"success",text:"MFA enabled successfully! Save your recovery codes."})}catch(re){w({type:"error",text:((X=(H=re==null?void 0:re.response)==null?void 0:H.data)==null?void 0:X.detail)||"Invalid MFA code"})}finally{P(!1)}}),$=()=>Q(this,null,function*(){var H,X;P(!0),w(null);try{yield J.post("/auth/mfa/disable"),C(!1),w({type:"success",text:"MFA disabled successfully"})}catch(re){w({type:"error",text:((X=(H=re==null?void 0:re.response)==null?void 0:H.data)==null?void 0:X.detail)||"Failed to disable MFA"})}finally{P(!1)}}),G=()=>Q(this,null,function*(){var H,X;P(!0),w(null);try{const re=yield J.post("/auth/mfa/recovery/regenerate");T(re.data.recovery_codes),w({type:"success",text:"Recovery codes regenerated! Save them securely."})}catch(re){w({type:"error",text:((X=(H=re==null?void 0:re.response)==null?void 0:H.data)==null?void 0:X.detail)||"Failed to regenerate recovery codes"})}finally{P(!1)}}),M=()=>{if(!I)return;const H=I.join(`
`);navigator.clipboard.writeText(H).then(()=>{w({type:"success",text:"Recovery codes copied to clipboard"})})},te=()=>{k(!1),se(null),B(""),T(null),w(null)};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"Profile & Settings"}),e.jsxs("div",{className:"px-10 py-6 max-w-2xl",children:[n&&e.jsx("div",{className:"mb-6 rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"h-5 w-5 text-semantic-warning flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-semantic-warning",children:"Password change required"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"For security reasons, you must change your password before continuing."})]})]})}),e.jsxs(ie,{className:"mb-6",children:[e.jsx(de,{children:e.jsx(me,{children:"User Information"})}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Name"}),e.jsx("div",{className:"text-sm text-text-primary",children:t==null?void 0:t.full_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Email"}),e.jsx("div",{className:"text-sm text-text-primary",children:t==null?void 0:t.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Role"}),e.jsx("div",{className:"text-sm text-text-primary capitalize",children:(he=t==null?void 0:t.role)==null?void 0:he.replace("_"," ")})]}),(t==null?void 0:t.created_at)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Account Created"}),e.jsx("div",{className:"text-sm text-text-secondary",children:z(t.created_at).format("MMMM D, YYYY [at] h:mm A")})]}),(t==null?void 0:t.last_login)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary mb-1",children:"Last Login"}),e.jsx("div",{className:"text-sm text-text-secondary",children:z(t.last_login).format("MMMM D, YYYY [at] h:mm A")})]})]})})]}),e.jsxs(ie,{className:"mb-6",children:[e.jsx(de,{children:e.jsx(me,{children:"Multi-Factor Authentication"})}),e.jsxs(ce,{children:[L&&e.jsx("div",{className:`mt-4 rounded-lg border p-3 text-sm ${L.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:L.text}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-text-primary",children:"MFA Status"}),e.jsx("div",{className:"text-xs text-text-secondary mt-1",children:N?"Your account is protected with MFA":"Add an extra layer of security"})]}),e.jsx("div",{className:`inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium ${N?"bg-semantic-success/10 text-semantic-success":"bg-gray-100 text-text-muted"}`,children:N?" Enabled":"Disabled"})]}),I&&e.jsxs("div",{className:"rounded-lg border border-border bg-app p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary",children:"Your Recovery Codes"}),e.jsx("button",{onClick:M,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:I.map(H=>e.jsx("code",{className:"text-xs bg-surface p-2 rounded border border-border font-mono",children:H},H))}),e.jsx("p",{className:"text-xs text-text-muted",children:" Save these codes in a secure location. Each code can only be used once."})]}),e.jsx("div",{className:"flex gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"secondary",onClick:()=>E("regen_recovery"),disabled:W,children:W?"Regenerating...":"Regenerate Recovery Codes"}),e.jsx(O,{variant:"secondary",onClick:()=>E("disable_mfa"),disabled:W,children:W?"Disabling...":"Disable MFA"})]}):e.jsx(O,{variant:"primary",onClick:q,disabled:W,children:W?"Setting up...":"Enable MFA"})})]})]})]}),e.jsxs(ie,{children:[e.jsx(de,{children:e.jsx(me,{children:"Change Password"})}),e.jsxs(ce,{children:[y&&e.jsx("div",{className:`mt-4 rounded-lg border p-3 text-sm ${y.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:y.text}),e.jsxs("form",{onSubmit:S,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{type:i?"text":"password",value:r,onChange:H=>a(H.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>c(!i),"aria-label":i?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:i?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{type:m?"text":"password",value:o,onChange:H=>d(H.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!m),"aria-label":m?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:m?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),o&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-app rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${U.color} transition-all duration-300`,style:{width:`${U.score/5*100}%`}})}),e.jsx("span",{className:"text-xs font-medium text-text-secondary",children:U.label})]}),e.jsxs("ul",{className:"text-xs text-text-muted space-y-0.5",children:[e.jsxs("li",{className:o.length>=8?"text-semantic-success":"",children:[o.length>=8?"":""," At least 8 characters"]}),e.jsxs("li",{className:/[a-z]/.test(o)&&/[A-Z]/.test(o)?"text-semantic-success":"",children:[/[a-z]/.test(o)&&/[A-Z]/.test(o)?"":""," Mixed case letters"]}),e.jsxs("li",{className:/\d/.test(o)?"text-semantic-success":"",children:[/\d/.test(o)?"":""," At least one number"]}),e.jsxs("li",{className:/[^a-zA-Z0-9]/.test(o)?"text-semantic-success":"",children:[/[^a-zA-Z0-9]/.test(o)?"":""," Special character (!@#$%, etc.)"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{type:v?"text":"password",value:u,onChange:H=>l(H.target.value),required:!0}),e.jsx("button",{type:"button",onClick:()=>x(!v),"aria-label":v?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:v?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),u&&o!==u&&e.jsx("p",{className:"text-xs text-semantic-error",children:"Passwords do not match"})]}),e.jsx(O,{type:"submit",variant:"primary",disabled:j,children:j?"Changing...":"Change Password"})]})]})]}),e.jsxs(fe,{open:D,onClose:te,children:[e.jsx(pe,{onClose:te,children:"Set up Multi-Factor Authentication"}),e.jsx(be,{children:e.jsx("div",{className:"space-y-4",children:Y&&!I?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx("div",{className:"flex justify-center p-4 bg-app rounded-lg",children:e.jsx(_r,{value:Y.otpauth_url,size:200})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-1",children:"Manual entry secret"}),e.jsx("code",{className:"block text-xs bg-app p-2 rounded border border-border font-mono break-all",children:Y.secret})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Enter the 6-digit code from your app"}),e.jsx(ne,{type:"text",autoFocus:!0,value:F,onChange:H=>B(H.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"123456",maxLength:6})]}),L&&e.jsx("div",{className:`rounded-lg border p-3 text-sm ${L.type==="success"?"border-semantic-success/30 bg-semantic-success/5 text-semantic-success":"border-semantic-error/30 bg-semantic-error/5 text-semantic-error"}`,children:L.text})]}):I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg border border-semantic-success/30 bg-semantic-success/5 p-3 text-sm text-semantic-success",children:" MFA enabled successfully!"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary",children:"Recovery Codes"}),e.jsx("button",{onClick:M,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:I.map(H=>e.jsx("code",{className:"text-xs bg-app p-2 rounded border border-border font-mono",children:H},H))}),e.jsx("p",{className:"text-xs text-text-muted",children:" Save these codes in a secure location. Each code can only be used once if you lose access to your authenticator app."})]})]}):e.jsx("p",{className:"text-sm text-text-muted",children:"Preparing MFA enrollment..."})})}),e.jsx(ge,{children:I?e.jsx(O,{variant:"primary",onClick:te,children:"Done"}):e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:"secondary",onClick:te,children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:V,disabled:F.length!==6||W,children:W?"Verifying...":"Verify & Enable"})]})})]}),e.jsxs(fe,{open:_!==null,onClose:()=>E(null),children:[e.jsx(pe,{onClose:()=>E(null),children:_==="disable_mfa"?"Disable MFA":"Regenerate Recovery Codes"}),e.jsx(be,{children:_==="disable_mfa"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Disabling MFA will make your account less secure. You will be able to re-enable MFA later."}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"This action reduces account security."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Regenerating recovery codes will invalidate your existing recovery codes."}),e.jsx("div",{className:"rounded-lg border border-semantic-warning/30 bg-semantic-warning/5 p-3 text-sm text-semantic-warning",children:"Any previously issued recovery codes will stop working."})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:()=>E(null),disabled:W,children:"Cancel"}),e.jsx(O,{variant:"primary",onClick:()=>Q(this,null,function*(){const H=_;E(null),H==="disable_mfa"&&(yield $()),H==="regen_recovery"&&(yield G())}),disabled:W,children:"Confirm"})]})]})]})]})}function ui(){const{token:t,role:s,name:n,login:r,logout:a,mustChangePassword:o,ready:d}=He(),[u,l]=f.useState(""),[i,c]=f.useState(""),[m,h]=f.useState(!1),[v,x]=f.useState(!1),[y,p]=f.useState(""),[j,R]=f.useState(""),[N,C]=f.useState(null),[D,k]=f.useState(!1),[Y,se]=f.useState(!1),[F,B]=f.useState(null),[I,T]=f.useState(null),[W,P]=f.useState(0),[L,w]=f.useState(!1),_=Ke(),E=Xt();f.useEffect(()=>{d&&(t||E.pathname!=="/"&&_("/",{replace:!0}))},[d,t,E.pathname,_]),f.useEffect(()=>{t&&o&&E.pathname!=="/profile"&&_("/profile",{replace:!0,state:{forced:!0}})},[t,o,E.pathname,_]);const A=()=>Q(this,null,function*(){var $,G;C(null),x(!0);try{const M=yield r(u,i,D?y:void 0,D?j:void 0);k(!1),p(""),R(""),M!=null&&M.mfa_enrollment_required?(P(M.mfa_remaining_skips||0),yield U()):_("/")}catch(M){const te=(G=($=M==null?void 0:M.response)==null?void 0:$.data)==null?void 0:G.detail;te==="MFA code required"||(te==null?void 0:te.code)==="mfa_required"?(k(!0),C("Enter your 6-digit MFA code or a recovery code.")):C(te==="Invalid recovery code"||te==="Invalid MFA code"||te==="Invalid code"?"Invalid code. Please try again.":"Login failed. Check your credentials.")}finally{x(!1)}}),U=()=>Q(this,null,function*(){var $,G;try{const M=yield J.post("/auth/mfa/enroll");B(M.data),T(null),se(!0)}catch(M){C(((G=($=M==null?void 0:M.response)==null?void 0:$.data)==null?void 0:G.detail)||"Could not start MFA enrollment")}}),S=()=>Q(this,null,function*(){var $,G;w(!0);try{const M=yield J.post("/auth/mfa/verify",{code:y});T(M.data.recovery_codes),se(!1),p(""),P(0),_("/")}catch(M){C(((G=($=M==null?void 0:M.response)==null?void 0:$.data)==null?void 0:G.detail)||"Invalid code")}finally{w(!1)}}),q=()=>Q(this,null,function*(){var $,G;try{const M=yield J.post("/auth/mfa/skip");P(M.data.remaining_skips),se(!1),B(null)}catch(M){C(((G=($=M==null?void 0:M.response)==null?void 0:$.data)==null?void 0:G.detail)||"Cannot skip MFA")}}),V=()=>{if(!I)return;const $=I.join(`
`);navigator.clipboard.writeText($).then(()=>{alert("Recovery codes copied to clipboard")})};return t?e.jsx(Ua,{children:e.jsxs(nn,{children:[e.jsx(Fe,{path:"/",element:e.jsx(Ya,{})}),e.jsx(Fe,{path:"/tasks",element:e.jsx(Qa,{})}),e.jsx(Fe,{path:"/complaints",element:e.jsx(Wa,{})}),e.jsx(Fe,{path:"/create",element:e.jsx(Va,{})}),e.jsx(Fe,{path:"/complaints/:id",element:e.jsx(qa,{})}),e.jsx(Fe,{path:"/profile",element:e.jsx(Ws,{})}),e.jsx(Fe,{path:"/users",element:e.jsx(Xa,{})}),e.jsx(Fe,{path:"/reference",element:e.jsx(Ga,{})}),e.jsx(Fe,{path:"/settings",element:e.jsx(Ws,{})})]})}):e.jsxs("div",{className:"min-h-screen bg-app flex items-center justify-center p-4",children:[e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"rounded-card border border-border bg-surface shadow-card p-8",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold text-text-primary mb-2",children:"Sign in to Compass"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Use your credentials to access the complaints workspace"})]}),N&&e.jsx("div",{className:"mb-4 rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:N}),e.jsxs("form",{onSubmit:$=>{$.preventDefault(),A()},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Email"}),e.jsx(ne,{type:"email",value:u,onChange:$=>l($.target.value),placeholder:"you@example.com",autoComplete:"email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{type:m?"text":"password",value:i,onChange:$=>c($.target.value),placeholder:"",autoComplete:"current-password",required:!0}),e.jsx("button",{type:"button",onClick:()=>h(!m),"aria-label":m?"Hide password":"Show password",className:"absolute right-3 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-primary transition",children:m?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.75,children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"MFA Code (6 digits)"}),e.jsx(ne,{type:"text",autoFocus:!0,value:y,onChange:$=>p($.target.value),placeholder:"123456",maxLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Recovery Code (optional)"}),e.jsx(ne,{type:"text",value:j,onChange:$=>R($.target.value),placeholder:"recovery-code"})]})]}),e.jsx(O,{type:"submit",variant:"primary",className:"w-full mt-6",disabled:v,children:v?"Signing in...":"Sign in"})]})]})}),e.jsxs(fe,{open:Y,onClose:W>0?()=>{se(!1),C(null)}:()=>{},children:[e.jsx(pe,{onClose:W>0?()=>{se(!1),C(null)}:void 0,children:"Set up Multi-Factor Authentication"}),e.jsx(be,{children:e.jsxs("div",{className:"space-y-4",children:[W<=0?e.jsx("div",{className:"rounded-lg border border-semantic-error/30 bg-semantic-error/5 p-3 text-sm text-semantic-error",children:"You must enable MFA to continue."}):e.jsxs("p",{className:"text-sm text-text-secondary",children:["We recommend enabling MFA for enhanced security. You can skip up to ",W," more time(s)."]}),F?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-2",children:"Scan with your authenticator app"}),e.jsx("div",{className:"flex justify-center p-4 bg-app rounded-lg",children:e.jsx(_r,{value:F.otpauth_url,size:180})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-text-primary mb-1",children:"Manual entry secret"}),e.jsx("code",{className:"block text-xs bg-app p-2 rounded border border-border font-mono",children:F.secret})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium text-text-primary",children:"Enter 6-digit code"}),e.jsx(ne,{type:"text",autoFocus:!0,value:y,onChange:$=>p($.target.value),placeholder:"123456",maxLength:6})]}),I&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary",children:"Recovery codes (store securely)"}),e.jsx("button",{onClick:V,className:"text-xs text-brand hover:text-brand-dark font-medium",children:"Copy All"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:I.map($=>e.jsx("code",{className:"text-xs bg-app p-2 rounded border border-border font-mono",children:$},$))}),e.jsx("p",{className:"text-xs text-text-muted mt-2",children:"Save these codes in a secure location. They can be used to access your account if you lose your authenticator device."})]})]}):e.jsx("p",{className:"text-sm text-text-muted",children:"Preparing enrollment..."})]})}),e.jsxs(ge,{children:[e.jsx(O,{variant:"secondary",onClick:q,disabled:W<=0,children:"Skip for now"}),e.jsx(O,{variant:"primary",onClick:S,disabled:!y||y.length<6||L,children:L?"Verifying...":"Verify & Enable"})]})]})]})}qt.createRoot(document.getElementById("root")).render(e.jsx(nt.StrictMode,{children:e.jsx(an,{children:e.jsx(Ia,{children:e.jsx(ui,{})})})}))});export default xi();
